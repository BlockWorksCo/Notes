BackOffice VPN:
SteveTickle
garment seize optimism allow
b67bc45987c51f40f43606839cfd757b

"sudo openvpn --config ~/.vpn/SteveTickle.ovpn"
sudo openvpn --config ~/.vpn/SteveTickle.ovpn --auth-user-pass "garment seize optimism allow"


Cyanconnode-1__________
<Client>

<WPA & WPA2 Personal>
W6&v$8?6d!p3___________


CC-Guest:
welcometocyan


stickle@omnireltest1.dev.cyanconnode.com


VPN:
garment seize optimism allow
b67bc45987c51f40f43606839cfd757b

GitLab:
git clone https://gitlab.cyco.io/CyLecNode/cylec_node.git
SteveTickle
garment seize optimism allow

JIRA
stickle
b$1488#8OFX3

Slack
cyanconnode.slack.com
steve.tickle@cyantechnology.com
Cy4nST$239

https://artifactory.cyco.io
SteveTickle
garment seize optimism allow

vm:
username:ubuntu
pw:ubuntu

email:
steve.tickle@cyanconnode.com
Cy4nST$239

Windows:
Cy4nST$239

Linux
cy4nst$239


cylec_node:


Connode:
(gerrit.se.cyco.io)
stevetickle
Homeowner2#


https://jira.se.cyco.io
changeme


https://confluence.se.cyco.io/dologin.action


new email:
Steve.Tickle@cyanconnode.com
Homeowner6#

Laptop:
Ubuntu11#

mysql root user ubuntu


https://diskstation.se.cyco.io:5001/
diskstation.se.cyco.io
admin
Response1

ryanair.com
travel@cyanconnode.com
Cy4ntravel

ssh stickle@lnt-dev2.dev.cyanconnode.com


Windows Network
stevetickle
Homeowner10#


Username:         SteveTickle
Password:           mango surfeit balance yellow
Server:                 gw.cyantechnology.com:4433
Domain:               CyanTechnology               ( case sensitive – no space )


Instagram
2586 7014
9407 3812
9532 1670
6327 9184
0126 4893


----------------------------------------------------------


Another way to squash all your commits is to reset the index to master:

 git checkout yourBranch
 git reset $(git merge-base master yourBranch)
 git add -A
 git commit -m "one commit on yourBranch"


-----------------------------------------------------------

PVVNL


 * @subsection main_subsection_core Core Radio Modules
 * - @ref transport
 * - @ref collector
 * - @ref netmon
 *
 * @subsection main_subsection_system System-Wide Routines
 * - @ref system
 * - @ref preferences
 *
 * @subsection main_subsection_serial Serial Interface
 * - @ref command
 * - @ref meter
 *
 * @subsection main_subsection_utils Utility Modules
 * - @ref clock
 * - @ref security
 * - @ref otxu
 * - @ref dio
 * - @ref tamper
 * - @ref frame
 * - @ref led
 * - @ref sleep
 * - @ref debug
 *
 * @subsection main_subsection_lib CyLec Library
 * - @ref cylec
 * - @ref crc
 * - @ref xxtea
 * - @ref network_common
 * - @ref preferences_common
 * - @ref version


------------------------------------------------


PR_READ         - abstraction to allow reading from file/flash/etc.


consistent overhead byte stuffing (COBS). Why in HAL?


----------------------

EVENT_mount_sdcard_partition_table_size_mismatch_warning_WARNING

GPT_store() -> while(1) appropriate?


-----------------------------------------

Command.c
#define COMMAND_HANDLER_METER_DATA_STORE_SIZE (100l * 1024l * 1024l)

Look at .tpl files for protocol 0x80 at the load survey
request/response PDUs.

determine total for 45 days (dates in .json).

multiply by expected number of meters.


From LSS1.tpl:
- grep 7e LSS1.hex
LSS1.hex = 19904
therefore LSS1.bin would be 19904/2 = 9952 bytes
LSS1 is 3 days worth of data:


2016-09-22T00:00:00-00:00 ->
2016-09-24T00:00:00-00:00 ->
2016-09-27T19:19:41-00:00 ->

over 45 request/response pairs.

-----------------------------------------

DCU
callback
dlms
hdlc
meter_emulator
protocol_xxxx
protocol


- generally wrapped messages are passed up but
for some requests that need iteration over the meter
side to form a single HES message, the dates need
to be extracted (e.g. logs).


---------------------------------------------

CyLec DCU v2 (Hwicce)


The DCUv2 has a python emulator called the python DCU.
It can be used to debug or reproduce problems and usually with DCUTool.
(I can't find the latest archive so if someone can add a link here it would be great)

When you build hwicce, you can run:

./dist/run_elecmeterdcu2 --sim --cylec_sim --gprs_tcpip --default_config=dcu_default_config.txt --sdcard_file=sdcard.raw --trace_cylec cylec.log --serial_number 2118245 --rky1 1b79c0ba24525a3fae008daff981a2e1

[uncompress sdcard-128.raw.xz and change path accordingly]

NOTE: there is a config_default.txt in hwicce as well.
The files attached have some of my settings.

------------------------------------
Q1) CYLEC_MAX_DATA_SIZE == 128 bytes but tx/rx buffers are 256 bytes each.
Q2) meter_command_protocol.c:630 arbitrary 128 byte buffer on stack.
Q3) cmode?/protobuf mode. cylec-frame-mode?
Q4) back end == head end??
Q5) datacol == data collector? IS/LS data.
Q6) DINE == Digital INput Events?
Q7) command_link.c:364 arbitrary 128 byte buffer on stack.
Q8) text/binary mode unnecessary... text mode for demo only? why is it in the product? complex state-machine.
Q9) lots of message buffers around, static and on stack.


meat of the DCU:
-           COMMAND_process(sdcard_fs_ready);
-           METERCOMMS_process(sdcard_fs_ready);


COMMAND_process:
- COMMAND_HANDLER_process
- COMMAND_LINK_process
- CABLE_process
- GPRS_process

METERCOMMS_process:
- CYLEC_process
- METERCOMMS_loadsurvey_schedule_process
- METERCOMMS_instantaneous_schedule_process
- METER_COMMAND_idle
- METERCOMMS_dine_run
- METERCOMMS_run_backend
- METERCOMMS_loadsurvey_schedule_next
- METERCOMMS_instantaneous_schedule_next
- METER_COMMAND_completed
- METERCOMMS_datacol_finish
- METERCOMMS_do_completed_actions


CYLEC_process:
if anything ready to transmit....
- CYLEC_PROTO_process
- CYLEC_LOCK_process_task
- METERCOMMS_dine_process_task
- CYLEC_CHANNEL_process_task()
- PASSTHROUGH_process_task
- METER_COMMAND_process_task
- CYLEC_PROTO_tx_frame


-------------------------------

CyLec_Msg       : Formation and parsing of frames.
CyLec_Proto     : transmission of frames
UART            : pipe to RF module (?)
CyLec:          : Top level state machine for transmission of messages.
CyLec_Channel   : Channel management state machine.

Meter_Command   :
Meter_Command_Protoocol : top-level message handling switch for meter-targeted messages.
Meter_Command_DINE      : Process a DINE message (simple state machine).

MeterComms_DINE : Manage a FIFO of DINE events.


command_meter_data_list                     : 100MB FIFO, data to backend, from
command_command_list                        : 1MB FIFO, commands from backend,
command_response_list                       : 1MB FIFO, commands to backend
command_passthough_frames_to_backend_fifo   : 1MB FIFO,
command_passthough_frames_from_backend_fifo : 1MB FIFO,

command_link_tx_fifo                        : Stores the pb encoded RX DCU_CommunicationUnion post CRC/COBS/framing/etc.
command_link_rx_fifo                        : Stores the pb encoded TX DCU_CommunicationUnion pre CRC/COBS/framing/etc.

METERCOMMS_init

MeterComms.c:
case FROM_BACKEND:
case FROM_DATACOL_LOADSURVEY_SCHEDULE:
case FROM_DATACOL_INSTANTANEOUS_SCHEDULE:
case FROM_DINE:


---------------------------------------------------------------
Last Gasp:
- Tamper/power-fail detect.
   - Another DIN?
   - On trigger, see if meter is alive to distnguish between tamper/powerFail?
- debounce.
- Separate pin is safest to implement from s/w perspective (no need to distinguish between tamper/powerfail)
-


On detect:
- stop all other comms to quieten the channel.
- wait a duration based on the meter number (form of TDMA). Each meter is allocated a transmit 'slot'.
- reduce power-usage until the duration expires, then generate message and transmit.
- The slots need to have a bit of space on either side for 'wiggle room'.
- create event in local event log? do we even have one? is it maintained by the meter?
- define message.


In normal mode:
- If a power-fail event message is received, assume a meter(s) on the network are
experiencing a power-failure and stop transmitting to clear the air (for x seconds).
- Only forward power-fail events if one has been detected (for x seconds).


Security:
- If not careful, it could be used as an exploit.


Implementation:
-


Testing:
- many nodes needed to test impact of many transmissions.
- synchronised power-fail.
- jittered power-fail.


---------------------------------------------------------------

PREFERENCES_BACKOFF_A
PREFERENCES_BACKOFF_B
PREFERENCES_BACKOFF_N
PREFERENCES_DINE3_PAYLOAD




PREFERENCES_ASYNC_JITTER_OFFSET
PREFERENCES_ASYNC_JITTER_MASK
PREFERENCES_ASYNC_JITTER_MAX_TRANSMITS


 203 Memory Configuration
 204
 205 Name             Origin             Length             Attributes
 206 CodeFlash        0x0000000008010000 0x0000000000028000 = 160KB : 0x27ce4
 207 DataFlash        0x0000000000000000 0x0000000000007fe0 = 32KB  :
 208 InfoFlash        0x0000000000007fe0 0x0000000000000020 = 32B   :
 209 TROMFlash        0x0000000020000000 0x0000000000002000 = 8KB   :
 210 BootFlash        0x0000000040000000 0x0000000000002000 = 8KB   :
 211 DataRam          0x0000000000008000 0x0000000000005fc0 = 24KB  :
 212 codelow          0x0000000008000000 0x0000000000010000 = 64KB  :
 213 codehigh         0x0000000008010000 0x0000000000028000 = 160KB :
 214 rodata           0x0000000000000000 0x0000000000007fe0 = 32KB  :
 215 info             0x0000000000007fe0 0x0000000000000020 = 32B   :
 216 trom             0x0000000020000000 0x0000000000002000 = 8KB   :
 217 boot             0x0000000040000000 0x0000000000002000 = 8KB   :
 218 rwdata           0x0000000000008000 0x0000000000005fc0 = 24KB  :
 219 *default*        0x0000000000000000 0xffffffffffffffff =
 220

--------------------------------------------------

Current:
   text    data     bss     dec     hex filename
 189116      32   22146  211294   3395e cylec_node.elf



LD script in : ~/Projects/cygh/cyghlib/config/board/mCOG-RF-1X-SPA1


ca build --buildenv build --cmd 'make clean stamp-build-cylec-node-cyanide'





------------------------------------------------------------------------


To free up space, remove:
PREFERENCES_RELAY0_CONFIGURATION    : R0CF
PREFERENCES_RELAY0_CONTROL          : R0CT
PREFERENCES_TAMPER0_CONFIGURATION   : T0CF
PREFERENCES_TAMPER0_STATE           : T0ST

relay_control.c
tamper_monitor.c


config set NSYC xQZD3GW37dz
config set CYSN 0xabcd

transport_send_udp() generates the event.
look at tamper_process_transition()




------------------------------------------------------------------------

New architecture notes:
- Option 1: Translate DLMS from meter->OMP in node.
- Option 2: Pass-thru DLMS from meter up into node and further.

- Option 2 can potentially mean less code on Node, but is this significant if both options are available in cheapest configuration?
- Option 1 puts more intelligence onto Node. This can be tailored to meter. i.e. Meter-specific builds.
- Option 1 will can be more optimal regarding communications, optimised, proprietary comms will beat DLMS/HDLC forwarding and the multiple round-trips that are currently needed can be
  reduced to one potentially (RAM limitation here?)
- Option 1 means intelligence drops out of DCU, meaning a cheaper DCU potentially.
- Potentially use compressed packets, leading to less congestion and more overhead for larger networks.
- Reduction of on-air traffic means more clear-air for comms and hence more supported Nodes per DCU.


- Possible formats for over the air in Option 1.
binary FlatBuffers <--- looks very good.
OMP
MessagePack
BER
protobuf
BSON
thrift

format comparison:
google.github.io/flatbuffers/flatbuffers_benchmarks.html


--------------------------------------

BAN-41

- defaults for preferences
- cancel tamper id.


-----------------------------------------------------


MDM UI:
- Drill down. chart showing Number of alerts of different types->list of meters in spreadsheet view->individual meter->action.
- use existing logs to form usage model.

------------------------------------

build commands:

cylec_node:
ca build --buildenv build --cmd 'make clean stamp-build-cylec-node-cyanide'
~/Projects/cylec_node$ docker rmi build && ca docker_build --dockerfile Dockerfile.build --tag build:latest


cyghlib:
ca build --buildenv cygh/buildenv_cygh --cmd 'make clean stamp-build-cyghlib-cyanide'
rm stamp-build-cyghlib-cyanide && ca build --buildenv cygh/buildenv_cygh --cmd 'make stamp-build-cyghlib-cyanide'



Command line:
ca build --buildenv build


-----------------------------------------------
udev rules in doc.


 1486  ls /etc/udev/rules.d/
 1487  ls
 1488  cd
 1489  cd Projects/stlink/etc/udev/rules.d/
 1490  ls
 1491  sudo cp * /etc/udev/rules.d
 1492  ls /etc/udev/rules.d/
 1493  sudo udevadm control --reload-rules
 1494  sudo udevadm trigger


--------------------------------------------------



rg.gpio.ef.ip_en    = 0x0001;
rg.gpio.ef.op_en    = 0xfffe;
fd.gpio.ef.op_sel.porte_0   = 1;//enable gpio
while(true)
{
    volatile uint8_t state  = fd.gpio.ef.ip_state.porte_0;
    state++;
}

---------------------------------------

Cylec frame ids for DINE:
- CYLEC_FRAME_ID_DIN_EVENT_EXTENDED
- CYLEC_FRAME_ID_DIN_EVENT

dine states on DCU.
- PROTOCOL_SEND_CANCEL
- PROTOCOL_SEND_WAIT_OK
- PROTOCOL_SEND_ERSC
- PROTOCOL_SEND_WAIT_CONFIGDATA



cygh_uart_main_set_config(CYGH_CONFIG_UART_MAIN_BITS, CYGH_CONFIG_UART_MAIN_STOP_BITS, CYGH_CONFIG_UART_MAIN_PARITY);


---------------------------------------------------


1234
INFO


Welcome to minicom 2.7

OPTIONS: I18n
Compiled on Feb  7 2016, 13:37:27.
Port /dev/ttyUSB1, 09:38:20

Press CTRL-A Z for help on special keys

Meter-Node
# CyLec (v2.9.0.515130044)
# Hardware rev: 0000 00 @00000
# System address (CY3S): 0xE1EC
# Network address (CY3A): 0x0000
# Serial no (CYSN): 0x00000000
# Band (BND1): 865MHz Type Approval
# Channel (CHAN): 0
# Dynamic Thresholds (St1a & St2d): On
# Role (METR): Meter
# OTXU: Off
# Boot address (CYBA): 0xFFFFFFFF
METR: 1



DCU-Node.
# CyLec (v2.9.0.515130044)
# Hardware rev: 0000 00 @00000
# System address (CY3S): 0x0002
# Network address (CY3A): 0x0001
# Serial no (CYSN): 0x00001002
# Band (BND1): 865MHz Type Approval
# Channel (CHAN): 0
# Dynamic Thresholds (St1a & St2d): On
# Role (METR): Concentrator/Handheld
# OTXU: Off
# Boot address (CYBA): 0xFFFFFFFF

-----------------------------------------------------

config get ERSC

1 == active
0 = not active.



PREFERENCES_DINE3_PAYLOAD
PREFERENCES_ASYNC_JITTER_OFFSET
PREFERENCES_ASYNC_JITTER_MASK
PREFERENCES_ASYNC_JITTER_MAX_TRANSMITS


0x60000 in 1/65536 units = 6 seconds. 6 seconds in 1/1024 units = 6*1024=0x1800.
0x7ffff in 1/65536 units = 7 seconds. 7 seocnds in 1/1024 units = 7*1024=0x1c00
0x1fff in 1/1024 units = 7 seconds.


def decode_alarm(meter_protocol_id, octets, metadata):
    """
    decode octets into it's decoded json structure
    """

    #
    # decode the meter-generic messages.
    #
    decoder = MeterCommonAlarmDecoder()
    decoded = decoder.decode_alarm(octets, metadata)
    octets_out = meterproto_json.dumps(decoded)

    if octets_out == None:

        #
        # This wasn't a message common to all meters, so
        # decode the meter-specific messages.
        #
        decoder = get_decoder(meter_protocol_id)
        decoded = decoder.decode_alarm(octets, metadata)
        octets_out = meterproto_json.dumps(decoded)

    return octets_out

------------------------------------------------------------------------

DCUb4

- CM-T43 dev board Compulab.
- Primary bootloader FLASH is SPI0. expose these for boot purposes.
- JTAG, 6xUARTs, SPI0 FLASH, I2C0 (board-info), ADC for monitoring,



------------------------------------------------------------------------


|
ERROR: Task 3520 (/BuildArea/cm-t43-yocto-dev/tisdk/sources/oe-core/meta/recipes-multimedia/gstreamer/gstreamer1.0-plugins-bad_1.2.3.bb, do_unpack) failed with exit code '1'
WARNING: Failed to fetch URL http://releases.linaro.org/13.03/components/toolchain/gcc-linaro/4.7/gcc-linaro-4.7-2013.03.tar.bz2, attempting MIRRORS if available
ERROR: Fetcher failure: Fetch command failed with exit code 8, output:
http://releases.linaro.org/13.03/components/toolchain/gcc-linaro/4.7/gcc-linaro-4.7-2013.03.tar.bz2:
2017-05-25 09:33:17 ERROR 404: NOT FOUND.

ERROR: Function failed: Fetcher failure for URL: 'http://releases.linaro.org/13.03/components/toolchain/gcc-linaro/4.7/gcc-linaro-4.7-2013.03.tar.bz2'. Unable to fetch URL from any source.
ERROR: Logfile of failure stored in: /BuildArea/cm-t43-yocto-dev/tisdk/build/arago-tmp-external-linaro-toolchain/work/cortexa9t2hf-vfp-neon-linux-gnueabi/gcc/linaro-4.7-r2013.03-arago1/temp/log.do_fetch.10728
ERROR: Task 3368 (/BuildArea/cm-t43-yocto-dev/tisdk/sources/meta-arago/meta-arago-distro/recipes-devtools/gcc/gcc_linaro-4.7.bb, do_fetch) failed with exit code '1'



--------------------------------

U-Boot

*
* NAND Device Support
*
Support Denali NAND controller (NAND_DENALI) [N/y/?] (NEW)
Support for Freescale NFC for VF610/MPC5125 (NAND_VF610_NFC) [N/y/?] (NEW)
Support for NAND on PXA3xx and Armada 370/XP/38x (NAND_PXA3XX) [N/y/?] (NEW)
Configure Arasan Nand (NAND_ARASAN) [N/y/?] (NEW)
Support for Zynq Nand controller (NAND_ZYNQ) [N/y/?] (NEW)

*
* Generic NAND options
*
*
* SPI Flash Support
*
Legacy SPI Flash Interface support (SPI_FLASH) [N/y/?] (NEW)


*
* SPI Support
*
Freescale eSPI driver (FSL_ESPI) [N/y/?] (NEW)
Freescale QSPI driver (FSL_QSPI) [N/y/?] (NEW)
TI QSPI driver (TI_QSPI) [N/y/?] (NEW)




------------------------------------------------


BeagleBone:

login: debian
password: temppwd

The IP Address for usb0 is: 192.168.7.2
beaglebone login: debian
Password:
Linux beaglebone 3.8.13-bone79 #1 SMP Tue Oct 13 20:44:55 UTC 2015 armv7l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
debian@beaglebone:~$ ifconfig
eth0      Link encap:Ethernet  HWaddr 04:a3:16:e1:44:07
          inet addr:172.16.32.112  Bcast:172.16.32.255  Mask:255.255.255.0
          inet6 addr: fe80::6a3:16ff:fee1:4407/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2514 errors:0 dropped:7 overruns:0 frame:0
          TX packets:151 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:382899 (373.9 KiB)  TX bytes:23452 (22.9 KiB)
          Interrupt:40

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:32 errors:0 dropped:0 overruns:0 frame:0
          TX packets:32 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:2592 (2.5 KiB)  TX bytes:2592 (2.5 KiB)

usb0      Link encap:Ethernet  HWaddr 04:a3:16:e1:44:00
          inet addr:192.168.7.2  Bcast:192.168.7.3  Mask:255.255.255.252
          inet6 addr: fe80::6a3:16ff:fee1:4400/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

debian@beaglebone:~$


----------------------------------------------------------------------

u-boot (from SD-Card):

setenv bootcmd "load mmc 0:1 0x82000000 /boot/zImage; load mmc 0:1 0x88000000 /boot/am437x-sbc-t43.dtb; bootz 0x82000000 - 0x88000000 "

setenv bootargs "root=/dev/mmcblk0p1 ro console=ttyO0,115200n8 rootwait "
setenv bootargs "root=/dev/mmcblk0p1 ro console=ttyO0,115200n8 rootwait quiet "

device tree is am437x-sbc-t43.dts


Welcome to Cosmos
Cosmos login: root
# blkid
/dev/mmcblk1p2: LABEL="rootfs" UUID="c861bdea-fbfd-420a-bb47-4945d15a9d61"
/dev/mmcblk1p1: LABEL="boot" UUID="1a3e2366-ba6c-456b-bf0b-d3321b66ed44"
/dev/mmcblk0p1: UUID="4e730d6a-3941-42f7-a5be-f5fdaa50a375"
#

bcm7xxx
mdio-bcm-unimac
pxa168_eth
bcmsysport
genet


BeagleBone black boot lines:
load mmc 0:1 0x82000000 /boot/zImage; load mmc 0:1 0x88000000 /boot/am335x-boneblack.dtb; bootz 0x82000000 - 0x88000000
bootargs=root=/dev/mmcblk0p1 ro console=ttyO0,115200n8 rootwait quiet



------------------------------------------------


METERCOMMS_process()
METERCOMMS_run_backend()
EVENT_metercomms_starting_command_from_backend_ERROR(&req->uuid);




METERCOMMS_start_new_command()
EVENT_metercomms_failed_command_unkown_meter_ERROR()
METER_get_by_uuid() failed.


METER_get_by_uuid()
 CONFIG_meter_iterate_start() -> LIST_iterate()
  CONFIG_meter_next() -> LIST_next()
   UUID_equals()


- UUID reported is actualyl correct, therefore the list must be corrupt (or the search thru it).

error triggered by NULL uuid. (in util/nanopb/event.pb.macro.h)
#define EVENT_metercomms_starting_command_from_backend_ERROR(u_metercomms_starting_command_from_backend_uuid) \
  /* type check enum arguments by comparing them to something of the expected type */ \
  if (u_metercomms_starting_command_from_backend_uuid == (const UUID *)0) {} \
  EVENT_metercomms_starting_command_from_backend_log_(MODULE, __LINE__, EventSeverity_ERROR, u_metercomms_starting_command_from_backend_uuid)

&req->uuid must != 0 therefore this will always cause an error.





event_diag_log_id: 79 timestamp: 1496997186 time_since_boot_secs: 163 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: DIN_EVENT_EXTENDED flags: 0 src_addr: 2 dst_addr: 1 payload: "CYLEC_DINE3_LAST_GASP_SENTINEL" } } }


event_diag_log_id: 112 timestamp: 1496997378 time_since_boot_secs: 355 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: DIN_EVENT_EXTENDED flags: 0 src_addr: 2 dst_addr: 1 payload: "CYLEC_DINE3_LAST_GASP_SENTINEL" } } }
event_diag_log_id: 113 event_rec_log_id: 221 timestamp: 1496997378 time_since_boot_secs: 355 module: METERCOMMS_DINE line: 154 severity: WARNING din_event { meter_uuid { uuid_bytes: "9\343e\205\244\206E\332\251r\265\337) !\000" } tamper_data: "CYLEC_DINE3_LAST_GASP_SENTINEL" }
event_diag_log_id: 114 timestamp: 1496997378 time_since_boot_secs: 355 module: CYLEC line: 74 severity: DEBUG cylec { packet_from_dcu { cylec_frame { frame_id: OPEN_CHANNEL flags: 0 src_addr: 1 dst_addr: 2 payload: "" } } }
event_diag_log_id: 115 timestamp: 1496997378 time_since_boot_secs: 355 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: OK flags: 0 src_addr: 2 dst_addr: 1 payload: "" } } }
event_diag_log_id: 116 timestamp: 1496997378 time_since_boot_secs: 355 module: CYLEC line: 74 severity: DEBUG cylec { packet_from_dcu { cylec_frame { frame_id: SET_CONFIG flags: 0 src_addr: 1 dst_addr: 2 payload: "CSRE\000\002\000\000" } } }



<- CyLecFrame(FRAME_EVENT_DATA 0x2->0x1 "CYLEC_DINE3_LAST_GASP_SENTINEL")
-> CyLecFrame(OPEN_CHANNEL 0x1->0x2 "")
<- CyLecFrame(OK 0x2->0x1 "")
-> CyLecFrame(SET_CONFIG 0x1->0x2 "CSRE\x00\x02\x00\x00")
<- CyLecFrame(UNKNOWN_PREF 0x2->0x1 "")
-> CyLecFrame(CLOSE_CHANNEL 0x1->0x2 "")
<- CyLecFrame(OK 0x2->0x1 "")
-> CyLecFrame(OPEN_CHANNEL 0x1->0x2 "")
<- CyLecFrame(OK 0x2->0x1 "")
-> CyLecFrame(SET_CONFIG 0x1->0x2 "CSRE\x00\x02\x00\x00")
<- CyLecFrame(UNKNOWN_PREF 0x2->0x1 "")
-> CyLecFrame(CLOSE_CHANNEL 0x1->0x2 "")
<- CyLecFrame(OK 0x2->0x1 "")


event_diag_log_id: 633 timestamp: 1497007698 time_since_boot_secs: 5631 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: DIN_EVENT_EXTENDED flags: 0 src_addr: 2 dst_addr: 1 payload: "CYLEC_DINE3_LAST_GASP_SENTINEL" } } }
event_diag_log_id: 634 event_rec_log_id: 262 timestamp: 1497007698 time_since_boot_secs: 5631 module: METERCOMMS_DINE line: 154 severity: WARNING din_event { meter_uuid { uuid_bytes: "9\343e\205\244\206E\332\251r\265\337) !\000" } tamper_data: "CYLEC_DINE3_LAST_GASP_SENTINEL" }
event_diag_log_id: 635 timestamp: 1497007698 time_since_boot_secs: 5631 module: CYLEC line: 74 severity: DEBUG cylec { packet_from_dcu { cylec_frame { frame_id: OPEN_CHANNEL flags: 0 src_addr: 1 dst_addr: 2 payload: "" } } }
event_diag_log_id: 636 timestamp: 1497007698 time_since_boot_secs: 5632 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: OK flags: 0 src_addr: 2 dst_addr: 1 payload: "" } } }
event_diag_log_id: 637 timestamp: 1497007698 time_since_boot_secs: 5632 module: CYLEC line: 74 severity: DEBUG cylec { packet_from_dcu { cylec_frame { frame_id: SET_CONFIG flags: 0 src_addr: 1 dst_addr: 2 payload: "CSRE\000\002\000\000" } } }
event_diag_log_id: 638 timestamp: 1497007698 time_since_boot_secs: 5632 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: UNKNOWN_PREF flags: 0 src_addr: 2 dst_addr: 1 payload: "" } } }
event_diag_log_id: 639 timestamp: 1497007698 time_since_boot_secs: 5632 module: CYLEC line: 74 severity: DEBUG cylec { packet_from_dcu { cylec_frame { frame_id: CLOSE_CHANNEL flags: 0 src_addr: 1 dst_addr: 2 payload: "" } } }
event_diag_log_id: 640 timestamp: 1497007698 time_since_boot_secs: 5632 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: OK flags: 0 src_addr: 2 dst_addr: 1 payload: "" } } }


event_diag_log_id: 79 timestamp: 1497009253 time_since_boot_secs: 120 module: MAIN line: 332 severity: DEBUG main_loop_stats { period_in_microseconds: 713 sdcard_peak_writes_in_main_loop: 0 main_loop_peak_us: 22158 }
event_diag_log_id: 80 timestamp: 1497009254 time_since_boot_secs: 120 module: COMMAND_LINK line: 434 severity: DEBUG dcucomms_rx_msg_type { receive_msg: 21 }
event_diag_log_id: 81 timestamp: 1497009254 time_since_boot_secs: 120 module: COMMAND_LINK line: 479 severity: DEBUG dcucomms_tx_msg_type { transmit_msg: 22 }
event_diag_log_id: 82 timestamp: 1497009255 time_since_boot_secs: 122 module: CYLEC line: 46 severity: DEBUG cylec { packet_from_node { cylec_frame { frame_id: DIN_EVENT_EXTENDED flags: 0 src_addr: 2 dst_addr: 1 payload: "CYLEC_DINE3_LAST_GASP_SENTINEL" } } }
event_diag_log_id: 83 event_rec_log_id: 272 timestamp: 1497009255 time_since_boot_secs: 122 module: METERCOMMS_DINE line: 154 severity: WARNING din_event { meter_uuid { uuid_bytes: "9\343e\205\244\206E\332\251r\265\337) !\000" } tamper_data: "CYLEC_DINE3_LAST_GASP_SENTINEL" }
event_diag_log_id: 84 timestamp: 1497009255 time_since_boot_secs: 122 module: CYLEC line: 74 severity: DEBUG cylec { packet_from_dcu { cylec_frame { frame_id: OPEN_CHANNEL flags: 0 src_addr: 1 dst_addr: 2 payload: "" } } }


2017-06-09 15:31:52,132 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:56846): event id 291: processing
2017-06-09 15:31:52,184 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:56846): Re-mapping event id 291 to uuid d5751a00-09a6-4bf8-824a-c05494c6e3be
2017-06-09 15:31:52,184 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:56846): event id d5751a00-09a6-4bf8-824a-c05494c6e3be: is dine3, sending to node_alarm processor
2017-06-09 15:31:52,185 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:56846): event id 291: done







-----------------------------

old:
2017-05-23 17:32:18,188 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): checking dcu config version
2017-05-23 17:32:18,204 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): generated config is 5950fa7e415b4b8cbaab16d858c5274d
2017-05-23 17:32:18,214 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): dcu config version is 97eb2eedd4ee20ebd77549788b5dc8ff
2017-05-23 17:32:18,231 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): last applied config is 97eb2eedd4ee20ebd77549788b5dc8ff
2017-05-23 17:32:18,231 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): generated different to last-applied: saving generated
2017-05-23 17:32:18,232 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): storing previous config "5950fa7e415b4b8cbaab16d858c5274d" to database
2017-05-23 17:32:18,265 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): generated different to dcu: updating dcu
2017-05-23 17:32:18,289 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): dcu config updated to "5950fa7e415b4b8cbaab16d858c5274d"
2017-05-23 17:32:18,289 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): resetting dcu after config update
2017-05-23 17:32:18,330 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): dcu confirmed reset
2017-05-23 17:32:18,342 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): dcu=34eea9bf-222c-49d3-8348-09510e767ea9: disconnected
2017-05-23 17:32:18,343 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): main loop: terminated
2017-05-23 17:32:18,343 craik.clm INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52330): ended for 172.17.0.1:52330

2017-05-23 17:32:19,437 craik.clm INFO Have new connection from 172.17.0.1:52334
2017-05-23 17:32:19,486 craik.clm INFO CLM(None,172.17.0.1:52334): starting for 172.17.0.1:52334
2017-05-23 17:32:19,486 root INFO CLM(None,172.17.0.1:52334): mainloop: starting
2017-05-23 17:32:19,487 root INFO CLM(None,172.17.0.1:52334): got hello: DCUDetails(dcu_id=UUID('34eea9bf-222c-49d3-8348-09510e767ea9'),firmware_version=Version(major=2, minor=10, bug=1, build=3769),timestamp=datetime.datetime(2017, 5, 23, 16, 32, 19, tzinfo=<UTC>),serial=2118245,hardware=HardwareCode(product_code=u'PRODUCT-CODE', revision=u'REVISION'),licence_serial=0,supported_features=DCUFeatures(METER_UUID))
2017-05-23 17:32:19,501 root INFO CLM(None,172.17.0.1:52334): dcu=34eea9bf-222c-49d3-8348-09510e767ea9: authenticated ok
2017-05-23 17:32:19,516 craik.notify.api INFO subscribing to notifications from: 34eea9bf-222c-49d3-8348-09510e767ea9
2017-05-23 17:32:19,579 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): time to update dcu time
2017-05-23 17:32:19,585 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): setting dcu time to datetime.datetime(2017, 5, 23, 16, 32, 19, 585215, tzinfo=<UTC>)
2017-05-23 17:32:19,594 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): checking dcu config version
2017-05-23 17:32:19,609 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): generated config is 5950fa7e415b4b8cbaab16d858c5274d
2017-05-23 17:32:19,616 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): dcu config version is 5950fa7e415b4b8cbaab16d858c5274d
2017-05-23 17:32:19,640 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): last applied config is 5950fa7e415b4b8cbaab16d858c5274d
2017-05-23 17:32:19,647 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): generated same as dcu: not updating dcu
2017-05-23 17:32:19,649 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): dcuconfig update done
2017-05-23 17:32:19,649 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): checking DCU for eventlogs
2017-05-23 17:32:19,653 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): (from dcu) last event: 40
2017-05-23 17:32:19,659 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): (from db) last event: 21
2017-05-23 17:32:19,659 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): updated eventlogs last_pending: 21
2017-05-23 17:32:19,661 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): new events to get: 22->40 (19)
2017-05-23 17:32:19,661 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): event id 22: processing
2017-05-23 17:32:19,710 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): Re-mapping event id 22 to uuid 88344ca7-9bea-4a8f-9e87-b19835ab5bfb
2017-05-23 17:32:19,711 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): event id 22: done
2017-05-23 17:32:19,711 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): event id 23: processing
2017-05-23 17:32:19,759 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): Re-mapping event id 23 to uuid 969c1351-ff8a-46e8-8f0f-e9155c49deeb
2017-05-23 17:32:19,760 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.1:52334): event id 23: done



new:

2017-06-15 11:48:33,793 craik.clm INFO Have new connection from 172.17.0.2:33668
2017-06-15 11:48:33,836 craik.clm INFO CLM(None,172.17.0.2:33668): starting for 172.17.0.2:33668
2017-06-15 11:48:33,837 root INFO CLM(None,172.17.0.2:33668): mainloop: starting
2017-06-15 11:48:33,838 root INFO CLM(None,172.17.0.2:33668): got hello: DCUDetails(dcu_id=UUID('34eea9bf-222c-49d3-8348-09510e767ea9'),firmware_version=Version(major=2, minor=11, bug=0, build=3972),timestamp=datetime.datetime(2017, 6, 15, 10, 48, 33, tzinfo=<UTC>),serial=2118245,hardware=HardwareCode(product_code=u'PRODUCT-CODE', revision=u'REVISION'),licence_serial=656,supported_features=DCUFeatures(METER_UUID))
2017-06-15 11:48:33,905 root INFO CLM(None,172.17.0.2:33668): dcu=34eea9bf-222c-49d3-8348-09510e767ea9: authenticated ok
2017-06-15 11:48:33,914 craik.notify.api INFO subscribing to notifications from: 34eea9bf-222c-49d3-8348-09510e767ea9
2017-06-15 11:48:33,956 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): time to update dcu time
2017-06-15 11:48:33,961 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): setting dcu time to datetime.datetime(2017, 6, 15, 10, 48, 33, 961932, tzinfo=<UTC>)
2017-06-15 11:48:33,965 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): checking dcu config version
2017-06-15 11:48:33,976 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): generated config is 5950fa7e415b4b8cbaab16d858c5274d
2017-06-15 11:48:33,981 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): dcu config version is e14e8ceee7141bb9b8bf4c9284e46ec8
2017-06-15 11:48:34,000 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): last applied config is 5950fa7e415b4b8cbaab16d858c5274d
2017-06-15 11:48:34,000 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): dcu different to last-applied: saving dcu config
2017-06-15 11:48:34,044 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): storing previous config "e14e8ceee7141bb9b8bf4c9284e46ec8" to database
2017-06-15 11:48:34,072 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): generated different to dcu: updating dcu
2017-06-15 11:48:34,133 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): dcu config updated to "5950fa7e415b4b8cbaab16d858c5274d"
2017-06-15 11:48:34,134 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): resetting dcu after config update
2017-06-15 11:48:34,175 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): dcu confirmed reset
2017-06-15 11:48:34,211 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): dcu=34eea9bf-222c-49d3-8348-09510e767ea9: disconnected
2017-06-15 11:48:34,212 root INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): main loop: terminated
2017-06-15 11:48:34,213 craik.clm INFO CLM(34eea9bf-222c-49d3-8348-09510e767ea9,172.17.0.2:33668): ended for 172.17.0.2:33668












2017-06-15 13:37:01,488 craikdecoder.processor INFO <craikdecoder.processor.AlarmDecoderProcessor object at 0x7f9d2acb7350>: outage: got msg
2017-06-15 13:37:01,489 craikdecoder.processor INFO <craikdecoder.processor.AlarmDecoderProcessor object at 0x7f9d2acb7350>: event outage: processing
2017-06-15 13:37:01,513 craikdecoder.processor INFO <craikdecoder.processor.AlarmDecoderProcessor object at 0x7f9d2acb7350>: event outage: decode failed done.
2017-06-15 13:37:01,513 root ERROR <craikdecoder.processor.AlarmDecoderProcessor object at 0x7f9d2acb7350>: outage: decode failure
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/craikdecoder/processor.py", line 188, in handle_msg
    out_octets = self._handle_msg(in_msg)
  File "/usr/local/lib/python2.7/dist-packages/craikdecoder/processor.py", line 526, in _handle_msg
    response = self.handle_alarm(in_obj)
  File "/usr/local/lib/python2.7/dist-packages/craikdecoder/processor.py", line 490, in handle_alarm
    metadata=metadata2,
  File "/usr/local/lib/python2.7/dist-packages/meterprotocol/decode.py", line 107, in decode_alarm
    decoder = get_decoder(meter_protocol_id, octets)
  File "/usr/local/lib/python2.7/dist-packages/meterprotocol/decode.py", line 58, in get_decoder
    package="meterprotocol"
  File "/usr/lib/python2.7/importlib/__init__.py", line 38, in import_module
    return sys.modules[name]
KeyError: 'meterprotocol.decoders.nodealarm.'
2017-06-15 13:37:01,515 craikdecoder.processor ERROR <craikdecoder.processor.AlarmDecoderProcessor object at 0x7f9d2acb7350>: outage: rejected(hard): why="KeyError('meterprotocol.decoders.nodealarm.',)": msg=Message[body: {"alarm_raw": {"octets": "Q1lMRUNfRElORTNfTEFTVF9HQVNQX1NFTlRJTkVM"}, "metadata": {"event_idx": 3013, "meter_serial": "TEST1", "meter_id": "39e36585-a486-45da-a972-b5df29202100", "dcu_id": "34eea9bf-222c-49d3-8348-09510e767ea9", "dcu_rtc": "2017-06-15T12:36:03+00:00", "event_id": "outage", "type": "alarm", "meter_protocol_type": "METER_TYPE_COMP_0010"}}, delivery_info: {'exchange': 'al-decoder-ex', 'consumer_tag': 'amq.ctag-Fo5OeArUoyaURlPLmlelJw', 'routing_key': 'COMP.0010', 'redelivered': 0, 'delivery_tag': 1, 'channel': <haigha.channel.Channel object at 0x7f9d2acb7050>}, properties: {'correlation_id': 'outage', 'type': 'alarm'}]
2017-06-15 13:37:01,519 craikdecoder.processor INFO <craikdecoder.processor.AlarmDecoderProcessor object at 0x7f9d2acb7350>: outage: done msg





craik@198a71bd54cd:/var/log/craik$ tail -f craik-decoder.log
    event_.snapshot.accept(decoder)
  File "/usr/local/lib/python2.7/dist-packages/meterprotocol/decoders/nodealarm.py", line 94, in snapshot
    snap = self.make_snapshot(snap_data)
  File "/usr/local/lib/python2.7/dist-packages/meterprotocol/decoders/comp_0010/event.py", line 107, in make_snapshot
    snap = snapshot.Snapshot.make_snapshot(snap_data)
  File "/usr/local/lib/python2.7/dist-packages/meterprotocol/decoders/comp_0010/snapshot.py", line 166, in make_snapshot
    snap_id = snap_data[0]
TypeError: 'int' object has no attribute '__getitem__'
2017-06-15 14:17:02,294 craikdecoder.processor ERROR <craikdecoder.processor.AlarmDecoderProcessor object at 0x7fab746fdc10>: outage: rejected(hard): why='TypeError("\'int\' object has no attribute \'__getitem__\'",)': msg=Message[body: {"alarm_raw": {"octets": "Q1lMRUNfRElORTNfTEFTVF9HQVNQX1NFTlRJTkVM"}, "metadata": {"event_idx": 3021, "meter_serial": "TEST1", "meter_id": "39e36585-a486-45da-a972-b5df29202100", "dcu_id": "34eea9bf-222c-49d3-8348-09510e767ea9", "dcu_rtc": "2017-06-15T13:16:46+00:00", "event_id": "outage", "type": "alarm", "meter_protocol_type": "METER_TYPE_COMP_0010"}}, delivery_info: {'exchange': 'al-decoder-ex', 'consumer_tag': 'amq.ctag-NlBqOepIDjuCdkRJ4k5-8A', 'routing_key': 'COMP.0010', 'redelivered': 0, 'delivery_tag': 2, 'channel': <haigha.channel.Channel object at 0x7fab746fdc50>}, properties: {'correlation_id': 'outage', 'type': 'alarm'}]
2017-06-15 14:17:02,295 craikdecoder.processor INFO <craikdecoder.processor.AlarmDecoderProcessor object at 0x7fab746fdc10>: outage: done msg


-----------------------------------------------------------

bootargs=root=/dev/mmcblk0p1 ro console=ttyO0,115200n8 rootwait quiet
bootargs=root=/dev/mmcblk0p2 ro console=ttyO0,115200n8 rootwait quiet
bootargs=root=/dev/sda2 ro console=ttyO0,115200n8 rootwait quiet

bootcmd
load mmc 0:1 0x82000000 /boot/zImage; load mmc 0:1 0x88000000 /boot/am437x-sbc-t43.dtb; bootz 0x82000000 - 0x88000000
load mmc 0:2 0x82000000 /boot/zImage; load mmc 0:2 0x88000000 /boot/am437x-sbc-t43.dtb; bootz 0x82000000 - 0x88000000
usb start;load usb 0:2 0x82000000 /boot/zImage; load usb 0:2 0x88000000 /boot/am437x-sbc-t43.dtb; bootz 0x82000000 - 0x88000000

bootargs=root=/dev/sda3 ro console=ttyO0,115200n8 rootwait quiet
usb start;load usb 0:3 0x82000000 /boot/zImage; load usb 0:3 0x88000000 /boot/am437x-sbc-t43.dtb; bootz 0x82000000 - 0x88000000

usb start
ls usb 0:1 /


----------------------------------------

Boot from u-boot script on /dev/sda1

ext2load usb 0:1 0x83000000 /bootscr.img

usb start ; ext2load usb 0:1 0x83000000 /bootscr.img; source 0x83000000

setenv bootcmd "usb start ; ext2load usb 0:1 0x83000000 /bootscr.img; source 0x83000000"




--------------------------------------------------




GPIO

echo 67 > /sys/class/gpio/export
ls /sys/class/gpio
ls -laF /sys/class/gpio/gpio67/

echo out > /sys/class/gpio/gpio67/direction
echo 1 > /sys/class/gpio/gpio67/value
echo 0 > /sys/class/gpio/gpio67/value


https://www.allaboutcircuits.com/projects/how-to-use-the-digital-i-o-on-a-beaglebone/


----------------------------------


git pull origin
git checkout master
git pull
git reset --hard origin/master
git pull --rebase
git merge --no-ff origin/<branchname>


----------------------------------------------------------


43594c45435f44494e45335f4c4153545f474153505f53454e54494e454c

{
    "EVENT_METER_ALARM":
    {
        "event_type": "outage",
        "meter": "39e36585-a486-45da-a972-b5df29202100",
        "dcu_rtc__datetime": "2017-06-28T16:37:04+00:00",
        "meter_serial": "TEST1",
        "event_start_end": "start",
        "dcu": "34eea9bf-222c-49d3-8348-09510e767ea9",
        "event_data":
        {
            "EVENT_EMPTY": {}
        }
    }
}


-------------------------------------------------


wget http://127.0.0.1:5000/UpgradePack/Patch.tar
dd if=/dev/sda2 of=/dev/sda3 bs=1M
mount /dev/sda3 /mnt

- need translation between uid 'ubuntu'(1000) and root(0) i.e. a 'pseudo root'.
- need translation between gid 'ubuntu'(1000) and root(0) i.e. a 'pseudo root'.
- need to minimise chowns/mkdirs/chmod

wget -nv --post-data "value=08585858&message=This is yet another log entry" http://172.16.32.107:5000/Log
wget -nv http://172.16.32.107:5000/UpgradePack/Patch.tar

ssh-keygen: generating new host keys: RSA Saving key "/etc/ssh/ssh_host_rsa_key" failed: Read-only filem
ssh-keygen: generating new host keys: DSA Saving key "/etc/ssh/ssh_host_dsa_key" failed: Read-only filem
ssh-keygen: generating new host keys: ECDSA Saving key "/etc/ssh/ssh_host_ecdsa_key" failed: Read-only m
ssh-keygen: generating new host keys: ED25519 Saving key "/etc/ssh/ssh_host_ed25519_key" failed: Read-om

----------------------------------------------

BAN-78-0083-Update-OUCVBCS-HES-API

----------------------------------------------

Starting logging: OK
read-only file system detected...done
Starting network: OK
ssh-keygen: generating new host keys: RSA Saving key "/etc/ssh/ssh_host_rsa_key" failed: Read-only filem
ssh-keygen: generating new host keys: DSA Saving key "/etc/ssh/ssh_host_dsa_key" failed: Read-only filem
ssh-keygen: generating new host keys: ECDSA Saving key "/etc/ssh/ssh_host_ecdsa_key" failed: Read-only m
ssh-keygen: generating new host keys: ED25519 Saving key "/etc/ssh/ssh_host_ed25519_key" failed: Read-om
Starting sshd: Could not load host key: /etc/ssh/ssh_host_rsa_key
Could not load host key: /etc/ssh/ssh_host_dsa_key
Could not load host key: /etc/ssh/ssh_host_ecdsa_key
Could not load host key: /etc/ssh/ssh_host_ed25519_key
sshd: no hostkeys available -- exiting.
OK
no interfaces have a carrier
forked to background, child pid 145
[   15.264080] libphy: PHY 4a101000.mdio:00 not found
[   15.269168] net eth0: phy "4a101000.mdio:00" not found on slave 0, err -19
[   15.288399] libphy: PHY 4a101000.mdio:01 not found
[   15.293538] net eth1: phy "4a101000.mdio:01" not found on slave 1, err -19

----------------------------------------------


Starting logging: OK
read-only file system detected...done
Starting network: OK
Starting sshd: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for '/etc/ssh/ssh_host_rsa_key' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
key_load_private: bad permissions
Could not load host key: /etc/ssh/ssh_host_rsa_key
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for '/etc/ssh/ssh_host_dsa_key' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
key_load_private: bad permissions
Could not load host key: /etc/ssh/ssh_host_dsa_key
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for '/etc/ssh/ssh_host_ecdsa_key' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
key_load_private: bad permissions
Could not load host key: /etc/ssh/ssh_host_ecdsa_key
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for '/etc/ssh/ssh_host_ed25519_key' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
key_load_private: bad permissions
Could not load host key: /etc/ssh/ssh_host_ed25519_key
sshd: no hostkeys available -- exiting.
OK
no interfaces have a carrier
forked to background, child pid 146
[    4.509449] libphy: PHY 4a101000.mdio:00 not found
[    4.514495] net eth0: phy "4a101000.mdio:00" not found on slave 0, err -19
[    4.534625] libphy: PHY 4a101000.mdio:01 not found
[    4.539726] net eth1: phy "4a101000.mdio:01" not found on slave 1, err -19

Welcome to Cosmos


------------------------------------------------------------------


python3 SecureFirmware.py -m t

python3 SecureFirmware.py -m g -e enc_key -p sign_key_pub.der -q signing_key_private.der
cp enc_key
cp sign_key_pub.der
cp signing_key_private.der

python3 SecureFirmware.py -m e -e enc_key -q signing_key_private.der -i Patch.tar -o SignedPatch.tar

python3 SecureFirmware.py -m d -e enc_key -p sign_key_pub.der -i SignedPatch.tar -o Patch2.tar




------------------------------------------------------------------


cd /home/app
python SecureFirmware.py -m e -e Keys/enc_key -q Keys/signing_key_private.der -i /tmp/Patch.tar -o SignedPatch.tar

------------------------------------------------------------------

mknod /dev/ppp c 108 0
insmod ppp
start-stop-daemon --start --background --make-pidfile --pidfile /run/WANMonitor.pid --startas /usr/bin/WANMonitor.py -- ppp0 -l /var/log/WANMonitor.log


---------------------------------

Loose ends:

- SecureFirmware.py needs to not produce an output on verification failure.
- GenerateHash needs to generate same results on host & target. Also needs to incorporate metadata (permissions, gid, uid, etc).
- Add the logic for determining if a new upgrade is available to incorporate the hash generation.
- Before marking the new rootfs as good, it must match hashes with the downloaded patch.
- minimisation of Patch.sh commands (currently does more than is needed).
- Check for broken links in new fs prior to patch generation.
- Check for interrupted upgrade on boot (i.e. power failed during application).
- Download process needs to check for available space before downloading patch.
- Should do an fsck on the new rootfs prior to marking it ready to boot (or even prior to copy?).
- Verify hash of previous source rootfs before copy??
- Current STOP mode is in U-boot. is this desirable? avoidable?
- If no partitions marked as bootable, try last-known-good? (possible security hole here).
- Change disk image name.
- Add genext2fs to Dockerfile.
- Add LVM2 and initrd (needed to boot from LVM2). This also needs the partition arrangement to change.
- Change the fw upgrade from a 'dd' copy to a 'mkfs and cp-R' copy which will allow resizing of partitions.
- Need resize2fs on the platform to allow for fs resizing.
- CMUX on UART to modem, to allow for status checking while call in progress.

--------------------------------------


Jan  1 00:04:13 Cosmos daemon.notice pppd[232]: pppd 2.4.7 started by root, uid 0
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (BUSY)
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (NO CARRIER)
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (VOICE)
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (NO DIALTONE)
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (NO DIAL TONE)
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (NO ANSWER)
Jan  1 00:04:14 Cosmos local2.info chat[236]: abort on (DELAYED)
Jan  1 00:04:14 Cosmos local2.info chat[236]: report (CONNECT)
Jan  1 00:04:14 Cosmos local2.info chat[236]: timeout set to 6 seconds
Jan  1 00:04:14 Cosmos local2.info chat[236]: send (ATQ0^M)
Jan  1 00:04:14 Cosmos local2.info chat[236]: expect (OK)
Jan  1 00:04:14 Cosmos local2.info chat[236]: ATQ0^M^M
Jan  1 00:04:14 Cosmos local2.info chat[236]: OK
Jan  1 00:04:14 Cosmos local2.info chat[236]:  -- got it
Jan  1 00:04:14 Cosmos local2.info chat[236]: send (ATZ^M)
Jan  1 00:04:14 Cosmos local2.info chat[236]: timeout set to 3 seconds
Jan  1 00:04:14 Cosmos local2.info chat[236]: expect (OKd)
Jan  1 00:04:14 Cosmos local2.info chat[236]: ^M
Jan  1 00:04:14 Cosmos local2.info chat[236]: ATZ^M^M
Jan  1 00:04:14 Cosmos local2.info chat[236]: OK^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: alarm
Jan  1 00:04:17 Cosmos local2.info chat[236]: send (AT^M)
Jan  1 00:04:17 Cosmos local2.info chat[236]: expect (OK)
Jan  1 00:04:17 Cosmos local2.info chat[236]: AT^M^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: OK
Jan  1 00:04:17 Cosmos local2.info chat[236]:  -- got it
Jan  1 00:04:17 Cosmos local2.info chat[236]: send (ATI^M)
Jan  1 00:04:17 Cosmos local2.info chat[236]: expect (OK)
Jan  1 00:04:17 Cosmos local2.info chat[236]: ^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: ATI^M^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: 332^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: ^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: OK
Jan  1 00:04:17 Cosmos local2.info chat[236]:  -- got it
Jan  1 00:04:17 Cosmos local2.info chat[236]: send (ATZ^M)
Jan  1 00:04:17 Cosmos local2.info chat[236]: expect (OK)
Jan  1 00:04:17 Cosmos local2.info chat[236]: ^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: ATZ^M^M
Jan  1 00:04:17 Cosmos local2.info chat[236]: OK
Jan  1 00:04:17 Cosmos local2.info chat[236]:  -- got it
Jan  1 00:04:17 Cosmos local2.info chat[236]: send (AT+CGDCONT=1,"IP","wirelesslogic.co.uk"^M)
Jan  1 00:04:18 Cosmos local2.info chat[236]: expect (OK)
Jan  1 00:04:18 Cosmos local2.info chat[236]: ^M
Jan  1 00:04:18 Cosmos local2.info chat[236]: AT+CGDCONT=1,"IP","wirelesslogic.co.uk"^M^M
Jan  1 00:04:18 Cosmos local2.info chat[236]: OK
Jan  1 00:04:18 Cosmos local2.info chat[236]:  -- got it
Jan  1 00:04:18 Cosmos local2.info chat[236]: send (ATD*99***1#^M)
Jan  1 00:04:18 Cosmos local2.info chat[236]: timeout set to 30 seconds
Jan  1 00:04:18 Cosmos local2.info chat[236]: expect (CONNECT)
Jan  1 00:04:18 Cosmos local2.info chat[236]: ^M
Jan  1 00:04:18 Cosmos local2.info chat[236]: ATD*99***1#^M^M
Jan  1 00:04:18 Cosmos local2.info chat[236]: CONNECT
Jan  1 00:04:18 Cosmos local2.info chat[236]:  -- got it
Jan  1 00:04:18 Cosmos local2.info chat[236]: send (^M)
Jan  1 00:04:18 Cosmos daemon.debug pppd[232]: Script /usr/sbin/chat -v -t15 -f /etc/ppp/chatscripts/mo0
Jan  1 00:04:18 Cosmos daemon.info pppd[232]: Serial connection established.
Jan  1 00:04:18 Cosmos daemon.debug pppd[232]: using channel 1
Jan  1 00:04:18 Cosmos daemon.info pppd[232]: Using interface ppp0
Jan  1 00:04:18 Cosmos daemon.notice pppd[232]: Connect: ppp0 <--> /dev/ttyUSB1
[  259.364850] PPP Deflate Compression module registered
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: sent [LCP ConfReq id=0x1 <asyncmap 0x0> <magic 0x811df57]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: rcvd [LCP ConfAck id=0x1 <asyncmap 0x0> <magic 0x811df57]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: rcvd [LCP ConfReq id=0x1 <asyncmap 0x0> <auth pap> <magi]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: sent [LCP ConfAck id=0x1 <asyncmap 0x0> <auth pap> <magi]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: sent [PAP AuthReq id=0x1 user="cyan" password=<hidden>]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: rcvd [PAP AuthAck id=0x1 "Welcome!"]
Jan  1 00:04:19 Cosmos daemon.info pppd[232]: Remote message: Welcome!
Jan  1 00:04:19 Cosmos daemon.notice pppd[232]: PAP authentication succeeded
Jan  1 00:04:19 Cosmos user.info kernel: [  259.364850] PPP Deflate Compression module registered
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: sent [CCP ConfReq id=0x1 <deflate 15> <deflate(old#) 15>]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: sent [IPCP ConfReq id=0x1 <addr 0.0.0.0> <ms-dns1 0.0.0.]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: rcvd [IPCP ConfReq id=0x1 <addr 192.168.202.0>]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: sent [IPCP ConfAck id=0x1 <addr 192.168.202.0>]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: rcvd [LCP ProtRej id=0x1 80 fd 01 01 00 0c 1a 04 78 00 1]
Jan  1 00:04:19 Cosmos daemon.debug pppd[232]: Protocol-Reject for 'Compression Control Protocol' (0x80d
Jan  1 00:04:20 Cosmos daemon.debug pppd[232]: rcvd [IPCP ConfNak id=0x1 <addr 10.7.61.28> <ms-dns1 10.]
Jan  1 00:04:20 Cosmos daemon.debug pppd[232]: sent [IPCP ConfReq id=0x2 <addr 10.7.61.28> <ms-dns1 10.]
Jan  1 00:04:20 Cosmos daemon.debug pppd[232]: rcvd [IPCP ConfAck id=0x2 <addr 10.7.61.28> <ms-dns1 10.]
Jan  1 00:04:20 Cosmos daemon.err pppd[232]: not replacing existing default route via 172.16.32.254
Jan  1 00:04:20 Cosmos daemon.notice pppd[232]: local  IP address 10.7.61.28
Jan  1 00:04:20 Cosmos daemon.notice pppd[232]: remote IP address 192.168.202.0
Jan  1 00:04:20 Cosmos daemon.notice pppd[232]: primary   DNS address 10.4.0.240
Jan  1 00:04:20 Cosmos daemon.notice pppd[232]: secondary DNS address 10.4.0.230





---------------------


mknod /dev/ppp c 108 0

/etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4


ifup ppp0


route add default ppp0

/etc/network/interfaces
remove wait-for line.

---------------------------------

with SSH access on port 22222 at address 185.81.161.158
debian:temppwd



-------------------------------------------------

TestApplication ports

dcuhw/rf_node.py:        'tty': '/dev/ttyUSB5'
dcuhw/rf_node.py:        'tty': '/dev/ttyUSB6'
dcuhw/gprs.py:        Gprs.instance = Gprs(tty='/dev/ttyUSB1')
mts/mts_serial.py:    def __init__(self, port='/dev/ttyUSB4', baudrate=115200, timeout=1):



aux_power_check_request.json                            - WILL FAIL
ethernet_autoneg_test_execute_request.json              - PASS
ethernet_ping_test_execute_request.json                 - PASS
fat_flag_set_request.json                               - DONE
gprs_network_status_check_execute_request.json          - PASS
gprs_sim_check_present_execute_request.json             - PASS
main_power_check_request.json                           - WILL FAIL
nand_test_execute_request.json                          - PASS
reset_request.json                                      - DONE
rf_loopback_test_execute_request.json                   - PASS
rtc_date_check_request.json                             - PASS
rtc_date_set_request.json                               - PASS
rtc_time_check_request.json                             - PASS
rtc_time_set_request.json                               - PASS
scap_voltage_check_execute_request.json                 - WILL FAIL
sdram_test_execute_request.json                         - PASS
test_log_read_request.json                              - DONE
usb_loopback_test_execute_request.json                  - WILL FAIL
usb_peripheral_detect_test_execute_request.json         - WILL FAIL



----------------------------------------

Star names:

"Zubenelgenubi"


# CyLec (v2.12.0.720122308)
# Hardware rev: 0000 00 @00000
# System address (CY3S): 0x5678
# Network address (CY3A): 0x0002
# Serial no (CYSN): 0x00008235
# Band (BND1): BD 433MHz
# Channel (CHAN): 6
# Dynamic Thresholds (St1a & St2d): On
# Role (METR): Meter
# OTXU: Off
# Boot address (CYBA): 0xFFFFFFFF

am437x-cm-t43 am437x-idk-evm am437x-sbc-t43 am437x-gp-evm
DeviceTree/am437x-cm-t43.dts DeviceTree/am437x-idk-evm.dts DeviceTree/am437x-sbc-t43.dts DeviceTree/am437x-gp-evm.dts


-----------------------------------

MTS loose ends:
- RF node loopback test can be intermittent as it picks up "CMD>" in the response from the receiving node.
- SDRAM test needs to be rewritten.
- NAND test is not thorough enough.
- USB OTG (as device) needs implementing (or does it? what requirement?)
- modem test mode should have a new test.
- rf node PRBS should have a new test.



RTC DTS
cd /sys/firmware/devicetree/base/ocp@44000000/rtc@44e3e000


{
    "MTS__TEST_EXECUTE__REQUEST": {
        "RTC_Time_Set": {
            "Time": "10:55:44"
        }
    }
}

{
    "MTS__TEST_EXECUTE__REQUEST": {
        "RTC_Time_Check": {
            "Time": "10:55:59"
        }
    }
}


-------------------------------------

eMMC

emmc_pins: pinmux_emmc_pins {

        emmc_pins: pinmux_emmc_pins {
                pinctrl-single,pins = <
                        AM33XX_IOPAD(0x880, PIN_INPUT_PULLUP | MUX_MODE2) /* gpmc_csn1.mmc1_clk */
                        AM33XX_IOPAD(0x884, PIN_INPUT_PULLUP | MUX_MODE2) /* gpmc_csn2.mmc1_cmd */
                        AM33XX_IOPAD(0x800, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad0.mmc1_dat0 */
                        AM33XX_IOPAD(0x804, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad1.mmc1_dat1 */
                        AM33XX_IOPAD(0x808, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad2.mmc1_dat2 */
                        AM33XX_IOPAD(0x80c, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad3.mmc1_dat3 */
                        AM33XX_IOPAD(0x810, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad4.mmc1_dat4 */
                        AM33XX_IOPAD(0x814, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad5.mmc1_dat5 */
                        AM33XX_IOPAD(0x818, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad6.mmc1_dat6 */
                        AM33XX_IOPAD(0x81c, PIN_INPUT_PULLUP | MUX_MODE1) /* gpmc_ad7.mmc1_dat7 */
                >;
        };

};


&mmc2 {
        vmmc-supply = <&vmmcsd_fixed>;
        pinctrl-names = "default";
        pinctrl-0 = <&emmc_pins>;
        bus-width = <8>;
        status = "okay";
};



                mmc2: mmc@481d8000 {
                        compatible = "ti,omap4-hsmmc";
                        ti,hwmods = "mmc2";
                        ti,needs-special-reset;
                        dmas = <&edma 2 0
                                &edma 3 0>;
                        dma-names = "tx", "rx";
                        interrupts = <28>;
                        interrupt-parent = <&intc>;
                        reg = <0x481d8000 0x1000>;
                        status = "disabled";
                };



=> gpio status -a
Bank gpio@44e07000:                             // bank 1
gpio@44e070000: input: 0 [ ]
gpio@44e070001: input: 0 [ ]
gpio@44e070002: input: 1 [ ]
gpio@44e070003: input: 1 [ ]
gpio@44e070004: input: 1 [ ]
gpio@44e070005: input: 0 [ ]
gpio@44e070006: input: 1 [ ]
gpio@44e070007: input: 0 [ ]
gpio@44e070008: input: 0 [ ]
gpio@44e070009: input: 0 [ ]
gpio@44e0700010: input: 0 [ ]
gpio@44e0700011: input: 0 [ ]
gpio@44e0700012: input: 1 [ ]
gpio@44e0700013: input: 1 [ ]
gpio@44e0700014: input: 0 [ ]
gpio@44e0700015: input: 0 [ ]
gpio@44e0700016: input: 0 [ ]                   //
gpio@44e0700017: input: 0 [ ]
gpio@44e0700018: input: 0 [ ]                   // EXT_LED GPIO1_18 Llinux 0/18 (18)
gpio@44e0700019: input: 0 [ ]
gpio@44e0700020: input: 0 [ ]
gpio@44e0700021: input: 0 [ ]                   // RFMOD_A_RST GPIO0_21 Linux 0/21 (21)
gpio@44e0700022: input: 0 [ ]
gpio@44e0700023: input: 0 [ ]                   // RFMOD_A_DINE GPIO0_23 LInux 0/23 (23)
gpio@44e0700024: input: 0 [ ]
gpio@44e0700025: input: 0 [ ]
gpio@44e0700026: input: 0 [ ]
gpio@44e0700027: input: 0 [ ]                   // GPRS_PWR GPIO1_27 (D8) TP101 (59)
gpio@44e0700028: input: 0 [ ]                   // GPRS_VEN GPIO1_28 (A3) TP100 (60)
gpio@44e0700029: input: 0 [ ]
gpio@44e0700030: input: 0 [ ]
gpio@44e0700031: input: 0 [ ]

Bank gpio@4804c000:                             // bank 2  Linux 1
gpio@4804c0000: input: 0 [ ]
gpio@4804c0001: input: 0 [ ]
gpio@4804c0002: input: 0 [ ]
gpio@4804c0003: input: 0 [ ]
gpio@4804c0004: input: 0 [ ]
gpio@4804c0005: input: 0 [ ]
gpio@4804c0006: input: 0 [ ]
gpio@4804c0007: input: 0 [ ]
gpio@4804c0008: input: 1 [ ]
gpio@4804c0009: input: 1 [ ]
gpio@4804c00010: input: 0 [ ]
gpio@4804c00011: input: 0 [ ]
gpio@4804c00012: input: 0 [ ]
gpio@4804c00013: input: 0 [ ]
gpio@4804c00014: input: 0 [ ]
gpio@4804c00015: input: 0 [ ]
gpio@4804c00016: input: 0 [ ]                   // ethernet phy reset GPIO1_16   Linux 0/16
gpio@4804c00017: input: 0 [ ]                   // eMMC nRST GPIO1_17            Linux 0/17
gpio@4804c00018: input: 0 [ ]                   // ext_led        GPIO1_18
gpio@4804c00019: output: 1 [ ]                  // EN_DDR3_VTT    GPIO1_19
gpio@4804c00020: input: 0 [ ]                   // TP302  GPIO1_20
gpio@4804c00021: input: 0 [ ]                   // TP303  GPIO1_21
gpio@4804c00022: input: 0 [ ]                   // EXP_GPIO_0     GPIO1_22
gpio@4804c00023: input: 0 [ ]                   // EXP_GPIO_1     GPIO1_23
gpio@4804c00024: input: 0 [ ]                   // EXP_GPIO_2     GPIO1_24
gpio@4804c00025: input: 0 [ ]                   // EXP_GPIO_3     GPIO1_25
gpio@4804c00026: input: 0 [ ]
gpio@4804c00027: input: 0 [ ]                   // GPRS_PWR       GPIO1_27
gpio@4804c00028: input: 1 [ ]                   // GPRS_VEN       GPIO1_28
gpio@4804c00029: input: 0 [ ]
gpio@4804c00030: input: 0 [ ]
gpio@4804c00031: input: 0 [ ]

Bank gpio@481ae000:                             // bank 3    Linux 1
gpio@481ae0000: input: 1 [ ]
gpio@481ae0001: input: 0 [ ]
gpio@481ae0002: input: 0 [ ]
gpio@481ae0003: input: 0 [ ]
gpio@481ae0004: input: 0 [ ]
gpio@481ae0005: input: 0 [ ]
gpio@481ae0006: input: 0 [ ]
gpio@481ae0007: input: 0 [ ]                    // RFMOD_B_RST GPIO3_7 Linux 1/7 (39)
gpio@481ae0008: input: 0 [ ]                    // RFMOD_B_DINE GPIO3_8 Linux 1/8 (40)
gpio@481ae0009: input: 0 [ ]
gpio@481ae00010: input: 0 [ ]
gpio@481ae00011: input: 0 [ ]
gpio@481ae00012: input: 0 [ ]
gpio@481ae00013: input: 0 [ ]
gpio@481ae00014: input: 0 [ ]
gpio@481ae00015: input: 0 [ ]
gpio@481ae00016: input: 0 [ ]
gpio@481ae00017: input: 0 [ ]
gpio@481ae00018: input: 0 [ ]
gpio@481ae00019: input: 0 [ ]
gpio@481ae00020: input: 0 [ ]
gpio@481ae00021: input: 0 [ ]
gpio@481ae00022: input: 0 [ ]                   // 3v3B enable        Linux 2/22 (86)
gpio@481ae00023: input: 1 [ ]
gpio@481ae00024: input: 1 [ ]                   // red LED GPIO3_24   Linux 2/24 (88)
gpio@481ae00025: input: 1 [ ]
gpio@481ae00026: input: 0 [ ]
gpio@481ae00027: input: 0 [ ]
gpio@481ae00028: input: 0 [ ]
gpio@481ae00029: input: 0 [ ]
gpio@481ae00030: input: 0 [ ]
gpio@481ae00031: input: 0 [ ]

Bank gpio@48320000:                             // bank 4  Linux 3
gpio@483200000: input: 0 [ ]
gpio@483200001: input: 0 [ ]
gpio@483200002: input: 0 [ ]
gpio@483200003: input: 0 [ ]
gpio@483200004: input: 0 [ ]
gpio@483200005: input: 0 [ ]
gpio@483200006: input: 0 [ ]
gpio@483200007: input: 0 [ ]
gpio@483200008: input: 0 [ ]
gpio@483200009: input: 0 [ ]
gpio@4832000010: input: 0 [ ]
gpio@4832000011: input: 0 [ ]
gpio@4832000012: input: 0 [ ]
gpio@4832000013: input: 0 [ ]
gpio@4832000014: input: 0 [ ]
gpio@4832000015: input: 0 [ ]
gpio@4832000016: input: 0 [ ]
gpio@4832000017: input: 0 [ ]
gpio@4832000018: input: 0 [ ]
gpio@4832000019: input: 0 [ ]
gpio@4832000020: input: 0 [ ]
gpio@4832000021: input: 0 [ ]
gpio@4832000022: input: 0 [ ]
gpio@4832000023: input: 0 [ ]
gpio@4832000024: input: 0 [ ]
gpio@4832000025: input: 0 [ ]
gpio@4832000026: input: 0 [ ]
gpio@4832000027: input: 0 [ ]
gpio@4832000028: input: 0 [ ]
gpio@4832000029: input: 0 [ ]
gpio@4832000030: input: 0 [ ]
gpio@4832000031: input: 0 [ ]

Bank gpio@48322000:                             // bank 5  Linux 4
gpio@483220000: input: 1 [ ]
gpio@483220001: input: 1 [ ]
gpio@483220002: input: 1 [ ]
gpio@483220003: input: 1 [ ]
gpio@483220004: input: 1 [ ]                    // green LED GPIO5_4  Linux 4/4 = 132
gpio@483220005: input: 0 [ ]                    // blue LED GPIO5_5   Linux 4/5 = 133
gpio@483220006: input: 0 [ ]                    // MODEM_PWR  GPIO5_6          (166)
gpio@483220007: input: 1 [ ]                    // EN_232 GPIO_5_7 Linux 4/7 = 135
gpio@483220008: input: 0 [ ]
gpio@483220009: input: 0 [ ]
gpio@4832200010: input: 0 [ ]
gpio@4832200011: input: 0 [ ]
gpio@4832200012: input: 0 [ ]
gpio@4832200013: input: 0 [ ]
gpio@4832200014: input: 0 [ ]
gpio@4832200015: input: 0 [ ]
gpio@4832200016: input: 0 [ ]
gpio@4832200017: input: 0 [ ]
gpio@4832200018: input: 0 [ ]
gpio@4832200019: input: 0 [ ]
gpio@4832200020: input: 0 [ ]
gpio@4832200021: input: 0 [ ]
gpio@4832200022: input: 0 [ ]
gpio@4832200023: input: 0 [ ]
gpio@4832200024: input: 0 [ ]
gpio@4832200025: input: 0 [ ]
gpio@4832200026: input: 0 [ ]
gpio@4832200027: input: 0 [ ]
gpio@4832200028: input: 0 [ ]
gpio@4832200029: input: 0 [ ]
gpio@4832200030: input: 0 [ ]
gpio@4832200031: input: 0 [ ]
=> gpio toggle gpio@4832000022











------------------------------

mmcblk0: mmc0:0001 SEM08G 7.28 GiB
mmcblk1: mmc1:aaaa SB16G 14.8 GiB


-----------------------------

mkimage -f fitImage_nonsecure.its -r fitImage


-----------

U-boot config change:

include/configs/am43xx_evm.h

#define CONFIG_SYS_NS16550_COM1         0x481a8000      /* Base EVM has UART4 */


mkimage -f fitImage_nonsecure.its -r fitImage



-------------------------------

at#gpio=1,1,1  (Modem Green LED)
at#gpio=2,1,1  (Modem Red LED)


SIM switching

OK
at#ccid
#CCID: 89441000300307211676

OK
at#gpio=3,1,1
OK
at#simdet=0
OK
at#simdet=1
OK
at#ccid
#CCID: 89441000300307211544

OK

---------------------------------------------

import re
t=open('screen.cap').read()
d=re.compile('--- ([0-9]+) ---.*?NodeA(.*?)NodeB(.*?)---',re.DOTALL).findall(t)



--------------------------


# CyLec (v2.11.0.613142607)
# Hardware rev: 0000 00 @00000
# System address (CY3S): 0x5678
# Network address (CY3A): 0x0002
# Serial no (CYSN): 0x00001235
# Band (BND1): 865MHz Type Approval
# Channel (CHAN): 7
# Dynamic Thresholds (St1a & St2d): On
# Role (METR): Meter
# OTXU: On
# Boot address (CYBA): 0xFFFFFFFF


-------------------------


# i2cdetect -y -r 0
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- UU -- -- -- -- 29 -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --


i2cget -y 0 0x29 0x00

# i2cdump -f -y -r 0x00-0x26 0 0x24
No size specified (using byte-data access)
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f    0123456789abcdef
00: 03 00 00 3f 3f 28 00 00 00 00 00 00 00 00 00 00    ?..??(..........
10: 00 3f 13 48 c0 00 19 19 98 b2 06 1f 00 00 00 00    .??H?.??????....
20: 00 00 98 70 00 63 03                               ..?p.c?
#


Remove freshness seal
i2cset -f -y 0 0x24 0x10 0xb1 0xfe 0xa3 i

Read status PMIC register
i2cget -f -y 0 0x24 0x05


------------------------------------------------------


*(0x44DF0000 + 0x2B68) = 0x00000002

*(0x44E07000 + ) = enabled




mount /dev/mmcblk0p1 /mnt
mknod /dev/hack c 100 0
insmod /mnt/GPIOHack.ko
python /home/app/ioctl.py /dev/hack 0


---------------------------

date +%Y%m%d -s "20081128"
date +%T -s "10:13:13"
hwclock -w


----------------------------------------------------

assertion "(irq1flags & RF_IRQFLAGS1_TIMEOUT) || (irq2flags & RF_IRQFLAGS2_PAYLOADREADY)" failed: file 0


------------------------------

debugfs from kernel:

mount -t debugfs none /sys/kernel/debug

------------------------

pinmux functions:
cat /sys/kernel/debug/pinctrl/44e10800.pinmux/pins


---------------------------------------------------------------


for _cable_, _main_, _diag_ :

cygh_uart_cable_get_baudrate
cygh_uart_cable_handshake_hw_available
cygh_uart_cable_handshake_set_enable
cygh_uart_cable_handshake_sw_available
cygh_uart_cable_initialise
cygh_uart_cable_process
cygh_uart_cable_rxchar
cygh_uart_cable_rx_clear
cygh_uart_cable_set_baudrate
cygh_uart_cable_tx
cygh_uart_cable_tx_buffer_free
cygh_uart_cable_tx_clear
cygh_uart_diag_tx_blocking
cygh_uart_diag_txchar_blocking




------------------------------

BR2_TOOLCHAIN_BUILDROOT_WCHAR=y
BR2_PTHREAD_DEBUG=y
BR2_PACKAGE_GDB=y
BR2_PACKAGE_GDB_SERVER=y
BR2_PACKAGE_GDB_DEBUGGER=y
BR2_PACKAGE_GDB_TUI=y



----------------------------------------------------

Store:

FILE_NANOPB_init();
FILE_init();
FS_FIFO_init();
FS_FROM_FILE_init();
FS_ONEFILE_init();
FS_init();
GPT_SDCARD_init();
GPT_init();
LIST_init();
MOUNT_init();


-------------


https://artifactory.cyco.io:443/general-dev/cosmos/arm_buildroot_linux_gnueabihf/20170905/assembly.tar.gz






PATH="/BuildArea/BuildRoot/output/host/bin:/BuildArea/BuildRoot/output/host/sbin:/BuildArea/BuildRoot/output/host/usr/bin:/BuildArea/BuildRoot/output/host/usr/sbin:/opt/arm-buildroot-linux-gnueabihf/usr/bin:/opt/ae-toolchain/usr/bin:/usr/local/lib/ecog1x-cyan-elf-toolchain/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" BR_BINARIES_DIR=/BuildArea/BuildRoot/output/images KBUILD_BUILD_VERSION=1 KBUILD_BUILD_USER=buildroot KBUILD_BUILD_HOST=buildroot KBUILD_BUILD_TIMESTAMP="Mon May  1 22:00:00 UTC 2017" /usr/bin/make -j3 HOSTCC="/usr/bin/gcc" HOSTCFLAGS="" ARCH=arm INSTALL_MOD_PATH=/BuildArea/BuildRoot/output/target CROSS_COMPILE="/BuildArea/BuildRoot/output/host/usr/bin/arm-buildroot-linux-gnueabi-" DEPMOD=/BuildArea/BuildRoot/output/host/sbin/depmod INSTALL_MOD_STRIP=1 -C /BuildArea/BuildRoot/output/build/linux-4.9.13 zImage



----------------------------------------------


The detection of whether an image is present on a selected device differs by device type:
• On a GP Device type, a booting image (bootloader) is considered to be present when the first four
bytes of the sector are not equal to 00000000h or FFFFFFFFh.
During the first read sector call, the first sector is copied to a temporary RAM buffer. Once the image is
found and the destination address is known from the decoding the header, the content of the temporary
buffer is moved to the target RAM location so it is not needed to re-read the first image sector. On a GP
device the GP header is discarded, and only executable code is located in RAM with the first executable
instruction located at the destination address.
Memory booting
Initialization
and
Device detection
Set first / next valid block
Read a sector
Return
fail
Copying failed
No more sectors to read
Device detection
Initialization failed
No more blocks
Loading Initial SW
Completed?
Store the loaded sector with
Initial SW in the target buffer
Initial SW execution
No
Yes
www.ti.com Functional Description
SPRUHL7F–April 2014–Revised September 2016 195
Submit Documentation Feedback
Copyright © 2014–2016, Texas Instruments Incorporated
Initialization
MMC/SD cards (in raw mode), SPI, and NAND devices hold up to four copies of the booting image. The
ROM Code searches for one valid image out of the four, if present, by walking over the first four blocks of
the mass storage space. Other XIP devices (NOR) use only one copy of the booting image.




MMC and SD standards detail this phase as initialization phase. Both standards differ in the first
commands involved: CMD1 and ACMD41. The ROM Code uses this difference in command set to
discriminate between MMC and SD devices: CMD1 is supported only by the MMC standard, whereas
ACMD41 is only supported by SD standard.
The ROM Code first sends a CMD1 to the device and gets a response only if an MMC device is
connected. If no response is received, then ACMD41 (ACMD41 is made out of CMD55 and ACMD41) is
sent and a response is expected from an SD device. If no response is received, then it is assumed that no
device is connected and the ROM

5.2.6.5.5 MMC/SD Read Sector Procedure in Raw Mode
In raw mode the booting image can be located at one of the four consecutive locations in the main area:
• offset 0x0
• 0x40000 (256KB)
• 0x80000 (512KB)
• 0xC0000 (768KB)
A booting image must not exceed 256KB in size. However, it is possible to flash a device with an image
greater than 256KB starting at one of the four locations and the ROM Code will not check the image size.
The only drawback is that the image will cross the subsequent image boundary.
The raw mode is detected by reading sectors #0 and #1024. The content of these sectors is then verified
for presence of a TOC structure as described in 10. In the case of a GP Device, a Configuration Header
(CH) must be located in the first sector followed by a GP header (1)
. The CH might be void (only containing
a CHSETTINGS item for which the valid field is zero).





For Raw Mode, the Configuration Header should be formatted as follows:



Table 1. CH TOC Item

Offset     Field       Size (Bytes)          Value                      Description

0x0000    Start                        4              0x000000a0            Offset from the start address of TOC to the actual address of a section

0x0004    Size                         4              0x00000050            Size of a section

0x0008    Reserved                4              0x00000000            Unused

0x000C    Reserved                4              0x00000000            Unused

0x0010    Reserved                4              0x00000000            Unused

0x0014    Filename                  12            0x45534843

                                                                0x4e495454

                                                                0x00005347            12-character name of a section, including the zero (\0) terminator (these are the ASCII                                                                                                                                      characters for 'CHSETTINGS')

0x0020    Closing item             4              0xFFFFFFFF

0x0024    Closing item             4              0xFFFFFFFF

0x0028    Closing item             4              0xFFFFFFFF

0x002C    Closing item             4              0xFFFFFFFF

0x0030    Closing item             4              0xFFFFFFFF

0x0034    Closing item             4              0xFFFFFFFF

0x0038    Closing item             4              0xFFFFFFFF

0x003C    Closing item             4              0xFFFFFFFF            32 bytes of 0xFF to signify the end of the TOC item





Table 2. CHSETTINGS

Offset     Field                       Value                      Description

0000h      Section key             0xC0C0C0C1           Key used for section verification

0004h      Valid                        0x00                        Enables/disables the section

                                                                                00h: Disable

                                                                                Other: Enable

0005h      Version                   0x001                      Configuration header version

                                                                                Others: For future use

0006h      Reserved                0x00                        Set the reset of the header (offset 0x6 to 0xe0) to 0x00

...

0xe0     Reserved           0x00





Image format for GP Device
A GP device involves no security, so keys and certificates are not required in the boot image.
When the booting memory device is non-XIP (for example, MMC) the image must contain a small header
(referred as GP header) with the size of the image and the destination address where to store it.
The GP header is not required when booting from an XIP memory device (for example, NOR) or if
peripheral booting. In this case, the peripheral or memory booting image starts directly with executable
code.


GPHeader:

Size            +0  32 bit          Size of executable+8 byte header.
Destination     +4  32 bit          address
Image           +8  xxx bytes.A     image

TOC:



------------------------------------------------------------------------

mkimage:
betelgeuse/ti-processor-sdk-linux-am437x-evm-03.03.00.04/board-support/u-boot-2016.05+gitAUTOINC+4db46a6bbd-g4db46a6bbd/sandbox/tools/mkimage

-T gpimage | omapimage

Prepend GP-header:
mkimage -T gpimage -a 0x402f4000 -d MLO gpMLO
mkimage -T omapimage -a 0x402f4000 -d BuildRoot.Rigel/output/images/MLO omapMLO

dd if=/mnt/omapMLO of=/dev/mmcblk1 bs=256K seek=3


The raw mode is detected by reading sectors #0 and #1024. The content of these sectors is then verified
for presence of a TOC structure as described in 10. In the case of a GP Device, a Configuration Header
(CH) must be located in the first sector followed by a GP header (1)
. The CH might be void (only containing
a CHSETTINGS item for which the valid field is zero).

dd if=/mnt/omapMLO of=/dev/mmcblk1 bs=512 seek=1024
dd if=/dev/mmcblk1 bs=512 skip=1024 count=1 | od -t x4 -v


fdisk is not capable of performing eMMC native partitioning, it just creates a "HD-like" partition table on the eMMC user partition.  For most purposes this is fine.  Note in particular that the ROM bootloader will only boot from the eMMC user partition, it does not use eMMC boot mode.

You can still access the (fixed-size) eMMC-native boot0 and boot1 partitions in linux, which may be useful to retain some data even if the "whole device" (in practice: the whole user partition) is reflashed. They may also have enhanced reliability compared to the user partition. They appear as separate block devices, /dev/mmcblk0boot{0,1}.  Presumably if the eMMC has GP partitions, those will also show up, though I haven't checked whether linux supports these yet (it would be easy to support them though since accessing them is similar to the boot partitions).

Note however that eMMC native partitioning (splitting off parts of the user partition as gp0-gp3) is one time programmable only, there's no way to change or undo it afterwards. This is probably part of why it's not very popular to use that functionality. I have no idea what tool can be used to perform it.

I'm not sure whether you can (currently) access the RPMB on linux. Access to it follows a very specific protocol that is unlike accessing a normal partition.




----------------------------


Panmesh:

- apt-get install quilt gcc-arm-none-eabi gdb-arm-none-eabi binutils-arm-none-eabi
- unzip terminal.zip
- make fortec
- src/device/addons/metering/*.c (two modules, readings & sampling)
- src/device/drivers/fortec/*.c (one module ~1400 LoC). Duplicate this & modify.
- Add new meter driver to management module.
- Add new meter driver to Makefile.
- Need to know how to drive the system to cause a reading to happen, configuration to be applied  etc.
- add config/ytl32001.mk







st-util 1.3.1-15-g3d24377
2017-09-26T14:58:40 INFO src/common.c: Loading device parameters....
2017-09-26T14:58:40 INFO src/common.c: Device connected is: F2 device, id 0x201f6411
2017-09-26T14:58:40 INFO src/common.c: SRAM size: 0x20000 bytes (128 KiB), Flash: 0x100000 bytes (1024 KiB) in pages of 131072 bytes
2017-09-26T14:58:40 INFO src/gdbserver/gdb-server.c: Chip ID is 00000411, Core ID is  2ba01477.
2017-09-26T14:58:40 INFO src/gdbserver/gdb-server.c: Listening at *:4242...
2017-09-26T15:01:00 INFO src/gdbserver/gdb-server.c: Found 6 hw breakpoint registers
2017-09-26T15:01:00 INFO src/gdbserver/gdb-server.c: GDB connected.
2017-09-26T15:01:04 INFO src/common.c: Attempting to write 65536 (0x10000) bytes to stm32 address: 134283264 (0x8010000)
Flash page at addr: 0x08010000 erased
2017-09-26T15:01:05 INFO src/common.c: Finished erasing 1 pages of 65536 (0x10000) bytes
2017-09-26T15:01:05 INFO src/common.c: Starting Flash write for F2/F4/L4
2017-09-26T15:01:05 INFO src/flash_loader.c: Successfully loaded flash loader in sram
enabling 32-bit flash writes
size: 32768
size: 32768
2017-09-26T15:01:06 INFO src/common.c: Starting verification of write complete
2017-09-26T15:01:07 INFO src/common.c: Flash written and verified! jolly good!
2017-09-26T15:01:07 INFO src/common.c: Attempting to write 131072 (0x20000) bytes to stm32 address: 134348800 (0x8020000)
Flash page at addr: 0x08020000 erased
2017-09-26T15:01:08 INFO src/common.c: Finished erasing 1 pages of 131072 (0x20000) bytes
2017-09-26T15:01:08 INFO src/common.c: Starting Flash write for F2/F4/L4
2017-09-26T15:01:08 INFO src/flash_loader.c: Successfully loaded flash loader in sram
enabling 32-bit flash writes
size: 32768
size: 32768
size: 32768
size: 32768
2017-09-26T15:01:10 INFO src/common.c: Starting verification of write complete
2017-09-26T15:01:11 INFO src/common.c: Flash written and verified! jolly good!
2017-09-26T15:01:11 INFO src/common.c: Attempting to write 131072 (0x20000) bytes to stm32 address: 134479872 (0x8040000)
Flash page at addr: 0x08040000 erased
2017-09-26T15:01:12 INFO src/common.c: Finished erasing 1 pages of 131072 (0x20000) bytes
2017-09-26T15:01:12 INFO src/common.c: Starting Flash write for F2/F4/L4
2017-09-26T15:01:12 INFO src/flash_loader.c: Successfully loaded flash loader in sram
enabling 32-bit flash writes
size: 32768
size: 32768
size: 32768
size: 32768
2017-09-26T15:01:14 INFO src/common.c: Starting verification of write complete
2017-09-26T15:01:15 INFO src/common.c: Flash written and verified! jolly good!




----------------------------------------

host-ctrlporthub

ctrlporthub -controllerport 4000 -serial /dev/ttyUSB0 -loglevel debug

./rpc_prodtest.py --setparam server.ip -v fd00::1
./rpc_prodtest.py --setparam prod.lowpan.eui64 -v 00-1B-C5-0C-60-00-7D-63
./rpc_prodtest.py --loadkey -s client-key -f ../00-1B-C5-0C-60-00-7D-63/node.key.der
./rpc_prodtest.py --loadkey -s client-cert -f ../00-1B-C5-0C-60-00-7D-63/node.crt.der
./rpc_prodtest.py --loadkey -s root-cert -f ../00-1B-C5-0C-60-00-7D-63/ca.crt.der
./rpc_prodtest.py --loadkey -s mac-key -f ../00-1B-C5-0C-60-00-7D-63/mac_key
./rpc_prodtest.py –finalize




debug-stm32.sh


openocd \
    -f interface/stlink-v2.cfg \
    -f target/stm32f2x.cfg \
    -c "init" \
    -c "reset init" \
    -c "halt" \


Place this in “terminal/tools/gdb” along with the others.

Then:
Arm-none-eabi-geb <whatever>.elf
Tar rem:3333
Load
Mon reset
C

make bootloader


7e20a04103289381bc14800102020607010104040869017e

----------------------------------------------

genus   : 7e a0 20 03 41 93 28 bc 81 80 14 05 02 01 00 06 02 01 00 07 04 00 00 00 01 08 04 00 00 00 01 69 6d 7e
original: 7E A0 21 4E 32 0A A5 41 93 75 E8 81 80 12 05 01 FF 06 01 FF 07 04 00 00 00 01 08 04 00 00 00 01 55 1C 7E
current : 7e a0 23 04 e6 42 d2 42 93 ec f3 81 80 14 05 02 01 00 06 02 01 00 07 04 00 00 00 01 08 04 00 00 00 01 69 6d 7e

<HDLC len="31" >
<TargetAddress Value="1" />
<SourceAddress Value="32" />
<PDU>
<Ua>
  <MaxInfoRX Value="256" />
  <MaxInfoTX Value="256" />
  <WindowSizeRX Value="1" />
  <WindowSizeTX Value="1" />
</Ua>
</PDU>
</HDLC>


O<HDLC len="32" >
<TargetAddress Value="82199250" />
<SourceAddress Value="32" />
<PDU>
<Ua>
  <MaxInfoRX Value="255" />
  <MaxInfoTX Value="255" />
  <WindowSizeRX Value="1" />
  <WindowSizeTX Value="1" />
</Ua>
</PDU>
</HDLC>



82199250 = 04 e6 42 d2

7e a0 20 03 41 93 28 bc 81 80 14 05 02 01 00 06 02 01 00 07 04 00 00 00 01 08 04 00 00 00 01 69 6d 7e

---------------------------------------------------------------

make ytl-insecure ipa1-bl-insecure host-ctrlporthub


build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -serial /dev/ttyUSB0

python tools/c4-tools/node-meter-bridge.py /dev/ttyUSB2 /dev/ttyUSB1

tools/gdb/debug-stm32.sh

arm-none-eabi-gdb -tui  build/ytl-dlms/bin/agent.elf

tools/c4-tools/coap_request.py --config device.dlms.lls_password '...'
tools/c4-tools/coap_request.py --config device.dlms.lls_password '12345678'

socat /dev/ttyUSB0,raw,echo=0,crnl /dev/ttyUSB1,raw,echo=0,crnl


tools/c4-tools/coap_request.py --config prod.lowpan.eui64 00-1b-c5-0c-60-00-bc-21

tools/c4-tools/coap_request.py --config prod.prodtime 1


---------------------------------------------------------------

<HDLC len="39" >
<TargetAddress Value="8" />
<SourceAddress Value="4011" />
<PDU>

<AssociationResponse>
  <ApplicationContextName Value="LN" />
  <AssociationResult Value="01" />
  <ResultSourceDiagnostic>
    <ACSEServiceUser Value="02" />
  </ResultSourceDiagnostic>
  <InitiateResponse>
    <NegotiatedDlmsVersionNumber Value="06" />
    <NegotiatedConformance>
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </NegotiatedConformance>
    <NegotiatedMaxPduSize Value="00B4" />
    <VaaName Value="0007" />
  </InitiateResponse>
</AssociationResponse>
</PDU>
</HDLC>


generated: 7e a0 23 4e 32 0a a5 41 93 ce df 81 80 14 05 02 01 00 06 02 01 00 07 04 00 00 00 01 08 04 00 00 00 01 69 6d 7e
original:  7E A0 21 4E 32 0A A5 41 93 75 E8 81 80 12 05 01 FF 06 01 FF 07 04 00 00 00 01 08 04 00 00 00 01 55 1C 7E


original:
7E A0 21        Frame type & length.
4E 32 0A A5     address
41              address
93              frame type (SNRM).
75 E8
81 80 12 05 01 FF 06 01 FF 07 04 00 00 00 01 08 04 00 00 00 01 55 1C 7E

generated:
7e a0 23        Frame type & length.
4e 32 0a a5     address
41              address
93              frame type (SNRM)
ce df
81 80 14 05 02 01 00 06 02 01 00 07 04 00 00 00 01 08 04 00 00 00 01 // connectLink.payload
69 6d
7e


4E 32 0A A5  == 4e 32 0a a5




original:  7E A0 21 4E 32 0A A5 41 93 75 E8 81 80 12 05 01 FF 06 01 FF 07 04 00 00 00 01 08 04 00 00 00 01 55 1C 7E
           7e a0 21 4e 32 0a a5 41 93 75 e8 81 80 12 05 01 ff 06 01 ff 07 04 00 00 00 01 08 04 00 00 00 01 55 1c 7e





A<-B: RX: 7ea021000200231193bbd28180120501ff0601ff070400000001080400000001551c7e
A->B: RX: 7ea0231100020023732602818014050200b4060200b407040000000108040000000115ca7e
A<-B: RX: 7ea0470002002311106098e6e6006036a1090607608574050801018a0207808b0760857405080201ac0a80083132333435363738be10040e01000000065f1f0400001f1fffffdc527e
A->B: RX: 7ea03a1100020023304986e6e7006129a109060760857405080101a203020101a305a103020102be10040e0800065f1f040000101000b400072a9b7e


theirs:
<HDLC len="46" >
<TargetAddress Value="4E642D2" />
<SourceAddress Value="20" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="3132333435363738" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="06" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
      <ConformanceBit Name="Attribute0SupportedWithGet" />
      <ConformanceBit Name="PriorityMgmtSupported" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="04B0" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>


Ours:
<HDLC len="46" >
<TargetAddress Value="4011" />
<SourceAddress Value="8" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="3132333435363738" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="06" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="FFFF" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

---------------------------------------
2017-10-03 16:16:19.172 #1   001bc50c600080d4 <log> 0:20:06.576 [ info] [        dlms] {   device}: Found register 0-0:1.0.0*255 ic 8 attrId 2  // clock
2017-10-03 16:16:19.172 #1   001bc50c600080d4 <log> 0:20:06.586 [ info] [        dlms] {   device}: Found register 1-0:0.1.2*255 ic 1 attrId 2
2017-10-03 16:16:19.172 #1   001bc50c600080d4 <log> 0:20:06.595 [ info] [        dlms] {   device}: Found register 1-0:31.7.0*255 ic 3 attrId 2 // L1 current
2017-10-03 16:16:19.215 #1   001bc50c600080d4 <log> 0:20:06.604 [ info] [        dlms] {   device}: Found register 1-0:51.7.0*255 ic 3 attrId 2 // L2 current
2017-10-03 16:16:19.215 #1   001bc50c600080d4 <log> 0:20:06.613 [ info] [        dlms] {   device}: Found register 1-0:71.7.0*255 ic 3 attrId 2 // L3 current
2017-10-03 16:16:19.215 #1   001bc50c600080d4 <log> 0:20:06.622 [ info] [        dlms] {   device}: Found register 1-0:32.7.0*255 ic 3 attrId 2 // L1 voltage
2017-10-03 16:16:19.215 #1   001bc50c600080d4 <log> 0:20:06.631 [ info] [        dlms] {   device}: Found register 1-0:52.7.0*255 ic 3 attrId 2 // L2 voltage
2017-10-03 16:16:19.215 #1   001bc50c600080d4 <log> 0:20:06.641 [ info] [        dlms] {   device}: Found register 1-0:72.7.0*255 ic 3 attrId 2 // L3 voltage
2017-10-03 16:16:19.258 #1   001bc50c600080d4 <log> 0:20:06.650 [ info] [        dlms] {   device}: Found register 1-0:81.7.4*255 ic 3 attrId 2
2017-10-03 16:16:19.258 #1   001bc50c600080d4 <log> 0:20:06.659 [ info] [        dlms] {   device}: Found register 1-0:81.7.15*255 ic 3 attrId 2
2017-10-03 16:16:19.258 #1   001bc50c600080d4 <log> 0:20:06.668 [ info] [        dlms] {   device}: Found register 1-0:81.7.26*255 ic 3 attrId 2
2017-10-03 16:16:19.259 #1   001bc50c600080d4 <log> 0:20:06.678 [ info] [        dlms] {   device}: Found register 1-0:13.7.0*255 ic 3 attrId 2 // system power factor
2017-10-03 16:16:19.259 #1   001bc50c600080d4 <log> 0:20:06.687 [ info] [        dlms] {   device}: Found register 1-0:33.7.0*255 ic 3 attrId 2 // L1 power factor
2017-10-03 16:16:19.302 #1   001bc50c600080d4 <log> 0:20:06.696 [ info] [        dlms] {   device}: Found register 1-0:53.7.0*255 ic 3 attrId 2 // L2 power factor
2017-10-03 16:16:19.302 #1   001bc50c600080d4 <log> 0:20:06.705 [ info] [        dlms] {   device}: Found register 1-0:73.7.0*255 ic 3 attrId 2 // L3 power factor
2017-10-03 16:16:19.302 #1   001bc50c600080d4 <log> 0:20:06.714 [ info] [        dlms] {   device}: Found register 1-0:1.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.302 #1   001bc50c600080d4 <log> 0:20:06.723 [ info] [        dlms] {   device}: Found register 1-0:2.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.345 #1   001bc50c600080d4 <log> 0:20:06.732 [ info] [        dlms] {   device}: Found register 1-0:21.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.345 #1   001bc50c600080d4 <log> 0:20:06.742 [ info] [        dlms] {   device}: Found register 1-0:22.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.345 #1   001bc50c600080d4 <log> 0:20:06.751 [ info] [        dlms] {   device}: Found register 1-0:41.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.345 #1   001bc50c600080d4 <log> 0:20:06.760 [ info] [        dlms] {   device}: Found register 1-0:42.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.345 #1   001bc50c600080d4 <log> 0:20:06.769 [ info] [        dlms] {   device}: Found register 1-0:61.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.388 #1   001bc50c600080d4 <log> 0:20:06.778 [ info] [        dlms] {   device}: Found register 1-0:62.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.388 #1   001bc50c600080d4 <log> 0:20:06.788 [ info] [        dlms] {   device}: Found register 1-0:3.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.388 #1   001bc50c600080d4 <log> 0:20:06.797 [ info] [        dlms] {   device}: Found register 1-0:4.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.388 #1   001bc50c600080d4 <log> 0:20:06.806 [ info] [        dlms] {   device}: Found register 1-0:23.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.388 #1   001bc50c600080d4 <log> 0:20:06.815 [ info] [        dlms] {   device}: Found register 1-0:24.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.432 #1   001bc50c600080d4 <log> 0:20:06.824 [ info] [        dlms] {   device}: Found register 1-0:43.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.432 #1   001bc50c600080d4 <log> 0:20:06.833 [ info] [        dlms] {   device}: Found register 1-0:44.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.432 #1   001bc50c600080d4 <log> 0:20:06.842 [ info] [        dlms] {   device}: Found register 1-0:63.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.432 #1   001bc50c600080d4 <log> 0:20:06.852 [ info] [        dlms] {   device}: Found register 1-0:64.7.0*255 ic 3 attrId 2
2017-10-03 16:16:19.475 #1   001bc50c600080d4 <log> 0:20:06.861 [ info] [        dlms] {   device}: Found register 1-0:1.6.0*255 ic 5 attrId 2
2017-10-03 16:16:19.475 #1   001bc50c600080d4 <log> 0:20:06.870 [ info] [        dlms] {   device}: Found register 1-0:1.6.1*255 ic 5 attrId 2
2017-10-03 16:16:19.475 #1   001bc50c600080d4 <log> 0:20:06.879 [ info] [        dlms] {   device}: Found register 1-0:1.6.2*255 ic 5 attrId 2
2017-10-03 16:16:19.475 #1   001bc50c600080d4 <log> 0:20:06.888 [ info] [        dlms] {   device}: Found register 1-0:1.6.3*255 ic 5 attrId 2
2017-10-03 16:16:19.475 #1   001bc50c600080d4 <log> 0:20:06.897 [ info] [        dlms] {   device}: Found register 1-0:1.6.4*255 ic 5 attrId 2
2017-10-03 16:16:19.519 #1   001bc50c600080d4 <log> 0:20:06.906 [ info] [        dlms] {   device}: Found register 1-0:2.6.0*255 ic 5 attrId 2
2017-10-03 16:16:19.519 #1   001bc50c600080d4 <log> 0:20:06.915 [ info] [        dlms] {   device}: Found register 1-0:2.6.1*255 ic 5 attrId 2
2017-10-03 16:16:19.519 #1   001bc50c600080d4 <log> 0:20:06.924 [ info] [        dlms] {   device}: Found register 1-0:2.6.2*255 ic 5 attrId 2
2017-10-03 16:16:19.519 #1   001bc50c600080d4 <log> 0:20:06.934 [ info] [        dlms] {   device}: Found register 1-0:2.6.3*255 ic 5 attrId 2
2017-10-03 16:16:19.519 #1   001bc50c600080d4 <log> 0:20:06.943 [ info] [        dlms] {   device}: Found register 1-0:2.6.4*255 ic 5 attrId 2
2017-10-03 16:16:19.562 #1   001bc50c600080d4 <log> 0:20:06.952 [ info] [        dlms] {   device}: Found register 1-0:1.8.0*255 ic 3 attrId 2
2017-10-03 16:16:19.562 #1   001bc50c600080d4 <log> 0:20:06.961 [ info] [        dlms] {   device}: Found register 1-0:1.8.1*255 ic 3 attrId 2
2017-10-03 16:16:19.562 #1   001bc50c600080d4 <log> 0:20:06.970 [ info] [        dlms] {   device}: Found register 1-0:1.8.2*255 ic 3 attrId 2
2017-10-03 16:16:19.562 #1   001bc50c600080d4 <log> 0:20:06.979 [ info] [        dlms] {   device}: Found register 1-0:1.8.3*255 ic 3 attrId 2
2017-10-03 16:16:19.562 #1   001bc50c600080d4 <log> 0:20:06.988 [ info] [        dlms] {   device}: Found register 1-0:1.8.4*255 ic 3 attrId 2
2017-10-03 16:16:19.605 #1   001bc50c600080d4 <log> 0:20:06.997 [ info] [        dlms] {   device}: Found register 1-0:2.8.0*255 ic 3 attrId 2
2017-10-03 16:16:19.605 #1   001bc50c600080d4 <log> 0:20:07.006 [ info] [        dlms] {   device}: Found register 1-0:2.8.1*255 ic 3 attrId 2
2017-10-03 16:16:19.605 #1   001bc50c600080d4 <log> 0:20:07.015 [ info] [        dlms] {   device}: Found register 1-0:2.8.2*255 ic 3 attrId 2
2017-10-03 16:16:19.605 #1   001bc50c600080d4 <log> 0:20:07.024 [ info] [        dlms] {   device}: Found register 1-0:2.8.3*255 ic 3 attrId 2
2017-10-03 16:16:19.605 #1   001bc50c600080d4 <log> 0:20:07.034 [ info] [        dlms] {   device}: Found register 1-0:2.8.4*255 ic 3 attrId 2
2017-10-03 16:16:19.648 #1   001bc50c600080d4 <log> 0:20:07.043 [ info] [        dlms] {   device}: Found register 1-0:1.2.0*255 ic 3 attrId 2
2017-10-03 16:16:19.648 #1   001bc50c600080d4 <log> 0:20:07.052 [ info] [        dlms] {   device}: Found register 1-0:1.2.1*255 ic 3 attrId 2
2017-10-03 16:16:19.648 #1   001bc50c600080d4 <log> 0:20:07.061 [ info] [        dlms] {   device}: Found register 1-0:1.2.2*255 ic 3 attrId 2
2017-10-03 16:16:19.648 #1   001bc50c600080d4 <log> 0:20:07.070 [ info] [        dlms] {   device}: Found register 1-0:1.2.3*255 ic 3 attrId 2
2017-10-03 16:16:19.692 #1   001bc50c600080d4 <log> 0:20:07.079 [ info] [        dlms] {   device}: Found register 1-0:1.2.4*255 ic 3 attrId 2
2017-10-03 16:16:19.692 #1   001bc50c600080d4 <log> 0:20:07.088 [ info] [        dlms] {   device}: Found register 1-0:2.2.0*255 ic 3 attrId 2
2017-10-03 16:16:19.692 #1   001bc50c600080d4 <log> 0:20:07.097 [ info] [        dlms] {   device}: Found register 1-0:2.2.1*255 ic 3 attrId 2
2017-10-03 16:16:19.692 #1   001bc50c600080d4 <log> 0:20:07.106 [ info] [        dlms] {   device}: Found register 1-0:2.2.2*255 ic 3 attrId 2
2017-10-03 16:16:19.692 #1   001bc50c600080d4 <log> 0:20:07.115 [ info] [        dlms] {   device}: Found register 1-0:2.2.3*255 ic 3 attrId 2
2017-10-03 16:16:19.735 #1   001bc50c600080d4 <log> 0:20:07.124 [ info] [        dlms] {   device}: Found register 1-0:2.2.4*255 ic 3 attrId 2
2017-10-03 16:16:19.735 #1   001bc50c600080d4 <log> 0:20:07.133 [ info] [        dlms] {   device}: Found register 1-0:3.6.0*255 ic 5 attrId 2
2017-10-03 16:16:19.735 #1   001bc50c600080d4 <log> 0:20:07.143 [ info] [        dlms] {   device}: Found register 1-0:3.6.1*255 ic 5 attrId 2
2017-10-03 16:16:19.735 #1   001bc50c600080d4 <log> 0:20:07.152 [ info] [        dlms] {   device}: Found register 1-0:3.6.2*255 ic 5 attrId 2
2017-10-03 16:16:19.735 #1   001bc50c600080d4 <log> 0:20:07.161 [ info] [        dlms] {   device}: Found register 1-0:3.6.3*255 ic 5 attrId 2
2017-10-03 16:16:19.779 #1   001bc50c600080d4 <log> 0:20:07.170 [ info] [        dlms] {   device}: Found register 1-0:3.6.4*255 ic 5 attrId 2
2017-10-03 16:16:19.779 #1   001bc50c600080d4 <log> 0:20:07.179 [ info] [        dlms] {   device}: Found register 1-0:4.6.0*255 ic 5 attrId 2
2017-10-03 16:16:19.779 #1   001bc50c600080d4 <log> 0:20:07.188 [ info] [        dlms] {   device}: Found register 1-0:4.6.1*255 ic 5 attrId 2
2017-10-03 16:16:19.779 #1   001bc50c600080d4 <log> 0:20:07.197 [ info] [        dlms] {   device}: Found register 1-0:4.6.2*255 ic 5 attrId 2
2017-10-03 16:16:19.779 #1   001bc50c600080d4 <log> 0:20:07.206 [ info] [        dlms] {   device}: Found register 1-0:4.6.3*255 ic 5 attrId 2
2017-10-03 16:16:19.822 #1   001bc50c600080d4 <log> 0:20:07.215 [ info] [        dlms] {   device}: Found register 1-0:4.6.4*255 ic 5 attrId 2
2017-10-03 16:16:19.822 #1   001bc50c600080d4 <log> 0:20:07.224 [ info] [        dlms] {   device}: Found register 1-0:3.8.0*255 ic 3 attrId 2
2017-10-03 16:16:19.822 #1   001bc50c600080d4 <log> 0:20:07.233 [ info] [        dlms] {   device}: Found register 1-0:3.8.1*255 ic 3 attrId 2
2017-10-03 16:16:19.822 #1   001bc50c600080d4 <log> 0:20:07.243 [ info] [        dlms] {   device}: Found register 1-0:3.8.2*255 ic 3 attrId 2
2017-10-03 16:16:19.865 #1   001bc50c600080d4 <log> 0:20:07.252 [ info] [        dlms] {   device}: Found register 1-0:3.8.3*255 ic 3 attrId 2
2017-10-03 16:16:19.865 #1   001bc50c600080d4 <log> 0:20:07.261 [ info] [        dlms] {   device}: Found register 1-0:3.8.4*255 ic 3 attrId 2
2017-10-03 16:16:19.865 #1   001bc50c600080d4 <log> 0:20:07.270 [ info] [        dlms] {   device}: Found register 1-0:4.8.0*255 ic 3 attrId 2
2017-10-03 16:16:19.865 #1   001bc50c600080d4 <log> 0:20:07.279 [ info] [        dlms] {   device}: Found register 1-0:4.8.1*255 ic 3 attrId 2
2017-10-03 16:16:19.865 #1   001bc50c600080d4 <log> 0:20:07.288 [ info] [        dlms] {   device}: Found register 1-0:4.8.2*255 ic 3 attrId 2
2017-10-03 16:16:19.909 #1   001bc50c600080d4 <log> 0:20:07.297 [ info] [        dlms] {   device}: Found register 1-0:4.8.3*255 ic 3 attrId 2
2017-10-03 16:16:19.909 #1   001bc50c600080d4 <log> 0:20:07.306 [ info] [        dlms] {   device}: Found register 1-0:4.8.4*255 ic 3 attrId 2
2017-10-03 16:16:19.909 #1   001bc50c600080d4 <log> 0:20:07.315 [ info] [        dlms] {   device}: Found register 1-0:3.2.0*255 ic 3 attrId 2
2017-10-03 16:16:19.909 #1   001bc50c600080d4 <log> 0:20:07.324 [ info] [        dlms] {   device}: Found register 1-0:3.2.1*255 ic 3 attrId 2
2017-10-03 16:16:19.909 #1   001bc50c600080d4 <log> 0:20:07.333 [ info] [        dlms] {   device}: Found register 1-0:3.2.2*255 ic 3 attrId 2
2017-10-03 16:16:19.952 #1   001bc50c600080d4 <log> 0:20:07.343 [ info] [        dlms] {   device}: Found register 1-0:3.2.3*255 ic 3 attrId 2
2017-10-03 16:16:19.952 #1   001bc50c600080d4 <log> 0:20:07.352 [ info] [        dlms] {   device}: Found register 1-0:3.2.4*255 ic 3 attrId 2
2017-10-03 16:16:19.952 #1   001bc50c600080d4 <log> 0:20:07.361 [ info] [        dlms] {   device}: Found register 1-0:4.2.0*255 ic 3 attrId 2
2017-10-03 16:16:19.952 #1   001bc50c600080d4 <log> 0:20:07.370 [ info] [        dlms] {   device}: Found register 1-0:4.2.1*255 ic 3 attrId 2
2017-10-03 16:16:19.952 #1   001bc50c600080d4 <log> 0:20:07.379 [ info] [        dlms] {   device}: Found register 1-0:4.2.2*255 ic 3 attrId 2
2017-10-03 16:16:20.005 #1   001bc50c600080d4 <log> 0:20:07.388 [ info] [        dlms] {   device}: Found register 1-0:4.2.3*255 ic 3 attrId 2
2017-10-03 16:16:20.005 #1   001bc50c600080d4 <log> 0:20:07.397 [ info] [        dlms] {   device}: Found register 1-0:4.2.3*255 ic 3 attrId 2
2017-10-03 16:16:20.005 #1   001bc50c600080d4 <log> 0:20:07.406 [ info] [        dlms] {   device}: Found register 0-0:1.0.0*255 ic 8 attrId 3
2017-10-03 16:16:20.005 #1   001bc50c600080d4 <log> 0:20:07.415 [ info] [        dlms] {   device}: Found 92 registers in IS Profile object

---------------------------------------------------------


dlmsParseProfileCaptureObjects()
dlmsGetIsProfileObject()
ProfileObject


s_isProfileObjects[j].instantObject.code
s_isProfileObjects[index].scalerIndex
s_isProfileObjects[j].attrId


-----------------------------------


MessageReadoutRequest:
request->type == ReadingReadoutPeriodicSample
s_isActiveIsProfile == true

processIsProfileResponse() gets called for response.

s_currentMsg->x.readoutRequest.request.type = ReadingReadoutPeriodicSample



dlmsGetParseFn(s_currentObj, s_readingState);
dlmsGetParseFn(const CosemData* object, int8_t attribute)





2017-10-13 11:25:10.531 #1   001bc50c6000bc21 <log> 0:03:13.502 [ info] [   meter/ytl] {   device}: Reading ready 91/91
2017-10-13 11:25:10.531 #1   001bc50c6000bc21 <log> 0:03:13.509 [ info] [   meter/ytl] {   device}: --- processIsProfileResponse (4) ---
2017-10-13 11:25:10.531 #1   001bc50c6000bc21 <log> 0:03:13.517 [ info] [   meter/ytl] {   device}: ---- Register 0:  ----
2017-10-13 11:25:10.531 #1   001bc50c6000bc21 <log> 0:03:13.524 [ info] [   meter/ytl] {   device}: ---- Register 1:  ----
2017-10-13 11:25:10.531 #1   001bc50c6000bc21 <log> 0:03:13.532 [ info] [   meter/ytl] {   device}: ---- Register 2: 0.000 *10^0 A ----
2017-10-13 11:25:10.574 #1   001bc50c6000bc21 <log> 0:03:13.540 [ info] [   meter/ytl] {   device}: ---- Register 3: 0.024 *10^0 A ----
2017-10-13 11:25:10.574 #1   001bc50c6000bc21 <log> 0:03:13.548 [ info] [   meter/ytl] {   device}: ---- Register 4: 0.000 *10^0 A ----
2017-10-13 11:25:10.574 #1   001bc50c6000bc21 <log> 0:03:13.557 [ info] [   meter/ytl] {   device}: ---- Register 5: 0.000 *10^0 V ----
2017-10-13 11:25:10.574 #1   001bc50c6000bc21 <log> 0:03:13.565 [ info] [   meter/ytl] {   device}: ---- Register 6: 0.006 *10^0 V ----
2017-10-13 11:25:10.574 #1   001bc50c6000bc21 <log> 0:03:13.574 [ info] [   meter/ytl] {   device}: ---- Register 7: 0.000 *10^0 V ----
2017-10-13 11:25:10.617 #1   001bc50c6000bc21 <log> 0:03:13.582 [ info] [   meter/ytl] {   device}: ---- Register 8: 0.000 *10^0 degree ----
2017-10-13 11:25:10.617 #1   001bc50c6000bc21 <log> 0:03:13.591 [ info] [   meter/ytl] {   device}: ---- Register 9: 0.000 *10^0 degree ----
2017-10-13 11:25:10.617 #1   001bc50c6000bc21 <log> 0:03:13.600 [ info] [   meter/ytl] {   device}: ---- Register 10: 0.000 *10^0 degree ----
2017-10-13 11:25:10.617 #1   001bc50c6000bc21 <log> 0:03:13.608 [ info] [   meter/ytl] {   device}: ---- Register 11: 0.000 *10^0  ----
2017-10-13 11:25:10.617 #1   001bc50c6000bc21 <log> 0:03:13.617 [ info] [   meter/ytl] {   device}: ---- Register 12: 0.000 *10^0  ----
2017-10-13 11:25:10.659 #1   001bc50c6000bc21 <log> 0:03:13.625 [ info] [   meter/ytl] {   device}: ---- Register 13: 0.006 *10^0  ----
2017-10-13 11:25:10.659 #1   001bc50c6000bc21 <log> 0:03:13.634 [ info] [   meter/ytl] {   device}: ---- Register 14: 0.000 *10^0  ----
2017-10-13 11:25:10.659 #1   001bc50c6000bc21 <log> 0:03:13.642 [ info] [   meter/ytl] {   device}: ---- Register 15: 1.000 *10^3 W ----
2017-10-13 11:25:10.660 #1   001bc50c6000bc21 <log> 0:03:13.650 [ info] [   meter/ytl] {   device}: ---- Register 16: 0.000 *10^3 W ----
2017-10-13 11:25:10.660 #1   001bc50c6000bc21 <log> 0:03:13.659 [ info] [   meter/ytl] {   device}: ---- Register 17: 0.000 *10^3 W ----
2017-10-13 11:25:10.702 #1   001bc50c6000bc21 <log> 0:03:13.667 [ info] [   meter/ytl] {   device}: ---- Register 18: 0.000 *10^3 W ----
2017-10-13 11:25:10.702 #1   001bc50c6000bc21 <log> 0:03:13.676 [ info] [   meter/ytl] {   device}: ---- Register 19: 0.000 *10^3 W ----
2017-10-13 11:25:10.702 #1   001bc50c6000bc21 <log> 0:03:13.684 [ info] [   meter/ytl] {   device}: ---- Register 20: 0.000 *10^3 W ----
2017-10-13 11:25:10.702 #1   001bc50c6000bc21 <log> 0:03:13.693 [ info] [   meter/ytl] {   device}: ---- Register 21: 0.005 *10^3 W ----
2017-10-13 11:25:10.702 #1   001bc50c6000bc21 <log> 0:03:13.701 [ info] [   meter/ytl] {   device}: ---- Register 22: 0.006 *10^3 W ----
2017-10-13 11:25:10.745 #1   001bc50c6000bc21 <log> 0:03:13.710 [ info] [   meter/ytl] {   device}: ---- Register 23: 0.000 *10^3 var ----
2017-10-13 11:25:10.745 #1   001bc50c6000bc21 <log> 0:03:13.718 [ info] [   meter/ytl] {   device}: ---- Register 24: 0.000 *10^3 var ----
2017-10-13 11:25:10.745 #1   001bc50c6000bc21 <log> 0:03:13.727 [ info] [   meter/ytl] {   device}: ---- Register 25: 0.000 *10^3 var ----
2017-10-13 11:25:10.745 #1   001bc50c6000bc21 <log> 0:03:13.736 [ info] [   meter/ytl] {   device}: ---- Register 26: 0.000 *10^3 var ----
2017-10-13 11:25:10.745 #1   001bc50c6000bc21 <log> 0:03:13.744 [ info] [   meter/ytl] {   device}: ---- Register 27: 0.000 *10^3 var ----
2017-10-13 11:25:10.788 #1   001bc50c6000bc21 <log> 0:03:13.753 [ info] [   meter/ytl] {   device}: ---- Register 28: 0.000 *10^3 var ----
2017-10-13 11:25:10.788 #1   001bc50c6000bc21 <log> 0:03:13.762 [ info] [   meter/ytl] {   device}: ---- Register 29: 0.000 *10^3 var ----
2017-10-13 11:25:10.788 #1   001bc50c6000bc21 <log> 0:03:13.770 [ info] [   meter/ytl] {   device}: ---- Register 30: 0.000 *10^3 var ----
2017-10-13 11:25:10.788 #1   001bc50c6000bc21 <log> 0:03:13.779 [ info] [   meter/ytl] {   device}: ---- Register 31: 0.000 *10^3 W ----
2017-10-13 11:25:10.788 #1   001bc50c6000bc21 <log> 0:03:13.787 [ info] [   meter/ytl] {   device}: ---- Register 32: 0.000 *10^3 W ----
2017-10-13 11:25:10.830 #1   001bc50c6000bc21 <log> 0:03:13.796 [ info] [   meter/ytl] {   device}: ---- Register 33: 0.000 *10^3 W ----
2017-10-13 11:25:10.830 #1   001bc50c6000bc21 <log> 0:03:13.804 [ info] [   meter/ytl] {   device}: ---- Register 34: 0.000 *10^3 W ----
2017-10-13 11:25:10.830 #1   001bc50c6000bc21 <log> 0:03:13.813 [ info] [   meter/ytl] {   device}: ---- Register 35: 0.000 *10^3 W ----
2017-10-13 11:25:10.830 #1   001bc50c6000bc21 <log> 0:03:13.821 [ info] [   meter/ytl] {   device}: ---- Register 36: 0.000 *10^3 W ----
2017-10-13 11:25:10.830 #1   001bc50c6000bc21 <log> 0:03:13.830 [ info] [   meter/ytl] {   device}: ---- Register 37: 0.000 *10^3 W ----
2017-10-13 11:25:10.873 #1   001bc50c6000bc21 <log> 0:03:13.838 [ info] [   meter/ytl] {   device}: ---- Register 38: 0.000 *10^3 W ----
2017-10-13 11:25:10.873 #1   001bc50c6000bc21 <log> 0:03:13.847 [ info] [   meter/ytl] {   device}: ---- Register 39: 0.000 *10^3 W ----
2017-10-13 11:25:10.873 #1   001bc50c6000bc21 <log> 0:03:13.855 [ info] [   meter/ytl] {   device}: ---- Register 40: 0.000 *10^3 W ----
2017-10-13 11:25:10.873 #1   001bc50c6000bc21 <log> 0:03:13.864 [ info] [   meter/ytl] {   device}: ---- Register 41: 1.000 *10^3 Wh ----
2017-10-13 11:25:10.873 #1   001bc50c6000bc21 <log> 0:03:13.872 [ info] [   meter/ytl] {   device}: ---- Register 42: 1.000 *10^3 Wh ----
2017-10-13 11:25:10.916 #1   001bc50c6000bc21 <log> 0:03:13.881 [ info] [   meter/ytl] {   device}: ---- Register 43: 1.000 *10^3 Wh ----
2017-10-13 11:25:10.916 #1   001bc50c6000bc21 <log> 0:03:13.889 [ info] [   meter/ytl] {   device}: ---- Register 44: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.916 #1   001bc50c6000bc21 <log> 0:03:13.898 [ info] [   meter/ytl] {   device}: ---- Register 45: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.916 #1   001bc50c6000bc21 <log> 0:03:13.907 [ info] [   meter/ytl] {   device}: ---- Register 46: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.916 #1   001bc50c6000bc21 <log> 0:03:13.915 [ info] [   meter/ytl] {   device}: ---- Register 47: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.958 #1   001bc50c6000bc21 <log> 0:03:13.924 [ info] [   meter/ytl] {   device}: ---- Register 48: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.958 #1   001bc50c6000bc21 <log> 0:03:13.932 [ info] [   meter/ytl] {   device}: ---- Register 49: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.958 #1   001bc50c6000bc21 <log> 0:03:13.941 [ info] [   meter/ytl] {   device}: ---- Register 50: 0.000 *10^3 Wh ----
2017-10-13 11:25:10.958 #1   001bc50c6000bc21 <log> 0:03:13.949 [ info] [   meter/ytl] {   device}: ---- Register 51: 2 *10^3 W ----
2017-10-13 11:25:10.958 #1   001bc50c6000bc21 <log> 0:03:13.957 [ info] [   meter/ytl] {   device}: ---- Register 52: 0.000 *10^3 W ----
2017-10-13 11:25:11.001 #1   001bc50c6000bc21 <log> 0:03:13.966 [ info] [   meter/ytl] {   device}: ---- Register 53: 0.000 *10^3 W ----
2017-10-13 11:25:11.001 #1   001bc50c6000bc21 <log> 0:03:13.974 [ info] [   meter/ytl] {   device}: ---- Register 54: 0.000 *10^3 W ----
2017-10-13 11:25:11.001 #1   001bc50c6000bc21 <log> 0:03:13.983 [ info] [   meter/ytl] {   device}: ---- Register 55: 247.589 *10^3 W ----
2017-10-13 11:25:11.001 #1   001bc50c6000bc21 <log> 0:03:13.992 [ info] [   meter/ytl] {   device}: ---- Register 56: 0.000 *10^3 W ----
2017-10-13 11:25:11.001 #1   001bc50c6000bc21 <log> 0:03:14.000 [ info] [   meter/ytl] {   device}: ---- Register 57: 0.000 *10^3 W ----
2017-10-13 11:25:11.044 #1   001bc50c6000bc21 <log> 0:03:14.009 [ info] [   meter/ytl] {   device}: ---- Register 58: 0.000 *10^3 W ----
2017-10-13 11:25:11.044 #1   001bc50c6000bc21 <log> 0:03:14.017 [ info] [   meter/ytl] {   device}: ---- Register 59: 0.000 *10^3 W ----
2017-10-13 11:25:11.044 #1   001bc50c6000bc21 <log> 0:03:14.025 [ info] [   meter/ytl] {   device}: ---- Register 60: 0.000 *10^3 W ----
2017-10-13 11:25:11.044 #1   001bc50c6000bc21 <log> 0:03:14.034 [ info] [   meter/ytl] {   device}: ---- Register 61: 0.000 *10^3 var ----
2017-10-13 11:25:11.044 #1   001bc50c6000bc21 <log> 0:03:14.043 [ info] [   meter/ytl] {   device}: ---- Register 62: 0.000 *10^3 var ----
2017-10-13 11:25:11.087 #1   001bc50c6000bc21 <log> 0:03:14.051 [ info] [   meter/ytl] {   device}: ---- Register 63: 0.000 *10^3 var ----
2017-10-13 11:25:11.087 #1   001bc50c6000bc21 <log> 0:03:14.060 [ info] [   meter/ytl] {   device}: ---- Register 64: 0.003 *10^3 var ----
2017-10-13 11:25:11.087 #1   001bc50c6000bc21 <log> 0:03:14.069 [ info] [   meter/ytl] {   device}: ---- Register 65: 0.000 *10^3 var ----
2017-10-13 11:25:11.087 #1   001bc50c6000bc21 <log> 0:03:14.077 [ info] [   meter/ytl] {   device}: ---- Register 66: 0.000 *10^3 var ----
2017-10-13 11:25:11.087 #1   001bc50c6000bc21 <log> 0:03:14.086 [ info] [   meter/ytl] {   device}: ---- Register 67: 0.000 *10^3 var ----
2017-10-13 11:25:11.129 #1   001bc50c6000bc21 <log> 0:03:14.094 [ info] [   meter/ytl] {   device}: ---- Register 68: 0.000 *10^3 var ----
2017-10-13 11:25:11.129 #1   001bc50c6000bc21 <log> 0:03:14.103 [ info] [   meter/ytl] {   device}: ---- Register 69: 0.000 *10^3 var ----
2017-10-13 11:25:11.129 #1   001bc50c6000bc21 <log> 0:03:14.112 [ info] [   meter/ytl] {   device}: ---- Register 70: 0.000 *10^3 var ----
2017-10-13 11:25:11.129 #1   001bc50c6000bc21 <log> 0:03:14.120 [ info] [   meter/ytl] {   device}: ---- Register 71: 0.001 *10^3 varh ----
2017-10-13 11:25:11.129 #1   001bc50c6000bc21 <log> 0:03:14.129 [ info] [   meter/ytl] {   device}: ---- Register 72: 0.000 *10^3 varh ----
2017-10-13 11:25:11.172 #1   001bc50c6000bc21 <log> 0:03:14.138 [ info] [   meter/ytl] {   device}: ---- Register 73: 0.000 *10^3 varh ----
2017-10-13 11:25:11.172 #1   001bc50c6000bc21 <log> 0:03:14.147 [ info] [   meter/ytl] {   device}: ---- Register 74: 0.000 *10^3 varh ----
2017-10-13 11:25:11.172 #1   001bc50c6000bc21 <log> 0:03:14.155 [ info] [   meter/ytl] {   device}: ---- Register 75: 0.000 *10^3 varh ----
2017-10-13 11:25:11.172 #1   001bc50c6000bc21 <log> 0:03:14.164 [ info] [   meter/ytl] {   device}: ---- Register 76: 0.000 *10^3 varh ----
2017-10-13 11:25:11.172 #1   001bc50c6000bc21 <log> 0:03:14.173 [ info] [   meter/ytl] {   device}: ---- Register 77: 0.000 *10^3 varh ----
2017-10-13 11:25:11.215 #1   001bc50c6000bc21 <log> 0:03:14.182 [ info] [   meter/ytl] {   device}: ---- Register 78: 0.000 *10^3 varh ----
2017-10-13 11:25:11.215 #1   001bc50c6000bc21 <log> 0:03:14.190 [ info] [   meter/ytl] {   device}: ---- Register 79: 0.000 *10^3 varh ----
2017-10-13 11:25:11.215 #1   001bc50c6000bc21 <log> 0:03:14.199 [ info] [   meter/ytl] {   device}: ---- Register 80: 0.000 *10^3 varh ----
2017-10-13 11:25:11.215 #1   001bc50c6000bc21 <log> 0:03:14.208 [ info] [   meter/ytl] {   device}: ---- Register 81: 0.000 *10^3 var ----
2017-10-13 11:25:11.215 #1   001bc50c6000bc21 <log> 0:03:14.216 [ info] [   meter/ytl] {   device}: ---- Register 82: 0.000 *10^3 var ----
2017-10-13 11:25:11.258 #1   001bc50c6000bc21 <log> 0:03:14.225 [ info] [   meter/ytl] {   device}: ---- Register 83: 0.000 *10^3 var ----
2017-10-13 11:25:11.258 #1   001bc50c6000bc21 <log> 0:03:14.234 [ info] [   meter/ytl] {   device}: ---- Register 84: 0.000 *10^3 var ----
2017-10-13 11:25:11.258 #1   001bc50c6000bc21 <log> 0:03:14.242 [ info] [   meter/ytl] {   device}: ---- Register 85: 0.000 *10^3 var ----
2017-10-13 11:25:11.258 #1   001bc50c6000bc21 <log> 0:03:14.251 [ info] [   meter/ytl] {   device}: ---- Register 86: 0.000 *10^3 var ----
2017-10-13 11:25:11.258 #1   001bc50c6000bc21 <log> 0:03:14.260 [ info] [   meter/ytl] {   device}: ---- Register 87: 0.000 *10^3 var ----
2017-10-13 11:25:11.294 #1   001bc50c6000bc21 <log> 0:03:14.268 [ info] [   meter/ytl] {   device}: ---- Register 88: 0.000 *10^3 var ----
2017-10-13 11:25:11.294 #1   001bc50c6000bc21 <log> 0:03:14.277 [ info] [   meter/ytl] {   device}: ---- Register 89: 0.000 *10^3 var ----
2017-10-13 11:25:11.294 #1   001bc50c6000bc21 <log> 0:03:14.286 [ info] [   meter/ytl] {   device}: ---- Register 90: 0.000 *10^3 var ----
2017-10-13 11:25:11.355 #1   001bc50c6000bc21 <log> 0:03:14.344 [ info] [        dlms] {   device}: Disconnect HDLC link





-------------------------------


load profile


sampleComplexProfiles()


request for load profile buffer.
0x01, 0x02, 0x04, 0x02, 0x04,
DLMS_TYPE_U_LONG, 0x00, 0x08, 0x09, 0x06, 0x00, 0x00, 0x01, 0x00, 0x00, 0xff,
DLMS_TYPE_INTEGER, 0x02,
DLMS_TYPE_U_LONG, 0x00, 0x00,
'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x',
'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x',
0x01, 0x00 // All columns to retrieve


<GetRequest>
  <GetRequestNormal>
    <InvokeIdAndPriority Value="131" />
    <AttributeDescriptor>
      <!--PROFILE_GENERIC-->
      <ClassId Value="7" />
      <!--1.0.99.1.1.255-->
      <InstanceId Value="0100630101FF" />
      <AttributeId Value="2" />
    </AttributeDescriptor>
    <AccessSelection>
      <AccessSelector Value="1" />
      <AccessParameters>
        <Structure Qty="4" >
          <Structure Qty="4" >
            <UInt16 Value="8" />
            <!--0.0.1.0.0.255-->
            <OctetString Value="0000010000FF" />
            <Int8 Value="2" />
            <UInt16 Value="0" />
          </Structure>
          <!--2016-11-28 10:00:00-->
          <OctetString Value="07E00B1CFF0A000000FFFFFF" />
          <!--2016-11-29 00:00:00-->
          <OctetString Value="07E00B1DFF00000000FFFFFF" />
          <Array Qty="0" >
          </Array>
        </Structure>
      </AccessParameters>
    </AccessSelection>
  </GetRequestNormal>
</GetRequest>

processComplexSampleResponse()



processComplexSampleResponse()
 -> profileSampleCreate()

bad frame:
7e a023 00020023 41 93 f736 818014050200b4060200b407040000000108040000000 115ca 7e

7e a013 41 00020023 30 92e4 e6e700 0e010600 3ef5 7e


7e a04b 00020023 41 32 1df8 e6e600
c001 81 00 070100630101ff0201010204020412000809060000010000ff0f0212000007d0010400021500ff80000007d0010400021800ff8000000100
00d3
7e


07d0010400021500ff80000007d0010400021800ff800000010000d37e


c001 81 00 0701005e4200ff0201010204020412000809060000010000ff0f0212000007d0010400021500ff80000007d0010400021800ff8000000100



pbEncodeDataProfileValues()
 pb_encode_string()


dlmsParseProfileScalerUnit()

/sm/[deviceId]/[action]->smResourceCallback()->getDiscoveryAction()->getDiscoveryCb()->sendDataProfileDiscovery()


src/device/addons/metering/readings.h:18:#define READING_REG_VALUE_SIZE               (  60 )


if bad deviceId, getDiscoveryCb is called with NULL response and logProfileDiscovery gets called
with a NULL ptr which it dereferences causing a hard-fault.

pbEncodeProfiles(): pbProfileConfig.registers.arg = (void*)currentProfile;  // BUG: was address-of currentProfile.


#define PB_BUFFER_MAX_SIZE 8192




-------------------------------

saveDataProfileSample() -> uint32_t seqNo = mqCreate(MqEntry_dataProfileSample_tag, MqDataProfileSample_fields, &dpSample);


----------------------------------


I1.0.71.7.0.255,I1.0.51.7.0.255,I1.0.94.66.0.255

"<ProfileResult>, this is a very long profile result, will t"

",07e10b07020e0c06ff800000*10^-86,07d0000000000000ff800000*10^-86,2*10^0 A,0.270*10^0 A,0.000*10^0 A,0.000*10^0 V,249.644*10^0 V,0.000*10^0 V,0.000*10^0 degree,70.852*10^0 degree,0.000*10^0 degree,0.000*10^0,0.324*10^0,0.274*10^0,1.000*10^0,1.000*10^3 W"
",07e10b07020f0615ff800000*10^-86,07d0000000000000ff800000*10^-86,2*10^0 A,0.257*10^0 A,0.000*10^0 A,0.000*10^0 V,247.273*10^0 V,0.000*10^0 V,0.000*10^0 degree,69.923*10^0 degree,0.000*10^0 degree,0.000*10^0,0.337*10^0,0.285*10^0,1.000*10^0,1.000*10^3 W,0.018*10^3 W,0.000*10^3 W,0.018*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 var,0.050*10^3 var,0.000*10^3 var,0.050*10^3 var,0.000*10^3 var,0.000*10^3 var,0.000*10^3 var,0.000*10^3 var,0.000*10^-86,0.895*10^-86,0.198*10^-86,0.052*10^-86,0.895*10^-86,0.019*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^3 Wh,7.308*10^3 Wh,1.781*10^3 Wh,1.753*10^3 Wh,2.005*10^3 Wh,1.766*10^3 Wh,0.000*10^3 Wh,0.000*10^3 Wh,0.000*10^3 Wh,0.000*10^3 Wh,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^-86,0.063*10^-86,0.061*10^-86,0.061*10^-86,0.062*10^-86,0.062*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^3 varh,20.371*10^3 varh,5.013*10^3 varh,5.107*10^3 varh,5.097*10^3 varh,5.152*10^3 varh,0.036*10^3 varh,0.009*10^3 varh,0.008*10^3 varh,0.008*10^3 varh,0.009*10^3 var,0.000*10^3 var,0.000*10^3 var"
[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,278,1000,1000,18,0,18,0,0,0,0,0,52,0,52,0,0,0,0,0,895,0,0,0,0,0,0,0,0,0,0,1890,1865,2116,1868,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,0],


",07e10b0702111a31ff800000*10^-86,07d0000000000000ff800000*10^-86,2*10^0 A,0.278*10^0 A,0.000*10^0 A,0.000*10^0 V,250.481*10^0 V,0.000*10^0 V,0.000*10^0 degree,71.255*10^0 degree,0.000*10^0 degree,0.000*10^0,0.318*10^0,0.269*10^0,1.000*10^0,1.000*10^3 W,0.018*10^3 W,0.000*10^3 W,0.018*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 var,0.055*10^3 var,0.000*10^3 var,0.055*10^3 var,0.000*10^3 var,0.000*10^3 var,0.000*10^3 var,0.000*10^3 var,0.000*10^-86,0.895*10^-86,0.198*10^-86,0.052*10^-86,0.895*10^-86,0.019*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^3 Wh,7.345*10^3 Wh,1.781*10^3 Wh,1.791*10^3 Wh,2.005*10^3 Wh,1.766*10^3 Wh,0.000*10^3 Wh,0.000*10^3 Wh,0.000*10^3 Wh,0.000*10^3 Wh,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^3 W,0.000*10^-86,0.063*10^-86,0.061*10^-86,0.061*10^-86,0.062*10^-86,0.062*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^3 varh,20.479*10^3 varh,5.013*10^3 varh,5.216*10^3 varh,5.097*10^3 varh,5.152*10^3 varh,0.036*10^3 varh,0.009*10^3 varh,0.008*10^3 varh,0.008*10^3 varh,0.009*10^3 var,0.000*10^3 var,0.000*10^3 var"
",07d0020500061c0fff800000*10^-86,255*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,07d0011000063900ff800000*10^-86,0*10^-86,0.326*10^-86,249.136*10^-86,0.000*10^-86,0.000*10^-86,0.268*10^-86,0.000*10^-86,0.000*10^-86,8.030*10^-86,0.229*10^-86,0.239*10^-86,0.137*10^-86,0.002*10^-86,0.002*10^-86,0.275*10^-86,1.000*10^-86,1.000*10^-86,07d0011000063a00ff800000*10^-86,0*10^-86,0.327*10^-86,249.192*10^-86,0.000*10^-86,0.000*10^-86,0.267*10^-86,0.000*10^-86,0.000*10^-86,8.020*10^-86,0.229*10^-86,0.239*10^-86,0.136*10^-86,0.002*10^-86,0.002*10^-86,0.276*10^-86,1.000*10^-86,1.000*10^-86,07d0011000063b00ff800000*10^-86,0*10^-86,0.326*10^-86,249.449*10^-86,0.000*10^-86,0.000*10^-86,0.268*10^-86,0.000*10^-86,0.000*10^-86,8.130*10^-86,0.228*10^-86,0.238*10^-86,0.137*10^-86,0.002*10^-86,0.002*10^-86,0.275*10^-86,1.000*10^-86,1.000*10^-86,07d0011000070000ff800000*10^-86,0*10^-86,0.325*10^-86,249.449*10^-86,0.000*10^-86,0.000*10^-86,0.268*10^-86,0.000*10^-86,0.000*10^-86,8.158*10^-86,0.228*10^-86,0.237*10^-86,0.137*10^-86"

"[07d0020500061c0fff800000*10^-86,255*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86,0.000*10^-86],
 [07d0011000171d00ff800000*10^-86,0*10^-86,0.335*10^-86,247.602*10^-86,0.000*10^-86,0.000*10^-86,0.259*10^-86,0.000*10^-86,0.000*10^-86,7.956*10^-86,0.232*10^-86,0.240*10^-86,0.133*10^-86,0.002*10^-86,0.002*10^-86,0.283*10^-86,1.000*10^-86,1.000*10^-86],
 [07d0011000171e00ff800000*10^-86,0*10^-86,0.334*10^-86,247.579*10^-86,0.000*10^-86,0.000*10^-86,0.259*10^-86,0.000*10^-86,0.000*10^-86,8.036*10^-86,0.231*10^-86,0.240*10^-86,0.133*10^-86,0.002*10^-86,0.002*10^-86,0.283*10^-86,1.000*10^-86,1.000*10^-86],
 [07d0011000171f00ff800000*10^-86,0*10^-86,0.333*10^-86,247.857*10^-86,0.000*10^-86,0.000*10^-86,0.261*10^-86,0.000*10^-86,0.000*10^-86,8.090*10^-86,0.232*10^-86,0.240*10^-86,0.134*10^-86,0.002*10^-86,0.002*10^-86,0.281*10^-86,1.000*10^-86,1.000*10^-86],
 [07d0011000172000ff800000*10^-86,0*10^-86,0.333*10^-86,247.806*10^-86,0.000*10^-86,0.000*10^-86,0.261*10^-86,0.000*10^-86,0.000*10^-86,8.087*10^-86,0.232*10^-86,0.240*10^-86,0.134*10^-86,0.002*10^-86,0.002*10^-86,*10^-86,*10^-86,*10^-86], "




discoverNextProfile()
discoverProfiles()

#registers.append('L1.0.31.7.0.255')
#registers.append('I1.0.51.7.0.255')
#registers.append('I1.0.71.7.0.255')
registers.append('I1.0.94.66.0.255')
#registers.append('I1.0.99.1.1.255')


I1.0.99.1.1.255:-120
I1.0.94.66.0.255
I1.0.94.66.0.255,I1.0.99.1.1.255:-900
I1.0.98.1.0.255

I1.0.98.1.0.255:-9:9:18
I1.0.98.1.0.255:-9:4:10

I1.0.98.1.0.255:-9:0:1,I1.0.98.1.0.255:-9:1:2,I1.0.98.1.0.255:-9:2:3,I1.0.98.1.0.255:-9:3:4
I1.0.98.1.0.255:-9:0:1,I1.0.98.1.0.255:-9:1:2

I1.0.99.1.1.255:-7200,I1.0.94.66.0.255,I1.0.99.1.1.255:-3600

I1.0.98.1.0.255:-9:0:1,I1.0.98.1.0.255:-9:1:2
I1.0.98.1.0.255:-9:2:3,I1.0.98.1.0.255:-9:3:4

I1.0.98.1.0.255:-9:0:1, I1.0.98.1.0.255:-9:1:2, I1.0.98.1.0.255:-9:2:3, I1.0.98.1.0.255:-9:3:4



MessageReadoutRequest:
readingsCreateResponse()

LOG_DEBUG("--> %s:%d",__FILE__,__LINE__);


0000600A02FF is 1, 3?
0000600A02FF

2017-06-01T08:51:00.000-00:00 0,0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.2,0.0,0.0,0.2,0.2,0.4,0.0,0.0,0.4,0.4,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,117282.796,117531.601,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,246545.78,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,07e1051c00091611ff800000,07e1051f030e2600ff800000,0000000000000000ff800000,07e1051c10091711ff800000


I1.0.98.1.0.255:-9:9:18



--------------------------------------------------------------

P1.0.94.66.0.255    - IS
P1.0.99.1.0.255     - LS


I0.0.1.0.0.255
I1.0.0.1.2.255
I1.0.0.1.1.255
I1.0.31.7.0.255
I1.0.51.7.0.255
I1.0.71.7.0.255
I1.0.32.7.0.255
I1.0.52.7.0.255
I1.0.72.7.0.255
I1.0.81.7.4.255
I1.0.81.7.15.255
I1.0.81.7.26.255
I1.0.13.7.0.255
I1.0.33.7.0.255
I1.0.53.7.0.255
I1.0.73.7.0.255
I1.0.1.7.0.255
I1.0.2.7.0.255
I1.0.21.7.0.255
I1.0.22.7.0.255
I1.0.41.7.0.255
I1.0.42.7.0.255
I1.0.61.7.0.255
I1.0.62.7.0.255
I1.0.3.7.0.255
I1.0.4.7.0.255
I1.0.23.7.0.255
I1.0.24.7.0.255
I1.0.43.7.0.255
I1.0.44.7.0.255
I1.0.63.7.0.255
I1.0.64.7.0.255
I1.0.1.6.0.255
I1.0.1.6.1.255
I1.0.1.6.2.255
I1.0.1.6.3.255
I1.0.2.6.0.255
I1.0.2.6.1.255
I1.0.2.6.2.255
I1.0.2.6.3.255
I1.0.1.8.0.255
I1.0.1.8.1.255
I1.0.1.8.2.255
I1.0.1.8.3.255
I1.0.2.8.0.255
I1.0.2.8.1.255
I1.0.2.8.2.255
I1.0.2.8.3.255
I1.0.1.2.0.255
I1.0.1.2.1.255
I1.0.1.2.2.255
I1.0.1.2.3.255
I1.0.2.2.0.255
I1.0.2.2.1.255
I1.0.2.2.2.255
I1.0.2.2.3.255
I1.0.3.6.0.255
I1.0.3.6.1.255
I1.0.3.6.2.255
I1.0.3.6.3.255
I1.0.4.6.0.255
I1.0.4.6.1.255
I1.0.4.6.2.255
I1.0.4.6.3.255
I1.0.3.8.0.255
I1.0.3.8.1.255
I1.0.3.8.2.255
I1.0.3.8.3.255
I1.0.4.8.0.255
I1.0.4.8.1.255
I1.0.4.8.2.255
I1.0.4.8.3.255
I1.0.3.2.0.255
I1.0.3.2.1.255
I1.0.3.2.2.255
I1.0.3.2.3.255
I1.0.4.2.0.255
I1.0.4.2.1.255
I1.0.4.2.2.255
I1.0.4.2.3.255

-------------------------------------

Mitsu IS

"0.0.1.0.0.255"     : Time
"1.0.0.1.2.255"     : Time/date of billing reset
"1.0.0.1.1.255"     : Total number of billing reset
"1.0.11.7.0.255"    : Current: Inst. Value (A)
"1.0.31.7.0.255"    : L1 Current ; Inst. value;
"1.0.51.7.0.255"    : L2 Current ; Inst. value;
"1.0.71.7.0.255"    : L3 Current ; Inst. value;
"1.0.12.7.0.255"    : Voltage: Inst. Value (V)
"1.0.32.7.0.255"    : L1 Voltage; Inst. Value;
"1.0.52.7.0.255"    : L2 Voltage; Inst. Value;
"1.0.72.7.0.255"    : L3 Voltage; Inst. Value;
"1.0.81.7.4.255"    : Angle of I(L1) - U(L1)
"1.0.81.7.15.255"   : Angle of I(L2) - U(L2)
"1.0.81.7.26.255"   : Angle of I(L3) - U(L3)
"1.0.13.7.0.255"    : System power factor: Inst. value
"1.0.33.7.0.255"    : L1 Power factor; Current avg. 5  ?
"1.0.53.7.0.255"    : L2 Power factor; Current avg. 5  ?
"1.0.73.7.0.255"    : L3 Power factor; Current avg. 5  ?
"1.0.1.7.0.255"     : ΣLi Active power+ (QI+QIV); Inst. Value
"1.0.2.7.0.255"     : ΣLi Active power- (QII+QIII); Inst. Value
"1.0.21.7.0.255"    : L1 Active power+ (QI+QIV); Inst. Value
"1.0.22.7.0.255"    : L1 Active power- (QII+QIII); Inst. Value
"1.0.41.7.0.255"    : L2 Active power+ (QI+QIV); Inst. Value
"1.0.42.7.0.255"    : L2 Active power- (QII+QIII); Inst. Value
"1.0.61.7.0.255"    : L3 Active power+ (QI+QIV); Inst. Value
"1.0.62.7.0.255"    : L3 Active power- (QII+QIII); Inst. Value
"1.0.3.7.0.255"     : ΣLi Reactive power+ (QI+QII); Inst. Value
"1.0.4.7.0.255"     : ΣLi Reactive power- (QIII+QIV); Inst. Value
"1.0.23.7.0.255"    : L1 Reactive power+ (QI+QII); Inst. Value
"1.0.24.7.0.255"    : L1 Reactive power- (QIII+QIV); Inst. Value
"1.0.43.7.0.255"    : L2 Reactive power+ (QI+QII); Inst. Value
"1.0.44.7.0.255"    : L2 Reactive power- (QIII+QIV); Inst. Value
"1.0.63.7.0.255"    : L3 Reactive power+ (QI+QII); Inst. Value
"1.0.64.7.0.255"    : L3 Reactive power- (QIII+QIV); Inst. Value
"1.0.1.6.0.255"     : ΣLi Active power+ (QI+QIV); Max.; [Total, Rate 0]
"1.0.2.6.0.255"     : ΣLi Active power- (QII+QIII); Max.; Rate 0
"1.0.1.6.1.255"     : ΣLi Active power+ (QI+QIV); Max.; [Total, Rate 1]
"1.0.2.6.1.255"     : ΣLi Active power- (QII+QIII); Max.; Rate 1
"1.0.1.6.2.255"     : ΣLi Active power+ (QI+QIV); Max.; [Total, Rate 2]
"1.0.2.6.2.255"     : ΣLi Active power- (QII+QIII); Max.; Rate 2
"1.0.1.6.3.255"     : ΣLi Active power+ (QI+QIV); Max.; [Total, Rate 3]
"1.0.2.6.3.255"     : ΣLi Active power- (QII+QIII); Max.; Rate 3
"1.0.1.6.4.255"     : ΣLi Active power+ (QI+QIV); Max.; [Total, Rate 4]
"1.0.2.6.4.255"     : ΣLi Active power- (QII+QIII); Max.; Rate 4
"1.0.1.8.0.255"     : ΣLi Active power+ (QI+QIV); Time integral 1; Rate 0
"1.0.2.8.0.255"     : ΣLi Active power- (QII+QIII); Time integral 1; Rate 0
"1.0.1.8.1.255"     : ΣLi Active power+ (QI+QIV); Time integral 1; Rate 1
"1.0.2.8.1.255"     : ΣLi Active power- (QII+QIII); Time integral 1; Rate 1
"1.0.1.8.2.255"     : ΣLi Active power+ (QI+QIV); Time integral 1; Rate 2
"1.0.2.8.2.255"     : ΣLi Active power- (QII+QIII); Time integral 1; Rate 2
"1.0.1.8.3.255"     : ΣLi Active power+ (QI+QIV); Time integral 1; Rate 3
"1.0.2.8.3.255"     : ΣLi Active power- (QII+QIII); Time integral 1; Rate 3
"1.0.1.8.4.255"     : ΣLi Active power+ (QI+QIV); Time integral 1; Rate 4
"1.0.2.8.4.255"     : ΣLi Active power- (QII+QIII); Time integral 1; Rate 4
"1.0.1.2.0.255"     : ΣLi Active power+ (QI+QIV); Cum. max. 1; Rate 0
"1.0.2.2.0.255"     : ΣLi Active power- (QII+QIII); Cum. max. 1; Rate 0
"1.0.1.2.1.255"     : ΣLi Active power+ (QI+QIV); Cum. max. 1; Rate 1
"1.0.2.2.1.255"     : ΣLi Active power- (QII+QIII); Cum. max. 1; Rate 1
"1.0.1.2.2.255"     : ΣLi Active power+ (QI+QIV); Cum. max. 1; Rate 2
"1.0.2.2.2.255"     : ΣLi Active power- (QII+QIII); Cum. max. 1; Rate 2
"1.0.1.2.3.255"     : ΣLi Active power+ (QI+QIV); Cum. max. 1; Rate 3
"1.0.2.2.3.255"     : ΣLi Active power- (QII+QIII); Cum. max. 1; Rate 3
"1.0.1.2.4.255"     : ΣLi Active power+ (QI+QIV); Cum. max. 1; Rate 4
"1.0.2.2.4.255"     : ΣLi Active power- (QII+QIII); Cum. max. 1; Rate 4
"1.0.3.6.0.255"     : ΣLi Reactive power+ (QI+QIV); Max.; Rate 0
"1.0.4.6.0.255"     : ΣLi Reactive power- (QII+QIII); Max.; Rate 0
"1.0.3.6.1.255"     : ΣLi Reactive power+ (QI+QIV); Max.; Rate 1
"1.0.4.6.1.255"     : ΣLi Reactive power- (QII+QIII); Max.; Rate 1
"1.0.3.6.2.255"     : ΣLi Reactive power+ (QI+QIV); Max.; Rate 2
"1.0.4.6.2.255"     : ΣLi Reactive power- (QII+QIII); Max.; Rate 2
"1.0.3.6.3.255"     : ΣLi Reactive power+ (QI+QIV); Max.; Rate 3
"1.0.4.6.3.255"     : ΣLi Reactive power- (QII+QIII); Max.; Rate 3
"1.0.3.6.4.255"     : ΣLi Reactive power+ (QI+QIV); Max.; Rate 4
"1.0.4.6.4.255"     : ΣLi Reactive power- (QII+QIII); Max.; Rate 4
"1.0.3.8.0.255"     : ΣLi Reactive power+ (QI+QIV); Time integral 1; Rate 0
"1.0.4.8.0.255"     : ΣLi Reactive power- (QII+QIII); Time integral 1; Rate 0
"1.0.3.8.1.255"     : ΣLi Reactive power+ (QI+QIV); Time integral 1; Rate 1
"1.0.4.8.1.255"     : ΣLi Reactive power- (QII+QIII); Time integral 1; Rate 1
"1.0.3.8.2.255"     : ΣLi Reactive power+ (QI+QIV); Time integral 1; Rate 2
"1.0.4.8.2.255"     : ΣLi Reactive power- (QII+QIII); Time integral 1; Rate 2
"1.0.3.8.3.255"     : ΣLi Reactive power+ (QI+QIV); Time integral 1; Rate 3
"1.0.4.8.3.255"     : ΣLi Reactive power- (QII+QIII); Time integral 1; Rate 3
"1.0.3.8.4.255"     : ΣLi Reactive power+ (QI+QIV); Time integral 1; Rate 4
"1.0.4.8.4.255"     : ΣLi Reactive power- (QII+QIII); Time integral 1; Rate 4
"1.0.3.2.0.255"     : ΣLi Reactive power+ (QI+QIV); Cum. max. 1; Rate 0
"1.0.4.2.0.255"     : ΣLi Reactive power- (QII+QIII); Cum. max. 1; Rate 0
"1.0.3.2.1.255"     : ΣLi Reactive power+ (QI+QIV); Cum. max. 1; Rate 1
"1.0.4.2.1.255"     : ΣLi Reactive power- (QII+QIII); Cum. max. 1; Rate 1
"1.0.3.2.2.255"     : ΣLi Reactive power+ (QI+QIV); Cum. max. 1; Rate 2
"1.0.4.2.2.255"     : ΣLi Reactive power- (QII+QIII); Cum. max. 1; Rate 2
"1.0.3.2.3.255"     : ΣLi Reactive power+ (QI+QIV); Cum. max. 1; Rate 3
"1.0.4.2.3.255"     : ΣLi Reactive power- (QII+QIII); Cum. max. 1; Rate 3
"1.0.3.2.4.255"     : ΣLi Reactive power+ (QI+QIV); Cum. max. 1; Rate 4
"1.0.4.2.4.255"     : ΣLi Reactive power- (QII+QIII); Cum. max. 1; Rate 4


2017-11-28T11:35:13.000-00:00 00 0xff
2017-11-28T11:35:13.000-00:00 00 0xff
4
0
0
0
0
21.941
21.941
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0

--------------------------------------------------


Mitsu LS:

"0.0.1.0.0.255","0.0.96.5.0.255","1.0.1.4.0.255","1.0.2.4.0.255","1.0.3.4.0.255","1.0.4.4.0.255","1.0.1.29.0.255","1.0.2.29.0.255","1.0.3.29.0.255","1.0.4.29.0.255","1.0.12.27.0.255","1.0.11.27.0.255","1.0.12.128.124.255","1.0.11.128.124.255","1.0.13.27.0.255","1.0.81.128.4.255"


2017-11-28T11:30:00.000-00:00 00 0xff
0
0
0
0
0
0
0
0
0
21971
0
0
0
0
0
2.659
0
0
0
0
0
0
0
0
0
0
0
0


------------------------------------------------

C:\Users\SteveTickle\AppData\Local\Programs\Python\Python36-32\Lib\site-packages\suds\sax

cp /usr/lib/python3/dist-packages/suds/client.py .
cp /usr/lib/python3/dist-packages/suds/sax/text.py .

--------------------------------------------------

node.boot

terminal.c:232 temrinalTask generates EVENT_CREATE(event, EVENT_NODE_BOOT);



----------------------------

SM API notes:
- Capabiliites info? event support, profile support, permissions
- How opinionated are we? e.g. can on-deman come from retrieved data? come with latency but simplifies our system.
- Are we intending to present a unified interface or an infinitely configurable interface? middle-ground?.
- Are we wedding ourselves to DLMS? should we be presenting a DLMS/OBIS interface? or simply IS/LS/BP, i.e. no OBISs.
- Should profileObisCode be necessary? should be hidden? use name instead? which is the identifier?
- "ic" interface class, attributeID, etc are a DLMS-ism that is only of importance when interrogating the meter, not for the user of the data.
- We should not really be exposing DLMS-isms to the outer API. We need to consider what portions of DLMS that we want to expose.
- "scaler" not "scalar" i.e. a value that represents the scale, not that it is a scalar value.
- MeterRegisterValue. I don't think we should be exposing the low-level interface to the end user API.
- Format of returned data is not described. Either refer to A-XDR doc or describe fully here.
- "ws" prefix. Does this have a real meaning? surely not "web service"?! that would be implied.
- API versioning? Should this be in the URL or negotiated on a client-by-client basis?
- Do we need a distinction between profiles and single values? or simply multi-valued results with a common request interface?
- Asynchronous events? no API is apparent for those yet other than polling (long-poll connection? / websockets?).
- Time its own smart-metering API, legal time shouldn't be part of the NMS.
- Should capabilities even be exposed to the API user? isn't the purpose to abstract them away?


-------------------------------------

3e  :   hw1:v104
2d  :   mitsubishi-insecure:v102.1
2e  :   mitsubishi-insecure:v102.1
2f  :   mitsubishi-insecure:v102.1
31  :   ytl-insecure:v101-310-gcd0cc63
34  :   ytl-insecure:v101-310-gcd0cc63
35  :   mitsubishi-insecure:v102.1
36  :   mitsubishi-insecure:v102.1


-------------------------------------------------


cygh/sdram.c:

int cygh_sdram_read(uint32_t offset, void *buf, size_t size)
int cygh_sdram_write(uint32_t offset, const void *buf, size_t size)

used by:
- firmware_updater
- store/file.c   FILERESULT FILE_write(file_t *file, const void *buf, size_t len)
- store/file.c   FILERESULT FILE_read(file_t *file, void *buf, size_t len, size_t *outlen)
- store/fs.c     FSRESULT FS_storage_read(fs_t *handle, uint32_t lba_offset, void * buffer)

used by:
- file_nanopb.c
- list.c
- fs_onefile.c
- fs.c
- stream_output_fs.c
- meter_command_protocol.c
- passthrough.c
- licensing.c
- gprs.c
- command_handler.c


- can we allocate dynamically or statically >64KB on the eCog?

-------------------------------------------

cyglib build instability:

git clean -xfd
./build

PASSED erase_with_filter_main_alt
Writing preferences until compaction happens.
Measuring time for unlimited sized preference store.
Write     0: took   0 milliseconds, read took   0 milliseconds
Write     1: took   0 milliseconds, read took   0 milliseconds
Write     2: took   0 milliseconds, read took   0 milliseconds
Write     3: took   0 milliseconds, read took   0 milliseconds
Write     4: took   0 milliseconds, read took   0 milliseconds
Write     5: took   0 milliseconds, read took   0 milliseconds
Write     6: took   0 milliseconds, read took   0 milliseconds
Write     7: took   0 milliseconds, read took   0 milliseconds
Write     8: took   0 milliseconds, read took   0 milliseconds
Write     9: took   0 milliseconds, read took   0 milliseconds
Write    10: took   0 milliseconds, read took   0 milliseconds
Write    11: took   0 milliseconds, read took   0 milliseconds
Write    12: took   0 milliseconds, read took   0 milliseconds
Write    13: took   0 milliseconds, read took   0 milliseconds
Write    14: took   0 milliseconds, read took   0 milliseconds
Write    15: took   0 milliseconds, read took   0 milliseconds
Write    16: took   1 milliseconds, read took   0 milliseconds
FAILED 448: compaction_timing:On max memory with unlimited tags, the last write must fail
PASSED read_chip_id
Test suite summary for: preferences
Tests run 22
Tests passed 21
Tests failed 1
Test suite details for: preferences
PASSED test_the_test
PASSED initialise
PASSED read_empty
PASSED size
PASSED read_from_main
PASSED read_from_alt
PASSED write_to_empty
PASSED write_new_value_for_tag
PASSED write_two_tags
PASSED write_two_tags_twice
PASSED compact
PASSED write_after_compact
PASSED compact_auto
PASSED write_and_compact_blank
PASSED erase_main
PASSED erase_alt
PASSED erase_main_alt
PASSED erase_with_filter_main
PASSED erase_with_filter_alt
PASSED erase_with_filter_main_alt
FAILED 448: compaction_timing:On max memory with unlimited tags, the last write must fail
PASSED read_chip_id
Tests run 22
Tests passed 21
Tests failed 1
make[1]: *** [run] Error 1
/project/cyghlib/tools/cygh_py_app.mak:57: recipe for target 'run' failed
make[1]: Leaving directory '/project/test/preferences'
Makefile:227: recipe for target 'stamp-test-cyghpy' failed
make: *** [stamp-test-cyghpy] Error 1

----------------------------------------------------------

hwicce build instability:

event_diag_log_id: 59 event_rec_log_id: 54 timestamp: 1083 time_since_boot_secs: 1083 module: METERCOMMS line: 481 severity: WARNING metercomms_datacol_disabled { }
event_diag_log_id: 60 event_rec_log_id: 55 timestamp: 1113 time_since_boot_secs: 1113 module: METERCOMMS line: 481 severity: WARNING metercomms_datacol_disabled { }
event_diag_log_id: 61 event_rec_log_id: 56 timestamp: 1144 time_since_boot_secs: 1144 module: METERCOMMS line: 481 severity: WARNING metercomms_datacol_disabled { }
event_diag_log_id: 62 timestamp: 1152 time_since_boot_secs: 1152 module: CABLE line: 187 severity: INFO cable_connection_attempt_while_connected { }
event_diag_log_id: 63 timestamp: 1155 time_since_boot_secs: 1155 ok
module: FS_ONEFILE line: 87 severity: INFO fs_onefile { commit_success { data: "dcu_config_runtime" } }
event_diag_log_id: 64 event_rec_log_id: 57 timestamp: 1155 time_since_boot_secs: 1155 module: METERCOMMS line: 491 severity: WARNING metercomms_datacol_enabled { }
event_diag_log_id: 65 timestamp: 1164 time_since_boot_secs: 1164 module: FS_ONEFILE line: 87 severity: INFO fs_onefile { commit_success { data: "dcu_config_runtime" } }
event_diag_log_id: 66 event_rec_log_id: 58 timestamp: 1164 time_since_boot_secs: 1164 module: METERCOMMS line: 180 severity: ERROR metercomms_success_command { uuid { uuid_bytes: "\310\277\177\302\036,K\023\221\372Z\362o\246}\227" } meter_cmd { metercmd_protocol_read_type_instantaneous_schedule { } } meter_uuid { uuid_bytes: "\227\266\316\027\221yJ2\253\214\0359f\322\000\004" } scheduled: true instantaneous_schedule_collection_config_secs: 1800 }


hwicce build instability:

PYTHONPATH='/usr/local/lib/cylec_scripts:/project/thirdparty/nanopb/generator:/usr/local/lib/cygh/cyghlib/CyGHPyDebug' python -u -c 'from ctypes import PyDLL; PyDLL("/project/dcuunittest/dcu/metercomms/instantaneous_schedule/CyGHPyDebug/_lib.so")'
PYTHONPATH='/usr/local/lib/cylec_scripts:/project/thirdparty/nanopb/generator:/usr/local/lib/cygh/cyghlib/CyGHPyDebug' python -u /usr/bin/nosetests -s -v
dcuunittest.dcu.metercomms.instantaneous_schedule.test.test_main ... Starting Suite config

Start and Reading Timing test.FAILED 152: IS_start_and_reading_timing_test:diff >= start_sec-5

End Timing test................................................................
PASSED IS_end_timing_test

Reset Timing test
PASSED IS_reset_timing_test
Test suite summary for: config
Tests run 3
Tests passed 2
Tests failed 1
Test suite details for: config
FAILED 152: IS_start_and_reading_timing_test:diff >= start_sec-5
PASSED IS_end_timing_test
PASSED IS_reset_timing_test
Tests run 3
Tests passed 2
Tests failed 1
FAIL

======================================================================
FAIL: dcuunittest.dcu.metercomms.instantaneous_schedule.test.test_main
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/project/dcuunittest/dcu/metercomms/instantaneous_schedule/test.py", line 11, in test_main
    eq_(lib.cygh_main(), 0) #@UndefinedVariable
AssertionError: 1 != 0

----------------------------------------------------------------------
Ran 1 test in 17.540s

FAILED (failures=1)
../../../common.mak:80: recipe for target 'test' failed
make[2]: *** [test] Error 1
make[2]: Leaving directory '/project/dcuunittest/dcu/metercomms/instantaneous_schedule'
Makefile:15: recipe for target 'dcu/metercomms/instantaneous_schedule-test' failed
make[1]: Leaving directory '/project/dcuunittest'
make[1]: *** [dcu/metercomms/instantaneous_schedule-test] Error 2
Makefile:69: recipe for target 'unittest' failed
make: *** [unittest] Error 2

------------------------------------------------------------------------

hwicce build instability:

grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
grps_uart: DEBUG: tcpip_open failed due to connections not being accepted
--------------------- >> end captured logging << ---------------------

----------------------------------------------------------------------
Ran 6 tests in 8.068s

FAILED (failures=1)

Exception in thread Thread-9 (most likely raised during interpreter shutdown):
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
  File "/project/dcuunittest/dcutestutils/network_sim.py", line 545, in run
  File "/usr/lib/python2.7/Queue.py", line 177, in get
  File "/usr/lib/python2.7/threading.py", line 355, in wait
<type 'exceptions.TypeError'>: 'NoneType' object is not callable
config/chip/python/time.c:42: error: cygh_py_abort called
Exception in thread DCU Main Thread (most likely raised during interpreter shutdown):
Traceback (most recent call last):
  File "/usr/lib/python2.7/threading.py", line 801, in __bootstrap_inner
  File "/project/dcuunittest/dcutestutils/dcu.py", line 291, in run
  File "/usr/local/lib/cygh/cyghlib/CyGHPyDebug/cygh/time.py", line 76, in clock
  File "/usr/local/lib/cygh/cyghlib/CyGHPyDebug/cygh/time.py", line 125, in _now
<type 'exceptions.AttributeError'>: 'NoneType' object has no attribute 'time'
Makefile:67: recipe for target 'dcuapptest/licensing_test/licensing_test.py-apptest' failed
make: *** [dcuapptest/licensing_test/licensing_test.py-apptest] Error 1







----------------------------------------------------------------------
Ran 2 tests in 26.357s

OK
make: *** [dcuapptest/config_tests/test_disable_datacol.py-apptest] Segmentation fault (core dumped)
Makefile:67: recipe for target 'dcuapptest/config_tests/test_disable_datacol.py-apptest' failed

-----------------------------------------------

From meter:

main
 CYLEC_process
  CYLEC_PROTO_process
   CYLEC_PROTO_receive_frame
    CYLEC_MSG_receive_frame


METER_COMMAND_protocol_process_task


protocol_0010_process_received_data

protocol_load_unsigned8

protocol_internal.h

protocol_integration.h
PR_READ
protocol_store_signed32_be
protocol_store_unsigned32_le
protocol_store_unsigned16_be
protocol_store_unsigned16_le
protocol_store_unsigned8

protocol_buffer_copy
protocol_buffer_cmp

METER_COMMAND_protocol_callback() supplies bytes to cmp.



------------------------------------------------------------

test_protocol.c: read_buffer_line() READ_BUFFER_SIZE



---------------------------------------------------------

chesney cable SWD:

SWDIO   -
SWDCLK  -
SWO     -
nRESET  -
GND     -
VTRef   -


JTAG pins:

TCK     - AD0
TDI     - AD1
TDO     - AD2
TMS     - AD3
TRST    - AC0 ?
SRST    - AC1 ?



---------------------------------------------------------

bellatrix port:


make PROJECT_BASE=.. CYLEC_METER_PROTOCOL_BASE=../Dependencies/cylec_meter_protocol TOOLCHAIN_BASE=/usr/bin TOOLS=HostGCC clean all


bug:
if cygh_uart_initialise() fails, then CYLEC_PROTO_init short circuits initialisation of some data
and consequently it looks as if a message has falsely been received and the length of the non-existent
message is used in a memcpy, crashing hard.

-------------------------------------------------


b protocol_0010.c:2027 if _step==12




./test_protocol_dcuv2_linux
  readings/0010/1004/LSS_med.txt.rep_length = 88
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 25
.rep_length = 65
.rep_length = 25
.rep_length = 65
.rep_length = 17
.rep_length = 9360
.pass


O.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 44
.rep_length = 25
.rep_length = 65
.rep_length = 25
.rep_length = 65
.rep_length = 17
.rep_length = 8192

__assert_fail@plt





------------------------



(gdb) p *(FILE*)sourceFile
$3 = {
  _p = 0xbaef "7ea8894103b4f32e00270505000000000500000000050000005605000000c4020c090c07dd0c13ff0c0f19ff014a0011440500005d640500005d640500005d6405000009c30500000000050000000005000000560500000000050000000005000000c702"..., _r = 881, _w = 0,
  _flags = 3204, _file = 7, _bf = {
    _base = 0xba60 "0000056050000000005000000c0020c090c07dd0c13ff0c0e16ff014a00113b0500005d640500005d640500005d64050000000005000000000500b2c37e\n7ea00703415144817e\n7ea8894103b4f32e00270505000000000500000000050000005605000"..., _size = 1024},
  _lbfsize = 0, _cookie = 0xb5c0, _read = 0x800013a <__sread$ind>,
  _write = 0x8000140 <__swrite$ind>, _seek = 0x8000146 <__sseek$ind>,
  _close = 0x800014c <__sclose$ind>, _ub = {_base = 0x0, _size = 0}, _up = 0x0,
  _ur = 0, _ubuf = "\000\000", _nbuf = "", _lb = {_base = 0x0, _size = 0},
  _blksize = 1024, _offset = -32768, _data = 0x0, _lock = 0}
(gdb)



/build/bakery/toolchain-gnu-ecog1-trunk-111113-085438/linux/cyan-dists/gnu/newlib/libgloss/ecog1x/lseek.c:45

off_t
_DEFUN (_lseek, (fd,  offset, whence),
       int fd _AND
       off_t offset _AND
       int whence)
{
  int res_lo, res_hi;
  int buffer[6] = {fd, (int)(offset >> 16), (int)offset, (int)whence, (int)&res_hi, (int)&

  int r;
  off_t res;
  asm volatile ("simtrap # %0 %1 %2" :
                "=&Ral" (r) :
                "0" (SYSCALL_lseek), "Rah" (buffer) :
                "memory");

  res = ((long)res_hi & 0xffff) << 16 | ((long)res_lo & 0xffff);
  if (r < 0)
    {
      errno = -r;
      res = -1;
    }

  return (res);
}


The above code pieces the result back togther in the wrong form, so for example passing offset==141000 (0x226c8) should return this same value.
Instead this returns 0x26c80000 i.e. it gets res_lo and res_hi the wrong way around and res_hi gets zeroed, possibly using an incorrect register for res_lo.






Only need to walk back to beginning of line:

do
{
    fseek(sourceFile, -1, SEEK_CUR)
    c   = fgetc(sourceFile);

} while(c != '\n');



but:

METER_COMMAND_protocol_callback() needs 'index' from start of line.
rewind to beginning, then read 'index' bytes forward:

for(uint32_t i=0; i<index; i++)
{
    fgetc(sourceFile);
}





----------------------------------------------


ssh://stevetickle@gerrit.se.cyco.io:29418/ipa_prod

scp to:
prod@172.16.32.133:~/ipa_prod



---------------------------------------------


UGVCL gap analysis:

- Tariff server/agent.
- Large data streaming (COAP-blockwise), server/agent.
- Retrieving data from meter rather than relying on scheduled profile read.
- Change from OBIS->generic labels (If de-DLMS-ifying the API) server/agent.
- Normalisation of data types (If de-DLMS-ifying the API).
- Schema definitions (If de-DLMS-ifying the API) server/agent.
- Time sync mechanism. (+-10sec sync, etc) server/agent. Use Blue-book style?
- configuration of meter (definition) This is a significant amount of work if we are to abstract away the DLMS details for calendars/ToU tables/etc.
- different calendar support Gregorian,  season profile, week profile and day profile support
- configuration of meter implementation server/agent. (See COSEM billing model).
- tamper work on supported agents, driver work.
- Async API server changes (request ID & response mechanism?) server only.
- batch mechanism from API? are groups sufficient?
- alarm read == profile read. Alarm reset mechanism by sevrer when read?? server/agent work, mechanism does not exist yet.
- accounting model for configuration, e.g. emergency credit with thresholds and accounts?
- How much of DataNotification is supported. Graeme says agenet has support for push of tamper. extend to be generic? it assumes a single type of message being pushed.
- Are we still using prefixes I/L/P?? why??
- firmware upgrade, file distribution.
- max demand reset.
- do we clear/reset buffers after capture and push or do we push deduplication duties to user of API?


config:
- demand integration period (how many periods?, which registers?, reset? last-period value?)
- push setup?
- profile capture periods.
- single action schedule for billing dates.
- activity calendar for time zones
- real time clock, date and time.
- script table (probably not needed, due to it being full of pseudo-OBISs).
-

Events can capture any of the following (configured by utility):
- Date and time of event 0 0 1 0 0 255 8 (Clock)
- Event code 0 0 96 11 0 255 1 (Data)
- Current, IR 1 0 31 7 0 255 3 (Register)
- Current, IY 1 0 51 7 0 255 3 (Register)
- Current, IB 1 0 71 7 0 255 3 (Register)
- Voltage, VRN (3 Φ/4W) 1 0 32 7 0 255 3 (Register)
- Voltage, VYN (3 Φ/4W) 1 0 52 7 0 255 3 (Register)
- Voltage, VBN (3 Φ/4W) 1 0 72 7 0 255 3 (Register)
- Voltage, VRY (3 Φ/3W) 1 0 32 7 0 255 3 (Register)
- Voltage, VYB (3 Φ/3W) 1 0 52 7 0 255 3 (Register)
- Power factor, R-Phase 1 0 33 7 0 255 3 (Register)
- Power factor, Y-Phase 1 0 53 7 0 255 3 (Register)
- Power factor, B-Phase 1 0 73 7 0 255 3 (Register)
- Cumulative energy, kWh 1 0 1 8 0 255 3 (Register)

From xls:
- RTC-Date and Time
- Demand integration period
- Profile capture period
- Single-action schedule for billing dates
- Activity calander for time zones
- Load limit(kw)
- Enable/disable load limit function
- Image transfer
- Metering mode
- Payment mode
- Last token recharge amount
- Last token recharge time
- Total amount at last recharge
- Current balance amount
- Current balance time
- LLS secret
- HLS secret
- Global key change
- Image activation single action schedule
- ESWF
- MD reset
- Apparent calculation- lag only / lag+lead
- LCD Display- Auto Parameters
- LCD Display- Push Parameters



log reading:
- supply events (voltage, current, power) (Profile generic) (not supported yet).
- billing (not supported yet).
- transaction events (RTC, demand integration period, profile capture period, singls action schedule for billing dates, activity calendar for time zones) (not supported yet).
- control events (not supported yet).
- non rollover events (not supported yet).
- other events (not supported yet).
- tamper alarms/reset? (not supported yet).



Phase 1:
- Low level API.
- Exposes details of meters.
- Since this is a low-level API and we expose details, do we also expose that meters don't implement (e.g IS on the mitsu?)
- Essentially an API that is at the level of DLMS/COSEM.
- data format is raw A-XDR data.
- Mixes domains, i.e. not strictly SM. NM is mixed in.
- Its what we have already, quick to implement.
- Specific to electricity.
- Synchronous.
- Pipe API.


Phase 2:
- High level API.
- Exposes SM concepts, but *not* meter individual details.
- Separates domains into Smart Metering, Comms Network Management, Supply Network Management.
- Generic enough for gas, elec, water, etc.
- Asynchronous.
- Non-pipe API.



----------------------------------


Push to gerrit:

https://gerrit.se.cyco.io/Documentation/user-upload.html

git push ssh://stevetickle@gerrit.se.cyco.io:29418/ipa_prod HEAD:refs/for/master



-----------------------------------------------------------



- Watchdog
- Storage
- Time
- Schedule
- Monitor
- Log
- FS
- CNDFS
- UFFS
- CtrlPort
- AlertBits
- BootLoader
- Configuration
- ConfiguratonBackEnd
- Security
- OSAL (OS Abstraction Layer)
- UI
- UID
- UART
- SPI
- RTC

- Radio
- Radio CC1200/Simulator
- PowerDown
- PgmFLASH
- Panic
- MTD
- MTD/SPI
- Modem
- I2C
- RNG
- HiResTimer
- GPIO
- Ethernet
- DMA
- DigIO
- DeviceKeys
- CRC

- Data (Structures)
   - BinaryBuf
   - BinaryReader
   - BinaryWriter
   - BitVec
   - Encoder
   - FIFO
   - Heap
   - RingBuffer
   - PacketBuf
   - PktQ
   - StringList
   - StringPairList
   - Vector
- AsyncIO
- Management
   - activity
   - configuration
   - DataRate
   - Events
   - File
   - Fuzz
   - LogCOAP
   - Login
   - MOnitor
   - NetInfo
   - Ping
   - PreferredParent
   - ProdMode
   - Restart
   - Status
   -

------------------------------------

dtls.c:122
uint8_t s_fifoBuf[1400];

Magic number... also suspiciously similar to the point where we hit problems. (Maybe should be IP_MAX_PAYLOAD)

also:
#define IP_MAX_PAYLOAD 1240

#define IP_LOWPAN_MTU 1280



Comment in IPSec.c:

"If there are two valid SAs, it is possible that the wrong one is
picked. But this is a rare case and probably not worth handling. The
gateway would need to send more packets than the limit which
triggered the new key, and all of those packets must be lost somehow.
Assuming that the limit is high enough, the keep alive mechanism on
the mesh should have deemed the link dead way before this scenario
can happen."


- Current Ping module is a CoAP-level ping, going to Node only. We need an SM-level ping that is directed at the meter (i.e. wraps up a read of RTC).
- UFFS: intended for NAND, not NOR... do the IPAx boards have NAND??
- no calculations about wear-rate on the FLASH has been performed.


-------------------------------------------------------------------------------------

Genus test rig:

- Black hole GW.
- Need to be able to get power fail notifications transferred from node to gw in some recognisable and actionable format.
- Need to be able to get tamper alert notifications transferred from node to gw in some recognisable and actionable format.
- The Node will be expecting to be talking to a Genus meter in order to perform TX/RX on UART pins, do we monitor or simulate a meter?
- Need to be able to trigger and deactivate a (all?) tamper mechanism(s) and see correct notifications.
- Need to be able to put Node into 'test' mode where it writes the signal strength to the meter at 5Hz.
- Visibility of Comms is not a good indicator of power.... could just be repreated resets or bad data. Do we need a proper 'quality' rather than 'presence of comms' signal?
- UART TX/RX ability of Node&Meter to successfully go thru the login mechanism SNRM/AARQ and read the time would be a good indicator of comms.


--------------------------------------------------------------

Omnimesh build

docker run -v `pwd`:'/project'   -it panmesh/buildenv_panmesh bash

but the code also now exists in buildenv_omnimesh repo.

now:
docker run -v `pwd`:'/project'   -it omnimesh/buildenv_omnimesh bash


Run ctrlporthub priot to agent:
./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -serial /dev/ttyUSB0 -loglevel debug
./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-00 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4000 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263



to run with ctrlporthub:
./build/host-ctrlporthub/bin/ctrlporthub -listen 4242 -controllerport 4000  -loglevel debug
./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-00 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4242 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263


to request a DLMS object:
 ./tools/c4-tools/coap_request.py --device KT026802  --device-op GET 7 0.0.99.98.6.255 3

----------------------------

Omnimesh server install

apt-get install npm gradle

Update node to latest stable version:

sudo npm cache clean -f
sudo npm install -g n
sudo n stable


./cibuild.sh



--------------------------------

0.0.99.98.0.255/3
array
{
    struct
    {
        int { 8 },
        octet-string { b'0000010000ff' },
        int { 2 },
        int { 0 }
    },
    struct
    {
        int { 1 },
        octet-string { b'0000600b00ff' },
        int { 2 },
        int { 0 }
    },
    struct
    {
        int { 3 },
        octet-string { b'01001f0700ff' },
        int { 2 },
        int { 0 }
    },
    struct
    {
        int { 3 },
        octet-string { b'0100330700ff' },
        int { 2 },
        int { 0 }
    },
    struct
    {
        int { 3 },
        octet-string { b'0100470700ff' },
        int { 2 },
        int { 0 }
    },
    struct
    {
        int { 3 },
        octet-string { b'0100200700ff' },
        int { 2 },
        int { 0 }
    },
    struct
    {
        int { 3 },
        octet-string { b'0100340700ff' },
        int { 2 },
        int { 0 }
    },
    struct
    { int { 3 }, octet-string { b'0100480700ff' }, int { 2 }, int { 0 } }, struct { int { 3 }, octet-string { b'0100210700ff' }, int { 2 }, int { 0 } }, struct { int { 3 }, octet-string { b'0100350700ff' }, int { 2 }, int { 0 } }, struct { int { 3 }, octet-string { b'0100490700ff' }, int { 2 }, int { 0 } }, struct { int { 3 }, octet-string { b'0100010800ff' }, int { 2 }, int { 0 } }, struct { int { 3 }, octet-string { b'0100020800ff' }, int { 2 }, int { 0 } }, struct { int { 1 }, octet-string { b'00005e5b00ff' }, int { 2 }, int { 0 } }, struct { int { 1 }, octet-string { b'0000600f00ff' }, int { 2 }, int { 0 } } }

0.0.99.98.0.255/2
array
{
    struct
    {
         datetime-octet-string { 2017-06-20T15:06:01 dev 330 status: 0x0 }
         int { 1 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 228.3000030517578 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         int { 1 }
         int { 1 }
    }
    struct
    {
         datetime-octet-string { 2017-06-20T15:06:01 dev 330 status: 0x0 }
         int { 3 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 228.3000030517578 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         int { 2 }
         int { 2 }
    }
    struct
    {
         datetime-octet-string { 2017-06-23T18:04:21 dev 330 status: 0x0 }
         int { 5 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 230.10000610351562 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         int { 4 }
         int { 3 }
    }
    struct
    {
         datetime-octet-string { 2017-06-23T18:04:23 dev 330 status: 0x0 }
         int { 2 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 230.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         int { 4 }
         int { 4 }
    }
    struct
    {
         datetime-octet-string { 2018-01-30T16:54:28 dev 330 status: 0x0 }
         int { 1 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 248.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         int { 22 }
         int { 5 }
    }
    struct
    {
         datetime-octet-string { 2018-01-30T16:54:31 dev 330 status: 0x0 }
         int { 6 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 248.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         float { 0.0 }
         int { 22 }
         int { 6 }
    }
}



-----------------------------------

Others event log:

array {
	struct { datetime-octet-string { 2018-01-31T17:06:04 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.10000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 32 }, int { 55 } },
	struct { datetime-octet-string { 2018-01-31T17:35:53 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.8000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 32 }, int { 56 } },
	struct { datetime-octet-string { 2018-01-31T17:36:03 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.1999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 33 }, int { 57 } },
	struct { datetime-octet-string { 2018-01-31T17:46:17 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.6999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 33 }, int { 58 } },
	struct { datetime-octet-string { 2018-01-31T17:48:26 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.60000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 34 }, int { 59 } },
	struct { datetime-octet-string { 2018-01-31T18:22:46 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 34 }, int { 60 } },
	struct { datetime-octet-string { 2018-01-31T18:23:30 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.5 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 35 }, int { 61 } },
	struct { datetime-octet-string { 2018-01-31T18:27:01 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 245.89999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 35 }, int { 62 } },
	struct { datetime-octet-string { 2018-01-31T18:27:23 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 245.89999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 36 }, int { 63 } },
	struct { datetime-octet-string { 2018-01-31T18:28:20 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 36 }, int { 64 } },
	struct { datetime-octet-string { 2018-01-31T19:16:43 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 37 }, int { 65 } },
	struct { datetime-octet-string { 2018-01-31T19:21:54 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.89999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 37 }, int { 66 } },
	struct { datetime-octet-string { 2018-01-31T19:23:29 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 38 }, int { 67 } },
	struct { datetime-octet-string { 2018-01-31T19:36:33 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 38 }, int { 68 } },
	struct { datetime-octet-string { 2018-01-31T19:37:00 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.60000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 39 }, int { 69 } },
	struct { datetime-octet-string { 2018-01-31T20:33:23 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 39 }, int { 70 } },
	struct { datetime-octet-string { 2018-01-31T20:38:23 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.10000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 40 }, int { 71 } },
	struct { datetime-octet-string { 2018-02-01T03:28:59 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 251.8000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 40 }, int { 72 } },
	struct { datetime-octet-string { 2018-02-01T03:52:12 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 252.6999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 41 }, int { 73 } },
	struct { datetime-octet-string { 2018-02-01T11:02:33 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.3000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 41 }, int { 74 } },
	struct { datetime-octet-string { 2018-02-01T11:03:10 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 42 }, int { 75 } },
	struct { datetime-octet-string { 2018-02-01T11:04:08 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.3000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 42 }, int { 76 } },
	struct { datetime-octet-string { 2018-02-01T11:04:48 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.60000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 43 }, int { 77 } },
	struct { datetime-octet-string { 2018-02-01T11:05:00 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.5 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 43 }, int { 78 } },
	struct { datetime-octet-string { 2018-02-01T11:05:22 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 248.5 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 44 }, int { 79 } },
	struct { datetime-octet-string { 2018-02-01T16:10:04 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.60000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 44 }, int { 80 } },
	struct { datetime-octet-string { 2018-02-01T16:10:19 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.6999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 45 }, int { 81 } },
	struct { datetime-octet-string { 2018-02-01T16:17:14 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.60000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 45 }, int { 82 } },
	struct { datetime-octet-string { 2018-02-01T16:17:33 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.60000610351562 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 46 }, int { 83 } },
	struct { datetime-octet-string { 2018-02-01T16:18:31 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.3000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 46 }, int { 84 } },
	struct { datetime-octet-string { 2018-02-01T16:19:33 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.6999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 47 }, int { 85 } },
	struct { datetime-octet-string { 2018-02-01T16:22:11 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.5 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 47 }, int { 86 } },
	struct { datetime-octet-string { 2018-02-01T16:22:40 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 48 }, int { 87 } },
	struct { datetime-octet-string { 2018-02-01T16:27:12 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 48 }, int { 88 } },
	struct { datetime-octet-string { 2018-02-01T16:30:38 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.1999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 49 }, int { 89 } },
	struct { datetime-octet-string { 2018-02-01T16:31:49 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 246.39999389648438 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 49 }, int { 90 } },
	struct { datetime-octet-string { 2018-02-02T04:27:14 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 254.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 50 }, int { 91 } },
	struct { datetime-octet-string { 2018-02-02T04:28:28 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 253.3000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 50 }, int { 92 } },
	struct { datetime-octet-string { 2018-02-02T04:38:34 dev 330 status: 0x0 }, int { 209 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 249.3000030517578 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 51 }, int { 93 } },
	struct { datetime-octet-string { 2018-02-02T17:27:03 dev 330 status: 0x0 }, int { 210 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 247.6999969482422 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, float { 0.0 }, int { 51 }, int { 94 } } }



----------------------------------------

Standalone:
./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-00 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4242 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263

Connected to server:
./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-00 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4242 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263


----------------------------------------

Possible memory allocation issue:

--- a/src/device/communication/dlms/dlms.c
+++ b/src/device/communication/dlms/dlms.c
@@ -1325,7 +1325,7 @@ bool dlmsParseListOfProfileObjects(const uint8_t* pkt, size_t pktLen, MeterProfi
         profile->objects = MALLOCZ(numOfElements * sizeof(ProfileObject));
     } else {
         profile->objects = NULL;
-        return true;
+        return false;       // malloc failure, we should be PANICing here, we should not be in this situation in normal circumstances.
     }


-------------------------------------------

make pypb2 host-genus-insecure host-ctrlporthub




------------------------------------------------


//
// - Send time request to meter
// - Extract meter time from response
//
DISCOVERY_PROFILE_STEP_0,

//
// - Request capture objects (attr 3) from profile-generic objects.
// - Populate profile->objects[i].instantObject from response data for all objects in profile.
//
DISCOVERY_PROFILE_STEP_1,

//
// - Perform a selective-access read request for the profile.
// - Populate profile->objects[i].valueOffset/Len/Type from generic-profile buffer data.
//
DISCOVERY_PROFILE_STEP_2,

//
// - Request the capture-period from the profile-generic object.
// - Populates profile->capturePeriod from the value in the response.
//
DISCOVERY_PROFILE_STEP_3,

//
// - Send request for capture-objects of the profile-generic object.
// - populates profile->objects[index].scalerIndex from the capture-objects response data
// for those objects where scalers are supported.
//
DISCOVERY_PROFILE_STEP_4,

//
// - Request the profile-generic buffer data.
// - Populates profile->objects[i].scalerUnit from profile-generic buffer response data.
//
DISCOVERY_PROFILE_STEP_5,

//
// For all objects in profile:
// - request object buffer data.
// - parse response to populate ic/scaler info.
//
DISCOVERY_PROFILE_STEP_6,



- Reading the buffer data from an event-profile-generic object produces a nested-PDU... very odd
and it fails to parse.
- dlmsParseProfileScalerUnit() seems to be trying to extract scaler data from the buffer attribute
data from a profile-generic. This contains only value data, not scaler.


------------------------------------------------------------

nested message:

7ea0190341d86ef5e6e600c001810007
0000636200ff020091797e

7ea9094103bc9184e6e700c402810000
0000010082019c0106020f090c07e106
14ff0f0601ff014a0012000117000000
00170000000017000000001700000000
17000000001743644ccd170000000017
00000000170000000017000000001700
0000001200010600000001020f090c07
e10614ff0f0601ff014a001200031700
00000017000000001700000000170000
000017000000001743644ccd17000000
00170000000017000000001700000000
17000000001200020600000002020f09
0c07e10617ff120415ff014a00120005
17000000001700000000170000000017
4366199a170000000017000000001700
00000017000000001700000000170000
00001700000000123b427e

7ea0070341f14e247e

7ea0b44103bef41c0004060000000302
0f090c07e10617ff120417ff014a0012
00021700000000170000000017000000
00174366000017000000001700000000
17000000001700000000170000000017
00000000170000000012000406000000
04020f090c07e2011eff10361cff014a
00120001170000000017000000001700
00000017000000001700000000174378
00001700000000170000000017000000
00170000000017000000001200160600
00000514ee7e


7ea01303411adecce6e600c002810000
0001737f7e

7ea06a4103d0b6c0e6e700c402810100
00000200820052020f090c07e2011eff
10361fff014a00120006170000000017
00000000170000000017000000001700
00000017437800001700000000170000
00001700000000170000000017000000
001200160600000006ede97e








7ea9094103bc9184e6e700c4028100000000010082019c0106020f090c07e10614ff0f0601ff014a00120001170000000017000000001700000000170000000017000000001743644ccd170000000017000000001700000000170000000017000000001200010600000001020f090c07e10614ff0f0601ff014a00120003170000000017000000001700000000170000000017000000001743644ccd170000000017000000001700000000170000000017000000001200020600000002020f090c07e10617ff120415ff014a00120005170000000017000000001700000000174366199a1700000000170000000017000000001700000000170000000017000000001700000000123b427e

----------------------------------------



DataProfileSample* profileSampleCreate(const uint8_t* pkt, uint32_t pktLen)


----------------------------------------------


Steve Tickle [11:38 AM]
ctrlporthub -controllerport 4000 -serial /dev/ttyUSB0 -loglevel debug

./rpc_prodtest.py --setparam server.ip -v fd00::1
./rpc_prodtest.py --setparam prod.lowpan.eui64 -v 00-1B-C5-0C-60-00-7D-63
./rpc_prodtest.py --loadkey -s client-key -f ../00-1B-C5-0C-60-00-7D-63/node.key.der
./rpc_prodtest.py --loadkey -s client-cert -f ../00-1B-C5-0C-60-00-7D-63/node.crt.der
./rpc_prodtest.py --loadkey -s root-cert -f ../00-1B-C5-0C-60-00-7D-63/ca.crt.der
./rpc_prodtest.py --loadkey -s mac-key -f ../00-1B-C5-0C-60-00-7D-63/mac_key
./rpc_prodtest.py –finalize



-------------------------------------------------------------------

docker run -v /Data/Projects/terminalSwedish:/project -it  omnimesh/buildenv_omnimesh bash
make pypb2 host-genus-insecure host-ctrlporthub ipa1-bl-insecure
./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -listen 4242 -loglevel debug
./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-00 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4242 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263



----------------------------------------------------------

install npm (not from repo).
apt-get install gradle openjdk-8-jdk-headless mysql-server
git clone omnimesh
git submodule update for 3pp and interfaces repos
./cibuild.sh

mkdir /opt/connode
mkdir /opt/sma
cp server.tar.gz /opt/connode
cp server-ws.tar.gz /opt/connode
cp SmartMetering.tar.gz /opt/sma

tar zxvf all the above in place.

mysql -p -uroot -e "create user 'meshnet'@'localhost' identified by 'meshnet';"
mysql -p -uroot -e "create database sma;grant all on sma.* to 'meshnet'@'localhost';flush privileges;"
mysql -p -umeshnet -pmeshnet sma < /opt/sma/db/mysql-ddl.sql

mysql -p -uroot -e "create database smc;grant all on smc.* to 'meshnet'@'localhost';flush privileges;"
mysql -p -umeshnet -pmeshnet smc < /usr/local/connode/db/mysql-ddl.sql

sudo systemctl enable /usr/local/connode/etc/c4server.service
sudo systemctl enable /opt/sma/config/sma.service
sudo systemctl start sma
sudo systemctl start c4server

http://<server address>:8882/

logs in /opt/sma/logs/sma.log
and:
/usr/local/connode/logs

agent side:
in ipa.mk
change CONFIG_UPLINK=y
CONFIG_GATEWAY=y
 change CONFIG_UPLINK_TUN6 to CONFIG_UPLINK_LINUX_TUN

./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-00 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4242 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263,server.ip=::1


get root.crt,root.key,server.crt and cerver.key from:
https://confluence.se.cyco.io/display/ENG/How+to+launch+agent+using+meshsim.pl?focusedCommentId=49579179#


(https://confluence.se.cyco.io/display/ENG/Panmesh+Operations+Manual+-+NMS+Installation)


Generate server certs and keys:

#!/bin/bash
openssl req \
    -new \
    -nodes \
    -out server.csr \
    -newkey ec:tools/c4-tools/cert/ec/root.crt \
    -keyout server.key \
    -sha256 \
    -outform DER \
    -subj "/CN=C4 Server"

openssl x509 \
    -req \
    -in server.csr \
    -CA tools/c4-tools/cert/ec/root.crt \
    -CAkey tools/c4-tools/cert/ec/root.key \
    -set_serial 1 \
    -out server.crt \
    -sha256 \
    -days 365


on server go to server->pki, find "Server Security Pair: is ABSENT Add". click "Add".

Server security pair generation:
openssl genrsa -aes128 -passout pass:'1234' -out key.priv 2048
openssl rsa -aes128 -in key.priv -passin pass:'1234' -pubout > key.pub


on server, got to server->pki->create server DTLS




---------------------------------------------

Building of the omnimesh "buildenv":

git clone git@gitlab.cyco.io:SteveTickle/buildenv_omnimesh.git
cd buildenv_omnimesh
./build.sh


Building of Omnimesh server:

git clone ssh://stevetickle@gerrit.se.cyco.io:29418/omnimesh
cd omnimesh
git submodule init
git submodule update
docker run -v $PWD:/project -it  omnimesh/buildenv_omnimesh:latest ./cibuild.sh


Building of the Ommimesh server container:

cd buildenv_omnimesh
./build_omnimesh_server.sh ../omnimesh


Running of the Omnimesh server container:

./run_omnimesh_server


Now go to:
http://172.17.0.2/nms/dashboard

To get a shell on the running container:
docker exec -i -t dbe4d35ba242 bash




--------------------------------

service mysql stop
mkdir -p /var/run/mysqld
chown mysql /var/run/mysqld
mysqld_safe --skip-grant-tables --skip-syslog &
use mysql;
flush privileges;
ALTER USER 'root'@'localhost' IDENTIFIED BY '1234';

service mysql start

---------------------------------------


./build/host-genus-insecure/bin/agent  -eui64 00-00-00-00-00-00-00-01 -meter /dev/ttyUSB0 -initrtc -ctrlhub 127.0.0.1 -ctrlhubport 4242 -loglevel debug -param device.dlms.lls_password=1A2B3C4D,device.dlms.authentication_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263,device.dlms.encryption_key=756776636c656b616b67313836616263,server.ip=fe80::42:25ff:fe6f:df4c

coap_request.py --ctrlporthub localhost:4000 --load-key client-key node.key.der
coap_request.py --ctrlporthub localhost:4000 --load-key client-cert node.crt.der
coap_request.py --ctrlporthub localhost:4000 --load-key root-cert ca.crt.der
coap_request.py --ctrlporthub localhost:4000 --rll-key mac-key mac_key


Crypto options:
   -rootcert file                      DER root certificate for authenticating coap server
   -cert file                          DER agent certificate
   -key file                           DER agent private key
   -mackey file                        MAC Layer key file. One line per key, first is preferred
                                       <index> <hexstring of key>
                                       Binary MAC layer AES-128 key (deprecated)

    -gateway




--------------------------------------------------------------

Running host-agent thru tun6d to localhost

Make sure your local machine has an ipv6 address:
"ip -6 add add fd00::1 dev eth0"
...or better, get an IPv6 address handed out via the DHCP6 server. Make sure you *don't* use ::1 (i.e loopback) as
that will get swallowed by the agent and not transmitted to the server.


sudo TUN6D_SECRET=whatsfordinner /usr/bin/tun6d --loglevel debug

./build/host-genus-insecure/bin/agent   -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_FT232R_USB_UART_A6023SX7-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket


-----------------------------------------------

(gdb) p msg
$1 = {has_deviceHash = true, deviceHash = {size = 16 '\020', bytes = ">\016u&BN\220R\341.\233#\303\304ů"}, has_deviceAlarmHash = false, deviceAlarmHash = {size = 0 '\000', bytes = '\000' <repeats 15 times>},
  has_globalProfileHash = true, globalProfileHash = {size = 16 '\020', bytes = "\354\305\071\363~V瀖\361N\274g\306\035\b"}}




NMS:
2018-03-02 11:22:16,992 TRACE [dtls-pool-4] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER receiveRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, PUT /registration, CONFIRMABLE, 4803)
2018-03-02 11:22:16,992 TRACE [dtls-pool-4] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER handleConfirmableRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, PUT /registration, CONFIRMABLE, 4803)
2018-03-02 11:22:16,995 TRACE [dtls-pool-4] [node=00-00-00-00-00-00-00-01] NodeRegistrationCoapResource - Node registration Node registration request attributes:nodeId:00-00-00-00-00-00-00-01, globalProfileHash: ecc539f37e56e78096f14ebc67c61d08, deviceHash: 3e0e7526424e9052e12e9b23c3c4c5af, nms address: http://127.0.0.1:8880/appserver/
2018-03-02 11:22:16,995 TRACE [dtls-pool-4] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER sendMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, ACKNOWLEDGEMENT, 4803)
2018-03-02 11:22:16,995 TRACE [dtls-pool-4] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT handleConfirmableRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, PUT /registration, CONFIRMABLE, 4803)
2018-03-02 11:22:16,995 TRACE [dtls-pool-4] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT receiveRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, PUT /registration, CONFIRMABLE, 4803)
2018-03-02 11:22:16,995 TRACE [dtls] DTLSConnection - DTLS packet 548d1e2 added to queue, address=/fd51:3c22:ee1f:0:200:0:0:1:5684, sessionId=SessionId(c54b440a1918032ba40177e174a4359871702d75c62a01557a1ea69f32568366), migrating=false

SMA:
2018-03-02 11:22:17.012 [http-nio-8880-exec-6] TRACE c.c.sma.rest.NmsController - Node registration request received with parameters for nodeId: 00-00-00-00-00-00-00-01
2018-03-02 11:22:17.017 [http-nio-8880-exec-6] DEBUG c.c.s.s.m.NodeRegistrationHandler - Node with node Id 00-00-00-00-00-00-00-01 already exists in DB
2018-03-02 11:22:17.049 [devDiscResp-00-00-00-00-00-00-00-01] WARN c.c.s.h.tasks.DeviceDiscoveryTask - Device discovery on node 00-00-00-00-00-00-00-01 failed. Status code received is 406. Message recevied is


-------------------------


 protoc: stdout: . stderr: /project/common/interface/src/main/proto: warning: directory does not exist.
  device_dataprofile.proto:10:5: "DATA_PROFILE" is already defined in file "device_mgmt.proto".
  device_dataprofile.proto:10:5: Note that enum values use C++ scoping rules, meaning that enum values are siblings of their type, not children of it.  Therefore, "DATA_PROFILE" must be unique within the global scope, not just within "ProfileFeature".

---------------------------------------

include directories in Makefile:

include_dirs       += src/device/drivers/dlms


-------------------------------


2018-03-05 16:45:04.653 #1   0000000000000001 <log> 0:06:06.898 [debug] [ tran_switch] {     coap}: UDP send from port 5684 to [fd00::1]:5684 of size 61: dtls session: 1
2018-03-05 16:45:04.653 #1   0000000000000001 <log> 0:06:06.899 [debug] [   coap/task] {     coap}: CoAP sessions: 0 in, 1 out
2018-03-05 16:45:04.654 #1   0000000000000001 <log> 0:06:06.899 [debug] [          ip] {     dtls}: Send IP on uplink, 98 B, type 17, ttl 32: fd51:3c22:ee1f:0:200::1 -> fd00::1
2018-03-05 16:45:04.654 #1   0000000000000001 <log> 0:06:06.899 [debug] [   ipv4/core] {uplink_tx}: eth_up: tx 127.0.0.1 -> 127.0.0.1 146B proto=17
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.939 [debug] [   ipv4/core] {socketUplink}: eth_up: rx 127.0.0.1 -> 127.0.0.1 128B proto=17
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.939 [debug] [    ipv4/udp] {socketUplink}: Got UDP 127.0.0.1:8050 -> 127.0.0.1:50412
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.939 [debug] [ uplink-tun6] {socketUplink}: Got IPv6 packet on eth_up from 127.0.0.1:8050 120B
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.939 [debug] [ tran_switch] {socketUplink}: UDP received from [fd00::1]:5684 to [fd51:3c22:ee1f:0:200::1]:5684 of size 72: dtls session: 1
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.940 [debug] [ tran_switch] {     dtls}: DTLS session 1: payload from [fd00::1]:5684 to [fd51:3c22:ee1f:0:200::1]:5684 of size 43
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.946 [debug] [   coap/task] {     coap}: session 10 (0be40f92): Received ack
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.947 [ info] [   coap/task] {     coap}: session 10 (0be40f92): Response from [fd00::1]:5684: 5.03 (T=ACK, MID=0x5164): 32 B: No application server configured
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.947 [ WARN] [meter/device] {     coap}: Unexpected response 163 from server,reschedule sending node registration
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.947 [debug] [   coap/task] {     coap}: session 10 (0be40f92): Removing outgoing because of response
2018-03-05 16:45:04.701 #1   0000000000000001 <log> 0:06:06.947 [debug] [   coap/task] {     coap}: CoAP sessions: 0 in, 0 out
2018-03-05 16:45:04.905 #1   0000000000000001 <log> 0:06:07.149 [debug] [  meter/dlms] {   device}: Setup AA using HLS without ciphering
2018-03-05 16:45:04.905 #1   0000000000000001 <log> 0:06:07.149 [debug] [        dlms] {   device}: Setup AA with HLS
2018-03-05 16:45:04.956 #1   0000000000000001 <log> 0:06:07.200 [debug] [        hdlc] {     hdlc}: Connect HDLC link
2018-03-05 16:45:04.962 #1   0000000000000001 <log> 0:06:07.206 [debug] [        hdlc] {     hdlc}: tx: (1/3): 7ea0200361931b9f8180140502010006
2018-03-05 16:45:04.962 #1   0000000000000001 <log> 0:06:07.206 [debug] [        hdlc] {     hdlc}: tx: (2/3): 02010007040000000108040000000169
2018-03-05 16:45:04.962 #1   0000000000000001 <log> 0:06:07.206 [debug] [        hdlc] {     hdlc}: tx: (3/3): 6d7e
2018-03-05 16:45:05.042 #1   0000000000000001 <log> 0:06:07.286 [debug] [        hdlc] {     hdlc}: rx: (1/3): 7ea020610373059e8180140502010006
2018-03-05 16:45:05.042 #1   0000000000000001 <log> 0:06:07.286 [debug] [        hdlc] {     hdlc}: rx: (2/3): 02010007040000000108040000000169
2018-03-05 16:45:05.042 #1   0000000000000001 <log> 0:06:07.286 [debug] [        hdlc] {     hdlc}: rx: (3/3): 6d7e
2018-03-05 16:45:05.047 #1   0000000000000001 <log> 0:06:07.292 [debug] [        hdlc] {     hdlc}: tx: (1/5): 7ea04c0361105827e6e600603ea10906
2018-03-05 16:45:05.048 #1   0000000000000001 <log> 0:06:07.292 [debug] [        hdlc] {     hdlc}: tx: (2/5): 07608574050801018a0207808b076085
2018-03-05 16:45:05.048 #1   0000000000000001 <log> 0:06:07.292 [debug] [        hdlc] {     hdlc}: tx: (3/5): 7405080202ac12801030654537456363
2018-03-05 16:45:05.048 #1   0000000000000001 <log> 0:06:07.292 [debug] [        hdlc] {     hdlc}: tx: (4/5): 633938356635344342be10040e010000
2018-03-05 16:45:05.048 #1   0000000000000001 <log> 0:06:07.292 [debug] [        hdlc] {     hdlc}: tx: (5/5): 00065f1f0400001f1ffffff8547e
2018-03-05 16:45:05.266 #1   0000000000000001 <log> 0:06:07.511 [debug] [        hdlc] {     hdlc}: rx: (1/6): 7ea0586103300751e6e700614aa10906
2018-03-05 16:45:05.267 #1   0000000000000001 <log> 0:06:07.511 [debug] [        hdlc] {     hdlc}: rx: (2/6): 0760857405080101a203020100a305a1
2018-03-05 16:45:05.267 #1   0000000000000001 <log> 0:06:07.511 [debug] [        hdlc] {     hdlc}: rx: (3/6): 0302010e880207808907608574050802
2018-03-05 16:45:05.267 #1   0000000000000001 <log> 0:06:07.511 [debug] [        hdlc] {     hdlc}: rx: (4/6): 02aa12801047656e7573190000000061
2018-03-05 16:45:05.267 #1   0000000000000001 <log> 0:06:07.512 [debug] [        hdlc] {     hdlc}: rx: (5/6): 001815c346be10040e0800065f1f0400
2018-03-05 16:45:05.267 #1   0000000000000001 <log> 0:06:07.512 [debug] [        hdlc] {     hdlc}: rx: (6/6): 00181d01000007bdf57e
2018-03-05 16:45:05.268 #1   0000000000000001 <log> 0:06:07.512 [debug] [        dlms] {     dlms}: extracted server max pdu size is 256
2018-03-05 16:45:05.268 #1   0000000000000001 <log> 0:06:07.512 [debug] [        dlms] {     dlms}: Action 0-0:40.0.0*255 ic 15 methodId 1 actionLen: 18 B
2018-03-05 16:45:05.324 #1   0000000000000001 <log> 0:06:07.568 [debug] [        hdlc] {     hdlc}: tx: (1/3): 7ea02b0361328debe6e600c30181000f
2018-03-05 16:45:05.324 #1   0000000000000001 <log> 0:06:07.568 [debug] [        hdlc] {     hdlc}: tx: (2/3): 0000280000ff010109105c89ea5f7433
2018-03-05 16:45:05.324 #1   0000000000000001 <log> 0:06:07.568 [debug] [        hdlc] {     hdlc}: tx: (3/3): a6ba0fbecc91ea38bf96ef6a7e
2018-03-05 16:45:05.410 #1   0000000000000001 <log> 0:06:07.654 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea011610352c7fee6e700c701c1010c
2018-03-05 16:45:05.410 #1   0000000000000001 <log> 0:06:07.655 [debug] [        hdlc] {     hdlc}: rx: (2/2): 48677e
2018-03-05 16:45:05.411 #1   0000000000000001 <log> 0:06:07.655 [ WARN] [        dlms] {     dlms}: Action Response result: hw fault
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.655 [ WARN] [        dlms] {     dlms}: processXDlmsApdu(5 B): failed
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.655 [ WARN] [  meter/dlms] {   device}: Broken response: check failed
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.655 [ WARN] [meter/device] {   device}: Error from USC 0000006: comm: broken rsp
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.655 [debug] [meter/device] {   device}: Ignoring alarm over rate limit
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.655 [debug] [  meter/dlms] {   device}: Setup AA failed. Trying again with ciphering enabled
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.655 [debug] [  meter/dlms] {   device}: Setup AA using HLS with ciphering
2018-03-05 16:45:05.412 #1   0000000000000001 <log> 0:06:07.656 [debug] [        dlms] {   device}: Setup AA with HLS
2018-03-05 16:45:05.467 #1   0000000000000001 <log> 0:06:07.712 [debug] [        hdlc] {     hdlc}: tx: (1/6): 7ea0580361543592e6e600604aa10906
2018-03-05 16:45:05.468 #1   0000000000000001 <log> 0:06:07.712 [debug] [        hdlc] {     hdlc}: tx: (2/6): 0760857405080103a60a04084d4d4d00
2018-03-05 16:45:05.469 #1   0000000000000001 <log> 0:06:07.713 [debug] [        hdlc] {     hdlc}: tx: (3/6): 00bc614e8a0207808b07608574050802
2018-03-05 16:45:05.469 #1   0000000000000001 <log> 0:06:07.713 [debug] [        hdlc] {     hdlc}: tx: (4/6): 02ac1280103065453745636363393835
2018-03-05 16:45:05.469 #1   0000000000000001 <log> 0:06:07.714 [debug] [        hdlc] {     hdlc}: tx: (5/6): 6635344342be10040e01000000065f1f
2018-03-05 16:45:05.469 #1   0000000000000001 <log> 0:06:07.714 [debug] [        hdlc] {     hdlc}: tx: (6/6): 0400001f1fffffa64c7e
2018-03-05 16:45:05.713 #1   0000000000000001 <log> 0:06:07.958 [debug] [        hdlc] {     hdlc}: rx: (1/8): 7ea0776103748d68e6e7006169a10906
2018-03-05 16:45:05.713 #1   0000000000000001 <log> 0:06:07.959 [debug] [        hdlc] {     hdlc}: rx: (2/8): 0760857405080103a203020101a305a1
2018-03-05 16:45:05.713 #1   0000000000000001 <log> 0:06:07.959 [debug] [        hdlc] {     hdlc}: rx: (3/8): 0302010e880207808907608574050802
2018-03-05 16:45:05.714 #1   0000000000000001 <log> 0:06:07.959 [debug] [        hdlc] {     hdlc}: rx: (4/8): 02aa12801047656e7573190000000061
2018-03-05 16:45:05.714 #1   0000000000000001 <log> 0:06:07.959 [debug] [        hdlc] {     hdlc}: rx: (5/8): 001815c346a40a0408474f4500000000
2018-03-05 16:45:05.714 #1   0000000000000001 <log> 0:06:07.959 [debug] [        hdlc] {     hdlc}: rx: (6/8): 06be230421281f3000000025eadcddb4
2018-03-05 16:45:05.714 #1   0000000000000001 <log> 0:06:07.959 [debug] [        hdlc] {     hdlc}: rx: (7/8): ff961527c0673409564861718a069e59
2018-03-05 16:45:05.714 #1   0000000000000001 <log> 0:06:07.960 [debug] [        hdlc] {     hdlc}: rx: (8/8): 8f082d6fe414ff307e
2018-03-05 16:45:05.715 #1   0000000000000001 <log> 0:06:07.960 [ WARN] [        dlms] {     dlms}: COSEM AA is rejected: authentication required
2018-03-05 16:45:05.715 #1   0000000000000001 <log> 0:06:07.960 [ WARN] [        dlms] {     dlms}: processAcseApdu(107 B): failed
2018-03-05 16:45:05.715 #1   0000000000000001 <log> 0:06:07.960 [ WARN] [  meter/dlms] {   device}: Broken response: check failed
2018-03-05 16:45:05.715 #1   0000000000000001 <log> 0:06:07.960 [ WARN] [meter/device] {   device}: Error from USC 0000006: comm: broken rsp
2018-03-05 16:45:05.715 #1   0000000000000001 <log> 0:06:07.960 [debug] [meter/device] {   device}: Ignoring alarm over rate limit
2018-03-05 16:45:05.766 #1   0000000000000001 <log> 0:06:08.010 [debug] [        dlms] {   device}: Disconnect HDLC link
2018-03-05 16:45:05.771 #1   0000000000000001 <log> 0:06:08.015 [debug] [        hdlc] {     hdlc}: tx: (1/1): 7ea00703615365817e
2018-03-05 16:45:05.793 #1   0000000000000001 <log> 0:06:08.037 [debug] [        hdlc] {     hdlc}: rx: (1/1): 7ea00761037377467e
2018-03-05 16:45:05.794 #1   0000000000000001 <log> 0:06:08.037 [debug] [        hdlc] {     hdlc}: HDLC link disconnected
2018-03-05 16:45:09.282 #1   0000000000000001 <log> 0:06:11.526 [debug] [ uplink-tun6] { schedule}: Scheduling keepalive in 20s



------------------------------------------


0:56:33:255 6/3/2018 to 5:56:33:255 6/3/2018

# No data
[Tue Mar  6 01:26:33 2018] [14:10:08.836] 1520295993 51008836 dlms  device  Profile Block load: From time: 2018-03-06 00:56:33
[Tue Mar  6 01:26:33 2018] [14:10:08.846] 1520295993 51008846 dlms  device  Profile Block load: To time: 2018-03-06 05:56:33
[Tue Mar  6 01:26:33 2018] [14:10:08.846] 1520295993 51008846 dlms  device  Get 1-0:99.1.0*255 ic 7 attr 2 selective access
[Tue Mar  6 01:26:33 2018] [14:10:08.979] 1520295993 51008979 hdlc  hdlc    tx: (1/5): 7ea04c0341327b06e6e600c001810007
[Tue Mar  6 01:26:33 2018] [14:10:08.979] 1520295993 51008979 hdlc  hdlc    tx: (2/5): 0100630100ff0201 0102040204120008
[Tue Mar  6 01:26:33 2018] [14:10:08.980] 1520295993 51008980 hdlc  hdlc    tx: (3/5): 09060000010000ff0f02120000090c07e20306ff003821fffeb600090c07e20306ff053821fffeb6000100bff57e
[Tue Mar  6 01:26:33 2018] [14:10:09.015] 1520295993 51009015 hdlc  hdlc    rx: (1/2): 7ea01c4103527376e6e700c402810100
[Tue Mar  6 01:26:33 2018] [14:10:09.015] 1520295993 51009015 hdlc  hdlc    rx: (2/2): 00000100820004018200004e3d7e
# Has data
#                                                                                          // DIDN'T CAPTURE FIRST LINE
[Tue Mar  6 01:26:34 2018] [14:10:09.611] 1520295994 51009611 hdlc  hdlc    tx: (2/5): 0100630100ff0201 0102040204120008
[Tue Mar  6 01:26:34 2018] [14:10:09.612] 1520295994 51009612 hdlc  hdlc    tx: (3/5): 09060000010000ff0f02120000 090c 07e20306 00 052d00 00 014a 00 090c 07e20306 ff 053822 fffeb600 0100 91da7e


0100630100ff0201010204020412000809060000010000ff0f02120000090c07e2030600052d0000014a00090c07e20306ff053822fffeb600010091da7e



-------------------------------------

possible exploit:

use time sync format packets to intentionally drift the clock on the meter using the time sync mechanism.
Broadcast the packets


timeServiceRegisterEpochTimeCallback()
timeServiceRegisterTzCallback()
updateMeterTime()

------------------------------------------

decode protobuf hex in file t:

xxd -r -p < t | protoc --decode_raw



------------------


mysql> set FOREIGN_KEY_CHECKS=0;




-------------------------------------------------

[Mon Mar 12 11:34:33 2018] [28:50:10.869] 1520850873 103810869 dlms device  Profile Block load: From time: 2018-03-12 11:04:33
[Mon Mar 12 11:34:33 2018] [28:50:10.879] 1520850873 103810879 dlms device  Profile Block load: To time: 2018-03-12 16:04:33
[Mon Mar 12 11:34:33 2018] [28:50:10.880] 1520850873 103810880 dlms device  Get 1-0:99.1.0*255 ic 7 attr 2 selective access
[Mon Mar 12 11:34:33 2018] [28:50:11.013] 1520850873 103811013 hdlc hdlc    tx: (1/5): 7ea04c0341327b06e6e600c001810007
[Mon Mar 12 11:34:33 2018] [28:50:11.013] 1520850873 103811013 hdlc hdlc    tx: (2/5): 0100630100ff02010102040204120008
[Mon Mar 12 11:34:33 2018] [28:50:11.014] 1520850873 103811014 hdlc hdlc    tx: (3/5): 09060000010000ff0f02120000090c07
[Mon Mar 12 11:34:33 2018] [28:50:11.014] 1520850873 103811014 hdlc hdlc    tx: (4/5): e2030cff0b0421ff014a00090c07e203
[Mon Mar 12 11:34:33 2018] [28:50:11.014] 1520850873 103811014 hdlc hdlc    tx: (5/5): 0cff100421ff014a000100fd6c7e
[Mon Mar 12 11:34:33 2018] [28:50:11.052] 1520850873 103811052 hdlc hdlc    rx: (1/2): 7ea01c4103527376e6e700c402810100
[Mon Mar 12 11:34:33 2018] [28:50:11.052] 1520850873 103811052 hdlc hdlc    rx: (2/2): 00000100820004018200004e3d7e



------------------------------------------

power cycle @ 21:11 (meter time)

SA read:

7ea04c0341dc0b08e6e600c001810007
0000636202ff02010102040204120008
09060000010000ff0f02120000090c07
e2030cff131128ff014a00090c07e203
0cff151128ff014a00010021027e
7ea01c4103fc073ae6e700c402810100
00000100820004018200004e3d7e


Full read:

7ea0190341dc4ab3e6e600c001810007
0000636202ff0200e7407e
7ea9094103fc95c6e6e700c402810100
000001008200f40182000a0203090c07
e10b06ff101300ff014a001200650600
0000010203090c07e10b06ff101700ff
014a0012006606000000020203090c07
e20217ff143500ff014a001200650600
0000030203090c07e20217ff143b00ff
014a0012006606000000040203090c07
e20217ff150200ff014a001200650600
0000050203090c07e20217ff150300ff
014a0012006606000000060203090c07
e2030cff123300ff014a001200650600
0000070203090c07e2030cff123400ff
014a0012006606000000080203090c07
e2030cff123900ff014a001200650600
0000090203090c07e2030cff123a00ff
014a001200660600f7867e


SA read:
7ea04c0341dc0b08e6e600c001810007
0000636202ff02010102040204120008
09060000010000ff0f02120000090c07
e2030cff142931ff014a00090c07e203
0cff162931ff014a000100628a7e
7ea01c4103fc073ae6e700c402810100
00000100820004018200004e3d7e





mysql -umeshnet -pmeshnet -N -B -e  "select HEX(registerValues) from sma.meter_sample where device_profile_id=2;" | xargs -I % sh -c "echo % | xxd -r -p | protoc --decode_raw " | grep "3: \".t" | cut -c4-100

import binascii
[binascii.hexlify(t[1:-1].decode('string_escape'))[4:] for t in open('t','rb').read().split()]


mysql -umeshnet -pmeshnet -N -B -e  "select HEX(registerValues) from sma.meter_sample where device_profile_id=2;" | xargs -I % sh -c "echo % | xxd -r -p | protoc --decode_raw " | grep "3: \".t" | cut -c4-100 | xargs -I + python -c "import binascii;print(binascii.hexlify(\"+\")[4:]) " | xargs -I @ python ~/Playground/DT_conv_cli.py @





------------------------------------------------------

7ea0190341dc4ab3e6e600c001810007
0000636202ff0200e7407e
 7ea9094103fc95c6e6e700c402810000
 00000100820184018200140203090c07
 e10b06ff101300ff014a001200650600
 0000010203090c07e10b06ff101700ff
 014a0012006606000000020203090c07
 e20217ff143500ff014a001200650600
 0000030203090c07e20217ff143b00ff
 014a0012006606000000040203090c07
 e20217ff150200ff014a001200650600
 0000050203090c07e20217ff150300ff
 014a0012006606000000060203090c07
 e2030cff123300ff014a001200650600
 0000070203090c07e2030cff123400ff
 014a0012006606000000080203090c07
 e2030cff123900ff014a001200650600
 0000090203090c07e2030cff123a00ff
 014a00120066060032a37e

7ea0070341f14e247e
 7ea09c4103fe7b3400000a0203090c07
 e2030cff161e00ff014a001200650600
 00000b0203090c07e2030cff161f00ff
 014a00120066060000000c0203090c07
 e2030cff162300ff014a001200650600
 00000d0203090c07e2030cff162400ff
 014a00120066060000000e0203090c07
 e2030cff162600ff014a001200650600
 00000f0203090c07e2030cff162700ff
 014a001200660600000010ddc17e
7ea01303411efa8ae6e600c002810000
0001737f7e
7ea0784103106dfce6e700c402810100
000002008200600203090c07e2030dff
0f2f00ff014a00120065060000001102
03090c07e2030dff0f3000ff014a0012
006606000000120203090c07e2030dff
100900ff014a00120065060000001302
03090c07e2030dff100a00ff014a0012
0066060000001473117e


<HDLC len="24" >
<TargetAddress Value="1" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="DC" />
<PDU>
<GetRequest>
  <GetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--PROFILE_GENERIC-->
      <ClassId Value="7" />
      <!--0.0.99.98.2.255-->
      <InstanceId Value="0000636202FF" />
      <AttributeId Value="2" />
    </AttributeDescriptor>
  </GetRequestNormal>
</GetRequest>
</PDU>
</HDLC>
<HDLC len="264" >
<TargetAddress Value="32" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="FC" />
<NextFrame Value="C40281000000000100820184018200140203090C07E10B06FF101300FF014A0012006506000000010203090C07E10B06FF101700FF014A0012006606000000020203090C07E20217FF143500FF014A0012006506000000030203090C07E20217FF143B00FF014A0012006606000000040203090C07E20217FF150200FF014A0012006506000000050203090C07E20217FF150300FF014A0012006606000000060203090C07E2030CFF123300FF014A0012006506000000070203090C07E2030CFF123400FF014A0012006606000000080203090C07E2030CFF123900FF014A0012006506000000090203090C07E2030CFF123A00FF014A001200660600" />
</HDLC>
<HDLC len="9" >
<TargetAddress Value="1" />
<SourceAddress Value="32" />
<!--S frame.-->
<FrameType Value="F1" />
<Command Value="NextFrame" />
</HDLC>
<HDLC len="155" >
<TargetAddress Value="32" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="FE" />
<NextFrame Value="00000A0203090C07E2030CFF161E00FF014A00120065060000000B0203090C07E2030CFF161F00FF014A00120066060000000C0203090C07E2030CFF162300FF014A00120065060000000D0203090C07E2030CFF162400FF014A00120066060000000E0203090C07E2030CFF162600FF014A00120065060000000F0203090C07E2030CFF162700FF014A001200660600000010" />
</HDLC>
<HDLC len="18" >
<TargetAddress Value="1" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="1E" />
<PDU>
<GetRequest>
  <GetRequestForNextDataBlock>
    <InvokeIdAndPriority Value="129" />
    <BlockNumber Value="1" />
  </GetRequestForNextDataBlock>
</GetRequest>
</PDU>
</HDLC>
<HDLC len="119" >
<TargetAddress Value="32" />
<SourceAddress Value="1" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<GetResponse>
  <GetResponsewithDataBlock>
    <InvokeIdAndPriority Value="129" />
    <Result>
      <LastBlock Value="1" />
      <BlockNumber Value="2" />
      <Result>
        <RawData Value="0203090C07E2030DFF0F2F00FF014A0012006506000000110203090C07E2030DFF0F3000FF014A0012006606000000120203090C07E2030DFF100900FF014A0012006506000000130203090C07E2030DFF100A00FF014A001200660600000014" />
      </Result>
    </Result>
  </GetResponsewithDataBlock>
</GetResponse>
</PDU>
</HDLC>





C4

02 81 00000000 01 00 82 01 84
01 82 00 14
    02 03
     090C 07E10B06FF101300FF014A00 12 0065 06 00000001
    0203
     090C 07E10B06FF101700FF014A00 12 0066 06 00000002
    0203
     090C 07E20217FF143500FF014A00 12 0065 06 00000003
    0203
     090C 07E20217FF143B00FF014A00 12 0066 06 00000004
    0203
     090C 07E20217FF150200FF014A00 12 0065 06 00000005
    0203
     090C 07E20217FF150300FF014A00 12 0066 06 00000006
    0203
     090C 07E2030CFF123300FF014A00 12 0065 06 00000007
    0203
     090C 07E2030CFF123400FF014A00 12 0066 06 00000008
    0203
     090C 07E2030CFF123900FF014A00 12 0065 06 00000009
    0203
     090C 07E2030CFF123A00FF014A00 12 0066 06 0000000A
    0203
     090C 07E2030CFF161E00FF014A00 12 0065 06 0000000B
    0203
     090C 07E2030CFF161F00FF014A00 12 0066 06 0000000C
    0203
     090C 07E2030CFF162300FF014A00 12 0065 06 0000000D
    0203
     090C 07E2030CFF162400FF014A00 12 0066 06 0000000E
    0203
     090C 07E2030CFF162600FF014A00 12 0065 06 0000000F
    0203
     090C 07E2030CFF162700FF014A00 12 0066 06 00000010
    0203
     090C 07E2030DFF0F2F00FF014A00 12 0065 06 00000011
    0203
     090C 07E2030DFF0F3000FF014A00 12 0066 06 00000012
    0203
     090C 07E2030DFF100900FF014A00 12 0065 06 00000013
    0203
     090C 07E2030DFF100A00FF014A00 12 0066 06 00000014


   <Data>
     <Array length="20" offset="4">
     <ArrayElement index="0" offset="4">
       <Structure length="3" offset="5">
       <Field index="0" offset="6">
         <OctetString offset="7" datetime="16:19:0:255 6/11/2017">07e10b06ff101300ff014a00</OctetString>
       </Field>
       <Field index="1" offset="20">
         <Uint16 offset="21">0065</Uint16>
       </Field>
       <Field index="2" offset="23">
         <Uint32 offset="24">00000001</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="1" offset="28">
       <Structure length="3" offset="29">
       <Field index="0" offset="30">
         <OctetString offset="31" datetime="16:23:0:255 6/11/2017">07e10b06ff101700ff014a00</OctetString>
       </Field>
       <Field index="1" offset="44">
         <Uint16 offset="45">0066</Uint16>
       </Field>
       <Field index="2" offset="47">
         <Uint32 offset="48">00000002</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="2" offset="52">
       <Structure length="3" offset="53">
       <Field index="0" offset="54">
         <OctetString offset="55" datetime="20:53:0:255 23/2/2018">07e20217ff143500ff014a00</OctetString>
       </Field>
       <Field index="1" offset="68">
         <Uint16 offset="69">0065</Uint16>
       </Field>
       <Field index="2" offset="71">
         <Uint32 offset="72">00000003</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="3" offset="76">
       <Structure length="3" offset="77">
       <Field index="0" offset="78">
         <OctetString offset="79" datetime="20:59:0:255 23/2/2018">07e20217ff143b00ff014a00</OctetString>
       </Field>
       <Field index="1" offset="92">
         <Uint16 offset="93">0066</Uint16>
       </Field>
       <Field index="2" offset="95">
         <Uint32 offset="96">00000004</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="4" offset="100">
       <Structure length="3" offset="101">
       <Field index="0" offset="102">
         <OctetString offset="103" datetime="21:2:0:255 23/2/2018">07e20217ff150200ff014a00</OctetString>
       </Field>
       <Field index="1" offset="116">
         <Uint16 offset="117">0065</Uint16>
       </Field>
       <Field index="2" offset="119">
         <Uint32 offset="120">00000005</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="5" offset="124">
       <Structure length="3" offset="125">
       <Field index="0" offset="126">
         <OctetString offset="127" datetime="21:3:0:255 23/2/2018">07e20217ff150300ff014a00</OctetString>
       </Field>
       <Field index="1" offset="140">
         <Uint16 offset="141">0066</Uint16>
       </Field>
       <Field index="2" offset="143">
         <Uint32 offset="144">00000006</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="6" offset="148">
       <Structure length="3" offset="149">
       <Field index="0" offset="150">
         <OctetString offset="151" datetime="18:51:0:255 12/3/2018">07e2030cff123300ff014a00</OctetString>
       </Field>
       <Field index="1" offset="164">
         <Uint16 offset="165">0065</Uint16>
       </Field>
       <Field index="2" offset="167">
         <Uint32 offset="168">00000007</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="7" offset="172">
       <Structure length="3" offset="173">
       <Field index="0" offset="174">
         <OctetString offset="175" datetime="18:52:0:255 12/3/2018">07e2030cff123400ff014a00</OctetString>
       </Field>
       <Field index="1" offset="188">
         <Uint16 offset="189">0066</Uint16>
       </Field>
       <Field index="2" offset="191">
         <Uint32 offset="192">00000008</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="8" offset="196">
       <Structure length="3" offset="197">
       <Field index="0" offset="198">
         <OctetString offset="199" datetime="18:57:0:255 12/3/2018">07e2030cff123900ff014a00</OctetString>
       </Field>
       <Field index="1" offset="212">
         <Uint16 offset="213">0065</Uint16>
       </Field>
       <Field index="2" offset="215">
         <Uint32 offset="216">00000009</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="9" offset="220">
       <Structure length="3" offset="221">
       <Field index="0" offset="222">
         <OctetString offset="223" datetime="18:58:0:255 12/3/2018">07e2030cff123a00ff014a00</OctetString>
       </Field>
       <Field index="1" offset="236">
         <Uint16 offset="237">0066</Uint16>
       </Field>
       <Field index="2" offset="239">
         <Uint32 offset="240">0000000a</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="10" offset="244">
       <Structure length="3" offset="245">
       <Field index="0" offset="246">
         <OctetString offset="247" datetime="22:30:0:255 12/3/2018">07e2030cff161e00ff014a00</OctetString>
       </Field>
       <Field index="1" offset="260">
         <Uint16 offset="261">0065</Uint16>
       </Field>
       <Field index="2" offset="263">
         <Uint32 offset="264">0000000b</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="11" offset="268">
       <Structure length="3" offset="269">
       <Field index="0" offset="270">
         <OctetString offset="271" datetime="22:31:0:255 12/3/2018">07e2030cff161f00ff014a00</OctetString>
       </Field>
       <Field index="1" offset="284">
         <Uint16 offset="285">0066</Uint16>
       </Field>
       <Field index="2" offset="287">
         <Uint32 offset="288">0000000c</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="12" offset="292">
       <Structure length="3" offset="293">
       <Field index="0" offset="294">
         <OctetString offset="295" datetime="22:35:0:255 12/3/2018">07e2030cff162300ff014a00</OctetString>
       </Field>
       <Field index="1" offset="308">
         <Uint16 offset="309">0065</Uint16>
       </Field>
       <Field index="2" offset="311">
         <Uint32 offset="312">0000000d</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="13" offset="316">
       <Structure length="3" offset="317">
       <Field index="0" offset="318">
         <OctetString offset="319" datetime="22:36:0:255 12/3/2018">07e2030cff162400ff014a00</OctetString>
       </Field>
       <Field index="1" offset="332">
         <Uint16 offset="333">0066</Uint16>
       </Field>
       <Field index="2" offset="335">
         <Uint32 offset="336">0000000e</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="14" offset="340">
       <Structure length="3" offset="341">
       <Field index="0" offset="342">
         <OctetString offset="343" datetime="22:38:0:255 12/3/2018">07e2030cff162600ff014a00</OctetString>
       </Field>
       <Field index="1" offset="356">
         <Uint16 offset="357">0065</Uint16>
       </Field>
       <Field index="2" offset="359">
         <Uint32 offset="360">0000000f</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="15" offset="364">
       <Structure length="3" offset="365">
       <Field index="0" offset="366">
         <OctetString offset="367" datetime="22:39:0:255 12/3/2018">07e2030cff162700ff014a00</OctetString>
       </Field>
       <Field index="1" offset="380">
         <Uint16 offset="381">0066</Uint16>
       </Field>
       <Field index="2" offset="383">
         <Uint32 offset="384">00000010</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="16" offset="388">
       <Structure length="3" offset="389">
       <Field index="0" offset="390">
         <OctetString offset="391" datetime="15:47:0:255 13/3/2018">07e2030dff0f2f00ff014a00</OctetString>
       </Field>
       <Field index="1" offset="404">
         <Uint16 offset="405">0065</Uint16>
       </Field>
       <Field index="2" offset="407">
         <Uint32 offset="408">00000011</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="17" offset="412">
       <Structure length="3" offset="413">
       <Field index="0" offset="414">
         <OctetString offset="415" datetime="15:48:0:255 13/3/2018">07e2030dff0f3000ff014a00</OctetString>
       </Field>
       <Field index="1" offset="428">
         <Uint16 offset="429">0066</Uint16>
       </Field>
       <Field index="2" offset="431">
         <Uint32 offset="432">00000012</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="18" offset="436">
       <Structure length="3" offset="437">
       <Field index="0" offset="438">
         <OctetString offset="439" datetime="16:9:0:255 13/3/2018">07e2030dff100900ff014a00</OctetString>
       </Field>
       <Field index="1" offset="452">
         <Uint16 offset="453">0065</Uint16>
       </Field>
       <Field index="2" offset="455">
         <Uint32 offset="456">00000013</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     <ArrayElement index="19" offset="460">
       <Structure length="3" offset="461">
       <Field index="0" offset="462">
         <OctetString offset="463" datetime="16:10:0:255 13/3/2018">07e2030dff100a00ff014a00</OctetString>
       </Field>
       <Field index="1" offset="476">
         <Uint16 offset="477">0066</Uint16>
       </Field>
       <Field index="2" offset="479">
         <Uint32 offset="480">00000014</Float32>
       </Field>
       </Structure>
     </ArrayElement>
     </Array>
   </Data>



-----------------------------------------------------------------------

DCUb4:
Note that there is a lot of potential "simplification" work such as removal of the filesystem that may make
further tasks much easier rather than having to deal with the archaic implementations.

Platform:
- Booting issue (Linux,C,low-level).
- Install scripts split and drive from MTS (Python/sh).

Application (From AppDeRisk branch):
- DCUTool interaction (serial 'break' issue) (Python?).
- Break up Stubs.c (C, makefile)
- Complete stub functionality for UART (mostly working) (C, Linux, Node & debug-terminal interaction).
- Complete stub functionality for clock/timing (Nothing done) (C, Linux).
- Complete stub functionality for SDCard (mostly working).
- Complete stub functionality for SDRAM (mostly working).
- Complete stub functionality for GPRSModem (nothing done, integrate with Python ModemController).
- Complete stub functionality for TCPIP (implemented but untested) (C, Linux, TCP/IP, DCUTool/server interaction).
- Complete stub functionality for OTXU storage/behaviour (nothing) (C, Platform & Linux interaction).
- Complete stub functionality for preferences (mostly working) (C, file ops, reimplement?).
- Complete stub functionality for Entropy (C,Linux, /dev/urandom).
- Complete stub functionality for power monitoring & control (C,Linux, GPIO, MTS?).
- Complete stub functionality for RTC (C, Linux, hwclock).
- Complete stub functionality for hunter reset pin?
- Complete stub functionality for FLASH? maybe remove instead, part of OTXU image storage IIRC.
- Complete stub functionality for reset functionality.
- Complete stub functionality for Watchdog.
- Move Stubs back into cygh (build/makefile issues?).
- Removal of 'dcutime' (its just wrappers around time/gmtime/localtime).
- Removal of 'timezone' (its just wrappers around tzset).

Testing:
- Evaluation of content of Hwicce unit tests and usefullness to Bellatrix.
- DCUTool interaction for configuration and further mnaual&dev testing.
- Maintenance of the hwicce unit tests.
- Upgrade testsi OTXU (Do we have them already?).
- End-to-end/system tests.
- Work through all functionality of DCUTool and ensure its all working.
- Integration & testing with 1 node (existing setup).
- Testing with 2 nodes (new setup).
- Performance testing with 1 node.
- Performance testing with 2 nodes.
- Watchdog/power reset/recovery/robustness testing.
- testing of ethernet functionality.

New functionality:
- Two-Node mods ().
- Replacement of SharkSSL with... (WolfSSL?)

Design work (priority TBD):
- Two node mods (may make sense to do some simplification work prior to this).
- Removal of filesystem (store) code from DCU (simplification and removal of old fs code). Maybe use SqLite for atomic/rollback/robustness reasons.
- More appropriate preferences implementation (use config.xml directly?, simple k-v store? sqlite would be nice, well supported & tested? redis?).
- Removal of SDRAM emulation (unnecessary).
- Removal of SDCard emulation (unnecessary).
- Investigate process-model changes & low-power/non-super-loop options.
- Without resource restrictions (RAM), the stream system is over-complicated. Investigate simplification & replacement.
- Reimplementation of 'event' into Python.
- Reimplementation of 'config' into Python.
- Reimplementation of 'metercomms' into Python.
- Reimplementation of 'command' into Python.
- Reimplementation of decoders in Python (bigger job, different repo).



-------------------------------------------------------------------


NMS/C4server restarted while agent logged in results in:

2018-03-16 11:30:03,573 TRACE [dtls] DTLSConnection - DTLS packet 6bf0a78c added to queue, address=/fd51:3c22:ee1f:0:200:0:0:1:5684, sessionId=SessionId(d53278cdf99b7beb878f976675847bae5c6d54eea6d891fe2ea1f74d3a0d2f37), migrating=false
2018-03-16 11:30:03,573 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] DTLSConnection - DTLS packet 6bf0a78c being processed, address=/fd51:3c22:ee1f:0:200:0:0:1:5684, sessionId=SessionId(d53278cdf99b7beb878f976675847bae5c6d54eea6d891fe2ea1f74d3a0d2f37), migrating=false
2018-03-16 11:30:03,573 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER receiveRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3312)
2018-03-16 11:30:03,573 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER handleConfirmableRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3312)
2018-03-16 11:30:03,573 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] IncomingCoapExchange - Received request POST /mq from peer /fd51:3c22:ee1f:0:200:0:0:1:5684 with payload [0811124408bbd5aed505723c0a024e4112060000636202ff1a0e090c07e20310ff0b2000ff014a001a031200651a05060000002b22108230e77dc4ad7272dd023b3c9a11fe282800].
2018-03-16 11:30:03,573 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] MqCoapResource - Node 00-00-00-00-00-00-00-01 sent 1 messages starting with sequence number 17.
2018-03-16 11:30:03,573 DEBUG [dtls-pool-2] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Sending to queue com.connode.service.terminal.mq.MessagesFromNode message of type class com.connode.service.terminal.mq.MessagesFromNode.
2018-03-16 11:30:03,578 TRACE [dtls] DTLSConnection - DTLS packet 37bfa3d4 added to queue, address=/fd51:3c22:ee1f:0:200:0:0:1:5684, sessionId=SessionId(d53278cdf99b7beb878f976675847bae5c6d54eea6d891fe2ea1f74d3a0d2f37), migrating=false
2018-03-16 11:30:03,610 DEBUG [dtls-pool-2] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Successfuly delivered to queue com.connode.service.terminal.mq.MessagesFromNode message MessagesFromNode{dbNodeId=1, scheduledPush=false, startSequenceNumber=17, messages=[MessageWithPayloads{message=Message{resetCounter=0, sequenceNumber=17, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, payloads=[DataProfileSamplePayload{deviceId='NA', profile=[0, 0, 99, 98, 2, -1], profileHash=[-126, 48, -25, 125, -60, -83, 114, 114, -35, 2, 59, 60, -102, 17, -2, 40], sampleTime=Thu Jan 01 01:00:00 GMT 1970, message=Message{resetCounter=0, sequenceNumber=17, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, createTime=null}]}]}
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER sendResponseMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, 2.01 Created, ACKNOWLEDGEMENT, 3312) for request (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3312)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER sendMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, 2.01 Created, ACKNOWLEDGEMENT, 3312)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT sendResponseMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, 2.01 Created, ACKNOWLEDGEMENT, 3312) for request (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3312)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT handleConfirmableRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3312)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT receiveRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3312)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] DTLSConnection - DTLS packet 37bfa3d4 being processed, address=/fd51:3c22:ee1f:0:200:0:0:1:5684, sessionId=SessionId(d53278cdf99b7beb878f976675847bae5c6d54eea6d891fe2ea1f74d3a0d2f37), migrating=false
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER receiveRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3313)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER handleConfirmableRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3313)
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] IncomingCoapExchange - Received request POST /mq from peer /fd51:3c22:ee1f:0:200:0:0:1:5684 with payload [0812124408bbd5aed505723c0a024e4112060000636202ff1a0e090c07e20310ff0b2200ff014a001a031200661a05060000002c22108230e77dc4ad7272dd023b3c9a11fe282800].
2018-03-16 11:30:03,611 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] MqCoapResource - Node 00-00-00-00-00-00-00-01 sent 1 messages starting with sequence number 18.
2018-03-16 11:30:03,611 DEBUG [dtls-pool-2] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Sending to queue com.connode.service.terminal.mq.MessagesFromNode message of type class com.connode.service.terminal.mq.MessagesFromNode.
2018-03-16 11:30:03,621 DEBUG [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Received payload MessagesFromNode{dbNodeId=1, scheduledPush=false, startSequenceNumber=17, messages=[MessageWithPayloads{message=Message{resetCounter=0, sequenceNumber=17, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, payloads=[DataProfileSamplePayload{deviceId='NA', profile=[0, 0, 99, 98, 2, -1], profileHash=[-126, 48, -25, 125, -60, -83, 114, 114, -35, 2, 59, 60, -102, 17, -2, 40], sampleTime=Thu Jan 01 01:00:00 GMT 1970, message=Message{resetCounter=0, sequenceNumber=17, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, createTime=null}]}]} from ActiveMQ queue com.connode.service.terminal.mq.MessagesFromNode
2018-03-16 11:30:03,625 DEBUG [dtls-pool-2] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Successfuly delivered to queue com.connode.service.terminal.mq.MessagesFromNode message MessagesFromNode{dbNodeId=1, scheduledPush=false, startSequenceNumber=18, messages=[MessageWithPayloads{message=Message{resetCounter=0, sequenceNumber=18, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, payloads=[DataProfileSamplePayload{deviceId='NA', profile=[0, 0, 99, 98, 2, -1], profileHash=[-126, 48, -25, 125, -60, -83, 114, 114, -35, 2, 59, 60, -102, 17, -2, 40], sampleTime=Thu Jan 01 01:00:00 GMT 1970, message=Message{resetCounter=0, sequenceNumber=18, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, createTime=null}]}]}
2018-03-16 11:30:03,625 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER sendResponseMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, 2.01 Created, ACKNOWLEDGEMENT, 3313) for request (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3313)
2018-03-16 11:30:03,625 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - ENTER sendMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, 2.01 Created, ACKNOWLEDGEMENT, 3313)
2018-03-16 11:30:03,626 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT sendResponseMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, 2.01 Created, ACKNOWLEDGEMENT, 3313) for request (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3313)
2018-03-16 11:30:03,626 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT handleConfirmableRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3313)
2018-03-16 11:30:03,626 TRACE [dtls-pool-2] [node=00-00-00-00-00-00-00-01] LocalCoapSession - EXIT receiveRequestMessage (/fd51:3c22:ee1f:0:200:0:0:1:5684, POST /mq, CONFIRMABLE, 3313)
2018-03-16 11:30:03,629 TRACE [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MqTracker - Ignoring message with sequence number 17, since it was already processed.
2018-03-16 11:30:03,629 WARN  [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] ApplicationServiceMessagePusher - No smart metering application server available
2018-03-16 11:30:03,629 WARN  [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] ApplicationServiceMessagePusher - No smart metering application server available
2018-03-16 11:30:03,629 TRACE [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MqTracker - Node 1 has MQ state MessageQueueState{node=00-00-00-00-00-00-00-01, resetCounter=0, startSequenceNumber=78009, lastReceivedSequenceNumber=81506, lastPullTime=null, pullInterval=null} after persisting 0 messages and 0 payloads.
2018-03-16 11:30:03,632 DEBUG [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Consumer accepted the message, acknowledging it for ActiveMQ
2018-03-16 11:30:03,651 DEBUG [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Received payload MessagesFromNode{dbNodeId=1, scheduledPush=false, startSequenceNumber=18, messages=[MessageWithPayloads{message=Message{resetCounter=0, sequenceNumber=18, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, payloads=[DataProfileSamplePayload{deviceId='NA', profile=[0, 0, 99, 98, 2, -1], profileHash=[-126, 48, -25, 125, -60, -83, 114, 114, -35, 2, 59, 60, -102, 17, -2, 40], sampleTime=Thu Jan 01 01:00:00 GMT 1970, message=Message{resetCounter=0, sequenceNumber=18, status=PUSH, timestamp=Fri Mar 16 11:30:03 GMT 2018, timestampUnreliable=false}, createTime=null}]}]} from ActiveMQ queue com.connode.service.terminal.mq.MessagesFromNode
2018-03-16 11:30:03,656 TRACE [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MqTracker - Ignoring message with sequence number 18, since it was already processed.
2018-03-16 11:30:03,656 WARN  [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] ApplicationServiceMessagePusher - No smart metering application server available
2018-03-16 11:30:03,656 WARN  [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] ApplicationServiceMessagePusher - No smart metering application server available
2018-03-16 11:30:03,656 TRACE [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MqTracker - Node 1 has MQ state MessageQueueState{node=00-00-00-00-00-00-00-01, resetCounter=0, startSequenceNumber=78009, lastReceivedSequenceNumber=81506, lastPullTime=null, pullInterval=null} after persisting 0 messages and 0 payloads.
2018-03-16 11:30:03,660 DEBUG [ActiveMQ Session Task-29] [node=00-00-00-00-00-00-00-01] MessageQueuePersister - Consumer accepted the message, acknowledging it for ActiveMQ
2018-03-16 11:30:05,976 TRACE [mq-gap-filler] MqTracker - ENTER checkOutNodeState
2018-03-16 11:30:05,977 TRACE [mq-gap-filler] MqTracker - EXIT checkOutNodeState dbNodeId=null



100,000 meters.
100 msgs per day

1 year = 365 * 100 = 36500/8 = 4.5KB per year per meter

after 1 year, 456MB on the one server....



---------------------------------------------


CND-7801: Scheduled event log collection

Add event log OBISs to the Genus-variant profile table.
This enables access to the logs via the existing profile-read mechanisms.

Change-Id: I4e74020ea5451e4d5a4fe0cac3ab8a47ec20ca35



------------------------------------------


util/nanopb/tariff_tou.proto
util/nanopb/meter_data.proto
util/nanopb/meter_cmd.proto
util/nanopb/meter.proto
util/nanopb/load_survey.proto
util/nanopb/load_curtailment.proto
util/nanopb/event_severity.proto
util/nanopb/event.proto
util/nanopb/configrun.proto
util/nanopb/config.proto
stack_extra_info.py
metercomms/metercomms.h
metercomms/metercomms.c
metercomms/meter_command_start.c
metercomms/meter_command_protocol.c
dcuunittest/dcutestutils/otxu.py
dcuunittest/dcutestutils/network_sim.py
dcuunittest/dcu_callbacks/metercomms/metercomms.c
dcuapptest/otxu_tests/test_otxu_operation.py
dcuapptest/meter_command_tests/meter_command_test.py
Makefile

cygh/Stubs.py
build.sh
Output/Makefile
EmbeddedPython.c
ChildBuild.sh



-----------------

Working:
./build/host-genus-insecure/bin/agent   -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/ttyUSB0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D \
                                        -param device.dlms.hls_key=756776636c686c737567313836616263 \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263 \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263 \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket







Profile 0-0:99.98.1*255 (in dlmsParseProfileValue): Bad struct                      x
Profile 0-0:99.98.1*255: Discovery failed at step 2                                 x
Profile discovery for 0-0:99.98.2*255 PowerEventLog: step 1                         x
Get 0-0:99.98.2*255 ic 7 attr 3 normal access                                       x
tx: (1/2): 7ea0190341502efde6e600c001810007                                         x
tx: (2/2): 0000636202ff03003f597e                                                   x
rx: (1/6): 7ea050410334c0f1e6e700c402810100                                         x
rx: (2/6): 00000100820038010302041200080906                                         x
rx: (3/6): 0000010000ff0f021200000204120001                                         x
rx: (4/6): 09060000600b02ff0f02120000020412                                         x
rx: (5/6): 000109060000600f02ff0f0212000095                                         x
rx: (6/6): cd7e                                                                     x
Profile 0-0:99.98.2*255: Extracting 3 objects                                       xr
Profile 0-0:99.98.2*255: 1/3: 0-0:1.0.0*255 ic 8 attr 2                             x
Profile 0-0:99.98.2*255: 2/3: 0-0:96.11.2*255 ic 1 attr 2                           x
Profile 0-0:99.98.2*255: 3/3: 0-0:96.15.2*255 ic 1 attr 2                           x
Profile discovery for 0-0:99.98.2*255 PowerEventLog: step 2                         x
Selective read: by range                                                            x
Selective read: by range - the latest entry                                         x
Get 0-0:99.98.2*255 ic 7 attr 2 by range:                                           x
Profile PowerEventLog: From time: 2018-03-23 17:36:15                               x
Profile PowerEventLog: To time: 2018-03-23 17:50:55                                 x
tx: (1/5): 7ea04c0341727f44e6e600c001810007                                         x
tx: (2/5): 0000636202ff02010102040204120008                                         x
tx: (3/5): 09060000010000ff0f02120000090c07                                         x
tx: (4/5): e20317ff11240fffffc400090c07e203                                         x
tx: (5/5): 17ff113237ffffc40001004bae7e                                             x
rx: (1/2): 7ea01c4103565730e6e700c402810100                                         x
rx: (2/2): 00000100820004018200004e3d7e                                             x
Bad struct: Too short: 0 B                                                          x
Profile 0-0:99.98.2*255 (in dlmsParseProfileValue): Bad struct                      x
Profile 0-0:99.98.2*255: Discovery failed at step 2                                 x
Profile discovery for 0-0:99.98.3*255 TransactionEventLog: step 1                   x
Get 0-0:99.98.3*255 ic 7 attr 3 normal access                                       x
0: transmit DIO to ff02::1a (rank=128, version=240)                                 x
ICMPv6 multicast to ff02::1a, RPL control message (DIO), 80 B                       x
Send IP on lowpan, 84 B, type 58, ttl 32: fe80::200:0:0:1 -> ff02::1a               x
Tx 113 B at 20 dBm as #114 to fd-ff-ff-ff-ff-ff-ff-ff: Failed: Radio error          x


-----------------------------------------------------------

Refactoring notes for device-dlms:

Device-dlms: (currently ~4500 line file):

Functionality:
- Module/device lifecycle management (deviceStart, stop, etc)
- Association support.
- Authentication support (pluggable? mixed issue with dlms.c)
- Session support (e.g. setup&releaseHdlcConnection)
- In-RAM profile structure support (alloc,free,access,find,etc)
- Simple/single-record profile support
- Complex/multi-record profile support.
- Psuedo-profile support (instantaneous & name-plate).
- Scheduled profile reading.
- immediate reads support
- Alarm support.
- Selective-access support.
- IS15159-specific 'features' such as 7xevent-logs.
- On-demand profile
- On-demand register
- Discovery state-machine.
- Meter-time support, read/write/sync.
- driver/WAN facing message-handlers & pb encoding.
- meter-facing message handlers.
- Disconnector.
- Hash management.

Issues:
- Speed of discovery
- Discovery requires data in profile to complete successfully.
- Confusing naming issues (e.g. saveDpTs, processOnDemandProfileSamplesProcess, loadFrameCounter-look at what it does).
- global state.
- memory usage? *lots* of allocating/freeing. Worst-case analysis? fragmentation? failure-modes?
- Variant mechanism needs to take into account a customer variant of the same meter type.
- unit tests?
- Add support utilities for iterating over the profile list & profile->object list?
- Should be a more-defined/more-obvious lifecycle for each request/response chain.
- Lots of boilerplate code for processing responses.


dlms.c split possibilities (Currently ~4500 line file):
- Module lifecycle.
- HDLC facing handlers.
- Association and session and generic error support.
- Crypto support (multiple, pluggable?)
- Data notification.
- DLMS "stack" (i.e. core protocol handling, req/rsp handling).
- A-XDR encoder/decoder.
- Multi-block management.
- Date/time utilities.
- Profile parsing and utilities (unclear split of responsibilities between dlms/device-dlms).
- Hash computation.
- capture period utilities.
- Type parser (array,struct,scalers).
- FrameCounter, we have read/write/load. Load perform a read and write (misnamed). Possible race
condition with setting counterToWrite and reading from it (message received while writing, since
its performed on a schedule, possibly...).

Issues:
- Need to be a separate task? combine with HDLC and save stack space and complexity.
- If DLMS frame-counter fails to restore correctly, it is set to zero (FIXME).
- Framecounter being persisted to FLASH every message, lots of FLASH activity?
- Framecounter needs wraparound situation considered.
- unit tests?
- Add support utilities for iterating over DLMS array & struct?


Overall:
- Need for more of a proper stack layering, i.e app-level generic DLMS objects such as capture-period
and profile-generic utilities/methods separated from the lower-levels.
- separation need from core protocol behaviour (session mgmt, req/resp/error mgmt) and messgae encoding and
decoding (i.e. A-XDR stream-oriented methods).
- Control path through the code needs to be more obvious.
- State machine(s) need more structure.
- Too much global state.

Larger issues:
- Make more use of the queue and less use of large state machines, e.g. break up the discovery state machine to
individual parts that can be queued.
- retrieve data from the meter, not from FLASH, don't use the mq.
- make the mq a priority q.
- Remove state 0 (time read) of disco state machine and queue a time read instead.


----------------------------------------------------------------------


break condition:

steve@blackbox1:~$ stty -a -F /dev/ttyUSB0
speed 57600 baud; rows 0; columns 0; line = 0;
intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = <undef>;
eol2 = <undef>; swtch = <undef>; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R;
werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0;
-parenb -parodd -cmspar cs8 hupcl -cstopb cread clocal -crtscts
-ignbrk -brkint -ignpar parmrk -inpck -istrip -inlcr -igncr -icrnl ixon -ixoff
-iuclc -ixany -imaxbel -iutf8
-opost -olcuc -ocrnl -onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0
-isig -icanon -iexten -echo -echoe -echok -echonl -noflsh -xcase -tostop -echoprt
-echoctl -echoke -flusho -extproc


break -> 0xff 0x00 0x00 (iff parmrk is set).
break -> 0x00 (iff parmrk is *not* set).

stty -F /dev/serial/by-id/usb-FTDI_TTL232R-3V3_FT9SI5ZW-if00-port0 -parenb -parodd -cmspar cs8 hupcl -cstopb cread clocal -crtscts -ignbrk -brkint -ignpar parmrk -inpck -istrip -inlcr -igncr -icrnl ixon -ixoff -iuclc -ixany -imaxbel -iutf8 -isig -icanon -iexten -echo -echoe -echok -echonl -noflsh -xcase -tostop -echoprt


------------------------------------------------------


cable_has_connection_attempt
CABLE_rx_connection_request()

b command_link.c:236

command_link_current_state = SEND_HELLO_INDICATION

b COMMAND_LINK_tx_put

WAIT_HELLO_RESPONSE

cygh_uart_txchar_blocking

b command_link.c:361

FS_storage_read_fileheader returns FS_CORRUPT_FILE_HEADER while popping hello message for tx and
assert fails, causing byte out of diag port.

stream_output_pb_encode fails in stream_nanopb.c:37
b stream_nanopb.c:37 func=pb_enc_varint


b command_link.c:361
assert fails.... FS_FIFO_peek fails with FS_CORRUPT_FILE_HEADER
b fs.c:145

if (!UUID_equals(expected_fs_uuid, &fs_uuid)) fails.... fs isnt formatted, maybe use or create
a fs image.

dcu is unlicensed. licensing_state == LICENSING_STATE_UNLICENSED.

command_link.c:268: COMMAND_LINK_tx_put(&msg); not outputing hello.
COMMAND_LINK_tx_put() works ok.

command_link.c:357
FS_FIFO_pop() fails. rerr==FS_CORRUPT_FILE_HEADER

in state FS_OPEN_FILE_STATE_START_OFFSETo

FS_file_header_unpack fails because UUID_equals(expected_fs_uuid, &fs_uuid) fails.
fs.c:145

COMMAND_LINK_init calls FS_FIFO_new_sdram() for command_link_rx_fifo and command_link_tx_fifo.

file that fials is:
FS_FIFO_pop(&command_link_tx_fifo, &command_link_tx_read_file)


this reads zeros:
cygh_sdram_read (offset=2732544, buf=0x6786a0 <fs_gpt_work_block>, size=512) at ../cygh/Stubs.c:1119
cygh_sdram_write
b cygh_sdram_read if offset == 2732544
b cygh_sdram_write if offset == 2732544



--------------------------------------------------------

get node out of production mode:

./tools/c4-tools/coap_request.py --config prod.lowpan.eui64 00-1b-c5-0c-60-00-bc-21
./tools/c4-tools/coap_request.py --config prod.prodtime 1
./tools/c4-tools/coap_request.py --load-key client-key node.key.der
./tools/c4-tools/coap_request.py --load-key client-cert node.crt.der
./tools/c4-tools/coap_request.py --load-key root-cert ca.crt.der
./tools/c4-tools/coap_request.py --rll-key mac.key
--------------------------------------------------------


From DCU:

c2022f0a120a100e1dd35389e344879b3aecd3fb786d6c100118022001280435ff7f00003d0000000042004a005d01000000

echo -n "c2022f0a120a100e1dd35389e344879b3aecd3fb786d6c100118022001280435ff7f00003d0000000042004a005d01000000" | xxd -r -p | protoc --decode_raw
40 {
  1 {
    1: "\016\035\323S\211\343D\207\233:\354\323\373xml"
  }
  2: 1
  3: 2
  4: 1
  5: 4
  6: 0x00007fff
  7: 0x00000000
  8: ""
  9: ""
  11: 0x00000001
}

23c2022f0a120a100e1dd35389e344879b3aecd3fb786d6c100118022001280435ff7f

COBS encoded output:
23 C2 02 2F 0A 12 0A 10 0E 1D D3 53 89 E3 44 87 9B 3A EC D3 FB 78 6D 6C 10 01 18 02 20 01 28 04 35 FF 7F 01 02 3D 01 01 01 02 42 02 4A 03 5D 01 01 01 01 01 01 00
   c2 02 2f 0a 12 0a 10 0e 1d d3 53 89 e3 44 87 9b 3a ec d3 fb 78 6d 6c 10 01 18 02 20 01 28 04 35 ff 7f 00 00 3d 00 00 00 00 42 00 4a 00 5d 01 00 00 00
xx                                                                                                       xx xx    xx xx xx xx    xx    xx       xx xx xx xx xx xx


------------------------------------------------



Ok, we've seen a few problems that taken together may be pointing towards the SMA not updating its meter/node info when upgraded:
- We have seen an instance of an agent being upgraded yet the new firmware version not being seen on the UI.
- Event profiles that should not have been discovered (since the agent fails to discover profiles that are empty) appeared after an upgrade.
- After an upgrade from an agent that did not support on-demand profiles to one that does, we have seen that the "on-demand" flags were not visible.

I briefly chatted to Bojan about it and he mentioned that the SMA has a discovery re-trigger mechanism that works in two cases:
- The global hash changes (which should pick up f/w version changes).
- The SMA receives data for a profile that it did not previously have registered for the meter.

The logs I've got do not seem conclusive to me but I can imagine that if the SMA isn't rediscovering a meter after a hash change then that
mechanism could cause the above effects.

Any thoughts? From the node logs, I can see that the discovery process works fine and certainly in the case of the version being incorrect then
the agent has no mechanism for reporting an old version so its unlikely to be an agent-side problem in that case.



./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -listen 4242 -loglevel debug

./build/host-genus-insecure/bin/agent   -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket



-----------------------------

1: "859def03282f6117dff596579b2bd873"
2 {
  1 {
    10: 0x30205453
    6: 48
    6: 48
    6: 53
  }
  2: "GENUS POWER INFRASTRUCTURES LTD"
  3: "Three phase a.c. static direct connected watt-hour smart"
  4: "GF6B7.325030"
  5: 1
  5: 2
  5: 3
  5: 4
  5: 5
  5: 6
  5: 7
  6: "genus_dlms"
}


---------------------------------------------------------


curl -s -X POST -H 'Content-Type: application/json' 'http://localhost:8880/ws/meterAlarms' --data '{"meterId":"UST 0000006",  "startId": "1", "count": "10"}' | python -m json.tool

curl -s -X POST -H 'Content-Type: application/json' 'http://localhost:8880/ws/meterAlarms' --data '{"meterId":"UST 0000006",  "startId": "600", "count": "1000"}' | python -m json.tool | grep alarmTime
-------------------------------------

docker run -v `pwd`:'/project'   -it omnimesh/buildenv_omnimesh  make pypb2 host-genus-insecure host-ctrlporthub ipa1-bl-insecure



------------------------------------------------

./build/host-genus-insecure/bin/agent   -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -rootcert ~/KeyTest/root.crt.der  \
                                        -cert ~/KeyTest/node.crt.der  \
                                        -key ~/KeyTest/node.key.der  \
                                        -mackey ~/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket



-------------------------------------

git show tags:

git show-ref --tags

10c3d49151a4402c0b4468e4c8823baab306d222 refs/tags/v106

tag v106
Tagger: Jonas Norling <jonas.norling@cyanconnode.com>
Date:   Tue Dec 12 12:18:42 2017 +0100

----------------------------------------------


grep "Node reg" /opt/sma/logs/sma.log  | cut -d' ' -f1,2

----------------------------------------------

$ sudo vim /etc/resolvconf/resolv.conf.d/base
Then put your nameserver list in like so:

nameserver 8.8.8.8
nameserver 8.8.4.4
Finally update resolvconf:

$ sudo resolvconf -u

Omnibox1:
sudo ip -6 add add fd19::1 dev eth0






------------------------------


cd buildenv_omnimesh
./build.sh
cd ../omnimesh
docker run -v `pwd`:'/project'   -it omnimesh/buildenv_omnimesh  ./cibuild.sh
cd ../buildenv_omnimesh
./build_omnimesh_server.sh ../omnimesh
./run_omnimesh_server


----------------------------------------------

Omnibox2:

When prompted for a password, use "steve" and "123456789"

NMS URL:
http://omnibox2/nms/dashboard

SMA URL:
http://omnibox2:8880

To run the agent, you may want three windows onto the Omniboxi as they all output text (that you may want to look at).
The commands to run are:
"sudo ./RunTun.sh"
"./RunCtrlPortHubForAgent.sh"
"./RunAgent.sh"

If you change the opto probe, you need to change the device name in RunAgent.sh
It currently is:
"/dev/serial/by-id/usb-FTDI_FT232R_USB_UART_A6023SX7-if00-port0"
Change it as appropriate.

to discover the opto-probe name, plug it in and do:
"ls /dev/serial/by-id/"


create a tarball of the new code, copy it to the omnibox with:
"scp LnT.tar steve@omnibox2:~/"

Log on to the OmniBox with:
"ssh steve@omnibox2"

Expand the tarball with:
"tar xvf LnT.tar"
"cd LnT"
"make host-lnt"

If you want to monitor the NMS:
"tail -f /usr/local/connode/logs/server.log"

If you want to monitor the SMA:
"tail -f /opt/sma/logs/sma.log"


----------------------------

IID: 02-1b-c5-0c-60-00-ea-11
G102032


2018-04-25 10:18:07,558 TRACE [http-63] ProxyController - method=GET, nodeId=00-1b-c5-0c-60-00-ea-11, coapUri=/sm/G102032/powerswitch
2018-04-25 10:18:07,559 TRACE [http-63] ProxyController - Node not found nodeId=00-1b-c5-0c-60-00-ea-11, coapUri=/sm/G102032/powerswitch
2018-04-25 10:18:07,559 TRACE [http-63] DeferredHttpCoapRequestContext - proxy response nodeId=00-1b-c5-0c-60-00-ea-11, coapUri=/sm/G102032/powerswitch, statusCode=502, payload=4e6f6465206e6f7420666f756e64


-------------------

sudo ./coap_request.py --server localhost:8080 --agent fd5f:fe8f:36c3:0:21b:c50c:6000:ea11 --config dtls.timeout.initial.s 55

--------------------------

Setting power control off:

lowpan.powercontrol 0

ssh tunnel to remote server then use tunnel to pass coap_request commands thru to meter.

ssh -f -L 9000:localhost:8080 stickle@omnireltest1.dev.cyanconnode.com sleep 172800
./tools/c4-tools/coap_request.py --server localhost:9000 --agent fd5f:fe8f:36c3:0:21b:c50c:6000:e9ef --config lowpan.powercontrol 0


------------------------------------------------

./sma-nms-service/src/main/java/com/cyanconnode/sma/service/mq/message/MessageServices.java
./sma-nms-service/src/test/java/com/cyanconnode/sma/service/mq/message/MessageServicesTest.java
./sma-common/src/main/java/com/cyanconnode/sma/common/sample/MeterSampleService.java
./sma-common/src/main/java/com/cyanconnode/sma/common/group/DeviceGroupService.java
./sma-common/src/main/java/com/cyanconnode/sma/common/profile/MeterProfileService.java
./sma-common/src/main/java/com/cyanconnode/sma/common/alarm/MeterAlarmService.java
./sma-common/src/test/java/com/cyanconnode/sma/common/group/DeviceGroupServiceTest.java
./sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/HttpCoapProxyService.java
./sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/DiscoveryServiceExecutor.java
./sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/ondemand/OnDemandProfileService.java
./sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/DeviceServices.java
./sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/DiscoveryService.java
./sma-nms-httpproxy/src/test/java/com/cyanconnode/sma/httpproxy/ServiceDiscoveryTest.java
./sma-nms-httpproxy/src/test/java/com/cyanconnode/sma/httpproxy/OnDemandMeterSampleServiceTest.java
./sma-nms-httpproxy/src/test/java/com/cyanconnode/sma/httpproxy/PowerSwitchServiceTest.java


sma-nms-service/src/main/java/com/cyanconnode/sma/service/mq/message/PostProcessingTask.java:3:public interface PostProcessingTask extends Runnable {
sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/DiscoveryServiceExecutor.java:24:        public Thread newThread(Runnable r) {
sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/tasks/DiscoveryTask.java:31:        public Thread newThread(Runnable r) {
sma-nms-httpproxy/src/main/java/com/cyanconnode/sma/httpproxy/DiscoveryService.java:27:public class DiscoveryService implements Runnable{


-----------------------------------------

Checking that hash changes as a result of features & capture list change.

2018-04-30 12:21:39.210 [debug] [        meter/dlms] {      device}: !!! Feature change
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}: Starting dlsmComputeHash:
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 29b15f641ebdd079343dddc7c021b5dc
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 8c65bbb524c9df3da9cd9c8cf2ee21ca
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 1a9f2139482b968346ae87c661725604
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 438426051854215b2bccf0aae20475ca
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 90ae0f00d33bfe7cf16bfab3f2bad140
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 57ef5547afc35524c643f854e43ea922
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 9e77e7990818c88823b0c76aba21e5cf
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 4d597ae3bfd4df1bec0d2e19049f81f9
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): bc2653c82345f196009f03c2f42dcc3a
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 0f7b43d0a0815a483311b5889ffad793
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- profilesHash: : (1/1): 62df13cd
2018-04-30 12:21:39.210 [debug] [        meter/dlms] {      device}: !!! Feature change
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}: Starting dlsmComputeHash:
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 1cc07dcea6f3ab84f53dcd4afac648b9
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 8c65bbb524c9df3da9cd9c8cf2ee21ca
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 1a9f2139482b968346ae87c661725604
2018-04-30 12:21:39.210 [debug] [              dlms] {      device}:  --- hash: : (1/1): 438426051854215b2bccf0aae20475ca
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 90ae0f00d33bfe7cf16bfab3f2bad140
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 57ef5547afc35524c643f854e43ea922
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 9e77e7990818c88823b0c76aba21e5cf
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 4d597ae3bfd4df1bec0d2e19049f81f9
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): bc2653c82345f196009f03c2f42dcc3a
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 0f7b43d0a0815a483311b5889ffad793
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- profilesHash: : (1/1): 37506577
2018-04-30 12:21:39.211 [debug] [        meter/dlms] {      device}: !!! objects change
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}: Starting dlsmComputeHash:
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 3f081f5de36c2388d80c3e096f90a417
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 8c65bbb524c9df3da9cd9c8cf2ee21ca
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 1a9f2139482b968346ae87c661725604
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 438426051854215b2bccf0aae20475ca
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 90ae0f00d33bfe7cf16bfab3f2bad140
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 57ef5547afc35524c643f854e43ea922
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 9e77e7990818c88823b0c76aba21e5cf
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 4d597ae3bfd4df1bec0d2e19049f81f9
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): bc2653c82345f196009f03c2f42dcc3a
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 0f7b43d0a0815a483311b5889ffad793
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- profilesHash: : (1/1): 09104aa7
2018-04-30 12:21:39.211 [debug] [        meter/dlms] {      device}: !!! original
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}: Starting dlsmComputeHash:
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 29b15f641ebdd079343dddc7c021b5dc
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 8c65bbb524c9df3da9cd9c8cf2ee21ca
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 1a9f2139482b968346ae87c661725604
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 438426051854215b2bccf0aae20475ca
2018-04-30 12:21:39.211 [debug] [              dlms] {      device}:  --- hash: : (1/1): 90ae0f00d33bfe7cf16bfab3f2bad140
2018-04-30 12:21:39.212 [debug] [              dlms] {      device}:  --- hash: : (1/1): 57ef5547afc35524c643f854e43ea922
2018-04-30 12:21:39.212 [debug] [              dlms] {      device}:  --- hash: : (1/1): 9e77e7990818c88823b0c76aba21e5cf
2018-04-30 12:21:39.212 [debug] [              dlms] {      device}:  --- hash: : (1/1): 4d597ae3bfd4df1bec0d2e19049f81f9
2018-04-30 12:21:39.212 [debug] [              dlms] {      device}:  --- hash: : (1/1): bc2653c82345f196009f03c2f42dcc3a
2018-04-30 12:21:39.212 [debug] [              dlms] {      device}:  --- hash: : (1/1): 0f7b43d0a0815a483311b5889ffad793
2018-04-30 12:21:39.212 [debug] [              dlms] {      device}:  --- profilesHash: : (1/1): 62df13cd
2018-04-30 12:21:39.212 [debug] [        meter/dlms] {      device}: deviceProfileHash is : (1/1): 62df13cdf8d9cfd9b953fee6d482cc3c


------------------------------------

Time set/update:

2018-04-30 13:49:00.841 [debug] [        meter/dlms] {      device}: ----> Forcing time set
2018-04-30 13:49:00.841 [ info] [        meter/dlms] {      device}: Setting time: 2018-04-30T13:49:00.000-01:00 0
2018-04-30 13:49:00.841 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 2 valueLen 14 B
2018-04-30 13:49:00.903 [debug] [              hdlc] {        hdlc}: tx: (1/3): 7ea027036154897ae6e600c101810008
2018-04-30 13:49:00.903 [debug] [              hdlc] {        hdlc}: tx: (2/3): 0000010000ff0200090c07e2041eff0d
2018-04-30 13:49:00.903 [debug] [              hdlc] {        hdlc}: tx: (3/3): 3100ffffc48019e87e
2018-04-30 13:49:01.065 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea01061037448a6e6e700c501810036
2018-04-30 13:49:01.065 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-04-30 13:49:01.065 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock
2018-04-30 13:49:01.065 [ info] [        meter/dlms] {      device}: Setting time offset: -60 minutes
2018-04-30 13:49:01.065 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 3 valueLen 3 B
2018-04-30 13:49:01.122 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361767ef4e6e600c101810008
2018-04-30 13:49:01.122 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff030010ffc426977e
2018-04-30 13:49:01.176 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103965462e6e700c501810036
2018-04-30 13:49:01.177 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e


2018-04-30 13:53:35.774 [debug] [        meter/dlms] {      device}: Either node or meter time is not known
2018-04-30 13:53:35.774 [debug] [        meter/dlms] {      device}: Clock drift is 3602 seconds
2018-04-30 13:53:35.774 [debug] [        meter/dlms] {      device}: ----> Forcing time set
2018-04-30 13:53:35.774 [ info] [        meter/dlms] {      device}: Setting time: 2018-04-30T14:53:35.000-01:00 0
2018-04-30 13:53:35.774 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 2 valueLen 14 B
2018-04-30 13:53:35.836 [debug] [              hdlc] {        hdlc}: tx: (1/3): 7ea027036154897ae6e600c101810008
2018-04-30 13:53:35.837 [debug] [              hdlc] {        hdlc}: tx: (2/3): 0000010000ff0200090c07e2041eff0e
2018-04-30 13:53:35.837 [debug] [              hdlc] {        hdlc}: tx: (3/3): 3523ffffc480862d7e
2018-04-30 13:53:35.996 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea01061037448a6e6e700c501810036
2018-04-30 13:53:35.996 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-04-30 13:53:35.996 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock
2018-04-30 13:53:35.996 [ info] [        meter/dlms] {      device}: Setting time offset: -60 minutes
2018-04-30 13:53:35.996 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 3 valueLen 3 B
2018-04-30 13:53:36.056 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361767ef4e6e600c101810008
2018-04-30 13:53:36.056 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff030010ffc426977e
2018-04-30 13:53:36.125 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103965462e6e700c501810036
2018-04-30 13:53:36.125 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e


2018-04-30 14:01:22.920 [debug] [        meter/dlms] {      device}: ----> Forcing time adjust
2018-04-30 14:01:22.920 [debug] [              dlms] {      device}: Action 0-0:1.0.0*255 ic 8 methodId 6 actionLen: 3 B
2018-04-30 14:01:22.976 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361546ef6e6e600c301810008
2018-04-30 14:01:22.976 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff060110fff669ab7e
2018-04-30 14:01:23.046 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea011610374f3bae6e700c701c10000
2018-04-30 14:01:23.046 [debug] [              hdlc] {        hdlc}: rx: (2/2): fcb47e
2018-04-30 14:01:23.046 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock
2018-04-30 14:01:23.047 [ info] [        meter/dlms] {      device}: Setting time offset: -60 minutes
2018-04-30 14:01:23.047 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 3 valueLen 3 B
2018-04-30 14:01:23.102 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361767ef4e6e600c101810008
2018-04-30 14:01:23.102 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff030010ffc426977e
2018-04-30 14:01:23.158 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103965462e6e700c501810036
2018-04-30 14:01:23.158 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-04-30 14:01:23.158 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock


2018-04-30 14:02:39.713 [debug] [        meter/dlms] {      device}: Clock drift is 3 seconds
2018-04-30 14:02:39.713 [debug] [        meter/dlms] {      device}: ----> Forcing time adjust
2018-04-30 14:02:39.713 [debug] [              dlms] {      device}: Action 0-0:1.0.0*255 ic 8 methodId 6 actionLen: 3 B
2018-04-30 14:02:39.770 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361546ef6e6e600c301810008
2018-04-30 14:02:39.770 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff060110005acf3b7e
2018-04-30 14:02:39.841 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea011610374f3bae6e700c701c10000
2018-04-30 14:02:39.841 [debug] [              hdlc] {        hdlc}: rx: (2/2): fcb47e
2018-04-30 14:02:39.841 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock
2018-04-30 14:02:39.841 [ info] [        meter/dlms] {      device}: Setting time offset: -60 minutes
2018-04-30 14:02:39.841 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 3 valueLen 3 B
2018-04-30 14:02:39.897 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361767ef4e6e600c101810008
2018-04-30 14:02:39.897 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff030010ffc426977e
2018-04-30 14:02:39.969 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103965462e6e700c501810036
2018-04-30 14:02:39.969 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-04-30 14:02:39.969 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock

2018-04-30 14:07:19.211 [debug] [        meter/dlms] {      device}: Either node or meter time is not known
2018-04-30 14:07:19.211 [debug] [        meter/dlms] {      device}: Clock drift is -57 seconds
2018-04-30 14:07:19.211 [debug] [        meter/dlms] {      device}: ----> Forcing time adjust
2018-04-30 14:07:19.211 [debug] [              dlms] {      device}: Action 0-0:1.0.0*255 ic 8 methodId 6 actionLen: 3 B
2018-04-30 14:07:19.269 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361546ef6e6e600c301810008
2018-04-30 14:07:19.269 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff060110ffa6ecf97e
2018-04-30 14:07:19.339 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea011610374f3bae6e700c701c10000
2018-04-30 14:07:19.339 [debug] [              hdlc] {        hdlc}: rx: (2/2): fcb47e
2018-04-30 14:07:19.339 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock
2018-04-30 14:07:19.339 [ info] [        meter/dlms] {      device}: Setting time offset: -60 minutes
2018-04-30 14:07:19.339 [debug] [              dlms] {      device}: Set 0-0:1.0.0*255 ic 8 attr 3 valueLen 3 B
2018-04-30 14:07:19.395 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01c0361767ef4e6e600c101810008
2018-04-30 14:07:19.395 [debug] [              hdlc] {        hdlc}: tx: (2/2): 0000010000ff030010ffc426977e
2018-04-30 14:07:19.452 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103965462e6e700c501810036
2018-04-30 14:07:19.452 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-04-30 14:07:19.452 [debug] [        meter/dlms] {      device}: ----> UpdateMeterClock
2018-04-30 14:07:19.503 [debug] [              dlms] {      device}: Disconnect HDLC link
2018-04-30 14:07:19.509 [debug] [              hdlc] {        hdlc}: tx: (1/1): 7ea00703615365817e
2018-04-30 14:07:19.530 [debug] [              hdlc] {        hdlc}: rx: (1/1): 7ea00761037377467e
2018-04-30 14:07:19.531 [debug] [              hdlc] {        hdlc}: HDLC link disconnected
2018-04-30 14:07:19.531 [debug] [        meter/dlms] {      device}: processAlarmsActivationRequest




------------------------
Omnibox wifi:


sudo iwlist wlan0 scanning | grep ESSID

nmcli dev

nmcli con

nmtui

nmcli dev wifi list

nmcli device status

wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf

sudo wpa_supplicant -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
dhclient wlan0

nmcli radio wifi on
nmcli device wifi scan
nmcli device wifi connect (your wifi name)


Cyanconnode-1__________
<Client>

<WPA & WPA2 Personal>
W6&v$8?6d!p3___________


CC-Guest:
welcometocyan

------------------------------------------

- power fail seen on interface board J2.

- 101
- 102
in 'power' event log.

Module Cover open:
- 209
- 210
in 'other' event log.

Meter Cover open:
- 251
- 252
in 'non-rollover' event log.


Can see event being generated, but no transition on Alert line.


To generate cover-open event:
- hold button down.
- reset tamper flags using tamper-generation-tool.
- read logs using DLMS-director.
- see 209 (meter-cover-replaced) but no 210 (tamper)
- Start LA recording.
- release button.
- stop recording.
- read logs using DLMS director.
- see 210 (tamper) generated.
- examine LA trace, no transition.


------------------------------------

Alarm status word, "Ch. 0 Identifiers for India":
0.0.94.91.18.255
00000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000
(84 and 86 set)





-----------------------------------------



./build/host-genus-insecure/bin/agent   -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket


----------------------------------------

7E A0 19 03 61 76 29 9A E6 E6 00 C0 01 C1 00 01 00 00 5E 5B 12 FF 02 00 E6 9D 7E
7E A0 24 61 03 96 4A 5C E6 E7 00 C4 01 C1 00   04 82   00 80 00 00 00 00 00 50 00 00 00 00 00 00 00 00 00 00   5A DB 7E
                                                             0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15

c4 01   81   00   04        82 00 80   00 00 00 00 00 50 00 00 00 00 00 00 00 00 00 00
GetResp invk pri  bitstring length     0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15


-----------------------------

ip -6 add add fd00::1 dev enp0s8




------------------------------------

Main CNDFS failures:
- CNDFS only has a rudimentary wear-levelling mechanism.
- CNDFS has no bad-block handling mechanism.
- The MQ on the Agent (primary user of CNDFS) does not have an integrity mechanism (e.g. CRC).
- Integrity currently handled at the application-level, e.g. ConfigFile is duplicated and can roll-back.
- We really don't need to be writing data to FLASH anyway.
- No way of allocating space deterministically from requirements.
- No halting of FLASH erasing/writing when power-fail is imminent.
- No real 'fsck' due to lack of integrity checking metadata.
- Processes that use the fs (i.e. DLMS profile data writer) cannot correctly handle the interruption of a failed write.


--------------------------------------

Pic1:
- All alerts cleared using tamper-tool.
- meter power cycled.
- pic shows trace during power up of the meter.
- no optical comms were present during this time.
- ALERT line shows two falling-edges, 1.4s apart.
- Default state of the ALERT line seems to be low (all alerts cleared at this point).

Pic2:
- Following on from Pic1 state.
- A single alert (Low voltage occurrence) is set using the tamper-tool.
- starting state of ALERT line is low.
-



----------------------------------------

set mac address randomisation via nmcli

nmcli connection show "cyanconnode-1"
nmcli connection modify "cyanconnode-1" 802-11-wireless.mac-address DC:44:6D:A4:DC:F7
nmcli connection modify "cyanconnode-1" 802-11-wireless.mac-address-randomization always

-------------------------------------------


monitorPFAIL called.
pin is raised
Power lost, waiting 0 s for power to come back
Initiating shutdown process, reason: 2
Found metadata #5 for /mq/000.mq: id=10 st=347 sz=1991 refs=0
Found metadata #5 for /mq/000.mq: id=10 st=347 sz=1991 refs=0
fsOpen (/mq/000.mq, mode=3, fd=0)
Committing 13 B at 1991 (filesize 1991)
flashopProgram 347:0x0 40 B
flashopProgram 347:0x7f9 13 B
Found metadata #5 for /mq/000.mq: id=10 st=347 sz=2004 refs=0
Wrote m# 91 of size 11 to file /mq/000.mq size 2004
Found metadata #3 for /device_config: id=12 st=900 sz=0 refs=0
Found metadata #3 for /device_config: id=12 st=900 sz=0 refs=0
flashopErase 900:0x0 4096 B
flashopProgram 162:0x0 40 B
Instantiated piece in sector 162
flashopProgram 162:0x28 14 B
flashopProgram 162:0x0 1 B
Created file /device_config
fsOpen (/device_config, mode=4, fd=0)
Shutting down
Maximum heap usage: 4164 B
Resetting




-------------------------------------

Blue book:
"The number and the order of the elements of the structure holding the entries is
the same as in the definition of the capture_objects"


------------------------------------


2018-05-16 14:21:51.671 #1   0011223344556677 <log> 0:32:03.532 [debug] [        osal] { schedule}: Task:  3  schedule p2  544/1400 0.586s
2018-05-16 14:21:51.671 #1   0011223344556677 <log> 0:32:03.541 [debug] [        osal] { schedule}: Task: 12      hdlc p2  608/1200 37.992s
2018-05-16 14:21:51.671 #1   0011223344556677 <log> 0:32:03.550 [debug] [        osal] { schedule}: Task:  2      IDLE p0  232/ 280 1867.612s
2018-05-16 14:21:51.671 #1   0011223344556677 <log> 0:32:03.559 [debug] [        osal] { schedule}: Task: 11  readings p2  856/1600 0.247s
2018-05-16 14:21:51.715 #1   0011223344556677 <log> 0:32:03.568 [debug] [        osal] { schedule}: Task: 15      cron p2  832/1200 0.013s
2018-05-16 14:21:51.715 #1   0011223344556677 <log> 0:32:03.577 [debug] [        osal] { schedule}: Task:  1  terminal p1  400/1600 3.245s
2018-05-16 14:21:51.715 #1   0011223344556677 <log> 0:32:03.586 [debug] [        osal] { schedule}: Task: 10       rpl p3  712/1600 0.121s
2018-05-16 14:21:51.715 #1   0011223344556677 <log> 0:32:03.594 [debug] [        osal] { schedule}: Task: 14    device p2  848/1700 6.858s
2018-05-16 14:21:51.715 #1   0011223344556677 <log> 0:32:03.603 [debug] [        osal] { schedule}: Task:  6     radio p5  408/ 800 0.229s
2018-05-16 14:21:51.759 #1   0011223344556677 <log> 0:32:03.612 [debug] [        osal] { schedule}: Task:  4  ctrlport p3 1320/1600 0.000s
2018-05-16 14:21:51.759 #1   0011223344556677 <log> 0:32:03.621 [debug] [        osal] { schedule}: Task:  9      dtls p2  784/1700 0.611s
2018-05-16 14:21:51.759 #1   0011223344556677 <log> 0:32:03.630 [debug] [        osal] { schedule}: Task: 16    filedl p2 1312/1600 0.000s
2018-05-16 14:21:51.759 #1   0011223344556677 <log> 0:32:03.638 [debug] [        osal] { schedule}: Task: 17  dlmsPipe p2 1040/1200 0.000s
2018-05-16 14:21:51.759 #1   0011223344556677 <log> 0:32:03.647 [debug] [        osal] { schedule}: Task:  7 lowpan_tx p3  264/1000 0.027s
2018-05-16 14:21:51.802 #1   0011223344556677 <log> 0:32:03.656 [debug] [        osal] { schedule}: Task: 13      dlms p2  528/1200 5.981s
2018-05-16 14:21:51.802 #1   0011223344556677 <log> 0:32:03.665 [debug] [        osal] { schedule}: Task:  5    mac_rx p4 1168/1400 0.000s
2018-05-16 14:21:51.802 #1   0011223344556677 <log> 0:32:03.674 [debug] [        osal] { schedule}: Task:  8      coap p3 1776/2048 0.000s
2018-05-16 14:21:51.802 #1   0011223344556677 <log> 0:32:03.682 [debug] [      status] { schedule}: CPU load: 3%
2018-05-16 14:21:51.802 #1   0011223344556677 <log> 0:32:03.689 [debug] [      status] { schedule}: Heap usage: 2719 (max 4164)
2018-05-16 14:21:51.845 #1   0011223344556677 <log> 0:32:03.697 [debug] [      status] { schedule}: Schedule statistics: scheduled: 9, max: 10, tot: 615
2018-05-16 14:21:51.845 #1   0011223344556677 <log> 0:32:03.707 [ info] [    rpl/task] {      rpl}: RPL Status: soliciting, instance 0
2018-05-16 14:21:51.845 #1   0011223344556677 <log> 0:32:03.715 [ info] [    rpl/data] {      rpl}: Number of dags: 0
2018-05-16 14:21:51.845 #1   0011223344556677 <log> 0:32:03.722 [ info] [    rpl/data] {      rpl}: Neighbors: 0, local: 0. Parents: 0, preferred: 0
2018-05-16 14:21:51.845 #1   0011223344556677 <log> 0:32:03.731 [debug] [rpl/routelist] {      rpl}: RPL route list: 0 entries using 0 B (0 B/entry)
2018-05-16 14:21:51.899 #1   0011223344556677 <log> 0:32:03.741 [debug] [        hdlc] {     hdlc}: tx: (1/1): 7ea00703415356a27e
2018-05-16 14:21:51.899 #1   0011223344556677 <log> 0:32:03.749 [debug] [        hdlc] {     hdlc}: rx: (1/1): 7ea0074103734c457e
2018-05-16 14:21:51.899 #1   0011223344556677 <log> 0:32:03.757 [debug] [        hdlc] {     hdlc}: HDLC link disconnected
2018-05-16 14:21:51.899 #1   0011223344556677 <log> 0:32:03.764 [debug] [        dlms] {   device}: Disconnect HDLC link
2018-05-16 14:21:51.899 #1   0011223344556677 <log> 0:32:03.771 [debug] [  meter/dlms] {   device}: Setup AA using LLS without ciphering
2018-05-16 14:21:51.899 #1   0011223344556677 <log> 0:32:03.780 [debug] [        dlms] {   device}: Setup AA with LLS
2018-05-16 14:21:51.956 #1   0011223344556677 <log> 0:32:03.836 [ERROR] [        dlms] {   device}: Previous send request is not yet processed
2018-05-16 14:21:54.574 #1   0011223344556677 <log> 0:32:06.454 [debug] [        cron] {     cron}: Time is not in sync, sleep for one minute
--> gap in node11.log <--
2018-05-16 14:22:13.912 #1   0011223344556677 <log> 0:32:25.771 [ERROR] [        dlms] {     dlms}: Timeout from HDLC module, hdlc tmo
2018-05-16 14:22:13.912 #1   0011223344556677 <log> 0:32:25.779 [ WARN] [  meter/dlms] {   device}: Response timeout
2018-05-16 14:22:13.912 #1   0011223344556677 <log> 0:32:25.786 [debug] [  meter/dlms] {   device}: Setup AA using LLS without ciphering
2018-05-16 14:22:13.912 #1   0011223344556677 <log> 0:32:25.794 [debug] [        dlms] {   device}: Setup AA with LLS
2018-05-16 14:22:13.971 #1   0011223344556677 <log> 0:32:25.851 [debug] [        hdlc] {     hdlc}: Connect HDLC link
2018-05-16 14:22:14.027 #1   0011223344556677 <log> 0:32:25.890 [debug] [        hdlc] {     hdlc}: tx: (1/3): 7ea02003419328bc8180140502010006
2018-05-16 14:22:14.027 #1   0011223344556677 <log> 0:32:25.899 [debug] [        hdlc] {     hdlc}: tx: (2/3): 02010007040000000108040000000169
2018-05-16 14:22:14.027 #1   0011223344556677 <log> 0:32:25.909 [debug] [        hdlc] {     hdlc}: tx: (3/3): 6d7e



----------------------

node12.log:

11172851 2018-05-21  9:27:27.425 #1   001bc50c6000e9ef <log> 0:00:34.012 [debug] [        hdlc] {     hdlc}: tx: (1/2): 7ea0190341723effe6e600c001810007
11172852 2018-05-21  9:27:27.425 #1   001bc50c6000e9ef <log> 0:00:34.021 [debug] [        hdlc] {     hdlc}: tx: (2/2): 01005e5b07ff0200b5d87e
11172853 2018-05-21  9:27:27.521 #1   001bc50c6000e9ef <log> 0:00:34.096 [debug] [      mac_tx] {lowpan_tx}: Tx 84 B at 17 dBm as #139 to 02-1b-c5-0c-60-01-73-c0: Failed: No ack after 4 tries
11172854 2018-05-21  9:27:27.521 #1   001bc50c6000e9ef <log> 0:00:34.108 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-01-73-c0: ack: 0, nack: 4, roundtrip: 0 ms, etx: 383/128
11172855 2018-05-21  9:27:27.521 #1   001bc50c6000e9ef <log> 0:00:34.121 [debug] [   lowpan_tx] {lowpan_tx}: Failed to send fragment 1, dropping frame
11172856 2018-05-21  9:27:27.521 #1   001bc50c6000e9ef <log> 0:00:34.130 [debug] [        hdlc] {     hdlc}: rx: (1/6): 7ea05e410356961fe6e700c402810100
11172857 2018-05-21  9:27:27.564 #1   001bc50c6000e9ef <log> 0:00:34.139 [debug] [        hdlc] {     hdlc}: rx: (2/6): 000001008200460101020b02020f0016
11172858 2018-05-21  9:27:27.564 #1   001bc50c6000e9ef <log> 0:00:34.148 [debug] [        hdlc] {     hdlc}: rx: (3/6): 2102020f00162102020f00162102020f
11172859 2018-05-21  9:27:27.564 #1   001bc50c6000e9ef <log> 0:00:34.157 [debug] [        hdlc] {     hdlc}: rx: (4/6): 00162302020f00162302020f00162302
11172860 2018-05-21  9:27:27.564 #1   001bc50c6000e9ef <log> 0:00:34.166 [debug] [        hdlc] {     hdlc}: rx: (5/6): 020f0016ff02020f0016ff02020f0016
11172861 2018-05-21  9:27:27.608 #1   001bc50c6000e9ef <log> 0:00:34.175 [debug] [        hdlc] {     hdlc}: rx: (6/6): ff02020f00161e02020f00161efb707e
11172862 2018-05-21  9:27:27.608 #1   001bc50c6000e9ef <log> 0:00:34.186 [debug] [  meter/dlms] {   device}: Discovery of 0-0:99.98.0*255 done
11172863 2018-05-21  9:27:27.608 #1   001bc50c6000e9ef <log> 0:00:34.194 [debug] [  meter/dlms] {   device}: Profile discovery for 0-0:99.98.1*255 CurrentEventLog: step 1
11172864 2018-05-21  9:27:27.608 #1   001bc50c6000e9ef <log> 0:00:34.205 [debug] [        dlms] {   device}: Get 0-0:99.98.1*255 ic 7 attr 3 normal access
11172865 2018-05-21  9:27:27.708 #1   001bc50c6000e9ef <log> 0:00:34.294 [debug] [        hdlc] {     hdlc}: tx: (1/2): 7ea019034194067de6e600c001810007
11172866 2018-05-21  9:27:27.708 #1   001bc50c6000e9ef <log> 0:00:34.303 [debug] [        hdlc] {     hdlc}: tx: (2/2): 0000636201ff0300f27c7e
11172867 2018-05-21  9:27:28.006 #1   001bc50c6000e9ef <log> 0:00:34.579 [debug] [        hdlc] {     hdlc}: rx: (1/17): 7ea909410378b904e6e700c402810100
11172868 2018-05-21  9:27:28.006 #1   001bc50c6000e9ef <log> 0:00:34.589 [debug] [        hdlc] {     hdlc}: rx: (2/17): 00000100820110010f02041200080906
11172869 2018-05-21  9:27:28.006 #1   001bc50c6000e9ef <log> 0:00:34.598 [debug] [        hdlc] {     hdlc}: rx: (3/17): 0000010000ff0f021200000204120001
11172870 2018-05-21  9:27:28.006 #1   001bc50c6000e9ef <log> 0:00:34.607 [debug] [        hdlc] {     hdlc}: rx: (4/17): 09060000600b01ff0f02120000020412
11172871 2018-05-21  9:27:28.049 #1   001bc50c6000e9ef <log> 0:00:34.616 [debug] [        hdlc] {     hdlc}: rx: (5/17): 0003090601001f0700ff0f0212000002
11172872 2018-05-21  9:27:28.049 #1   001bc50c6000e9ef <log> 0:00:34.625 [debug] [        hdlc] {     hdlc}: rx: (6/17): 0412000309060100330700ff0f021200
11172873 2018-05-21  9:27:28.049 #1   001bc50c6000e9ef <log> 0:00:34.635 [debug] [        hdlc] {     hdlc}: rx: (7/17): 00020412000309060100470700ff0f02
11172874 2018-05-21  9:27:28.049 #1   001bc50c6000e9ef <log> 0:00:34.644 [debug] [        hdlc] {     hdlc}: rx: (8/17): 120000020412000309060100200700ff
11172875 2018-05-21  9:27:28.049 #1   001bc50c6000e9ef <log> 0:00:34.653 [debug] [        hdlc] {     hdlc}: rx: (9/17): 0f021200000204120003090601003407
11172876 2018-05-21  9:27:28.092 #1   001bc50c6000e9ef <log> 0:00:34.662 [debug] [        hdlc] {     hdlc}: rx: (10/17): 00ff0f02120000020412000309060100
11172877 2018-05-21  9:27:28.092 #1   001bc50c6000e9ef <log> 0:00:34.672 [debug] [        hdlc] {     hdlc}: rx: (11/17): 480700ff0f0212000002041200030906
11172878 2018-05-21  9:27:28.092 #1   001bc50c6000e9ef <log> 0:00:34.681 [debug] [        hdlc] {     hdlc}: rx: (12/17): 0100210700ff0f021200000204120003
11172879 2018-05-21  9:27:28.092 #1   001bc50c6000e9ef <log> 0:00:34.690 [debug] [        hdlc] {     hdlc}: rx: (13/17): 09060100350700ff0f02120000020412
11172880 2018-05-21  9:27:28.092 #1   001bc50c6000e9ef <log> 0:00:34.700 [debug] [        hdlc] {     hdlc}: rx: (14/17): 000309060100490700ff0f0212000002
11172881 2018-05-21  9:27:28.136 #1   001bc50c6000e9ef <log> 0:00:34.709 [debug] [        hdlc] {     hdlc}: rx: (15/17): 0412000309060100010800ff0f021200
11172882 2018-05-21  9:27:28.136 #1   001bc50c6000e9ef <log> 0:00:34.718 [debug] [        hdlc] {     hdlc}: rx: (16/17): 00020412000309060100020800ff0f02
11172883 2018-05-21  9:27:28.136 #1   001bc50c6000e9ef <log> 0:00:34.727 [debug] [        hdlc] {     hdlc}: rx: (17/17): 1200000204120001c2b77e
11172884 2018-05-21  9:27:28.136 #1   001bc50c6000e9ef <log> 0:00:34.736 [ WARN] [        hdlc] {     hdlc}: No HDLC flag
11172885 2018-05-21  9:27:28.136 #1   001bc50c6000e9ef <log> 0:00:34.742 [ WARN] [        dlms] {     dlms}: Broken HDLC: bad format
11172886 2018-05-21  9:27:28.190 #1   001bc50c6000e9ef <log> 0:00:34.750 [debug] [        dlms] {     dlms}: Retry: request is failed second time
11172887 2018-05-21  9:27:28.190 #1   001bc50c6000e9ef <log> 0:00:34.758 [ WARN] [  meter/dlms] {   device}: Broken response: check failed
11172888 2018-05-21  9:27:28.190 #1   001bc50c6000e9ef <log> 0:00:34.767 [ WARN] [  meter/dlms] {   device}: Profile 0-0:99.98.1*255: Discovery failed at step 1
11172889 2018-05-21  9:27:28.190 #1   001bc50c6000e9ef <log> 0:00:34.777 [debug] [  meter/dlms] {   device}: Profile discovery for 0-0:99.98.2*255 PowerEventLog: step 1
11172890 2018-05-21  9:27:28.190 #1   001bc50c6000e9ef <log> 0:00:34.787 [debug] [        dlms] {   device}: Get 0-0:99.98.2*255 ic 7 attr 3 normal access
11172891 2018-05-21  9:27:28.290 #1   001bc50c6000e9ef <log> 0:00:34.876 [debug] [        hdlc] {     hdlc}: tx: (1/2): 7ea019034196145ee6e600c001810007
11172892 2018-05-21  9:27:28.290 #1   001bc50c6000e9ef <log> 0:00:34.885 [debug] [        hdlc] {     hdlc}: tx: (2/2): 0000636202ff03003f597e





11162599 2018-05-21  9:18:48.178 #1   001bc50c6000e9ef <log> 0:00:31.218 [debug] [  meter/dlms] {   device}: Discovery of 1-0:98.1.0*255 done
11162600 2018-05-21  9:18:48.178 #1   001bc50c6000e9ef <log> 0:00:31.226 [debug] [  meter/dlms] {   device}: Profile discovery for 0-0:99.98.0*255 VoltageEventLog: step 1
11162601 2018-05-21  9:18:48.194 #1   001bc50c6000e9ef <log> 0:00:31.237 [debug] [        dlms] {   device}: Get 0-0:99.98.0*255 ic 7 attr 3 normal access
11162602 2018-05-21  9:18:48.291 #1   001bc50c6000e9ef <log> 0:00:31.326 [debug] [        hdlc] {     hdlc}: tx: (1/2): 7ea0190341b86896e6e600c001810007
11162603 2018-05-21  9:18:48.291 #1   001bc50c6000e9ef <log> 0:00:31.335 [debug] [        hdlc] {     hdlc}: tx: (2/2): 0000636200ff030049607e
11162604 2018-05-21  9:18:48.593 #1   001bc50c6000e9ef <log> 0:00:31.616 [debug] [        hdlc] {     hdlc}: rx: (1/17): 7ea9094103baa7e1e6e700c402810100
11162605 2018-05-21  9:18:48.593 #1   001bc50c6000e9ef <log> 0:00:31.625 [debug] [        hdlc] {     hdlc}: rx: (2/17): 00000100820110010f02041200080906
11162606 2018-05-21  9:18:48.593 #1   001bc50c6000e9ef <log> 0:00:31.634 [debug] [        hdlc] {     hdlc}: rx: (3/17): 0000010000ff0f021200000204120001
11162607 2018-05-21  9:18:48.593 #1   001bc50c6000e9ef <log> 0:00:31.644 [debug] [        hdlc] {     hdlc}: rx: (4/17): 09060000600b00ff0f02120000020412
11162608 2018-05-21  9:18:48.636 #1   001bc50c6000e9ef <log> 0:00:31.653 [debug] [        hdlc] {     hdlc}: rx: (5/17): 0003090601001f0700ff0f0212000002
11162609 2018-05-21  9:18:48.636 #1   001bc50c6000e9ef <log> 0:00:31.662 [debug] [        hdlc] {     hdlc}: rx: (6/17): 0412000309060100330700ff0f021200
11162610 2018-05-21  9:18:48.636 #1   001bc50c6000e9ef <log> 0:00:31.671 [debug] [        hdlc] {     hdlc}: rx: (7/17): 00020412000309060100470700ff0f02
11162611 2018-05-21  9:18:48.636 #1   001bc50c6000e9ef <log> 0:00:31.680 [debug] [        hdlc] {     hdlc}: rx: (8/17): 120000020412000309060100200700ff
11162612 2018-05-21  9:18:48.636 #1   001bc50c6000e9ef <log> 0:00:31.690 [debug] [        hdlc] {     hdlc}: rx: (9/17): 0f021200000204120003090601003407
11162613 2018-05-21  9:18:48.679 #1   001bc50c6000e9ef <log> 0:00:31.699 [debug] [        hdlc] {     hdlc}: rx: (10/17): 00ff0f02120000020412000309060100
11162614 2018-05-21  9:18:48.679 #1   001bc50c6000e9ef <log> 0:00:31.708 [debug] [        hdlc] {     hdlc}: rx: (11/17): 480700ff0f0212000002041200030906
11162615 2018-05-21  9:18:48.679 #1   001bc50c6000e9ef <log> 0:00:31.718 [debug] [        hdlc] {     hdlc}: rx: (12/17): 0100210700ff0f021200000204120003
11162616 2018-05-21  9:18:48.679 #1   001bc50c6000e9ef <log> 0:00:31.727 [debug] [        hdlc] {     hdlc}: rx: (13/17): 09060100350700ff0f02120000020412
11162617 2018-05-21  9:18:48.722 #1   001bc50c6000e9ef <log> 0:00:31.736 [debug] [        hdlc] {     hdlc}: rx: (14/17): 000309060100490700ff0f0212000002
11162618 2018-05-21  9:18:48.722 #1   001bc50c6000e9ef <log> 0:00:31.745 [debug] [        hdlc] {     hdlc}: rx: (15/17): 0412000309060100010800ff0f021200
11162619 2018-05-21  9:18:48.722 #1   001bc50c6000e9ef <log> 0:00:31.755 [debug] [        hdlc] {     hdlc}: rx: (16/17): 00020412000309060100020800ff0f02
11162620 2018-05-21  9:18:48.722 #1   001bc50c6000e9ef <log> 0:00:31.764 [debug] [        hdlc] {     hdlc}: rx: (17/17): 1200000204120001185a7e
11162621 2018-05-21  9:18:48.722 #1   001bc50c6000e9ef <log> 0:00:31.772 [ WARN] [        hdlc] {     hdlc}: No HDLC flag
11162622 2018-05-21  9:18:48.722 #1   001bc50c6000e9ef <log> 0:00:31.779 [ WARN] [        dlms] {     dlms}: Broken HDLC: bad format
11162623 2018-05-21  9:18:48.766 #1   001bc50c6000e9ef <log> 0:00:31.786 [debug] [        dlms] {     dlms}: Retry: request is failed second time
11162624 2018-05-21  9:18:48.766 #1   001bc50c6000e9ef <log> 0:00:31.795 [ WARN] [  meter/dlms] {   device}: Broken response: check failed


 6306062 2018-05-18 15:36:26.585 #1   001bc50c6000e9ef <log> 0:01:24.174 [debug] [    rpl/core] {      rpl}: 0: process DIO from fe80::21b:c50c:6000:d580 (fd5f:fe8f:36c3:0:21b:c50c:6000:fdcf) v=246 rank=256 rssi
 6306063 2018-05-18 15:36:26.611 #1   001bc50c6000e9ef <log> 0:01:24.189 [event] [    rpl/core] {      rpl}: Neighbor info: fd5f:fe8f:36c3:0:21b:c50c:6000:d580, rank=256, v=246, dtsn=240, eol=2097s, etx=230, s=p
 6306064 2018-05-18 15:36:28.248 #1   001bc50c6000e9ef <log> 0:01:25.817 [ WARN] [        hdlc] {     hdlc}: Timeout while connecting
 6306065 2018-05-18 15:36:28.248 #1   001bc50c6000e9ef <log> 0:01:25.824 [ WARN] [        dlms] {     dlms}: Failed to receive response, rsp tmo
 6306066 2018-05-18 15:36:28.248 #1   001bc50c6000e9ef <log> 0:01:25.833 [debug] [        dlms] {     dlms}: Retry: send failed request again
 6306067 2018-05-18 15:36:28.304 #1   001bc50c6000e9ef <log> 0:01:25.891 [debug] [        hdlc] {     hdlc}: Connect HDLC link
 6306068 2018-05-18 15:36:28.365 #1   001bc50c6000e9ef <log> 0:01:25.935 [debug] [        hdlc] {     hdlc}: tx: (1/3): 7ea02003419328bc8180140502010006
 6306069 2018-05-18 15:36:28.365 #1   001bc50c6000e9ef <log> 0:01:25.944 [debug] [        hdlc] {     hdlc}: tx: (2/3): 02010007040000000108040000000169
 6306070 2018-05-18 15:36:28.365 #1   001bc50c6000e9ef <log> 0:01:25.953 [debug] [        hdlc] {     hdlc}: tx: (3/3): 6d7e
 6306071 2018-05-18 15:36:31.048 #1   001bc50c6000e9ef <log> 0:01:28.611 [debug] [      mac_rx] {   mac_rx}: Received 113 B, broadcast #137 from 02-1b-c5-0c-60-00-ea-14: rssi -76 dBm, sec 5, payload 89 B
 6306072 2018-05-18 15:36:31.048 #1   001bc50c6000e9ef <log> 0:01:28.625 [debug] [        icmp] {   mac_rx}: ICMPv6 multicast from fe80::21b:c50c:6000:ea14, RPL control message (DIO), 80 B
 6306073 2018-05-18 15:36:31.048 #1   001bc50c6000e9ef <log> 0:01:28.637 [debug] [    rpl/core] {      rpl}: 0: process DIO from fe80::21b:c50c:6000:ea14 (fd5f:fe8f:36c3:0:21b:c50c:6000:fdcf) v=246 rank=384 rssi
 6306074 2018-05-18 15:36:31.074 #1   001bc50c6000e9ef <log> 0:01:28.652 [event] [    rpl/core] {      rpl}: Neighbor info: fd5f:fe8f:36c3:0:21b:c50c:6000:ea14, rank=384, v=246, dtsn=240, eol=2097s, etx=159, s=p
 6306075 2018-05-18 15:36:32.165 #1   001bc50c6000e9ef <log> 0:01:29.748 [panic] ======== Panic ========
 6306076 2018-05-18 15:36:32.165 #1   001bc50c6000e9ef <log> 0:01:29.748 [panic] dlms:741, in task device: ASSERT FAILED



11062564 2018-05-21  7:59:24.772 #1   001bc50c6000e9ef <log> 0:01:06.906 [debug] [        hdlc] {     hdlc}: tx: (1/3): 7ea02003419328bc8180140502010006
11062565 2018-05-21  7:59:24.772 #1   001bc50c6000e9ef <log> 0:01:06.915 [debug] [        hdlc] {     hdlc}: tx: (2/3): 02010007040000000108040000000169
11062566 2018-05-21  7:59:24.772 #1   001bc50c6000e9ef <log> 0:01:06.924 [debug] [        hdlc] {     hdlc}: tx: (3/3): 6d7e
11062567 2018-05-21  7:59:27.417 #1   001bc50c6000e9ef <log> 0:01:09.540 [debug] [    rpl/core] {      rpl}: Probing parent fe80::21b:c50c:6000:ea14 (global)
11062568 2018-05-21  7:59:27.417 #1   001bc50c6000e9ef <log> 0:01:09.549 [debug] [        icmp] {      rpl}: ICMPv6 unicast to fe80::21b:c50c:6000:ea14, Private (probe), 6 B
11062569 2018-05-21  7:59:27.417 #1   001bc50c6000e9ef <log> 0:01:09.561 [debug] [          ip] {      rpl}: Send IP on lowpan, 10 B, type 58, ttl 1: fe80::21b:c50c:6000:e9ef -> fe80::21b:c50c:6000:ea14
11062570 2018-05-21  7:59:27.454 #1   001bc50c6000e9ef <log> 0:01:09.587 [debug] [      mac_tx] {lowpan_tx}: Tx 43 B at 17 dBm as #60 to 02-1b-c5-0c-60-00-ea-14: Got ack after 1 try
11062571 2018-05-21  7:59:27.454 #1   001bc50c6000e9ef <log> 0:01:09.599 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-ea-14: ack: 1, nack: 0, roundtrip: 2 ms, etx: 128/128
11062572 2018-05-21  7:59:40.401 #1   001bc50c6000e9ef <log> 0:01:22.551 [debug] [     rpl/dao] {      rpl}: 0: DAO: lifetime expires in 1144s (defLifeTime=1200s)
11062573 2018-05-21  7:59:43.264 #1   001bc50c6000e9ef <log> 0:01:25.387 [debug] [    rpl/core] {      rpl}: 0: transmit DIO to ff02::1a (rank=434, version=246)
11062574 2018-05-21  7:59:43.264 #1   001bc50c6000e9ef <log> 0:01:25.397 [debug] [        icmp] {      rpl}: ICMPv6 multicast to ff02::1a, RPL control message (DIO), 80 B
11062575 2018-05-21  7:59:43.264 #1   001bc50c6000e9ef <log> 0:01:25.408 [debug] [          ip] {      rpl}: Send IP on lowpan, 84 B, type 58, ttl 32: fe80::21b:c50c:6000:e9ef -> ff02::1a
11062576 2018-05-21  7:59:43.298 #1   001bc50c6000e9ef <log> 0:01:25.443 [debug] [      mac_tx] {lowpan_tx}: Tx 113 B at 17 dBm as #61 to fd-ff-ff-ff-ff-ff-ff-ff: Sent without ack request
11062577 2018-05-21  7:59:43.406 #1   001bc50c6000e9ef <log> 0:01:25.539 [ info] [        dtls] {     dtls}: Session 1: Timeout (last tx 40 s ago, user triggered: no)
11062578 2018-05-21  7:59:43.406 #1   001bc50c6000e9ef <log> 0:01:25.550 [debug] [          ip] {     dtls}: Send IP on lowpan, 186 B, type 17, ttl 32: fd5f:fe8f:36c3:0:21b:c50c:6000:e9ef -> fd00::1
11062579 2018-05-21  7:59:43.920 #1   001bc50c6000e9ef <log> 0:01:26.043 [debug] [      mac_tx] {lowpan_tx}: Tx 242 B at 17 dBm as #62 to 02-1b-c5-0c-60-00-e9-f0: Failed: No ack after 4 tries
11062580 2018-05-21  7:59:43.920 #1   001bc50c6000e9ef <log> 0:01:26.055 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-e9-f0: ack: 0, nack: 4, roundtrip: 0 ms, etx: 255/128
11062581 2018-05-21  7:59:43.920 #1   001bc50c6000e9ef <log> 0:01:26.068 [debug] [   lowpan_tx] {lowpan_tx}: Failed to send fragment 1, dropping frame
11062582 2018-05-21  7:59:44.797 #1   001bc50c6000e9ef <log> 0:01:26.931 [ WARN] [        hdlc] {     hdlc}: Timeout while connecting
11062583 2018-05-21  7:59:44.797 #1   001bc50c6000e9ef <log> 0:01:26.938 [ WARN] [        dlms] {     dlms}: Failed to receive response, rsp tmo
11062584 2018-05-21  7:59:44.797 #1   001bc50c6000e9ef <log> 0:01:26.947 [debug] [        dlms] {     dlms}: Retry: send failed request again
11062585 2018-05-21  7:59:44.855 #1   001bc50c6000e9ef <log> 0:01:27.005 [debug] [        hdlc] {     hdlc}: Connect HDLC link
11062586 2018-05-21  7:59:44.916 #1   001bc50c6000e9ef <log> 0:01:27.049 [debug] [        hdlc] {     hdlc}: tx: (1/3): 7ea02003419328bc8180140502010006
11062587 2018-05-21  7:59:44.916 #1   001bc50c6000e9ef <log> 0:01:27.058 [debug] [        hdlc] {     hdlc}: tx: (2/3): 02010007040000000108040000000169
11062588 2018-05-21  7:59:44.916 #1   001bc50c6000e9ef <log> 0:01:27.067 [debug] [        hdlc] {     hdlc}: tx: (3/3): 6d7e
11062589 2018-05-21  7:59:48.717 #1   001bc50c6000e9ef <log> 0:01:30.862 [debug] [  meter/dlms] {   device}: Setup AA using LLS without ciphering
11062590 2018-05-21  7:59:48.717 #1   001bc50c6000e9ef <log> 0:01:30.870 [debug] [        dlms] {   device}: Setup AA with LLS
11062591 2018-05-21  7:59:48.788 #1   001bc50c6000e9ef <log> 0:01:30.927 [ WARN] [        hdlc] {   device}: Previous send request is not yet processed
11062592 2018-05-21  7:59:48.788 #1   001bc50c6000e9ef <log> 0:01:30.936 [ERROR] [        dlms] {   device}: Failed to send AA Request to HDLC
what happened here??
11062593 2018-05-21  8:00:09.958 #1   0000000000000000 <hub> 0:00:00.004 [ info] Expected message# 2344 but got 1, node restarted?
11062594 2018-05-21  8:00:09.958 #1   0000000000000000 <log> 0:00:00.004 [ info] [       cndfs] { terminal}: Mounting with 1024 x 4096 KiB sectors = 4096 KiB
11062595 2018-05-21  8:00:10.259 #1   0000000000000000 <log> 0:00:00.264 [ info] [       cndfs] { terminal}: Mounted: 214 sectors used, 24 files
11062596 2018-05-21  8:00:10.259 #1   0000000000000000 <log> 0:00:00.272 [ info] [       cndfs] { terminal}: Flash map:
11062597 2018-05-21  8:00:10.259 #1   0000000000000000 <log> 0:00:00.285 [ info] [       cndfs] { terminal}:   -------- -------- -------- -------- -------- -------- -------- --------
11062598 2018-05-21  8:00:10.259 #1   0000000000000000 <log> 0:00:00.303 [ info] [       cndfs] { terminal}:   -------- -------- -------- ------GG GGGGGGGG GGGGG-GG -2HHHHHH HHHH-H-H
11062599 2018-05-21  8:00:10.328 #1   0000000000000000 <log> 0:00:00.321 [ info] [       cndfs] { terminal}:   -H------ H-H-HH-- --:----: -:-:8--: -:------ ---:---- -------- --------
11062600 2018-05-21  8:00:10.328 #1   0000000000000000 <log> 0:00:00.339 [ info] [       cndfs] { terminal}:   -------- -------- -------- -:-:--:- :::-:--- -----:-- ------:- -------:
11062601 2018-05-21  8:00:10.328 #1   0000000000000000 <log> 0:00:00.357 [ info] [       cndfs] { terminal}:   -------- -------- @-@-@@@@ @@@@-@-- -----@@@ @@@-AA-- -------- --------
11062602 2018-05-21  8:00:10.328 #1   0000000000000000 <log> 0:00:00.375 [ info] [       cndfs] { terminal}:   ----34-- ----1--- -------- -------- -------- -A------ --A----- ---A---9
11062603 2018-05-21  8:00:10.390 #1   0000000000000000 <log> 0:00:00.394 [ info] [       cndfs] { terminal}:   ----A--- ------A? AAAAAAAA AA-BBBBB BBBBB-BB -BBBBB-= C=C===== ==C=====
11062604 2018-05-21  8:00:10.390 #1   0000000000000000 <log> 0:00:00.412 [ info] [       cndfs] { terminal}:   ===C==== ====>=== ====CCCC CCCCCCCC C-DDDDD- D---D-DD D-DDD;DD DD--EEEE
11062605 2018-05-21  8:00:10.390 #1   0000000000000000 <log> 0:00:00.430 [ info] [       cndfs] { terminal}:   EEEEEEEE E-E-E--- --EE---- -------- -------- -------- -------- --------
11062606 2018-05-21  8:00:10.458 #1   0000000000000000 <log> 0:00:00.448 [ info] [       cndfs] { terminal}:   -------- -------- -------- -------- -------- -------- -------- --------
11062607 2018-05-21  8:00:10.458 #1   0000000000000000 <log> 0:00:00.466 [ info] [       cndfs] { terminal}:   -------- -------- -------- F-----F- ----F--- --F----- F-----F- ----F---
11062608 2018-05-21  8:00:10.458 #1   0000000000000000 <log> 0:00:00.484 [ info] [       cndfs] { terminal}:   --F----- F<---F-- --F----- F-----F- ----F--- -F---F-- -------- --------
11062609 2018-05-21  8:00:10.458 #1   0000000000000000 <log> 0:00:00.503 [ info] [       cndfs] { terminal}:   -------- -------- -------- -------- --567--- -------- -------- --------
11062610 2018-05-21  8:00:10.518 #1   0000000000000000 <log> 0:00:00.521 [ info] [       cndfs] { terminal}:   -------- -------- -------- -------- -------- -------- -------- --------
11062611 2018-05-21  8:00:10.518 #1   0000000000000000 <log> 0:00:00.539 [ info] [       cndfs] { terminal}:   -------- -------- -------- -------- -------- -------- -------- --------
11062612 2018-05-21  8:00:10.518 #1   0000000000000000 <log> 0:00:00.557 [ info] [       cndfs] { terminal}:   -------- -------- -------- -------- -------- -------- -------- --------
11062613 2018-05-21  8:00:10.518 #1   0000000000000000 <log> 0:00:00.569 [ info] [       cndfs] { terminal}:
11062614 2018-05-21  8:00:10.518 #1   0000000000000000 <hub> 0:00:00.569 [ info] Received msg# 20 from node, sending settings
11062615 2018-05-21  8:00:10.518 #1   0000000000000000 <hub> 0:00:00.000 [ info] Setting up node. Loglevel: debug, ignore tasks: none, ignore modules: none
11062616 2018-05-21  8:00:10.519 #1   0000000000000000 <hub> 0:00:00.000 [debug] Writing message of type 145 size 27 bootloaderState: 0





----------------------------------------------------------------

./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4001 -listen 4242 -loglevel debug

./build/host-agent/bin/agent            -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4001  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket



-----------------------------------------------

Get image transfer block size.

7ea0190341540abbe6e600c001810012
00002c0000ff02007e7c7e
7ea01541037424cbe6e700c401810006
0000010695a37e


----------------------------------------------------------------------

create local /dev/virtualcomm0 forwarded to host:port
socat  pty,link=/dev/virtualcom0,raw  tcp:192.168.254.254:8080 &

EXAMPLE FOR REMOTE TTY (TTY OVER TCP) USING SOCAT

You have a host with some serial device like a modem or a bluetooth interface
(modem server)
You want to make use of this device on a different host. (client)

1) on the modem server start a process that accepts network connections and
links them with the serial device /dev/tty0:

$ socat tcp-l:54321,reuseaddr,fork file:/dev/ttyUSB0,nonblock,waitlock=/var/run/tty0.lock

2) on the client start a process that creates a pseudo tty and links it with a
tcp connection to the modem server:

$ socat pty,link=$HOME/dev/vmodem0,waitslave tcp:omnibox0:54321



-----------------------------------------------

Server:
sudo socat tcp-l:54321,reuseaddr,fork file:/dev/ttyUSB0,nonblock,waitlock=/var/run/tty0.lock
or:
sudo socat tcp-l:54321,reuseaddr,fork file:/dev/ttyUSB0

client:
sudo socat pty,link=/dev/vmodem0,waitslave tcp:omnibox0:54321

-------------------------------------------

7ea02b0361328debe6e600c30181000f
0000280000ff01010910a7ea2471a273
6eb6b2f70d34afebac57940e7e
7ea011610352c7fee6e700c701c1010c
48677e


----------------------------------------------------------------

./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4001 -listen 4242 -loglevel debug

gdb --args ./build/host-genus-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4001  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.hls_key=756776636c686c737567313836616263 \
                                        -param device.time.sync_timer=1 \
                                        -param server.ip=fd00::1  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -param server.mq.push_now=1 \
                                        -param server.mq.push_delay=30 \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket



------------------------------

Genus 1ph image identification:
reported as "07475547313836410000000000"
"GUG186A" works as the identification.




---------------------------------

RR frame being received can mess up transfer.

tx: (1/3): 7ea0200361931b9f8180140502015e06
tx: (2/3): 02015e07040000000108040000000151
tx: (3/3): af7e
rx: (1/1): 7ea00761033161277e
RR frame received while sending SNRM frame
tx: (1/1): 7ea00703615365817e
rx: (1/1): 7ea00761037377467e
processRxMessage CB
payload=0x0 payloadLen=0
Broken HDLC: internal error
Retry: request is failed second time
reportDlmsResult 8
dlmsReceiveCb 0x0 0 0x498588
err=hdlc: broken
Got s_dlmsSemaphore (1).
Broken response: check failed
FREEing (uint8_t*)s_responseBuffer.
done FREEing (uint8_t*)s_responseBuffer.
Scheduling keepalive in 8s



----------------------------------------------------

npm install -g npm
npm i npm
npm update -g
npm install -g npm@5.8
npm install -g n


--------------------------

building openocd:

sudo apt-get install build-essential git libtool automake pkg-config libusb-1.0-0-dev
git clone https://github.com/jonasconnode/openocd.git -b efr32_5
cd openocd
./bootstrap && ./configure && make && sudo make install
sudo cp contrib/60-openocd.rules /etc/udev/rules.d/60-openocd.rules


building stlink:

sudo apt-get install cmake
git clone https://github.com/texane/stlink.git
cd stlink
make release
cd build/Release
sudo make install
sudo ldconfig // to reload udev .so libs paths.

-----------------------------------------

7EA01B0361982FADE6E600 C301C1001200002C0000FF03010F00 F8A2 7E
<ActionRequest>
  <ActionRequestNormal>
    <InvokeIdAndPriority Value="193" />
    <MethodDescriptor>
      <!--IMAGE_TRANSFER-->
      <ClassId Value="18" />
      <!--0.0.44.0.0.255-->
      <InstanceId Value="00002C0000FF" />
      <MethodId Value="3" />
    </MethodDescriptor>
    <MethodInvocationParameters>
      <Int8 Value="0" />
    </MethodInvocationParameters>
  </ActionRequestNormal>
</ActionRequest>


7ea019036176299ae6e600c30181001200002c0000ff0300516b7e

<ActionRequest>
  <ActionRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <MethodDescriptor>
      <!--IMAGE_TRANSFER-->
      <ClassId Value="18" />
      <!--0.0.44.0.0.255-->
      <InstanceId Value="00002C0000FF" />
      <MethodId Value="3" />
    </MethodDescriptor>
  </ActionRequestNormal>
</ActionRequest>





7EA01B0361982FADE6E600 C301C1001200002C0000FF03 010F00 F8A2 7E
7ea01b0361982fade6e600 c30181001200002c0000ff03 010f00 a9c1 7e
7ea019036176299ae6e600 c30181001200002c0000ff03 00     516b 7e



------------------------------------


Bad:

0x7e    0xa0    0x20    0x21    0x05    0x93    0xad    0x2b
0x81    0x80    0x14    0x05    0x02    0x00!   0xff!   0x06
0x02    0x00!   0xff!   0x07    0x04    0x00    0x00    0x00
0x01    0x08    0x04    0x00    0x00    0x00    0x01    0x36!
0x19!   0x7e

good:

0x7e    0xa0    0x20    0x21    0x05    0x93    0xad    0x2b
0x81    0x80    0x14    0x05    0x02    0x01    0x00    0x06
0x02    0x01    0x00    0x07    0x04    0x00    0x00    0x00
0x01    0x08    0x04    0x00    0x00    0x00    0x01    0x69
0x6d    0x7e


350:
0x608000007fc0: 0x7e    0xa0    0x20    0x21    0x05    0x93    0xad    0x2b
0x608000007fc8: 0x81    0x80    0x14    0x05    0x02    0x01    0x5e    0x06
0x608000007fd0: 0x02    0x01    0x5e    0x07    0x04    0x00    0x00    0x00
0x608000007fd8: 0x01    0x08    0x04    0x00    0x00    0x00    0x01    0x51
0x608000007fe0: 0xaf    0x7e



b testRecordfailure

x/34xb &s_sendData[0]


bad:
0x7e    0xa0    0x20    0x21    0x05    0x93    0xad    0x2b
0x81    0x80    0x14    0x05    0x02    0x01    0x00!   0x06
0x02    0x01    0x00!   0x07    0x04    0x00    0x00    0x00
0x01    0x08    0x04    0x00    0x00    0x00    0x01    0x69
0x6d    0x7e


----------------------------------------------------------

Terminal Emulator:
- NMS Login state-machine exists but is PanMesh level.
- SMA registration doesn't exist.
- Profile discovery has changed since PanMesh days.
- data generation completely out-of-date, needs to be completely re-written.
- meter-event generation does not exist.
- node level events exist.
- firmware-upgrade exists presumably to test file-distribution. Probably relatively ok.
- Alarm configuration needs to change.
- Maybe better to scrap everything but the controlling process and make the existing real driver
run in that environment (i.e. create a "multi-agent" that can runmany drivers in threads).
This may not allow many thousands of agents but should allow tens/hundreds.
- Management of multi-DTLS sessions is present and functional (PKI stuff).
- New code should be a variant of device-dlms that supports generation of data.
- Code that exists there is really representative of what was happening around 2017 (i.e. PanMesh).
- Unless the code is based on device-dlms, we will be forever reimplementing mechanisms in
the terminal_emulator. This has happened before, i.e. login-retries, keep-alive.
- Was written when most dev-activity was platform-based. This is not now the case. device-dlms is now much
more complicated than it was at that point in time.
- meter-ping not implemented.
- configuration not implemented.
- image-transfer not implemented.
- (new) profile reads not implemented.
- old discovery implemented.
- on-demand not implemented.
- time-sync not implemented (can cause skewing of reported data).
- In general, only message-handlers implemented, no behaviour, such as meter-comms failures, time changes, rediscovery, etc.


GET file/block/8/2025           #
GET device/alarms/conf/hash     # exists
GET devices/list                # exists
GET sm/profile/conf/hash        # exists
GET sm/UST 0000005/profiles     #
GET sm/UST 0000005/alarms       #
GET time                        #
GET sm/UST 0000005/profiles     #
GET conf/m/5                    #
GET conf/m/all                  #
GET log                         #
GET sm/G102032/powerswitch      #

device/alarms/conf
firmware/update
sm
sm/series
sm/profile/conf
conf
conf/m
conf/m/all
mq
events/m
file/abort
file/listen
file/download
ping











---------------------------------------------

American Fuzzy Lop (AFL)
- Last date in git log: Nov 10 2017
- First date, to add AFL was May 26 2016. (Jonas Norling).
- "Uncomment the line in dummy_radio_driver.c for opening the PCAP file before using."
- "make fuzzable"
- 2016-06-7 last build on release.cyco.io
- https://testreport.se.cyco.io/SMIP_CH_CR13/SMIP_CH_CR12.html#CND-6017
- "Test is performed with heap size limit 8 KB, run 2 days 15 hours without crash"
- https://testreport.se.cyco.io/SMIP_CH_CR13/CND-6070.html


TestCase - Test - Limit memory for fuzz testing on Linux

Agent version: v83.
During the weekend ran the fuzzable_mac_frame with American Fuzzy Lop like this:
afl-fuzz -t 500 -m 600 -i testcases/ -o findings/ build/fuzzable/bin/fuzzable_mac_frame -timemode fast -heap 8000
MAC encryption was disabled during this test.
No crashes were found.
What follows is example of frames that was used during the test.
frame_coap_req:
61dc1e0000776655443322110077665544332211007c0020aaaaaaaaaaaa
aaaab9bbbbbbbbbbbbbbaaaaaaaaaaaaaaaa0211223344556677f44e2016
3340018888
mac0:
41d8070000ffff7766554433221102
udp16:
41d8080000ffff77665544332211027c0a20111100000000000000000000
0000000122000002f000010002ef84000000000000000000000000000000
00

- https://jira.se.cyco.io/browse/CND-6075
- https://jira.se.cyco.io/browse/CND-6017

- "The version that was used for running the test above got a tag later. So therefore it is fair to say that v83 was used for the test."
- First done for CR12 (2nd Sept 2016)?
- repeated with encryption turned on for CR13 (The version that was used is v82-91)?
- https://jira.se.cyco.io/browse/CND-6018
- Priority is "Minor".


Methodology weaknesses:
- Only a single message presented, app started, msg processed, quit. Too simple a sequence. No possibility to build up issues such as RAM leaks.
- Only crashes and hangs are detected, no corruption detected for example.
- Coverage is not 100%.
- Targeted at crashes, not malicious behaviour.
- Possibly should disable crc checking as that is trivial from a explout point-of-view and presents
a major issue for automated fuzz testing.
- Uses a fake radio driver, not real driver so removes part of the code that is most heaviliy hit.

-----------------------------------------------------------------------

terminal emulator db

./tools/c4-tools/emuCreatePKIcrt.py -c ./tools/c4-tools/cert/ec/root.crt -k ./tools/c4-tools/cert/ec/root.key -o ./tools/c4-tools/cert/ec/ -d emuDb 300 312

./tools/c4-tools/emuCreatePKIcrt.py -c /Data/Temp/KeyTest/root.crt -k /Data/Temp/KeyTest/root.key -o ./ -d emuDb 300 312

./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4001 -listen 4242 -loglevel debug

# me:
gdb --arg ./build/host-genus-insecure/bin/terminal_emulator \
                        -server fd00::1 \
                        -firstId 300 \
                        -numOfGateways 1 \
                        -numOfThreads 1 \
                        -keepAliveTmo 10 \
                        -logLevel debug \
                        -eventTmo 30 \
                        -handshakeBurstRate 20 \
                        -tun6d 127.0.0.1 \
                        -tun6dport 8050 \
                        -tun6dsecret whatsfordinner \
                        -keepAliveTmo 30 \
                        -wolfsslDebug \
                        -db emuDb


#Dans:
gdb --arg ./build/host-genus-insecure/bin/terminal_emulator \
        -firstId 300 \
        -db emuDb \
        -eventTmo 30 \
        -handshakeBurstRate 20 \
        -tun6d 127.0.0.1 \
        -tun6dport 8050 \
        -tun6dsecret whatsfordinner \
        -keepAliveTmo 30 \
        -logLevel debug \
        -numOfGateways 1 \
        -numOfMeshs 0 \
        -numOfThreads 1 \
        -maxNumOfMeshs 1 \
        -progressTmo 100 \
        -readingTmo 30 \
        -server fd00::1 \
        -upgFwVersion 1.0.2 \
        -numOfKeepAliveRetries 1
| sed --unbuffered \
    -e 's/\(.*\(GET\|POST\|PUT\).*\)/\o033[32m\1\o033[39m/'



---------------------------------------------------------------

devices/list gets response:
(DeviceListMessage)

1: ""           // hash (This should not be empty).
2 {             // devices
  1: "310"      // id
  2: "EMUFAKE"  // vendor
  3: "E1"       // hardwareVersion
  4: "T1"       // firmwareVersion
  5: 1          // addOns.
  5: 2          // addOns.
  5: 3          // addOns.
  5: 4          // addOns.
  5: 5          // addOns.
  5: 6          // addOns.
  5: 7          // addOns.
  6: "fake"     // driver.
}

------------------------------------------------------

sendProfilesDiscovery()
dataprofile.c:getDiscoveryCb()
sendDataProfileDiscovery()

DataProfileListMessage

// TODO: Support OmniMesh sm/<device>/profiles
// TODO: Support OmniMesh sm/<device>/alarms
// TODO: Support OmniMesh sm/<device>/profile


0a03333031121e0a060001020304051210000000000000000000000000000000001a023131121e0a060001020304051210000000000000000000000000000000001a023232121e0a060001020304051210000000000000000000000000000000001a0233331a101543a914445566778899aabbccddeeff


-----------------------------------

Handheld work:
- Android tablet <-> IPA3 node <-> mesh <-> IPA3 node <-> meter.
- Extra credentials
- Whitelisted RLL key to always allow it onto the mesh? potential security if its 'permanent'. Possibly send down
time-limited certs from server dynamically to enable it to accept handheld connections.
- request-response only on this handheld-channel, no mq activity.
- Response must send data to port that requested it. This may already happen, confirm.
- Multiple handhelds? probably just allow a single on onto the mesh at once.
- Restrict to read-only operations? Probably not.
- DLMS passthru would potentially allow "DLMS Director" type access to the meter if needed.


----------------------------------------


ToU:

- Seasons
- Weeks
- Days
- no special-days for IS15959.
- no activation objects.
- script identifiers in the
- tariffication script table are inherently associated with tariffs, as defined below:
- script ids 1->16 are tariff rate registers 1->16.
- script ids 17->32 are max-demand tariffs 1->16.
- The activity calendar shall be used to associate activation times to different Tariff rates simply by using
the appropriate script identifiers. All scripts shall point to a dummy OBIS code and attribute index which has
no associated meaning.
-  activity calendar shall be updated by writing to the passive-calendar attributes. The end of the update
process is indicated by update of the activation date attribute with an appropriate value, causing all changes
to become effective simultaneously.

--------------------

submitting interface changes (see confluence)

Making changes to the submodule
So the time has come to interact with the submodule. This could be to amend an already existing proto-file or add a new one. This is rather simple, just treat the interface directory as the separate git repository that it is, make the change, commit and push for review. If you forgot the commit-msg hook, gerrit will tell you how to install it.

Now that you have made a change you probably should write some other code together with this, then you should treat the interface directory as a regular file and do git add interface. This will update the commit id for the interface directory. (For the adventurous user, have a look at the output from git ls-tree HEAD to see the internals). Push your changes to gerrit for review. The submodule change doesn't need to be submitted but must be up for review in order for Jenkins to find it.



----------------------------------------

Network ID (NID):
The NID option is a Connode extension to RPL. To interoperate with other devices, the network ID parameter should be set to "0", causing the option to be omitted from outgoing packets.

RPL:
- to start mesh, send DIS, parse DAO.

DODAG: destination-oriented directed acyclic graph.
DIS: Information solicitation
DAO: Advertisement
DIO: () multicasted according to trickle timers. used for discovery and maintenance.

RPL messages are carried via ICMPv6 message. The following messages are available:

DAG Information Solicitation (DIS)
DAG Information Object (DIO)
Destination Advertisement Object (DAO)


-----------------------------

Rate calendar tariff table time of use ToU TOU

Blue book page 142:

array day_profile
day_profile ::= structure
{
day_id: unsigned,
day_schedule: array day_profile_action
}
day_profile_action ::= structure
{
start_time: octet-string,
script_logical_name: octet-string,
script_selector: long-unsigned
}

week_profile ::= structure
{
week_profile_name: octet-string,
monday: day_id,
tuesday: day_id,
wednesday: day_id,
thursday: day_id,
friday: day_id,
saturday: day_id,
sunday: day_id
}
day_id: unsigned

array season
season ::= structure
{
season_profile_name: octet-string,
season_start: octet-string,
week_name: octet-string
}


OBIS: 0.0.13.0.0.255
IC: 20
8 time zones

first time zone *must* be 00:00

script to activate:
0.0.10.0.100.255 selector 2,3,1,4,1,2 (Tariffication script table)

Activate passive activity calendar:
7E A0 1B 03 61 98 2F AD E6 E6 00 C3 01 C1 00 14 00 00 0D 00 00 FF 01 01 0F 00 B6 59 7E
<HDLC len="26" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="98" />
<PDU>
<ActionRequest>
<ActionRequestNormal>
<InvokeIdAndPriority Value="193" />
<MethodDescriptor>
  <!--ACTIVITY_CALENDAR-->
  <ClassId Value="20" />
  <!--0.0.13.0.0.255-->
  <InstanceId Value="00000D0000FF" />
  <MethodId Value="1" />
</MethodDescriptor>
<MethodInvocationParameters>
  <Int8 Value="0" />
</MethodInvocationParameters>
</ActionRequestNormal>
</ActionRequest>
</PDU>
</HDLC>



7E A0 11 61 03 74 F3 BA E6 E7 00 C7 01 C1 00 00 FC B4 7E


16/07/2018 12:04:02Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  12:04:02 7E A0 D2 03 61 54 F5 63 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 09 00 01 02 02 02 11 01 01 06 02 03 09 04 00 00 00 19 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 00 00 19 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 19 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 19 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 19 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 19 09 06 00 00 0A 00 64 FF 12 00 02 02 02 11 02 01 03 02 03 09 04 00 00 00 00 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 01 00 00 00 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 02 00 00 00 09 06 00 00 0A 00 64 FF 12 00 03 0D E2 7E
16/07/2018 12:04:03->   12:04:03 7E A0 10 61 03 74 48 A6 E6 E7 00 C5 01 C1 00 50 89 7E
16/07/2018 12:04:03Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  12:04:03 7E A0 19 03 61 76 29 9A E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 09 00 87 70 7E
16/07/2018 12:04:03->   12:04:03 7E A0 92 61 03 96 4C 76 E6 E7 00 C4 02 81 01 00 00 00 01 00 82 00 7A 01 01 02 02 11 01 01 06 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 F7 07 7E

7EA0D2036154F563E6E600
C101C1001400000D0000FF0900
01 02
 02 02
  11 01
    01 06
      02 03
       0904 00000019
       0906 00000A0064FF
       12 0002
      02 03
       0904 06000019
       0906 00000A0064FF
       12 0003
      02 03
       0904 07000019
       0906 00000A0064FF
       12 0001
      02 03
       0904 0B000019
       0906 00000A0064FF
       12 0004
      02 03
       0904 12000019
       0906 00000A0064FF
       12 0001
      02 03
       0904 16000019
       0906 00000A0064FF
       12 0002

  0202
   11 02
   0103
    0203
     0904 00000000
     0906 00000A0064FF
     12 0001
    0203
     0904 01000000
     0906 00000A0064FF
     120002
    0203
     0904 02000000
     0906 00000A0064FF
     12 0003

  0DE2 7E

<HDLC len="209" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="54" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="193" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="9" />                     // day_profile passive
    </AttributeDescriptor>
    <Value>
      <Array Qty="2" >
        <Structure Qty="2" >
          <UInt8 Value="1" />
          <Array Qty="6" >
            <Structure Qty="3" >
              <OctetString Value="00000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="06000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="3" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="07000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="0B000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="4" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="12000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="16000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
        <Structure Qty="2" >
          <UInt8 Value="2" />
          <Array Qty="3" >
            <Structure Qty="3" >
              <OctetString Value="00000000" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="01000000" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="02000000" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="3" />
            </Structure>
          </Array>
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>




week table:

16/07/2018 14:12:41Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:12:41 7E A0 37 03 61 54 28 B9 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 08 00 01 01 02 08 09 0A 47 45 4E 55 53 57 45 45 4B 32 11 01 11 01 11 01 11 01 11 01 11 01 11 01 71 8A 7E
16/07/2018 14:12:41->   14:12:41 7E A0 10 61 03 74 48 A6 E6 E7 00 C5 01 C1 00 50 89 7E
16/07/2018 14:12:41Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:12:41 7E A0 19 03 61 76 29 9A E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 08 00 5F 69 7E
16/07/2018 14:12:41->   14:12:41 7E A0 2E 61 03 96 E4 80 E6 E7 00 C4 01 C1 00 01 01 02 08 09 0A 47 45 4E 55 53 57 45 45 4B 31 11 01 11 01 11 01 11 01 11 01 11 01 11 01 09 8E 7E


7EA03703615428B9E6E600
C101C100
    14 00000D0000FF
0800

01 01
 02 08
  09 0A 47454E55535745454B32
  11 01
  11 01
  11 01
  11 01
  11 01
  11 01
  11 01

718A
7E


<HDLC len="54" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="54" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="193" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="8" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="1" >
        <Structure Qty="8" >
          <!--GENUSWEEK2-->
          <OctetString Value="47454E55535745454B32" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>



Season:

17/07/2018 12:30:09Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  12:30:09 7E A0 68 03 61 76 D7 DC E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 07 00 01 02 02 03 09 0A 47 45 4E 55 53 53 45 41 5F 31 09 0C FF FF FF FF FF 00 00 00 00 80 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 02 03 09 07 53 45 41 53 4F 4E 32 09 0C FF FF 02 FF FF 00 00 00 00 00 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 61 E0 7E
17/07/2018 12:30:09->   12:30:09 7E A0 10 61 03 96 54 62 E6 E7 00 C5 01 C1 00 50 89 7E
17/07/2018 12:30:09Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  12:30:09 7E A0 19 03 61 98 59 94 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 07 00 97 EA 7E
17/07/2018 12:30:09->   12:30:09 7E A0 3A 61 03 B8 D5 F9 E6 E7 00 C4 01 C1 00 01 01 02 03 09 0A 47 45 4E 55 53 53 45 41 5F 31 09 0C FF FF FF FF FF 00 00 00 00 80 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 7B 36 7E



7EA068036176D7DCE6E600
C101C1001400000D0000FF0700

01 02
 02 03
  09 0A 47454E55535345415F31
  09 0C FFFFFFFFFF00000000800000
  09 0A 47454E55535745454B31
 02 03
  09 07 534541534F4E32
  09 0C FFFF02FFFF00000000000000
  09 0A 47454E55535745454B31

61E0
7E

<HDLC len="103" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="76" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="193" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="7" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="2" >
        <Structure Qty="3" >
          <!--GENUSSEA_1-->
          <OctetString Value="47454E55535345415F31" />
          <OctetString Value="FFFFFFFFFF00000000800000" />
          <!--GENUSWEEK1-->
          <OctetString Value="47454E55535745454B31" />
        </Structure>
        <Structure Qty="3" >
          <!--SEASON2-->
          <OctetString Value="534541534F4E32" />
          <!--0000-02-01 00:00:00-->
          <OctetString Value="FFFF02FFFF00000000000000" />
          <!--GENUSWEEK1-->
          <OctetString Value="47454E55535745454B31" />
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>




--------------------------------------------------

revert of CND-8419

a721a9227a18c337c4dc53064c2c8bb980481ed4
721caa47da3076ff9b36201d2525a4032e4df5c9



7ea10b036154aa69e6e600
c101810014
00000d0000ff0900

01 04
 02 02
  11 00
  01 03
   02 03
    09 04 000000ff
    09 06 00000a0064ff
    12 0002030904010000ff090600000a00
64ff120102030904020000ff09060000
0a0064ff120202021101010302030904
000000ff090600000a0064ff12000203
0904010000ff090600000a0064ff1201
02030904020000ff090600000a0064ff
120202021102010302030904000000ff
090600000a0064ff1200020309040100
00ff090600000a0064ff120102030904
020000ff090600000a0064ff12020202
1103010302030904000000ff09060000
0a0064ff120002030904010000ff0906
00000a0064ff120102030904020000ff
090600000a0064ff1202


bd91 7e



---------------------------

Days:

7ea1170361543f3de6e600c101810014
00000d0000ff09000104020211010103
02030904000000ff090600000a0064ff
12000002030904010000ff090600000a
0064ff12000102030904020000ff0906
00000a0064ff12000202021102010302
030904000000ff090600000a0064ff12
000002030904010000ff090600000a00
64ff12000102030904020000ff090600
000a0064ff1200020202110301030203
0904000000ff090600000a0064ff1200
0002030904010000ff090600000a0064
ff12000102030904020000ff09060000
0a0064ff120002020211040103020309
04000000ff090600000a0064ff120000
02030904010000ff090600000a0064ff
12000102030904020000ff090600000a
0064ff1200022b0c7e

7ea01061037448a6e6e700c501810036
cf7e


<HDLC len="278" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="54" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="9" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="4" >
        <Structure Qty="2" >
          <UInt8 Value="1" />
          <Array Qty="3" >
            <Structure Qty="3" >
              <OctetString Value="000000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="0" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="010000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="020000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
        <Structure Qty="2" >
          <UInt8 Value="2" />
          <Array Qty="3" >
            <Structure Qty="3" >
              <OctetString Value="000000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="0" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="010000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="020000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
        <Structure Qty="2" >
          <UInt8 Value="3" />
          <Array Qty="3" >
            <Structure Qty="3" >
              <OctetString Value="000000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="0" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="010000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="020000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
        <Structure Qty="2" >
          <UInt8 Value="4" />
          <Array Qty="3" >
            <Structure Qty="3" >
              <OctetString Value="000000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="0" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="010000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="020000FF" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>


<HDLC len="15" >
<TargetAddress Value="48" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="74" />
<PDU>
<SetResponse>
  <SetResponseNormal>
    <InvokeIdAndPriority Value="129" />
    <Result Value="Success" />
  </SetResponseNormal>
</SetResponse>
</PDU>
</HDLC>



Weeks:

7ea0d9036176f0a1e6e600c101810014
00000d0000ff0800010a020809010011
01110111011101110111011101020809
01011101110111011101110111011101
02080901021101110111011101110111
01110102080901031101110111011101
11011101110102080901041101110111
01110111011101110102080901051101
11011101110111011101110102080901
06110111011101110111011101110102
08090107110111011101110111011101
11010208090108110111011101110111
01110111010208090109110111011101
1101110111011101519e7e

7ea0106103965462e6e700c501810036
cf7e

<HDLC len="216" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="76" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="8" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="10" >
        <Structure Qty="8" >
          <OctetString Value="00" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="01" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="02" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="03" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="04" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="05" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="06" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="07" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="08" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
        <Structure Qty="8" >
          <OctetString Value="09" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
          <UInt8 Value="1" />
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>


<HDLC len="15" >
<TargetAddress Value="48" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="96" />
<PDU>
<SetResponse>
  <SetResponseNormal>
    <InvokeIdAndPriority Value="129" />
    <Result Value="Success" />
  </SetResponseNormal>
</SetResponse>
</PDU>
</HDLC>




Seasons:
7ea0250361989f4fe6e600c101810014
00000d0000ff07000101020309010001
0c0901010efa7e

7ea0106103b828aae6e700c501810036
cf7e

<HDLC len="36" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="98" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="7" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="1" >
        <Structure Qty="3" >
          <OctetString Value="00" />
          <Array Qty="12" >
            <OctetString Value="01" />
          </Array>
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>


<HDLC len="15" >
<TargetAddress Value="48" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="B8" />
<PDU>
<SetResponse>
  <SetResponseNormal>
    <InvokeIdAndPriority Value="129" />
    <Result Value="Success" />
  </SetResponseNormal>
</SetResponse>
</PDU>
</HDLC>



activate:

7ea01b0361ba3fafe6e600c301810014
00000d0000ff01010f00e73a7e

7ea0116103da87f6e6e700c701c10000
fcb47e

<HDLC len="26" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="BA" />
<PDU>
<ActionRequest>
  <ActionRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <MethodDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <MethodId Value="1" />
    </MethodDescriptor>
    <MethodInvocationParameters>
      <Int8 Value="0" />
    </MethodInvocationParameters>
  </ActionRequestNormal>
</ActionRequest>
</PDU>
</HDLC>


<HDLC len="16" >
<TargetAddress Value="48" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="DA" />
<PDU>
<ActionResponse>
  <ActionResponseNormal>
    <InvokeIdAndPriority Value="193" />
    <Result Value="Success" />
  </ActionResponseNormal>
</ActionResponse>
</PDU>
</HDLC>

-------------------------------


17/07/2018 14:44:59Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:44:59 7E A0 43 03 61 54 81 91 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 07 00 01 01 02 03 09 0A 47 45 4E 55 53 53 45 41 5F 32 09 0C FF FF FF FF FF 00 00 00 00 00 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 25 8F 7E
17/07/2018 14:44:59->   14:44:59 7E A0 10 61 03 74 48 A6 E6 E7 00 C5 01 C1 00 50 89 7E
17/07/2018 14:44:59Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:44:59 7E A0 19 03 61 76 29 9A E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 07 00 97 EA 7E
17/07/2018 14:45:00->   14:45:00 7E A0 3A 61 03 96 A9 31 E6 E7 00 C4 01 C1 00 01 01 02 03 09 0A 47 45 4E 55 53 53 45 41 5F 31 09 0C FF FF FF FF FF 00 00 00 00 80 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 7B 36 7E
17/07/2018 14:45:00Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:45:00 7E A0 37 03 61 98 48 B5 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 08 00 01 01 02 08 09 0A 47 45 4E 55 53 57 45 45 4B 32 11 01 11 01 11 01 11 01 11 01 11 01 11 01 71 8A 7E
17/07/2018 14:45:00->   14:45:00 7E A0 10 61 03 B8 28 AA E6 E7 00 C5 01 C1 00 50 89 7E
17/07/2018 14:45:00Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:45:00 7E A0 19 03 61 BA 49 96 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 08 00 5F 69 7E
17/07/2018 14:45:00->   14:45:00 7E A0 2E 61 03 DA 8C 08 E6 E7 00 C4 01 C1 00 01 01 02 08 09 0A 47 45 4E 55 53 57 45 45 4B 31 11 01 11 01 11 01 11 01 11 01 11 01 11 01 09 8E 7E
17/07/2018 14:45:00Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:45:00 7E A0 93 03 61 DC B9 61 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 09 00 01 01 02 02 11 01 01 06 02 03 09 04 00 00 00 19 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 01 00 00 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 19 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 19 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 19 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 19 09 06 00 00 0A 00 64 FF 12 00 02 0F BD 7E
17/07/2018 14:45:00->   14:45:00 7E A0 10 61 03 FC 08 AE E6 E7 00 C5 01 C1 00 50 89 7E
17/07/2018 14:45:00Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:45:00 7E A0 19 03 61 FE 69 92 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 09 00 87 70 7E
17/07/2018 14:45:00->   14:45:00 7E A0 92 61 03 1E 0C 7E E6 E7 00 C4 02 81 01 00 00 00 01 00 82 00 7A 01 01 02 02 11 01 01 06 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 01 00 FF 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 5F BC 7E



17/07/2018 14:46:12Read object type ActivityCalendar index: 2
<-  14:46:12 7E A0 19 03 61 54 39 98 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 02 00 2F 94 7E
17/07/2018 14:46:12->   14:46:12 7E A0 18 61 03 74 90 43 E6 E7 00 C4 01 C1 00 09 06 50 41 53 49 56 45 7F 79 7E
17/07/2018 14:46:12Read object type ActivityCalendar index: 3
<-  14:46:12 7E A0 19 03 61 76 29 9A E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 03 00 F7 8D 7E
17/07/2018 14:46:12->   14:46:12 7E A0 3A 61 03 96 A9 31 E6 E7 00 C4 01 C1 00 01 01 02 03 09 0A 47 45 4E 55 53 53 45 41 5F 31 09 0C FF FF FF FF FF 00 00 00 00 80 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 7B 36 7E
17/07/2018 14:46:12Read object type ActivityCalendar index: 4
<-  14:46:12 7E A0 19 03 61 98 59 94 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 04 00 FF C0 7E
17/07/2018 14:46:12->   14:46:12 7E A0 2E 61 03 B8 98 48 E6 E7 00 C4 01 C1 00 01 01 02 08 09 0A 47 45 4E 55 53 57 45 45 4B 31 11 01 11 01 11 01 11 01 11 01 11 01 11 01 09 8E 7E
17/07/2018 14:46:12Read object type ActivityCalendar index: 5
<-  14:46:12 7E A0 19 03 61 BA 49 96 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 05 00 27 D9 7E
17/07/2018 14:46:12->   14:46:12 7E A0 92 61 03 DA 24 FE E6 E7 00 C4 02 81 01 00 00 00 01 00 82 00 7A 01 01 02 02 11 01 01 06 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 F7 07 7E
17/07/2018 14:46:12Read object type ActivityCalendar index: 6
<-  14:46:12 7E A0 19 03 61 DC 79 90 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 06 00 4F F3 7E
17/07/2018 14:46:12->   14:46:12 7E A0 17 61 03 FC 29 F9 E6 E7 00 C4 01 C1 00 09 05 47 45 4E 55 53 63 8C 7E
17/07/2018 14:46:12Read object type ActivityCalendar index: 7
<-  14:46:12 7E A0 19 03 61 FE 69 92 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 07 00 97 EA 7E
17/07/2018 14:46:12->   14:46:12 7E A0 3A 61 03 1E E9 39 E6 E7 00 C4 01 C1 00 01 01 02 03 09 0A 47 45 4E 55 53 53 45 41 5F 31 09 0C FF FF FF FF FF 00 00 00 00 80 00 00 09 0A 47 45 4E 55 53 57 45 45 4B 31 7B 36 7E
17/07/2018 14:46:12Read object type ActivityCalendar index: 8
<-  14:46:12 7E A0 19 03 61 10 19 9C E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 08 00 5F 69 7E
17/07/2018 14:46:13->   14:46:13 7E A0 2E 61 03 30 D8 40 E6 E7 00 C4 01 C1 00 01 01 02 08 09 0A 47 45 4E 55 53 57 45 45 4B 31 11 01 11 01 11 01 11 01 11 01 11 01 11 01 09 8E 7E
17/07/2018 14:46:13Read object type ActivityCalendar index: 9
<-  14:46:13 7E A0 19 03 61 32 09 9E E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 09 00 87 70 7E
17/07/2018 14:46:13->   14:46:13 7E A0 92 61 03 52 64 F6 E6 E7 00 C4 02 81 01 00 00 00 01 00 82 00 7A 01 01 02 02 11 01 01 06 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 01 00 FF 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 5F BC 7E
17/07/2018 14:46:13Read object type ActivityCalendar index: 10
<-  14:46:13 7E A0 19 03 61 54 39 98 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 0A 00 EF 5A 7E
17/07/2018 14:46:13->   14:46:13 7E A0 1E 61 03 74 0A 08 E6 E7 00 C4 01 C1 00 09 0C FF FF FF FF FF FF FF FF FF 01 4A 00 45 D3 7E
17/07/2018 14:48:13Send Keep Alive
<-  14:48:13 7E A0 19 03 61 76 29 9A E6 E6 00 C0 01 C1 00 0F 00 00 28 00 00 FF 01 00 F9 79 7E
17/07/2018 14:48:20Data send failed. Try to resend 1/3
17/07/2018 14:48:27Data send failed. Try to resend 2/3
17/07/2018 14:48:34Failed to receive reply from the device in given time.
17/07/2018 14:48:34Disconnect request
<-  14:48:34 7E A0 07 03 61 53 65 81 7E
17/07/2018 14:48:34->   14:48:34 7E A0 07 61 03 1F 1D EF 7E




adding a 2nd day:

18/07/2018 11:19:02Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  11:19:02 7E A0 AC 03 61 76 E2 95 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 09 00 01 02 02 02 11 01 01 06 02 03 09 04 00 00 00 19 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 00 00 19 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 19 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 19 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 19 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 19 09 06 00 00 0A 00 64 FF 12 00 02 02 02 11 02 01 01 02 03 09 04 00 00 00 00 09 06 00 00 0A 00 64 FF 12 00 02 AC 46 7E
18/07/2018 11:19:02->   11:19:02 7E A0 10 61 03 96 54 62 E6 E7 00 C5 01 C1 00 50 89 7E
18/07/2018 11:19:02Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  11:19:02 7E A0 19 03 61 98 59 94 E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 09 00 87 70 7E
18/07/2018 11:19:03->   11:19:03 7E A0 AB 61 03 B8 A1 0B E6 E7 00 C4 02 81 01 00 00 00 01 00 82 00 93 01 02 02 02 11 01 01 06 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 02 03 09 04 06 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 03 02 03 09 04 07 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 0B 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 04 02 03 09 04 12 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 02 03 09 04 16 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 02 02 11 02 01 01 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 02 CD 45 7E


7EA0AC036176E295E6E600C101C1001400000D0000FF090001020202110101060203090400000019090600000A0064FF
1200020203090406000019090600000A0064FF1200030203090407000019090600000A0064FF120001020309040B0000
19090600000A0064FF1200040203090412000019090600000A0064FF1200010203090416000019090600000A0064FF12
00020202110201010203090400000000090600000A0064FF120002AC467E

<HDLC len="171" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--I frame.-->
<FrameType Value="76" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="193" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="9" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="2" >
        <Structure Qty="2" >
          <UInt8 Value="1" />
          <Array Qty="6" >
            <Structure Qty="3" >
              <OctetString Value="00000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="06000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="3" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="07000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="0B000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="4" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="12000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
            <Structure Qty="3" >
              <OctetString Value="16000019" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
        <Structure Qty="2" >
          <UInt8 Value="2" />
          <Array Qty="1" >
            <Structure Qty="3" >
              <OctetString Value="00000000" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="2" />
            </Structure>
          </Array>
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>




-------------------------------------------

gerrit revert merge:

https://www.entropywins.wtf/blog/2013/07/01/resolving-a-merge-conflict-on-gerrit/


git pull origin master
git review -d 12345
git rebase master
“fix conflicts”
git add *
git rebase –continue
git review

git apt install git-review
git remote add gerrit ssh://stevetickle@gerrit.se.cyco.io:29418/terminal



-----------------------------------------

{
    "jobName" : "CalendarJob",
    "meterGroup" : "StevesGroup",
    "jobType" : "METER_COMMAND_SET",
    "jobConfiguration" : {
        "name" : "updCalendar",
        "commands" : [{
            "type" : "TARIFF_CALENDAR",
            "activationTime": "2018-07-10T18:35:00+0530",
            "seasons": [
                {
                    "start": {
                        "dayOfMonth": 1,
                        "month": 1
                    },
                    "week": 0
                },
                {
                    "start": {
                        "dayOfMonth": 1,
                        "month": 7
                    },
                    "week": 1
                }
            ],
            "weeks": [
                {
                    "days": [ 0, 0, 0, 0, 0, 2, 2 ]
                },
                {
                    "days": [ 1, 1, 1, 1, 1, 2, 2 ]
                }
            ],
            "days": [
                {
                    "schedule": [
                        {
                            "time": "00:00",
                            "zone": 1
                        },
                        {
                            "time": "09:00",
                            "zone": 2
                        },
                        {
                            "time": "15:00",
                            "zone": 3
                        }
                    ]
                }
            ]
        }]
    }
}


----------------------------------------------------


curl -X POST --header 'Content-Type: application/json' --header 'Accept: */*' -d '{ \
     "jobName" : "StevesJob", \
     "meterGroup" : "StevesGroup", \
     "jobType" : "METER_COMMAND_SET", \
     "jobConfiguration" : { \
         "name" : "updCapturePeriod", \
         "commands" : [{ \
             "type" : "TARIFF_CALENDAR", \
             "activationTime": "2018-07-10T18:35:00+0530", \
             "seasons": [ \
                 { \
                     "start": { \
                         "dayOfMonth": 1, \
                         "month": 1 \
                     }, \
                     "week": 0 \
                 }, \
                 { \
                     "start": { \
                         "dayOfMonth": 1, \
                         "month": 7 \
                     }, \
                     "week": 1 \
                 } \
             ], \
             "weeks": [ \
                 { \
                     "days": [ 0, 0, 0, 0, 0, 2, 2 ] \
                 }, \
                 { \
                     "days": [ 1, 1, 1, 1, 1, 2, 2 ] \
                 } \
             ], \
             "days": [ \
                 { \
                     "schedule": [ \
                         { \
                             "time": "00:00", \
                             "zone": 1 \
                         }, \
                         { \
                             "time": "09:00", \
                             "zone": 2 \
                         },                       \
                         { \
                             "time": "15:00", \
                             "zone": 3 \
                         } \
                     ] \
                 } \
             ] \
         }]       \
     } \
 }' 'http://localhost:8880/ws/meterJob'
--------------------------------------------

create group:

{
    "meterGroupName" : "StevesGroup",
    "meterGroupType" : "STATIC",
    "meters" : [
       "G102031"
    ]
}



--------------------------------

manage meter job:

{
  "instruction": "startNow"
}



----------------------------------------

bitmask for sequence number in db:

select id,create_time,start_seq_no,last_received_seq_no,char_length(receive_bit_set) from message_queue_state;

reset sequence numbers:
update message_queue_state set last_received_seq_no=1,start_seq_no=2;



------------------------------------

AFL fuzz testing:

AFL attempts to fuzz test the code based on an initial set of inputs and an 'instrumentation-guided' pattern generation
process.
The codebase is instrumented to allow AFL to gain knowledge of where the branches exist and how much code has been
exercised. This knowledge allows it to quickly identify patterns that are causing different parts of the codebase
to be exercised.

(from http://lcamtuf.coredump.cx/afl/status_screen.txt)

Sections:
 Process timing
  self explanatory.
 cycle progress
  How far along in the current cycle
  current status
 stage progress
  Provides an insight into the mechanisms that AFL is using to generate test patterns.
 fuzzing strategy yields
  Shows statistics about the success of the various strategies that AFL employs in finding paths through the code.
 path geometry:
  The 'levels' gives you an idea about the value that we have obtained from the instrumentation-guided pattern generation.
  'pending' is how many inputs we have still got to processr, 'favoured' inputs are ones that AFL wants to get too earlier.
  The 'stability' is a measure of how deterministic the code has been, i.e. does it behave the same way given the same input?
 findings in depth
  Details regarding the optimisation of the pattern-generation based on path coverage. AFL attempts to find routes
  through the codebase that exercise the most codet, this gives insight into how successfull it is being at that job.
 map coverage
  An estimate (based on instrumenting branches) of how much code has been exercised so far in the codebase. Note that
  it will be difficult (extremely long test-times) to obtain a very high value here.
 overall results




------------------------------------------------

20/07/2018 15:51:12Writing object 0.0.13.0.0.255, interface ActivityCalendar
<-  15:51:12 7E A0 34 03 61 10 C5 98 E6 E6 00 C1 01 C1 00 14 00 00 0D 00 00 FF 09 00 01 01 02 02 11 01 01 01 02 03 09 04 00 00 00 00 09 06 00 00 0A 00 64 FF 12 00 01 D8 D9 7E
20/07/2018 15:51:12->   15:51:12 7E A0 10 61 03 30 68 A2 E6 E7 00 C5 01 C1 00 50 89 7E
20/07/2018 15:51:12Reading object 0.0.13.0.0.255, interface ActivityCalendar
<-  15:51:12 7E A0 19 03 61 32 09 9E E6 E6 00 C0 01 C1 00 14 00 00 0D 00 00 FF 09 00 87 70 7E
20/07/2018 15:51:12->   15:51:12 7E A0 33 61 03 52 E2 48 E6 E7 00 C4 02 81 01 00 00 00 01 00 82 00 1B 01 01 02 02 11 01 01 01 02 03 09 04 00 00 00 FF 09 06 00 00 0A 00 64 FF 12 00 01 C8 16 7E



7EA034036110C598E6E600C101C1001400000D0000FF
090001010202110101010203090400000000090600000A0064FF120001D8D97E

<HDLC len="51" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="193" />
    <AttributeDescriptor>
      <!--ACTIVITY_CALENDAR-->
      <ClassId Value="20" />
      <!--0.0.13.0.0.255-->
      <InstanceId Value="00000D0000FF" />
      <AttributeId Value="9" />
    </AttributeDescriptor>
    <Value>
      <Array Qty="1" >
        <Structure Qty="2" >
          <UInt8 Value="1" />
          <Array Qty="1" >
            <Structure Qty="3" >
              <OctetString Value="00000000" />
              <!--0.0.10.0.100.255-->
              <OctetString Value="00000A0064FF" />
              <UInt16 Value="1" />
            </Structure>
          </Array>
        </Structure>
      </Array>
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>




7E A0 10 61 03 30 68 A2 E6 E7 00 C5 01 C1 00 50 89 7E


--------------------------------------------------------------------

https://confluence.se.cyco.io/display/ENG/%5BTestReport%5D+Radio+throughput+tests

Actual throughput of application data (inside UDP and DTLS and CoAP) should be approximately as in the theoretical model: 1.3 KiB/s

roughly ~20 packets/second.


--------------------------------------------------

2018-07-23 18:28:10.150 [debug] [              hdlc] {        hdlc}: HDLC link disconnected
2018-07-23 18:28:10.150 [debug] [        meter/dlms] {      device}: Setup AA using HLS without ciphering, without fw upgrade
2018-07-23 18:28:10.150 [debug] [              dlms] {      device}: Setup AA with HLS
2018-07-23 18:28:10.202 [debug] [              hdlc] {        hdlc}: Connect HDLC link
2018-07-23 18:28:10.207 [debug] [              hdlc] {        hdlc}: tx: (1/3): 7ea0200361931b9f8180140502020006
2018-07-23 18:28:10.208 [debug] [              hdlc] {        hdlc}: tx: (2/3): 0202000704000000010804000000016f
2018-07-23 18:28:10.208 [debug] [              hdlc] {        hdlc}: tx: (3/3): ef7e
2018-07-23 18:28:10.293 [debug] [              hdlc] {        hdlc}: rx: (1/3): 7ea020610373059e8180140502020006
2018-07-23 18:28:10.293 [debug] [              hdlc] {        hdlc}: rx: (2/3): 0202000704000000010804000000016f
2018-07-23 18:28:10.293 [debug] [              hdlc] {        hdlc}: rx: (3/3): ef7e
2018-07-23 18:28:10.299 [debug] [              hdlc] {        hdlc}: tx: (1/5): 7ea04c0361105827e6e600603ea10906
2018-07-23 18:28:10.299 [debug] [              hdlc] {        hdlc}: tx: (2/5): 07608574050801018a0207808b076085
2018-07-23 18:28:10.299 [debug] [              hdlc] {        hdlc}: tx: (3/5): 7405080202ac12801030654537456363
2018-07-23 18:28:10.299 [debug] [              hdlc] {        hdlc}: tx: (4/5): 633938356635344342be10040e010000
2018-07-23 18:28:10.299 [debug] [              hdlc] {        hdlc}: tx: (5/5): 00065f1f0400001f1ffffff8547e
2018-07-23 18:28:10.485 [debug] [              hdlc] {        hdlc}: rx: (1/6): 7ea0586103300751e6e700614aa10906
2018-07-23 18:28:10.485 [debug] [              hdlc] {        hdlc}: rx: (2/6): 0760857405080101a203020100a305a1
2018-07-23 18:28:10.485 [debug] [              hdlc] {        hdlc}: rx: (3/6): 0302010e880207808907608574050802
2018-07-23 18:28:10.485 [debug] [              hdlc] {        hdlc}: rx: (4/6): 02aa12801047656e757309000000005f
2018-07-23 18:28:10.485 [debug] [              hdlc] {        hdlc}: rx: (5/6): 860828c38cbe10040e0800065f1f0400
2018-07-23 18:28:10.485 [debug] [              hdlc] {        hdlc}: rx: (6/6): 00181d020000071ac97e
2018-07-23 18:28:10.485 [debug] [              dlms] {        dlms}: extracted server max pdu size is 512
2018-07-23 18:28:10.485 [debug] [              dlms] {        dlms}: Action 0-0:40.0.0*255 ic 15 methodId 1 actionLen: 18 B
2018-07-23 18:28:10.542 [debug] [              hdlc] {        hdlc}: tx: (1/3): 7ea02b0361328debe6e600c30181000f
2018-07-23 18:28:10.542 [debug] [              hdlc] {        hdlc}: tx: (2/3): 0000280000ff01010910622fe6353a03
2018-07-23 18:28:10.542 [debug] [              hdlc] {        hdlc}: tx: (3/3): 0d108533c88b7c6e11ec80737e
2018-07-23 18:28:10.644 [debug] [              hdlc] {        hdlc}: rx: (1/3): 7ea02461035262dce6e700c701c10001
2018-07-23 18:28:10.644 [debug] [              hdlc] {        hdlc}: rx: (2/3): 00091042988aa97db5d10cad9ec17583
2018-07-23 18:28:10.644 [debug] [              hdlc] {        hdlc}: rx: (3/3): e4338a121c7e
2018-07-23 18:28:10.645 [debug] [              dlms] {        dlms}: COSEM AA with HLS setup is accepted
2018-07-23 18:28:10.645 [debug] [meter/configuration] {      device}: RateCalendar check ok, configuring it...
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: Set RateCalendar request (state 2).
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: *** Send day table ***
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: day 0, switch point 0, tariff (1)
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: day 0, switch point 1, tariff (2)
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: day 0, switch point 2, tariff (3)
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: day 1, switch point 0, tariff (1)
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: day 1, switch point 1, tariff (2)
2018-07-23 18:28:10.645 [debug] [      config/calnd] {      device}: day 1, switch point 2, tariff (3)
2018-07-23 18:28:10.645 [debug] [              dlms] {      device}: Set 0-0:13.0.0*255 ic 20 attr 9 valueLen 128 B
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (1/10): 7ea09903615457b5e6e600c101810014
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (2/10): 00000d0000ff09000102020211000103
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (3/10): 0203090400000019090600000a0064ff
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (4/10): 1200010203090409000019090600000a
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (5/10): 0064ff120002020309040f0000190906
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (6/10): 00000a0064ff12000302021101010302
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (7/10): 03090400000019090600000a0064ff12
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (8/10): 00010203090409000019090600000a00
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (9/10): 64ff120002020309040f000019090600
2018-07-23 18:28:10.702 [debug] [              hdlc] {        hdlc}: tx: (10/10): 000a0064ff12000361927e
2018-07-23 18:28:10.916 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea01061037448a6e6e700c501810036
2018-07-23 18:28:10.916 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-07-23 18:28:10.916 [debug] [      config/calnd] {      device}: Set RateCalendar request (state 3).
2018-07-23 18:28:10.916 [debug] [      config/calnd] {      device}: *** Send week table ***
2018-07-23 18:28:10.916 [debug] [              dlms] {      device}: Set 0-0:13.0.0*255 ic 20 attr 8 valueLen 21 B
2018-07-23 18:28:10.972 [debug] [              hdlc] {        hdlc}: tx: (1/3): 7ea02e036176fa81e6e600c101810014
2018-07-23 18:28:10.972 [debug] [              hdlc] {        hdlc}: tx: (2/3): 00000d0000ff08000101020809010011
2018-07-23 18:28:10.972 [debug] [              hdlc] {        hdlc}: tx: (3/3): 01110111011101110111011101bb427e
2018-07-23 18:28:11.059 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103965462e6e700c501810036
2018-07-23 18:28:11.059 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-07-23 18:28:11.060 [debug] [      config/calnd] {      device}: Set RateCalendar request (state 4).
2018-07-23 18:28:11.060 [debug] [      config/calnd] {      device}: *** Send season table ***
2018-07-23 18:28:11.060 [debug] [              dlms] {      device}: Set 0-0:13.0.0*255 ic 20 attr 7 valueLen 12 B
2018-07-23 18:28:11.117 [debug] [              hdlc] {        hdlc}: tx: (1/3): 7ea0250361989f4fe6e600c101810014
2018-07-23 18:28:11.117 [debug] [              hdlc] {        hdlc}: tx: (2/3): 00000d0000ff07000101020309000001
2018-07-23 18:28:11.117 [debug] [              hdlc] {        hdlc}: tx: (3/3): 0c09010052747e
2018-07-23 18:28:11.187 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0106103b828aae6e700c501810036
2018-07-23 18:28:11.187 [debug] [              hdlc] {        hdlc}: rx: (2/2): cf7e
2018-07-23 18:28:11.188 [debug] [      config/calnd] {      device}: Set RateCalendar request (state 5).
2018-07-23 18:28:11.188 [debug] [              dlms] {      device}: Action 0-0:13.0.0*255 ic 20 methodId 1 actionLen: 2 B
2018-07-23 18:28:11.244 [debug] [              hdlc] {        hdlc}: tx: (1/2): 7ea01b0361ba3fafe6e600c301810014
2018-07-23 18:28:11.245 [debug] [              hdlc] {        hdlc}: tx: (2/2): 00000d0000ff01010f00e73a7e
2018-07-23 18:28:11.890 [debug] [              hdlc] {        hdlc}: rx: (1/2): 7ea0116103da87f6e6e700c701c10000
2018-07-23 18:28:11.890 [debug] [              hdlc] {        hdlc}: rx: (2/2): fcb47e
2018-07-23 18:28:11.890 [debug] [      config/calnd] {      device}: Set RateCalendar request (state 1).
2018-07-23 18:28:11.890 [debug] [      config/calnd] {      device}: *** CleanUp  ***
2018-07-23 18:28:11.942 [debug] [              dlms] {      device}: Disconnect HDLC link
2018-07-23 18:28:11.947 [debug] [              hdlc] {        hdlc}: tx: (1/1): 7ea00703615365817e
2018-07-23 18:28:11.985 [debug] [              hdlc] {        hdlc}: rx: (1/1): 7ea00761037377467e
2018-07-23 18:28:11.986 [debug] [              hdlc] {        hdlc}: HDLC link disconnected
2018-07-23 18:28:11.986 [debug] [       meterConfig] {      device}: MeterConfiguration result: failure

--------------------------------------------


{
    "jobName" : "CalendarJob61",
    "meterGroup" : "StevesGroup",
    "jobType" : "METER_COMMAND_SET",
    "jobConfiguration" : {
        "name" : "updCalendar",
        "commands" : [{
            "type" : "TARIFF_CALENDAR",
            "activationTime": "2018-07-10T18:35:00+0530",
            "seasons": [
                {
                    "start": {
                        "dayOfMonth": 1,
                        "month": 1
                    },
                    "week": 0
                }
            ],
            "weeks": [
                {
                    "days": [ 1, 1, 1, 1, 1, 1, 1 ]
                }
            ],
            "days": [
                {
                    "schedule": [
                        {
                            "time": "00:00",
                            "zone": 1
                        },
                        {
                            "time": "09:00",
                            "zone": 2
                        },
                        {
                            "time": "15:00",
                            "zone": 3
                        }
                    ]
                },
                {
                    "schedule": [
                        {
                            "time": "00:00",
                            "zone": 1
                        },
                        {
                            "time": "09:00",
                            "zone": 2
                        },
                        {
                            "time": "15:00",
                            "zone": 3
                        }
                    ]
                }
            ]
        }]
    }
}

{
  "instruction": "startNow"
}


---------------------------------------------

billing period reset

curl -v -X POST http://localhost:8882/ws/meterJob -H 'Cache-Control: no-cache' -H 'Content-Type: application/json' -d '{"jobName":"bp1","meterGroup":"StevesGroup","jobType":"METER_COMMAND_SET","jobConfiguration":{"name":"bp1","scheduledTime":"2018-07-20T14:57:00.000","timeoutTime":"2018-07-20T14:59:00.000","commands":[{"type":"BILLING_PERIOD","activationTime":"2018-07-20T15:02:00+0530","date":{"dayOfMonth":15}}]}}'


curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{ "instruction": "startNow" } ' 'http://localhost:8880/ws/manageMeterJob/bp1'



-------------------------------------------------

radio_rail.c::transmitframe()
CCA still needs to work, so can't mute receiver during that time.

Reimplement CCA/LBT for RAIL:
- Currently uses one API call (RAIL_TxStart) to transmit the packet and perform the LBT.
- We need to split into two (Listen, wait for LBT period, transmit if rx level below threshold).
- May be able to use CC1200 implementation.


---------------------------

26/07/2018 14:58:35Method object 0.0.13.0.0.255, interface ActivityCalendar
<-  14:58:35 7E A0 1B 03 61 BA 3F AF E6 E6 00 C3 01 C1 00 14 00 00 0D 00 00 FF 01 01 0F 00 B6 59 7E
26/07/2018 14:58:35->   14:58:35 7E A0 11 61 03 DA 87 F6 E6 E7 00 C7 01 C1 00 00 FC B4 7E


-------------------------------------------------------------

activationTime write:

7EA0270361769978E6E600C101C1001400000D0000FF0A00090C07E2071A04162B10FFFFC4806D377E


-------------------------------------------------------------------

learning points.
Points to improve on:
- reduce reliance on a single test setup (omnireltest), ideally locally server-containers with local meter?
- Leave omnireltest for final manual testing
- use ethernet from gateway, not cellular, more deterministic.
- devs need to be able to run same setup locally to preempt failures.
- need easier way to upgrade/downgrade individual subsystems (containers again).
- need negative testing.
- need to debug omnireltest network, not performing well.
- need to redo omnireltest setup. we lost the keys/certs and now cant add new nodes or upgrade easily other than via OTA.


--------------------------------------------------------

Codebase improvements:

- weak linking for variant default code to avoid having to create defaults for all other variants.
- standard state machine structure throughout.
- removal of ADDON mechanism. dynamic addon mechanism not needed. all code will always be statically linked.
- driver interface should not be overloaded for application-specific code (i.e. metering).
- removal of "ifdef LNT" for more generic, non-specific code.
- naming e.g. activateSampleComplexProfiles().... actually the periodicProfileSampling().
- removal of complex/simple concept.
- removal of Panmesh support.
- Too many callbacks! can't follow code!

-------------------------------------------------------

Genus meter problems:
- Max-demand reset. Works ok, one-for-all, not individually controllable.
- calendar issues. Limited but seemingly functional. Need to check activation-time.
- Meter-upgrade 'image-identifier' is should be identifier of new image, not running image.



--------------------------------------------------------------

# Use socat to forward
# IPv4 TCP on port 4059 on this machine to
# IPv6 UDP on the agent node with the IPv6 address 2001:9b0:192:1005:4000::1
# running the dlmspipe on port 4059.
socat -ls -v -v -v tcp-listen:4059,reuseaddr,fork 'udp6:[2001:9b0:192:1005:4000::1]:4059'





--------------------------------------------

Fuzz tests with Aaron:
- unstructured ping
- "Big UDP" failure test.
- 10 hrs fuzz-mac test with DEBUG level info.


--------------------------------------------------


need a ~/.flexlmrc containing:
ARMLMD_LICENSE_FILE=8224@flexlm.se.cyco.io
or 8224@10.0.8.17 (if you run into IPv6 routing issues)

build SMIP & scimitar:

- make smip smip_ctrlporthub
- git clone ssh://stevetickle@gerrit.se.cyco.io:29418/scimitar_ch
- git checkout origin/connode_fixups
- #then copy over the header file:
- rsync -av --delete --exclude Makefile src/connode/ scimitar_ch/CommsHubFramework/3rdParty/Connode/c4_bin-smip_lg/include/connode/
- make -j2 -C scimitar_ch/CommsHubFramework TARGET=telit_apz OSTYPE=cygwin ARMLMD_LICENSE_FILE= ARMROOT= C4LIB=../../build/smip_ctrlporthub/release/libc4.a
- # to enable debug:
- change "C4_logSetLevel(cnd_LogLevelInfo);" to "C4_logSetLevel(cnd_LogLevelDebug);" in C4_task.c
- make -j2 -C scimitar_ch/CommsHubFramework TARGET=telit_apz OSTYPE=cygwin ARMLMD_LICENSE_FILE= ARMROOT= C4LIB=../../build/smip_ctrlporthub/release/libc4.a


binary in:
scimitar_ch/CommsHubFramework/bin/target/telit_apz/m2mapz.bin



====================================

provisioning IPA3b:

./tools/gdb/flash-ipa3.sh a.elf b.elf
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key 00-1B-C5-0C-60-03-B3-6C/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert 00-1B-C5-0C-60-03-B3-6C/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert 00-1B-C5-0C-60-03-B3-6C/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key 00-1B-C5-0C-60-03-B3-6C/mac_keys.txt
Done.

./tools/gdb/flash-ipa3.sh a.elf b.elf
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key 00-1B-C5-0C-60-03-B3-6D/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert 00-1B-C5-0C-60-03-B3-6D/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert 00-1B-C5-0C-60-03-B3-6D/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key 00-1B-C5-0C-60-03-B3-6D/mac_keys.txt
Done.

./tools/gdb/flash-ipa3.sh a.elf b.elf
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key 00-1B-C5-0C-60-03-B3-6E/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert 00-1B-C5-0C-60-03-B3-6E/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert 00-1B-C5-0C-60-03-B3-6E/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key 00-1B-C5-0C-60-03-B3-6E/mac_keys.txt
Done.

./tools/gdb/flash-ipa3.sh a.elf b.elf
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key 00-1B-C5-0C-60-03-B3-6F/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert 00-1B-C5-0C-60-03-B3-6F/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert 00-1B-C5-0C-60-03-B3-6F/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key 00-1B-C5-0C-60-03-B3-6F/mac_keys.txt
Done.

./tools/gdb/flash-ipa3.sh a.elf b.elf
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key 00-1B-C5-0C-60-03-B3-70/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert 00-1B-C5-0C-60-03-B3-70/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert 00-1B-C5-0C-60-03-B3-70/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key 00-1B-C5-0C-60-03-B3-70/mac_keys.txt
Done.

00-1B-C5-0C-60-03-B3-6C/config
00-1B-C5-0C-60-03-B3-6C/mac_keys.txt
00-1B-C5-0C-60-03-B3-6C/node.crt.der
00-1B-C5-0C-60-03-B3-6C/mac_key
00-1B-C5-0C-60-03-B3-6C/ca.crt.der
00-1B-C5-0C-60-03-B3-6C/node.key.der

-------------------------------------------------------------------------

protoc decode.

echo '0a036d616312110a0a6b65794368616e67656410011a010312110a0a756e6b6e6f776e4b657910021a0101' | xxd -p -r | protoc -I /home/aarons/terminal/interface/proto --decode=EventsMetadataModuleMessage /home/aarons/terminal/interface/proto/events.proto

-------------------------------------------------

Profile TransactionEventLog: Start time: 2018-08-12 05:39:01
Profile TransactionEventLog: Stop time: 2018-08-12 05:40:46

Profile TransactionEventLog: Start time: 2018-08-11 05:40:46
Profile TransactionEventLog: Stop time: 2018-08-12 05:39:59

Profile TransactionEventLog: Start time: 2018-08-12 05:39:01
Profile TransactionEventLog: Stop time: 2018-08-12 05:40:46


------------------------------------

RAM usage, memory usage.

CONFIG_MEMORY_TRACK_FILE
CONFIG_MEMSTATS
MEMSTATS_NUM_TASKS=1024

then use coap_request to get stats per task.

--memstats-info       Get information about memstats
--memstats-log        Request to log memstats info
--memstats TYPE       Request memstats for global, task or file


------------------------------------------------------


Run server:

sudo ip -6 add add fd00::1 dev enp0s8


Run agent:

./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -listen 4242 -loglevel debug

gdb --args ./build/host-genus-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.hls_key=756776636c686c737567313836616263 \
                                        -param device.time.sync_timer=1 \
                                        -param server.ip=2a03:a000:5:192:5dc0:2bda:b0bc:59c9  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -param server.mq.push_now=1 \
                                        -param server.mq.push_delay=30 \
                                        -rootcert /Data/Temp/KeyTest/root.crt.der  \
                                        -cert /Data/Temp/KeyTest/node.crt.der  \
                                        -key /Data/Temp/KeyTest/node.key.der  \
                                        -mackey /Data/Temp/KeyTest/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket

gdb --args ./build/host-genus-insecure/bin/agent -eui64 00-00-00-00-00-00-00-02  \
                                        -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
                                        -initrtc  \
                                        -ctrlhub 127.0.0.1  \
                                        -ctrlhubport 4242  \
                                        -loglevel debug  \
                                        -param device.dlms.lls_password=1A2B3C4D  \
                                        -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
                                        -param device.dlms.hls_key=756776636c686c737567313836616263 \
                                        -param device.time.sync_timer=1 \
                                        -param server.ip=2a03:a000:5:192:5dc0:2bda:b0bc:59c9  \
                                        -param modem.tun6.ip=localhost \
                                        -param modem.tun6.secret=whatsfordinner   \
                                        -param modem.apn=4g.tele2.se  \
                                        -param server.mq.push_now=1 \
                                        -param server.mq.push_delay=30 \
                                        -rootcert /Data/Temp/KeyTest2/root.crt.der  \
                                        -cert /Data/Temp/KeyTest2/node.crt.der  \
                                        -key /Data/Temp/KeyTest2/node.key.der  \
                                        -mackey /Data/Temp/KeyTest2/mac-keys.txt  \
                                        -gateway  \
                                        -statedir AgentState \
                                        -socket


gdb --args ./build/host-genus-insecure/bin/agent \
 -eui64 00-00-00-00-00-00-00-02  \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
 -initrtc  \
 -ctrlhubport 4242  \
 -loglevel debug  \
 -param device.dlms.lls_password=1A2B3C4D  \
 -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.hls_key=756776636c686c737567313836616263 \
 -param device.time.sync_timer=1 \
 -param server.ip=fd00::1  \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner \
 -param modem.apn=127.0.0.1  \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -rootcert /Data/Temp/KeyTest/root.crt.der  \
 -cert /Data/Temp/KeyTest/node.crt.der  \
 -key /Data/Temp/KeyTest/node.key.der  \
 -mackey /Data/Temp/KeyTest/mac-keys.txt  \
 -gateway  \
 -statedir AgentState \
 -ctrlhub 127.0.0.1 \
 -socket



----------------------------------------


client:
socat -ddd -x tcp:meterpi1:55006 pty,link=${HOME}/dev/S2,rawer

------------------------------------------

force ipv4

apt-get -o Acquire::ForceIPv4=true update

---------------------------------------------

Crash:

- Immediately prior to the crash, storeConfig() is running, causing a pb_encode of a dp_config into a file.
flashopProgram 564:0x32 1 B
flashopProgram 564:0x33 2 B
flashopProgram 564:0x35 1 B
 flashopProgram 564:0x36 1 B
 flashopProgram 564:0x37 11 B       - deviceId?
 flashopProgram 564:0x42 1 B
 flashopProgram 564:0x43 1 B
 flashopProgram 564:0x44 1 B
 flashopProgram 564:0x45 1 B
 flashopProgram 564:0x46 6 B        - OBIS?
 flashopProgram 564:0x4c 1 B
 flashopProgram 564:0x4d 5 B
 flashopProgram 564:0x52 1 B
 flashopProgram 564:0x53 1 B
 flashopProgram 564:0x54 1 B
 flashopProgram 564:0x55 1 B
 flashopProgram 564:0x56 6 B        - OBIS?
 flashopProgram 564:0x5c 1 B
 flashopProgram 564:0x5d 1 B
 flashopProgram 564:0x5e 12 B       - timestamp?
 flashopProgram 564:0x6a 1 B
 flashopProgram 564:0x6b 1 B
 flashopProgram 564:0x6c 1 B
 flashopProgram 564:0x6d 1 B
 flashopProgram 564:0x6e 6 B        - OBIS?
 flashopProgram 564:0x74 1 B
 flashopProgram 564:0x75 1 B
 flashopProgram 564:0x76 12 B       - timestamp?
 flashopProgram 564:0x82 1 B
 flashopProgram 564:0x83 1 B
 flashopProgram 564:0x84 1 B
 flashopProgram 564:0x85 1 B
 flashopProgram 564:0x86 6 B        - OBIS?
flashopProgram 564:0x8c 1 B
flashopProgram 564:0x8d 1 B
flashopProgram 564:0x8e 12 B        - timestamp?
flashopProgram 564:0x9a 1 B
flashopProgram 564:0x9b 1 B
flashopProgram 564:0x9c 1 B
flashopProgram 564:0x9d 1 B
flashopProgram 564:0x9e 6 B         - OBIS?
- always seems to write 114 or 110 bytes prior to the crash.

- One case of no interference by filedl activity, all others are interfered.

- Also we have a file download occurring with regular filedlWriteFileBlock() being called, sometimes
immediately prior to the storeConfig call. This call seems to be blocked on a file operation while the
storeConfig completes.

- nanopb is thread-safe, call into fsWrite is also mutexed.

--------------------------------------------------

meter config should possibly have a capabilities set of flags.


-------------------------------------------

radio packet test:
./tools/c4-tools/coap_request.py --ctrlporthub :4001 --radio-send --radio-test-count 10 --radio-test-size 32

-------------------------------------------

CoAP blockwise issue (JJ found issue)

coap_task.c


-------------------------------------

radio PER test (packet error rate):
./tools/c4-tools/coap_request.py --radio-test-id 7 --radio-send --radio-test-iid 02-1b-c5-0c-60-00-bc-2e --radio-test-power 54


--------------------------------------

c4tools
https://jenkins.se.cyco.io/job/Terminal_release/lastSuccessfulBuild/artifact/build/tools/release/


-------------------------------------------

mesh ping

./tools/c4-tools/coap_request.py --ctrlporthub :4001 --radio-send --radio-test-count 10 --radio-test-size 32 --radio-test-iid 02-1b-c5-0c-60-00-bc-2e

--------------------------------------


Version generation:

./tools/buildsys/scripts/get_git_version.sh
GIT_VERSION := $(shell $(BUILDSYS_ROOT)/scripts/get_git_version.sh)


--------------------------------------------------

Jason Webb [2:21 PM]
to verify certs:
1. convert der to pem: openssl x509 -in <path/to/crt.der> -inform der -outform pem <path/to/.pem>
2. convert both root.crt and node.crt to separate .pem
3. verify node to root cert: openssl verify -CAfile root.pem node.pem



-------------------------------------

+++ b/src/device/drivers/dlms/device-dlms.c
@@ -4585,6 +4585,14 @@ static void deviceStart(void)
     registerParamsRestrictCheckCB(dlmsVariantParamIsRestrictedCb);
     macReceiveSetRSSICallback(dlmsVariantUpdateRSSIFromSource);

+#if 1
+    {
+        IPadr adr = {.x = {0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x01} };
+        macSetRSSISourceAddress(&adr, false);
+    }
+
+#endif
+
     OS_taskCreateStatic(deviceTask, "device",
               s_deviceStack, ARRAY_SIZE(s_deviceStack),
               NULL, DEFAULT_PRIORITY, &s_deviceTask);


--------------------------------------------------------------

HDLC/DLMS stack improvements
- Priority queue for device-dlms.
- Give hdlc.c a proper queue rather than s_responseBuffer and s_sendPayload.
- Make HDLC delimit packets correctly.

-----------------------------

tx: (1/1): 7e
tx: (1/1): a02003419328bc
fcs=470f fcs2=470f

(gdb) p segmentLen
$3 = 23
(gdb) x/23bx payloadSegment
0x7fffd8000a70: 0x81    0x80    0x14    0x05    0x02    0x01    0x5e    0x06
0x7fffd8000a78: 0x02    0x01    0x5e    0x07    0x04    0x00    0x00    0x00
0x7fffd8000a80: 0x01    0x08    0x04    0x00    0x00    0x00    0x01
(gdb) p/x fcs
$4 = 0x470f
(gdb)

(gdb) p/x fcs
$5 = 0x956e


--------------------------------------------------


bad 2nd:
7e
a041
03
41
10
e48f
e6e600
6036a1090607608574050801018a0207
808b0760857405080201ac0a80083141
324233433444be10040e01000000065f
1f0400001f1fffff
dd04
7e



good 2nd msg:

7e
a044
03
41
10
b3e1
e6e600
6036a109060760857405080101
8a0207808b0760857405080201ac0a80
083141324233433444be10040e010000
00065f1f0400001f1fffff
dd04
7e


good 1stmessage:
tx: (1/1): 7e
tx: (1/1): a020 03 41 93 28bc
tx: (1/2): 8180140502015e0602015e0704000000
tx: (2/2): 01080400000001
fcs=51af
tx: (1/1): 51
tx: (1/1): af
tx: (1/1): 7e


--------------------------------


==1192==ERROR: AddressSanitizer: heap-use-after-free on address 0x606000023fe0 at pc 0x7ffff6ee1720 bp 0x7ffff3afeab0 sp 0x7ffff3afe258
READ of size 15 at 0x606000023fe0 thread T1
    #0 0x7ffff6ee171f in memcmp (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x7771f)
    #1 0x402fcd in linkSetup src/device/communication/hdlc/test-linux/test_hdlc.c:85
    #2 0x404572 in testLinkConnect src/device/communication/hdlc/test-linux/test_hdlc.c:377
    #3 0x5b17f9 in runTestCase src/base/test-linux/test/tester.c:509
    #4 0x5b2043 in runTestSuite src/base/test-linux/test/tester.c:612
    #5 0x5b28ec in runTestContext src/base/test-linux/test/tester.c:717
    #6 0x5b36a1 in runAllTests src/base/test-linux/test/tester.c:1006
    #7 0x408c65 in testTask src/device/communication/hdlc/test-linux/test_hdlc.c:1043
    #8 0x51e2f5 in taskWrapper src/platform/osal/osal-freertos/osal_freertos.c:89
    #9 0x51cf1e in prvWaitForStart src/platform/freertos/freertos_port-linux/freertos_port/port.c:135
    #10 0x7ffff6c546b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)
    #11 0x7ffff698a41c in clone (/lib/x86_64-linux-gnu/libc.so.6+0x10741c)



-----------------------------------

AddressSanitiser:

gdb breakpoint:

b __asan_report_error


------------------------------------------

Get configuration:

./omnisma-demo.py --sma_ws http://localhost:8880/ws -m G102030 --config-get data/get-all-active.json

------------------------------------------------

Crypto alg used:

DTLS -
// turn on EC support
wolfSSL_CTX_UseSupportedCurve(s_ctx, WOLFSSL_ECC_SECP256R1); (SECP256R1 curve as is the suggested SSL default)
// turn on trusted_ca_keys extension support
wolfSSL_CTX_UseTrustedCaKeys(s_ctx);

// limit the list of supported suites
wolfSSL_CTX_set_cipher_list(s_ctx, TLS_CIPHER_SUITE);

wolfSSL_CTX_load_verify_buffer(ctx, buffer, keyLen, SSL_FILETYPE_ASN1);

// CSR creation.
wc_Sha256Hash

The generic CSR format is defined in RFC2986 and is also known as PKCS #10.
The public key part of the CSR is defined in RFC5480, updating RFC3279 that
together with RFC5754/5758 describes the ECDSAwSHA256 signature used.


MAC security -
macSecurityEncryptFrame()
// Encode nonce as per IEEE 802.15.4 section 7.3.2

// We don't implement MIC only modes. wolfSSL's CCM can't do this,
// because it always encrypts the MIC. And it's somewhat pointless: the
// overhead for encryption is small (0 bytes, but additional AES rounds)


/// AES-128 key in bytes
#define KEY_SIZE 16
#define nonceSize 13
wc_AesCcmEncrypt(&s_aesTx, out, in, payloadSize, nonce, nonceSize, authTag, authTagSize, mhr, mhrSize);




file distribution -

filedlDecryptAndCheckMd5()

mode = EncryptionAes128Ctr.
aesSetKey(aes, key, keylen, iv, AES_ENCRYPTION);
aesCtrEncrypt(aes, cleartextbuffer, (const uint8_t*)buffer, readlen);
md5Update(md5, cleartextbuffer, readlen); (integrity check).

fw image encryption:

parseFirmwareHeader()
AES
SHA signature.



--------------------------------------

HMP

got: "{6050302} 2 3 5 6"
should be: "Wpower lost"

traceDumper() has a:
LOG(info->logLevel, "%u+%u %s:%d %s {%s} %s %d %d",
        entry->time, entry->time - info->timeOfFirst,
        strFileTitle(entry->file), entry->line, entry->func,
        entry->task, entry->str != NULL ? entry->str : "",
        entry->n1, entry->n2);

which contains the key format: "{%s} %s %d %d".

--------------------------------------------------------

macTx() packet from { .x = { 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01 } } to
{ .x = { 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02 } } works correctly and is acked.

packet is dropped as being invalid due to no content tho... as expected.

s_customRouting()

transportRegisterUdpReceiveCB(udpRxCb);


coapCreateSession();

coap_task::processReceivedUdpPacket()

coapTaskReceive();

communicationLayerStart() registers listener for UDP packets on CoAP port.

mqcoap.c:
const CoapSendRequestParams params = {
        CoapMethodPost, "mq", coapCB, (void*)(long)encodeData.end,
        CoapContentTypeExperimentalProtobuf,
        bbGet(bb), streamOut.bytes_written
};

rc = coapSendRequest(&params, NULL);

/**
 * Request Reference time from the server
 */
static ResultCode requestReferenceTime(void)
{
    uint32_t uptime = timeGetUptimeMsec();

    const CoapSendRequestParams params = {
            CoapMethodGet, "time",
            requestReferenceTimeCb, (void *)(intptr_t)uptime,
            .maxAttempts = 1
    };

    return coapSendRequest(&params, NULL);
}

requestReferenceTimeCb

----------------------------------------------------------------

0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00   ,0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02

./tools/c4-tools/coap_request.py --hh-get fe800000000000000200000000000002 time

./tools/c4-tools/coap_request.py --hh-discover resetList=true


fe800000000000000200000000000001


------------------------


processSendResponseMsg

coapGetSessionById



--------------------------------------------------------

OpenOCD:


- tar zxvf openocd_JN.tgz
- cd openocd.JN
- sudo apt-get install libtool-bin automake cmake gdb-arm-none-eabi libusb-1.0-0-dev
- ./bootstrap
- ./configure
- make


ST-link
- git clone https://github.com/texane/stlink
- cd stlink
- make
- cd Build/Release
- sudo make install
- sudo ldconfig


--------------------------------------------------

WolfSSL version 3.13.0
(WolfSSL 3.14.0 upgrade was reverted as it broke our patch).

List of algorithms:
- (DTLS 1.2) ECDHE-ECDSA-AES128-CCM-8
- AES-128-CCM




---------------------------------

building SMIP / smip

- sudo git clean -xfd
- Don't use docker buildenv, 'make smip' only.

ubuntu@ubuntu-VirtualBox:/Data/Projects/terminal$ ag wc_ /home/ubuntu/libc4_symbols_nodebug
4567:0000058d t wc_AesDecrypt
4568:00000055 t wc_AesEncrypt
4569:00000a2b t wc_AesSetKeyLocal
4570:00002eef t wc_BuildEccKeyDer
4571:000015a7 t wc_ecc_alloc_rs
4572:0000105b t wc_ecc_cmp_param
4573:00002a5d t _wc_ecc_curve_free
4574:0000006f t wc_ecc_curve_load
4575:00000001 t wc_ecc_curve_load_item
4576:0000254f t wc_ecc_export_raw
4577:000015d1 t wc_ecc_free_rs
4578:00002b6d t wc_ecc_gen_k
4579:00002849 t wc_ecc_import_raw_private
4580:00001387 t wc_ecc_make_pub_ex
4581:00002be1 t wc_ecc_reset
4582:00002ac5 t wc_ecc_shared_secret_gen_sync
4583:000004c1 t wc_RNG_HealthTestLocal


--------------------------------------------------

- taskc4_rndCB is exposed in our code as hwrngGetSeed(). It is used as a seed for our
internal random number generator. This RNG is used for general use and timing-related operations
such as for desynchronising messages, etc.
Also used by wolfssl via the CUSTOM_RAND_GENERATE macro during build for key generation, etc.








- Our 3pp/wolfssl/wolfssl_config.h has the following:
#define CUSTOM_RAND_GENERATE hwrngGetSeed

- 3pp/wolfssl/src/wolfcrypt/src/random.ci:626 uses CUSTOM_RAND_GENERATE in the following way:
ret = CUSTOM_RAND_GENERATE_BLOCK(output, sz);
which will be effectively
ret = hwrngGetSeed(output, sz);

- The prototype for hwrngGetSeed seems to be:
uint32_t hwrngGetSeed(void)
(src/platform/drivers/hwrng/hwrng-smip.c)

- Oooops.... We've a) failed to fill our buffer with random data. b) returned a random value as
the resultCode. c) the random data will be explicitly zeroed with the preceding XMEMSET which
is the worst possible key...
We should be (in the SMIP case) calling the 's_rndCB' directly as it has the same prototype.

- The above code is in wc_RNG_GenerateBlock() which is used for key/csr generatin for crypto
storage & DTLS sessions, IPSEC, etc.

Its ok... CUSTOM_RAND_GENERATE_BLOCK != CUSTOM_RAND_GENERATE

----------------------------------------------

wc_RNG_GenerateBlock results in many transactions to the vaultic RNG as a result of our misuse of
the provided RNG API. We're repeatedly calling a block-wise API to generate 32-bit values then
filling up a buffer using those 32-bit values.
Since the VaultIC device is an external device, it results in bus transactions for every 32-bit
value. This in itself will be slow, but will also be contending for access with other tasks (C4
and CH sides).


SendClientHello():
ret = wc_RNG_GenerateBlock(ssl->rng, output + idx, RAN_LEN);

Ultimately results in 8 consecutive calls to CRYPTOIF_Random for blocks of 32-bits each.

Each call will peform "ch_osal_mutex_lock(cryptoif_Lock, C_CH_OSAL_MUTEX_INFINITE, CH_OSAL_MUTEX_RECURSIVE)"

DIAGNOSTICS_Task is trying to get access to the crypto mutex and times out causing the reset.
DIAGNOSTICS_Task uses CRYPTO for:
- diagnostics_calculateHash()
- CRYPTOIF_RunTest().



-----------------------------------------------

supervisor_CreateTaskList()

supervisor_addTask(index, taskTfwName, TFW_Construct, 20, TASKID_TFWEnum);

supervisor_addTask(index, taskDiagName, DIAGNOSTICS_Construct, 12, TASKID_DiagnosticEnum);

supervisor_addTask(index, taskTestBenchName, TESTBENCH_Construct, 11, TASKID_TestBenchEnum);
supervisor_addTask(index, taskTestBenchGPFName, TBGPF_Construct, 11, TASKID_TestBenchGpfEnum);
supervisor_addTask(index, FwDownloadName, FWDOWNLOAD_Construct, 11, TASKID_FwDownloadEnum);
supervisor_addTask(index, taskCHFName, CHF_Construct, 11, TASKID_ChfEnum);
supervisor_addTask(index, taskHanMgrName, HANMGR_Construct, 11, TASKID_HanManagerEnum);
supervisor_addTask(index, taskDeviceName, DEVICE_Construct, 11, TASKID_DeviceEnum);
supervisor_addTask(index, taskGPFName, GPF_Construct, 11, TASKID_GpfEnum);
supervisor_addTask(index, taskHanInterface, HANInterface_Construct, 11, TASKID_HanInterfaceEnum);
supervisor_addTask(index, FwDownloadName, FWDOWNLOAD_Construct, 11, TASKID_FwDownloadEnum);

supervisor_addTask(index, taskSocketMgrName, SOCKETMGR_Construct, 10, TASKID_SocketMgrEnum);
supervisor_addTask(index, taskTimeName, TIME_Construct, 10, TASKID_TimeTaskEnum);
supervisor_addTask(index, taskC4Name, TASKC4_Construct, 10, TASKID_C4TerminalEnum);
supervisor_addTask(index, taskWanMgrName, WANMGR_Construct, 10, TASKID_WanManagerEnum);
supervisor_addTask(index, taskPPPName, PPP_Construct, 10, TASKID_PppMgrEnum);
supervisor_addTask(index, "C4TestTask", TASKC4TEST_Construct, 10, TASKID_Dummy_15Enum);
supervisor_addTask(index, taskTunnel, TUNNEL_Construct, 10, TASKID_TunnelEnum);

supervisor_addTask(index, taskPowerName, POWER_Construct, 9, TASKID_PowerEnum);
supervisor_addTask(index, taskEzspMgrName, EZSP_Construct, 9, TASKID_EzspManagerEnum);






---------------------------------------

/Data/Temp/8a-73-84-53-00-00-09-7c.log.20180914190003
[c:mac_rx          ]CH_osal_lock.c,1039:Task 'c:mac_rx' failed to lock 'c:termina', held by 'c:coap'
[c:coap            ]CH_osal_lock.c,1039:Task 'c:coap' failed to lock 'c:termina', held by 'c:mac_rx'
[c:schedule        ]CH_osal_lock.c,1039:Task 'c:schedule' failed to lock 'c:termina', held by 'c:mac_rx'
[c:rpl             ]CH_osal_lock.c,1039:Task 'c:rpl' failed to lock 'c:termina', held by 'c:coap'


--------------------------------------------------------------
to get the above, with the named/bookkeeping task names, use:
ch_osal_mutex_init_name()
ch_osal_mutex_init()    <---- OS_mutexCreate()
ch_osal_mutex_lock()    <--- OS_mutexTake()
ch_osal_mutex_unlock() <--- OS_mutexGive()

ch_osal_lock_cs_init()
ch_osal_lock_cs_lock()
ch_osal_lock_cs_unlock()

These don't set the task name:
ch_osal_lock_count_init()   <--- OS_semaphoreCreate()
ch_osal_lock_count_take()
ch_osal_lock_count_give()
ch_osal_lock_binary_init()  <--- OS_semaphoreCreateBinary()
ch_osal_lock_binary_unlock()
ch_osal_lock_mslock_init()  <--- OS_semaphoreCreateBinaryHiRes()
O

watchdog:
wdtFeed()


-----------------------------------------------------

uploading to SMIP CH:

./upload_smip.py -r /Data/Projects/terminal/scimitar_ch/CommsHubFramework/bin/target/telit_apz/m2mapz.bin -p /dev/serial/by-id/usb-Telit_6_CDC-ACM_004678058002915-if08
./upload_smip.py -p /dev/serial/by-id/usb-Telit_6_CDC-ACM_004678058002915-if08 --reboot

./tools/c4-tools/readport.py




-----------------------------------------

- KDF: ecHKDF_SHA256 (Not changed from WolfSSL default)


DER_KEY_SIZE=
wc_ecc_make_key
ecc_key type


- we use the WolfCrypt set of sources, not the OpenSSL set, headers should be taken from "\wolfssl". This
hopefully will mean that you can indeed just use the compiled library.

WolfSSL cipher suite: "ECDHE-ECDSA-AES128-CCM-8" using 128 and 256 bit keys.

- Block ciphers; only AES128.
- Block cipher modes; CCM only.
- Digital signatures; ECDSA-P256-SHA256.
- Key Derivation Functions; SHA256 (WolfSSL deafult).
- Key Management; Toshiba supplied CH API.
- Message Authentication; SHA256 (DTLS)
- Random Number Generation; Toshiba supplied CH API (using VaultIC RNG?)
- Secure Hashing; 256 bit SHA2 (SHA-256)
- Component Testing; No application-specific KDFs.





-----------------------------------------------------


aes_wolfssl.h:

// CCM mode
#define aesCcmSetKey wc_AesCcmSetKey        // ipsec, mac_security (RLL)
#define aesCcmEncrypt wc_AesCcmEncrypt      // ipsec, mac_security (RLL)
#define aesCcmDecrypt wc_AesCcmDecrypt      // ipsec, mac_security (RLL)

// CTR mode
#define aesSetKey wc_AesSetKey              // filedl encryption, fs_crypto
#define aesCtrEncrypt wc_AesCtrEncrypt      // filedl_storage.

// AES
#define aesEncryptBlock wc_AesEncryptDirect // dlms, "Secure Sprint-350 meter"
#define aesDecryptBlock wc_AesDecryptDirect // dlms

// GCM mode
#define aesGcmSetKey wc_AesGcmSetKey        // dlms.
#define aesGcmEncrypt wc_AesGcmEncrypt      // dlms.
#define aesGcmDecrypt wc_AesGcmDecrypt      // dlms.

// GMAC
#define GmacSetKey wc_GmacSetKey        // dlms.
#define GmacUpdate wc_GmacUpdate        // dlms.

https://www.wolfssl.com/docs/wolfssl-manual/ch4/




TLS_AUTHENTICATION "ECDHE-ECDSA"
TLS_ENCRYPTION "AES128-CCM-8".

This is combined via (another) macro into the "real" WolfSSL ciper-suite option:
wolfSSL_CTX_set_cipher_list("ECDHE-ECDSA-AES128-CCM-8");

TLS cipher suite: "ECDHE-ECDSA-AES128-CCM-8"


RFC-5758 3.2:
"ecdsa-with-SHA256 OBJECT IDENTIFIER ::= { iso(1) member-body(2)
        us(840) ansi-X9-62(10045) signatures(4) ecdsa-with-SHA2(3) 2 }"

above indicates ecdsa-with-SHA256 in encodeSignatureAlgorithm



-----------------------------------------------------------------------------------

./tools/gdb/flash-ipa3.sh a.elf b.elf
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-83/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-83/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-83/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-83/mac_keys.txt
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --config prod.lowpan.eui64 00-1B-C5-0C-60-00-01-83

./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-key /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-84/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key client-cert /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-84/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --load-key root-cert /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-84/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --rll-key /Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-84/mac_keys.txt
./tools/c4-tools/coap_request.py --ctrlporthub localhost:4000 --config prod.lowpan.eui64 00-1B-C5-0C-60-00-01-84

/Data/Temp/KeysAndCertsOmnireltest/00-1B-C5-0C-60-00-01-83/

----------------------------------------------------

Get meter time:

./tools/c4-tools/coap_request.py --device G102030  --device-op GET 8 0.0.1.0.0.255 2

--------------------------------------------------------------

New profile call stack:

Thread 16 "device" hit Breakpoint 1, mqCreateAtTime (type=type@entry=14, fields=0x4b9ba0 <MqDataProfileSample_fields>,
    msg=msg@entry=0x7fffdf7fddc0, time=1539015362, timeUncertain=true) at src/management/messagequeue/mq.c:15
15  {
(gdb) where
#0  mqCreateAtTime (type=type@entry=14, fields=0x4b9ba0 <MqDataProfileSample_fields>, msg=msg@entry=0x7fffdf7fddc0, time=1539015362,
    timeUncertain=true) at src/management/messagequeue/mq.c:15
#1  0x0000000000434ed3 in mqCreate (type=type@entry=14, fields=<optimised out>, msg=msg@entry=0x7fffdf7fddc0)
    at src/management/messagequeue/mq.c:64
#2  0x00000000004407ee in saveDataProfileSample (sample=0x7fffd8001220) at src/device/addons/dataprofile/dataprofile.c:557
#3  0x000000000044e441 in processComplexSampleByEntry (dataLen=<optimised out>, data=0x7fffd4000924 "\t\f\a\342\003\005\377\n\023")
    at src/device/drivers/dlms/device-dlms.c:3220
#4  processComplexSampleResponse (dataLen=<optimised out>, data=<optimised out>) at src/device/drivers/dlms/device-dlms.c:3344
#5  processDlmsPayload () at src/device/drivers/dlms/device-dlms.c:4088
#6  deviceTask (arg=<optimised out>) at src/device/drivers/dlms/device-dlms.c:4185
#7  0x000000000046b4f5 in taskWrapper (arg=0x6ed940 <s_deviceTask>) at src/platform/osal/osal-posix/osal_posix.c:134
#8  0x00007ffff79b96ba in start_thread (arg=0x7fffdf7fe700) at pthread_create.c:333
#9  0x00007ffff76ef41d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:109



----------------------------------------------------------

v98 (SMIP release).

commit 040d212621b050c399436dbee4f7fad6ee284f09
Merge: 894f17a 06609ef
Author: Jonas Norling <jonas.norling@cyanconnode.com>
Date:   Fri Jun 2 14:41:56 2017 +0200

    Merge "Set tag version in smip.dox"



-------------------------------------------------------

static bool generateNewKeyAndCsr(void)
{
    bool ret = false;
    wc_InitRng(&s_ctx->rng);
    wc_ecc_init(&s_ctx->keystruct);

    // The next step can take some 15 seconds and if unlucky that might trigger
    // the wd. Feed it before to ensure there is plenty of time to make the key.
    wdtFeed();

    if (wc_ecc_make_key(&s_ctx->rng, 32, &s_ctx->keystruct)) {
        goto out;
    }

    // As the previous step can take some time the watchdog will kick in before
    // the CSR creation is done. The next step also takes some 15-17 seconds
    // thus the whole time will exceed the typical ~30s watchdog.
    wdtFeed();

    s_ctx->csrLen = csrCreate(s_ctx->csr, &s_ctx->keystruct, &s_ctx->rng);
    if (!s_ctx->csrLen) {
        goto out;
    }
    csrEncodePrivateKey(s_ctx->key, &s_ctx->keystruct);

    ret = true;
out:
    wc_FreeRng(&s_ctx->rng);
    wc_ecc_free(&s_ctx->keystruct);

    return ret;
}


size_t encodeSignatureAlgorithm(uint8_t *der)
{
    size_t i = 0;

    /* signatureAlgorithm  */
    der[i++] = ASN1_SEQUENCE | ASN1_CONSTRUCTED;
    der[i++] = 10; /* Length */

    /*  algorithm */
    der[i++] = ASN1_OBJECT_IDENTIFIER;
    der[i++] = 8; /* Length */
    /* From RFC 5480, Appendix A. Also in RFC5754 3.3 and RFC5758 3.2.
     * ecdsa-with-SHA256 OBJECT IDENTIFIER ::= { iso(1) member-body(2)
     *   us(840) ansi-X9-62(10045) signatures(4) ecdsa-with-SHA2(3) 2 }
     */
    der[i++] = 1 * 40 + 2; /* Encode 1 and 2 */
    der[i++] = 0x80 | 840 / 128; /* Encode 840 */
    der[i++] = 840 % 128;
    der[i++] = 0x80 | 10045 / 128; /* Encode 10045 */
    der[i++] = 10045 % 128;
    der[i++] = 4;
    der[i++] = 3;
    der[i++] = 2;

    /* From RFC5758 section 3.2
     *    When the ecdsa-with-SHA224, ecdsa-with-SHA256, ecdsa-with-SHA384, or
     *    ecdsa-with-SHA512 algorithm identifier appears in the algorithm field
     *    as an AlgorithmIdentifier, the encoding MUST omit the parameters
     *    field.  That is, the AlgorithmIdentifier SHALL be a SEQUENCE of one
     *    component, the OID ecdsa-with-SHA224, ecdsa-with-SHA256, ecdsa-with-
     *    SHA384, or ecdsa-with-SHA512.
     * So skip parameters.
     */

    return i;
}


static size_t encodeCertificationRequestInfo(uint8_t *der, ecc_key *key)
{
    size_t i = 0;

    /* certificationRequestInfo */
    der[i++] = ASN1_SEQUENCE | ASN1_CONSTRUCTED;
    der[i++] = 98; /* Length */

    /*  version */
    der[i++] = ASN1_INTEGER;
    der[i++] = 1; /* Length */
    der[i++] = 0; /* v1, i.e. number 0 */

    /*  subject */
    der[i++] = ASN1_SEQUENCE | ASN1_CONSTRUCTED;
    der[i++] = 0; /* Length */

    /*  subjectPKInfo */
    der[i++] = ASN1_SEQUENCE | ASN1_CONSTRUCTED;
    der[i++] = 89; /* Length */

    /*   AlgorithmIdentifier */
    der[i++] = ASN1_SEQUENCE | ASN1_CONSTRUCTED;
    der[i++] = 19; /* Length */

    /*    algorithm */
    der[i++] = ASN1_OBJECT_IDENTIFIER;
    der[i++] = 7; /* Length */

    /* From RFC 5480, section 2.1.1
     * id-ecPublicKey OBJECT IDENTIFIER ::= {
     *   iso(1) member-body(2) us(840) ansi-X9-62(10045) keyType(2) 1 }
     */
    der[i++] = 1 * 40 + 2; /* Encode 1 and 2 */
    der[i++] = 0x80 | 840 / 128; /* Encode 840 */
    der[i++] = 840 % 128;
    der[i++] = 0x80 | 10045 / 128; /* Encode 10045 */
    der[i++] = 10045 % 128;
    der[i++] = 2;
    der[i++] = 1;

    /*    parameters (ECParameters) */
    i += encodeSecp256r1(der + i);

    /*    subjectPublicKey */
    i += encodePubKey(der + i, key);

    /*  attributes */
    der[i++] = ASN1_CONTEXT_SPECIFIC | ASN1_CONSTRUCTED | 0; /* tag 0 */
    der[i++] = 0; /* Length */

    ASSERT(i == 98 + 2);

    return i;
}



size_t csrCreate(uint8_t *der, ecc_key *key, WC_RNG *rng)
{
    size_t i = 0;

    /* Encode CertificationRequest */
    der[i++] = ASN1_SEQUENCE | ASN1_CONSTRUCTED;
    der[i++] = 0x80 | 0x01; /* Long form, one octet for length */
    der[i++] = 0; /* Length of CertificationRequest, To be filled in later */

    i += encodeCertificationRequestInfo(der + i, key);

    i += encodeSignatureAlgorithm(der + i);

    /*  signature */
    der[i++] = ASN1_BIT_STRING;
    der[i++] = 0; /* Length, to be filled in later */
    der[i++] = 0; /* Number of unused bits, when not multiple of 8 bits */

    uint8_t digest[SHA256_DIGEST_SIZE];
    /* Calculate the hash of certificationRequestInfo, length is header + body
     * of sequence create in encodeCertificationRequestInfo().
     */
    if (wc_Sha256Hash(der + 3, 2 + 98, digest)) {
        return 0;
    }

    // Sign the hash
    word32 signLen = DER_CSR_SIZE - i;
    if (wc_ecc_sign_hash((byte *)digest, sizeof(digest), der + i, &signLen,
                rng, key)) {
        return 0;
    }

    der[i - 2] = 1 + signLen; /* Encode length, include byte for unused bits */
    i += signLen;

    /* Set the length of CertificationRequest */
    der[2] = i - 3;

    ASSERT(i <= DER_CSR_SIZE);

    return i;
}


Key exchange in DTLS (Diffie-Helman):
TLSX_KeyShare_ProcessDh()
performs wc_DhAgree() to derive secret from private key and peers public key.



-----------------------------------------------------------



11/10/2018 14:34:41Invalid DLMS frame.

RX:
7E A8 89 03 61 7E 8E A2 6F 60 78 FE C4 C3 9E 44 45 EF 45 D0 5F BF D3 FD A3 BE BC 50 C7 E0 7F 7F BE 22 66 66 4B 5F BC 06 D3 D1 62 BA EA 18 79 57 95 71 03 D9 5B 10 F0 73 75 68 F7 AE F5 51 E2 60 30 26 70 3B EE 9D 72 F9 C1 83 BA AF 56 B1 23 E2 D5 55 61 79 D7 9E A0 EA 7C A6 27 AE 0E 3B 59 80 A5 89 58 2D 39 11 BF B6 67 81 9A B4 69 CF 89 0D D9 12 3C 9E 11 14 5E 08 EB D2 6C 27 16 46 03 7F 9D DF 99 AE 64 6E B7 35 B5 34 7E 7E A0 07 61 03 11 63 06 7E

14:34:41
<HDLC len="88" >
<TargetAddress Value="1" />
<SourceAddress Value="30" />
<FrameType Value="70" />
<NextFrame Value="AEA26F788E50DF8FC5E427FC2683325EE00F76B7D9790AA682697770B8A16EDE7203C233B69C8B0F76AB4E7F960D57451649CDC53C6ADD96EDA8AF8B3832407FD6499F48D264C64F99B7E1932784D23FD8E60A57143C3C23031CBA7564FB19DAEB726FD745E20C54BA2F10CCE0A4A83E68620A96711523EE8CA5FB5C0ACF1BC7" />
</HDLC>

14:34:41
<HDLC len="94" >
<TargetAddress Value="30" />
<SourceAddress Value="1" />
<FrameType Value="31" />
<Command Value="NextFrame" />
</HDLC>

14:34:41
<HDLC len="7E" >
<TargetAddress Value="1" />
<SourceAddress Value="30" />
<FrameType Value="72" />
<NextFrame Value="0551D22074E9E40C94A8D61002ECF8883AD82FAD716D6552EE69E4827080E6260F729FD7F8CAAF3D902F41E8151F1DD17375C12D2450448242B7FB7227C036E754520E36C45355E64882BECFF2BFACC2D2BDEB5D0CDD1FD5893D36D8F877B1C54F4B7FABE75A1E20D42F47C6F7405705CAA4357EC439" />
</HDLC>



11/10/2018 14:37:24Invalid DLMS frame.

RX:
7E A0 6B 03 61 10 2A FF E6 E6 00 60 5D A1 09 06 07 60 85 74 05 08 01 03 A6 0A 04 08 4C 54 43 4C 49 45 4E 54 8E 02 07 80 8B 07 60 85 74 05 08 02 02 AC 12 80 10 2D 1E 08 3D 47 1B 19 07 12 26 2D 6C 45 50 45 11 BE 23 04 21 21 1F 30 00 00 00 D2 D6 D1 F4 7C 91 8F F4 BD F1 65 A0 DD 14 E4 4E 2A 85 9C 19 A9 90 2D 65 7E 5F 03 FE 85 7E 7E A0 77 61 03 30 AD 6C E6 E7 00 61 69 A1 09 06 07 60 85 74 05 08 01 03 A2 03 02 01 00 A3 05 A1 03 02 01 0E A4 0A 04 08 4C 4E 54 30 31 31 38 30 88 02 07 80 89 07 60 85 74 05 08 02 02 AA 12 80 10 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 BE 23 04 21 28 1F 30 00 00 00 CD BB 68 67 B9 78 1D B5 50 AE B1 63 A5 44 74 4B 15 46 AB 4D F4 45 F5 F4 42 92 41 21 BB 7E

14:37:24
<HDLC len="3D" >
<TargetAddress Value="1" />
<SourceAddress Value="30" />
<FrameType Value="32" />
<PDU>
<glo_ActionRequest Value="30000000D32243FDF579485250F23F997F2D42868055FEDF53A30024112DC5815C3775E65F5360F12CBEB74657F3D0AF" />
</PDU>
</HDLC>

14:37:24
<HDLC len="3D" >
<TargetAddress Value="1" />
<SourceAddress Value="30" />
<FrameType Value="32" />
<PDU>
<glo_ActionRequest Value="30000000D32243FDF579485250F23F997F2D42868055FEDF53A30024112DC5815C3775E65F5360F12CBEB74657F3D0AF" />
</PDU>
</HDLC>

14:37:24
<HDLC len="36" >
<TargetAddress Value="30" />
<SourceAddress Value="1" />
<FrameType Value="52" />
<PDU>
<glo_ActionResponse Value="30000000CE47CDEBA5CC85E5F1F0D21C35AB429A290502DDB4EAFF218E6CCB50E9FBF136FE146505F0" />
</PDU>
</HDLC>
14:37:44 Send Keep Alive
TX:  7E A0 2C 03 61 54 9C BA E6 E6 00 C8 1E 30 00 00 00 D4 43 6A C7 EF 1E 55 70 19 57 89 CD 28 C9 E1 09 50 8A 31 E2 0A DF 80 0F 13 70 63 F1 7E
14:37:44
RX:  7E A0 2C 03 61 54 9C BA E6 E6 00 C8 1E 30 00 00 00 D4 43 6A C7 EF 1E 55 70 19 57 89 CD 28 C9 E1 09 50 8A 31 E2 0A DF 80 0F 13 70 63 F1 7E 7E A0 2B 61 03 74 AF 2A E6 E7 00 CC 1D 30 00 00 00 CF A3 BB 18 05 BE 19 3F B5 9D 70 C7 9E FD 79 40 6E 42 B8 AE A2 0F B5 89 B7 39 2A 7E
14:37:45 Writing object 0.0.13.0.0.255, interface ActivityCalendar
TX:  7E A8 89 03 61 76 C6 2E E6 E6 00 C9 82 01 EF 30 00 00 00 D5 37 02 F3 11 BA BF 3E 5A 9D 55 19 08 41 00 AD A5 D6 B8 BA FE 3E 8D 6A 52 04 D1 9F E9 83 76 20 24 BE 2F 17 FD 3A FA DA AF AE 8C 8A 3D DD 85 B5 36 CC 8D BD E8 34 35 3F A3 7B 0E 3A 14 D0 FB B6 38 4A 28 EF 9E A6 B3 F7 59 77 52 64 C9 A5 2A 60 D7 22 99 52 3E D1 5B EA D5 91 AE 7E 34 37 EB 20 B5 AB 44 65 BE B0 D6 DD CB 34 EB 43 55 EE F4 E3 1F 3B 57 24 39 98 A6 7E
14:37:46
RX:  7E A8 89 03 61 76 C6 2E E6 E6 00 C9 82 01 EF 38 00 00 00 D5 37 02 F3 11 BA BF 3E 5A 9D 55 19 08 41 00 AD A5 D6 B8 BA FE 3E 8D 6A 52 04 D1 9F E9 83 76 20 24 BE 2F 17 FD 3A FA DA AF AE 8C 8A 3D DD 85 B5 36 CC 8D BD E8 34 35 3F A3 7B 0E 3A 14 D0 FB B6 38 4A 28 EF 9E A6 B3 F7 59 77 52 64 C9 A5 2A 60 D7 22 99 52 3E D1 5B EA D5 91 AE 7E 34 37 EB 20 B5 AB 44 65 BE B0 D6 DD CB 34 EB 43 55 EE F4 E3 1F 3B 57 24 39 98 A6 7E 7E A0 07 61 03 91 6B 82 7E
14:37:46 Writing object 0.0.13.0.0.255, interface ActivityCalendar
TX:  7E A8 89 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 60 70 3B 03 22 88 1E AF 90 82 7A EC 40 2F DF 87 3F 7E EA FE FF B6 04 4A FB 79 29 E7 DE A4 B0 99 27 35 AE 24 E5 C6 5A D0 F7 6F A2 B6 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 62 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 93 C2 59 56 F6 35 13 99 54 E3 21 80 A4 1B 9E E7 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E
14:37:51 Data send failed. Try to resend 1/3 7E A8 89 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 60 70 3B 03 22 88 1E AF 90 82 7A EC 42 2F DF 87 3F 7E EA FE FF B6 04 4A FB 79 29 E7 DE A4 B0 99 27 35 AE 24 E5 C6 5A D0 F7 6F A2 B6 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 72 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 32 B8 56 95 5F D3 A2 33 55 BC 48 60 D2 23 76 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 7E A0 07 61 03 B1 69 A3 7E
14:37:56 Data send failed. Try to resend 2/3 7E A8 89 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 60 70 3B 03 22 88 1E AF 90 82 7A EC 42 2F DF 87 3F 7E EA FE FF B6 04 4A FB 79 29 E7 DE A4 B0 99 27 35 AE 24 E5 C6 5A D0 F7 6F A2 B6 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 72 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 32 B8 56 95 5F D3 A2 33 55 BC 48 60 D2 23 76 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 7E A0 07 61 03 B1 69 A3 7E 7E A8 A9 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 70 70 3B 03 22 89 1E AF D0 82 7A EC 40 2F DF 87 3F 7E EA FE FF B6 04 4A FB 79 29 E7 DE A4 B0 99 27 35 AE 24 E5 C6 5A D4 F7 6F A2 B6 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 62 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 93 C2 59 56 F6 35 13 99 54 E3 21 80 A4 1B 9E EF 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 7E A0 07 61 03 B1 69 A3 7E
14:37:56
RX:  7E A8 89 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 60 70 3B 03 22 88 1E AF 90 82 7A EC 42 2F DF 87 3F 7E EA FE FF B6 04 4A FB 79 29 E7 DE A4 B0 99 27 35 AE 24 E5 C6 5A D0 F7 6F A2 B6 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 72 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 32 B8 56 95 5F D3 A2 33 55 BC 48 60 D2 23 76 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 7E A0 07 61 03 B1 69 A3 7E 7E A8 A9 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 70 70 3B 03 22 89 1E AF D0 82 7A EC 40 2F DF 87 3F 7E EA FE FF B6 04 4A FB 79 29 E7 DE A4 B0 99 27 35 AE 24 E5 C6 5A D4 F7 6F A2 B6 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 62 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 93 C2 59 56 F6 35 13 99 54 E3 21 80 A4 1B 9E EF 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 7E A0 07 61 03 B1 69 A3 7E 7E A8 89 03 61 78 B8 C7 49 ED D2 4A E3 CB AE 87 B6 D0 C6 F5 A3 46 FC CC 08 71 DD F1 D9 DF 8E 61 60 70 3B 03 22 88 1E AF 90 82 7A EC 40 2F DF 87 3F 7E
14:37:56 Writing object 0.0.13.0.0.255, interface ActivityCalendar
TX:  7E A8 89 03 61 7A AA E4 9D 97 B2 0C B3 75 D2 A6 D4 6C EC 5D 82 8B 81 27 34 1B AB FA 81 72 57 DD 11 0D 7C 14 BD 56 0A 33 1C 48 D4 6D 76 8E 8C 65 69 46 23 9E EB 92 24 30 E2 8F 61 CB B8 0E 12 85 8B A7 94 45 3B F4 14 61 98 A1 DE AB E7 4A 31 E8 92 7C 32 84 EA B3 BF 0B 76 E9 D4 5C 6B EA 2A 6C A7 52 9B 6A 15 12 39 6E A0 3E 6C E8 FF 87 A1 22 38 02 4F 5C 68 2B A0 CA 3A 9E A7 C7 60 50 C4 24 7B BB 26 9F DD E6 83 AE D7 F5 7E
14:38:01 Data send failed. Try to resend 1/3 51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 62 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 93 C2 59 56 F6 35 13 99 54 E3 21 80 A4 1B 9E E7 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 1E 00 12 00 A0 A0 28 10 30 97 B2 0C B3 75 D2 A6 D4 6C EC 5D 82 8B 81 27 34 1B AB FA 81 72 57 DD 11 0D 7C 14 BD 56 0A 33 1C 48 D4 6D 76 8E 8C 65 69 46 23 9E EB 92 24 30 E2 8F 61 CB B8 0E 12 85 8B A7 94 45 3B F4 14 61 98 A1 DE AB E7 4A 31 E8 92 7C 32 84 EA B3 BF 0B 76 E9 D4 5C 6B EA 2A 6C A7 52 9B 6A 15 12 39 6E A0 3E 6C E8 FF 87 A1 22 38 02 4F 5C 68 2B A0 CA 3A 9E A7 C7 60 50 C4 24 7B BB 26 9F DD E6 83 AE D7 F5 7E
14:38:01
RX:  51 B4 52 B5 65 50 9F 95 3E D5 E9 B4 BE 62 6B DC 9A AB 8D E1 FF 00 EF FD C8 33 33 15 E5 93 C2 59 56 F6 35 13 99 54 E3 21 80 A4 1B 9E E7 74 61 5E AB C5 1B 67 AD E6 6F B0 E3 28 FE 07 E8 8D 7E 1E 00 12 00 A0 A0 28 10 30 97 B2 0C B3 75 D2 A6 D4 6C EC 5D 82 8B 81 27 34 1B AB FA 81 72 57 DD 11 0D 7C 14 BD 56 0A 33 1C 48 D4 6D 76 8E 8C 65 69 46 23 9E EB 92 24 30 E2 8F 61 CB B8 0E 12 85 8B A7 94 45 3B F4 14 61 98 A1 DE AB E7 4A 31 E8 92 7C 32 84 EA B3 BF 0B 76 E9 D4 5C 6B EA 2A 6C A7 52 9B 6A 15 12 39 6E A0 3E 6C E8 FF 87 A1 22 38 02 4F 5C 68 2B A0 CA 3A 9E A7 C7 60 50 C4 24 7B BB 26 9F DD E6 83 AE D7 F5 7E 7E A8 89 03 61 7A AA E4 9D 97 B2 0C B3 75 D2 A6 D4 6C EC 5D 82 8B 81 27 34 1B AB FA 81 72 57 DD 11 0D 7C 14 BD 56 0A 33 1C 48 D4 6D 76 8E 8C 65 69 46 23 9E EB 92 24 30 E2 8F 61 CB B8 0E 12 85 8B A7 94 45 3B F4 14 61 98 A1 DE AB E7 4A 31 E8 92 7C 32 84 EA B3 BF 0B 76 E9 D4 5C 6B EA 2A 6C A7 52 9B 6A 15 12 39 6E A0 3E 6C E8 FF 87 A1 22 38 02 4F 5C 68 2B A0 CA 3A 9E A7 C7 60 50 C4 24 7B BB 26 9F DD E6 83 AE D7 F5 7E 7E A0 07 61 03 D1 6F C0 7E
14:38:01 Writing object 0.0.13.0.0.255, interface ActivityCalendar
TX:  7E A0 7F 03 61 7C 0D E7 DD 5F F0 85 B2 DD 88 97 18 8F 99 97 38 97 D6 38 BD F6 14 D8 37 88 86 BA 86 FD F6 1C C4 38 35 21 E3 78 EA 07 11 62 B0 80 09 68 9F 16 C5 92 45 9B 78 AD 0F 47 BA 8F F3 67 EC 40 47 F4 C5 64 21 3C AF DE 73 26 5F 83 C9 F2 48 22 2C E8 37 54 66 A2 B1 D3 F4 9D 1B F8 14 B6 C0 0B 36 F4 EF 47 AD 3F F9 FC 7B E4 5F 79 48 BB 82 D4 2E 3A 0E 4A A2 5E 3F 54 AB 40 64 72 0E C9 7E




----------------------------------------------------------------------

connect & read:

14:41:28 Read object type ActivityCalendar index: 2
TX:  7E A0 2C 03 61 54 9C BA E6 E6 00 C8 1E 30 00 00 00 D8 61 7B B5 58 83 30 37 70 E9 E3 ED E2 5F 2F 93 68 8E 9B 0D 7E 75 77 A8 5D 98 49 5F 7E
14:41:28
RX:  7E A0 2C 03 61 54 9C BA E6 E6 00 C8 1E 30 00 00 00 D8 61 7B B5 58 83 30 37 70 E9 E3 ED E2 5F 2F 93 68 8E 9B 0D 7E 75 77 A8 5D 98 49 5F 7E 7E A0 2D 61 03 74 35 61 E6 E7 00 CC 1F 30 00 00 00 D3 CD 5D F6 A0 6D 7E FC FD 11 85 F1 21 7D 83 6D F2 ED CC 40 5E B7 59 3C C5 5F A9 92 E9 7E
14:41:28 Read object type ActivityCalendar index: 3
TX:  7E A0 2C 03 61 76 8C B8 E6 E6 00 C8 1E 30 00 00 00 D9 42 15 C6 08 F9 26 8D 2B F0 FC 11 DA 2E AD 36 B2 C3 37 F0 C0 65 A6 81 48 2D BE A5 7E
14:41:28
RX:  7E A0 2C 03 61 76 8C B8 E6 E6 00 C8 1E 30 00 00 00 D9 42 15 C6 08 F9 26 8D 2B F0 FC 11 DA 2E AD 36 B2 C3 37 F0 C0 6D A6 81 48 2D BE A5 7E 7E A0 3B 61 03 96 12 2D E6 E7 00 CC 2D 30 00 00 00 D4 89 64 99 03 4B DD 6E 68 44 21 99 17 B9 4E 8E 1A DE C2 C0 80 23 B6 11 40 F0 92 72 61 7A 42 B2 3F A4 D1 CD 65 FC C4 CD 13 97 BF 7E
14:41:28 Read object type ActivityCalendar index: 4
TX:  7E A0 2C 03 61 98 FC B6 E6 E6 00 C8 1E 30 00 00 00 DA ED 4F 56 87 B5 BD 66 EA ED 53 F0 1C BD 0D 7C 9E 36 B4 91 09 CF 41 4F 81 20 4E AC 7E
14:41:29
RX:  7E A0 2C 03 61 98 FC B6 E6 E6 00 C8 1E 30 00 00 00 DA ED 4F 56 87 B5 BD 66 EA ED 53 F0 1C BD 0D 7C 9E 36 B4 91 09 CF 41 4F 81 20 4E AC 7E 7E A0 38 61 03 B8 A3 C0 E6 E7 00 CC 2A 30 00 00 00 D5 8F 37 22 10 8A 0A 20 15 86 48 62 07 80 F8 CF A5 01 A1 B0 99 92 40 34 21 F2 F3 2D 78 2F 0B 23 89 FD 1F F4 6E B5 24 4E 7E
14:41:29 Read object type ActivityCalendar index: 5
TX:  7E A0 2C 03 61 BA EC B4 E6 E6 00 C8 1E 30 00 00 00 DB 36 76 8A 27 9C AC 92 42 7C 75 99 F5 1B E5 C9 64 F8 7C 87 7F 3A 6A 28 C3 BE B9 D4 7E
14:41:29
RX:  7E A0 2C 03 61 BA EC B4 E6 E6 00 C8 1E 30 00 00 00 DB 36 76 8A 27 9C AC 92 42 7C 75 99 F5 1B E5 C9 64 F8 7C 87 7F 3A 6A 28 C3 BE B9 D4 7E 7E A8 89 61 03 DA B0 A7 E6 E7 00 CC 81 B5 30 00 00 00 D6 A6 9C 29 41 A2 8D B9 99 4D C5 D6 D0 5D C5 09 32 1E D6 9B 69 ED 64 BA 63 2C 0D 4C 0A 97 D2 56 34 84 6F E4 07 9F 06 1B A8 99 F0 3C 81 57 DC BC 0E 28 FF C6 74 86 EA 2A 11 3A 7D 36 7B 85 80 A8 4C EB 4A 15 DA 8C 5A 47 11 18 7A C7 25 B3 6B 00 24 B2 42 DF E6 1E 35 A5 93 71 0F 0C DD D5 6A 18 FE B0 C6 41 E8 5B 6A B0 EC 0C 10 9A 45 A8 2E 57 CF 4F 55 09 A2 9A A4 11 7E
14:41:29
TX:  7E A0 07 03 61 D1 7F 26 7E
14:41:29
RX:  7E A0 07 03 61 D1 7F 26 7E 7E A0 44 61 03 DC F0 28 FC 2E 7B AE 01 93 BE FD A3 C3 E5 7D 08 04 2A F8 54 CC 6A C5 11 3E 1C 56 B4 69 6E 65 EB 40 9E 1E C0 94 3D 8B DC B3 28 B2 80 17 82 74 01 9B 15 BA B2 62 ED 79 97 EB 23 CD C1 0F CC 92 4D 7E
14:41:29 Read object type ActivityCalendar index: 6
TX:  7E A0 2C 03 61 FC DE 93 E6 E6 00 C8 1E 30 00 00 00 DC 82 A6 AB 43 2B 65 71 97 BF F7 0A 88 7C EB B4 17 11 E8 50 CB F7 73 A0 B9 4B 9B 9D 7E
14:41:29
RX:  7E A0 2C 03 61 FC DE 93 E6 E6 00 C8 1E 31 00 00 00 DC 82 A6 AB 43 2B 65 71 97 BF F7 0A 88 7C EB B4 17 11 E8 50 CB F7 73 A0 B9 4B 9B 9D 7E 7E A0 2D 61 03 FE 67 4A E6 E7 00 CC 1F 30 00 00 00 D7 E4 6E 3A 92 BA B7 FA 9F 2E 49 59 48 F9 7D C3 95 4D 98 CA F3 F5 F9 1B CC DF 83 6F 32 7E
14:41:29 Read object type ActivityCalendar index: 7
TX:  7E A0 2C 03 61 1E C2 57 E6 E6 00 C8 1E 30 00 00 00 DD 33 FC 5C 44 DD 95 4A 1D B5 2F D6 DE DB F2 47 21 0F 64 10 8C 2F 0B 6C AD C2 D5 D7 7E
14:41:29
RX:  7E A0 2C 03 61 1E C2 57 E6 E6 00 C8 1E 30 00 00 00 DD 33 FC 5C 44 DD 95 4A 1D B5 2F D6 DE DB F2 47 21 0F 64 10 8C 2F 0B 6C AD C2 D5 D7 7E 7E A0 7D 61 03 10 01 91 E6 E7 00 CC 6F 30 00 00 00 D8 2F 22 DC 2F 51 35 11 13 45 E3 9B 4E 84 73 93 40 24 EC 25 33 5A 93 69 52 C1 20 FF EF 84 24 27 F4 CC 59 81 A9 73 06 A5 FF 6C B9 34 BF D5 95 FD B0 3A 0E 14 6E 33 A7 81 08 B5 56 83 71 30 D6 19 D2 99 31 BE 33 2C CD 24 61 FD A6 F2 D8 0C CE 43 93 F7 92 CF 27 55 7D 79 2D B7 40 1C 2B CD 01 B7 FA 22 72 64 ED F5 7D 8A C1 64 2A 17 79 7E
14:41:29 Read object type ActivityCalendar index: 8
TX:  7E A0 2C 03 61 30 BE 9F E6 E6 00 C8 1E 30 00 00 00 DE 59 2E B1 06 9E 7C E1 77 75 96 4A E7 B6 D8 01 55 A8 B7 4C B9 EF 43 E4 09 07 DB FE 7E
14:41:30
RX:  7E A0 2C 03 61 30 BE 9F E6 E6 00 C8 1E 30 00 00 00 DE 59 2E B1 06 9E 7C E1 77 75 96 4A E7 B6 D8 01 55 A8 B7 4C B9 EF 43 E4 09 07 DB FE 7E 7E A0 71 61 03 32 25 04 E6 E7 00 CC 63 30 00 00 00 D9 DB A3 88 80 ED 4C CE 8B 46 B3 A2 D6 2E 93 34 73 6E 7E EA A9 BC FD 9A 61 20 9D 00 EC 8C CB E9 A8 45 73 D1 79 49 4C E8 E7 5C D4 BB 7B 1B 21 D7 C7 E6 DD 29 93 38 41 62 06 7A F3 A3 50 22 40 C2 45 5F BC 0D EF 69 22 77 4F D8 E1 6D FC 85 8D DA FE F4 AB C9 C9 A1 2C 87 E4 5C 76 37 EC C3 3D 72 8F 7E
14:41:30 Read object type ActivityCalendar index: 9
TX:  7E A0 2C 03 61 52 AA DF E6 E6 00 C8 1E 30 00 00 00 DF 15 8B 9F FF E1 CB 16 50 C1 58 A0 07 83 1B 6E 7E 23 93 9A 78 E2 A2 68 7F A3 F3 42 7E
14:41:30
RX:  7E A0 2C 03 61 52 AA DF E6 E6 00 C8 1E 30 00 00 00 DF 15 8B 9F FF E1 CB 16 50 C1 58 A0 07 83 1B 6E 7E 23 93 9A 78 E2 A2 68 7F A3 F3 42 7E 7E A8 89 61 03 54 C6 CA E6 E7 00 CC 82 01 5B 30 00 00 00 DA E4 65 1E DC E9 D4 7A A6 4F 7C A0 BF 61 18 47 C2 49 C1 8F 65 35 0E A0 8E E2 E4 A7 C8 2E DE 3A C2 0D 82 30 B2 3A 47 86 28 73 75 9A 2D 92 DF 1D CC 7B 5D F0 70 B9 4E 47 84 40 7A C9 CF EA AB DD B5 88 72 A1 EF BD 17 B7 47 5E 9E 58 74 0C 53 E2 F9 85 01 5F AB 33 E9 E3 3C 9C D8 AB 28 8C 45 20 C8 DE 99 4F A0 6B F4 0C 02 F6 E4 A4 32 16 47 09 ED 61 DE 1C E0 6F 5A 7E
14:41:30
TX:  7E A0 07 03 61 71 75 83 7E
14:41:30
RX:  7E A0 07 03 61 71 75 83 7E 7E A8 89 61 03 56 D4 E9 7F EE 01 30 8D 53 4B AF 9E BD 1E AF E4 66 42 B1 DC 19 6D 26 11 97 F4 5C 0A 98 95 38 38 27 4E 42 28 2B 10 5F AB 70 D6 CA CB 0C 73 8D 7B 39 0D 2C CE 12 B6 1A 30 81 71 1D A2 BA 67 3D DB AA 4F A4 78 99 76 06 C5 CE E0 05 F1 6E 0C 73 B8 0F 8D C6 38 BB B2 EB 5D 80 EA 3E 0F C4 53 5A C4 C6 5A B9 91 A9 53 F3 78 83 37 CA D9 FE 47 C4 99 DC 95 CC 6D 03 FE F8 4D 7D 25 59 FE 2F 43 D7 1F DA 80 D4 65 A0 7E
14:41:30
TX:  7E A0 07 03 61 91 7B 64 7E
14:41:30
RX:  7E B0 07 03 61 91 7B 64 7E 7E A0 6B 61 03 58 76 D7 1E 3D F6 01 01 20 6C 05 D9 B8 A3 0F C1 C5 1B 99 7E 5D 7F 50 1C 4A 91 14 BC EF 84 DB F2 D0 D6 F0 7F 15 C2 2C 4E 2C 12 ED 8E FF A1 63 8F DF 7D C0 AF 06 6A FB 47 94 A1 7D F4 1C 8A 6D E5 7C B9 7D F7 F5 D8 82 94 F6 EA F7 34 92 80 74 53 9D 7B 0C 7F 8E 45 F9 E2 4C B2 D4 E4 FC 2E 2A 2F 07 11 71 E6 1D EC B1 7E
14:41:30
TX:  7E A0 26 03 61 B4 3C 81 E6 E6 00 C8 18 30 00 00 00 E0 02 5A 8D D4 01 22 70 44 4B B2 4D DC 61 F7 B2 62 64 5A FC 6C 00 7E
14:41:30
RX:  7E A0 26 03 61 B4 3C 81 E6 E6 00 C8 18 30 00 00 00 E0 02 5A 8D D4 21 22 70 44 4B B2 4D DC 61 F7 B2 62 64 5A FC 6C 00 7E 7E A8 89 61 03 7A BA 02 E6 E7 00 CC 82 01 59 30 00 00 00 DB B4 A0 5B 17 0F 23 58 08 C8 2C 76 DB 07 2E DE 41 7E 7B 33 44 D0 97 B5 B9 CD 55 55 4A 5D AA 3F 94 F9 94 8B 50 21 87 F5 23 29 51 33 DA 36 D0 05 11 F0 9F A0 06 AF 2A 40 E0 D1 52 C4 B9 8E 72 37 5B AA 44 31 44 70 D2 E8 D5 C6 87 3A C5 D1 69 BD 2A A9 16 25 D1 E2 6E D7 07 26 25 2B 66 E4 E7 85 55 96 41 D6 A1 37 10 82 48 14 F8 67 28 F3 57 67 19 F6 37 4E BC 32 BF 7E
14:41:30
TX:  7E A0 07 03 61 D1 7F 26 7E
14:41:31
RX:  7E A0 07 03 61 D1 7F 26 7E 7E A8 89 61 03 7C 8C 67 C4 4D 5E B1 DB D4 5A B3 D5 6E ED 17 D7 DF C2 E4 BB 8D 27 7A 1C 28 4F AA 8F E8 9C 18 91 21 C0 AF ED 1F 50 E2 F0 64 EC 75 CE 4B 02 6D C3 E7 E7 56 3D A4 58 2F 92 EB C0 35 DE 04 63 55 F3 6A C4 E7 6D A4 77 25 2E 14 AF 8B 59 7E 4E 4C 0A A3 B4 37 9B 41 7D 6C 49 2F DF 24 FF 28 D2 19 FE 0A CC 38 D6 14 7A 9F 2E 8F 90 37 4F A8 81 B4 33 92 6E 87 26 93 78 AE AD 68 84 B3 8E 23 A5 01 4F A5 4A C1 CB D0 7E
14:41:31
TX:  7E A0 07 03 61 F1 7D 07 7E
14:41:31
RX:  7E A0 07 23 61 F1 7D 07 7E 7E A0 69 61 03 7E 34 AA 7A C2 69 EB CC 1F 9C 3B 9C 4C 98 0E 80 A1 D5 1E 7E 44 88 80 9A CF 10 BF 4B 26 96 93 28 75 BE 55 FE 72 8E 37 84 0E 76 AF 5B 7E 60 2A DD 9F 0A 58 3E 9E 02 39 2B AB BC C2 FA 34 9D D5 5A 4A 73 03 9C C7 28 73 6E 6C DA 67 56 B4 6B B0 6D ED F0 50 53 73 47 52 B7 C0 1D BA FD A4 16 91 7A 1D CC 14 58 81 7E
14:41:31
TX:  7E A0 26 03 61 16 24 07 E6 E6 00 C8 18 30 00 00 00 E1 AD C7 83 B8 C9 D7 01 B1 B2 2C 53 9B AB A6 C7 CB F0 B7 D0 D0 93 7E
14:41:31
RX:  7E A0 26 03 61 16 24 07 E6 E6 00 C8 18 30 00 00 00 E1 AD C7 83 B8 C9 D7 01 B1 B2 2C 53 9B AB A6 C7 CB F0 B7 D0 D0 93 7E 7E A8 89 61 03 90 EE 4A E6 E7 00 CC 82 01 59 30 00 00 00 DC 74 5D 5B AD BF E6 18 ED 0D 0C 78 7E 92 B0 10 2B F4 7B 73 5E FD DC E3 04 17 B2 43 41 81 8F BD 71 F2 29 88 39 3B 3B 8F A6 B8 25 7C 19 CC BB 9B 6A 3C BA F9 AF 95 89 A1 44 B0 53 6E 4D 25 72 3B 0B 82 91 73 C1 6A A1 75 0D CC A4 2E FC A3 74 B5 50 91 09 A7 A6 8E 87 92 11 31 C8 1C D3 84 8C 4C 93 54 AA 2E 13 31 DF 39 0F 97 BE 11 CA 0E 89 10 05 21 79 75 E9 40 07 7E
14:41:31
TX:  7E A0 07 03 61 31 71 C1 7E
14:41:31
RX:  7E A0 07 03 61 31 71 C1 7E 7E A8 89 61 03 92 FC 69 43 9B 20 B9 3D 1F 84 F9 69 8A B7 E6 98 74 85 91 1F C1 06 64 E0 0A A3 05 54 49 66 08 2E 3A 24 E4 E7 56 76 1B 21 1B 8B DA 50 E6 2C 6D D1 F3 9F C5 58 09 CF 51 A0 EC D3 60 EF 28 83 2D A5 64 5D 3C 5D 8A 95 FA 9C 7B 49 68 73 68 1A 62 B5 8A 19 AC 00 DE E7 27 74 00 AA 88 26 DA 63 C7 CB E3 00 CB 44 E9 9F CC F3 55 71 9C 02 2C 81 77 88 8D E2 52 36 37 A8 B9 F1 27 86 88 4F 70 A1 07 88 28 94 8E DC DA 7E
14:41:31
TX:  7E A0 07 03 61 51 77 A2 7E
14:41:31
RX:  7E A0 07 03 E1 51 77 A2 7E 7E A0 69 61 03 94 60 E2 6B 97 A4 96 C1 41 B2 7D 4C F3 51 58 24 8B 58 94 A3 10 21 1F E3 CF 18 FD C7 F4 D5 6F F4 1E 23 8A 88 6B 4B 91 F0 D6 18 E2 C3 43 BC 49 BA 7F AF 95 BB A2 4C A9 31 2B 50 08 06 E0 76 A3 AE C5 38 87 BB 0B 99 98 B3 FA 42 94 77 D2 24 2B BE D6 4E 01 A6 16 33 B3 05 12 9A 2B 42 11 46 C5 7A BD 3C 20 61 E9 7E
14:41:31 Read object type ActivityCalendar index: 10
TX:  7E A0 2C 03 61 78 F2 51 E6 E6 00 C8 1E 30 00 00 00 E2 1C A1 9C 69 FF B8 09 DC 30 D7 0F A8 9B E2 52 B8 8B 2C 4D 27 79 36 DE 2D F2 E1 99 7E
14:41:31
RX:  7E A0 2C 03 61 78 F2 51 E6 E6 00 C8 1E 30 00 00 00 E2 1C A1 9C 69 FF B8 09 DC 30 D7 0F A8 9B E2 52 B8 8B 2C 4D 27 79 36 DE 2D F2 E1 99 7E 7E A0 31 61 03 B6 BE D0 E6 E7 00 CC 23 30 00 00 00 DD 2A B6 1A E7 FA 8E 77 E1 25 32 5B CC 3B D4 E0 1E C9 8C D7 0F 35 74 2B 68 E5 2E C8 2F 50 7E 8D CB 7E


------------------------------------------------------------------

gcc-4.9-arm-linux-gnueabihf-base

dpkg --add-architecture armhf


--------------------------------------

disable watchdog wdog

#include "em_wdog.h"
WDOG_Enable( DEFAULT_WDOG );

src/platform/drivers/watchdog/watchdog-efr32.c


---------------------------------------------

IPA3b 500mW issues:

- RAIL_PaCtuneSet()/RAIL_SetPaCTune() "Sets the PA capacitor tune value for transmit and receive."
- RAIL_CalValues_t. ImageRejection (IR) and temperature.

The EFR32 has two supported calibrations. There is the Image Rejection (IR)
calibration and a temperature dependent calibration. The IR calibration is
something that can be computed once and stored off or computed each time at
startup. It is PHY specific and provides sensitivity improvements so we
highly recommend using it. The IR calibration should only be run when the
radio is IDLE.

The temperature dependent calibrations are used to recalibrate the synth if
the temperature crosses 0C or the temperature delta since the last
calibration exceeds 70C while sitting in receive. RAIL will run VCO
calibration automatically upon entering receive state so the application can
omit this calibration if the stack will re-enter receive with enough
frequency to not hit this temperature delta.  If the application does not
calibrate for temperature, it's possible to miss receive packets due to
drift in the carrier frequency.



------------------------------------------------

nc -6ul 4100

nc -6u 2a03:a000:5:192:a0d5:1380:93b:8f63 4100

-----------------------------------------

omnibox8:
wlan0     Link encap:Ethernet  HWaddr dc:44:6d:a4:dc:f6
          inet addr:172.16.32.159  Bcast:172.16.32.255  Mask:255.255.255.0
          inet6 addr: fe80::de44:6dff:fea4:dcf6/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1141 errors:0 dropped:0 overruns:0 frame:0
          TX packets:319 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:191150 (191.1 KB)  TX bytes:38062 (38.0 KB)


random MAC address on armbian ubuntu
https://www.paulfurley.com/randomize-your-wifi-mac-address-on-ubuntu-1604-xenial/


Oomni@omnibox3:~$ ifconfig
eth0      Link encap:Ethernet  HWaddr 1a:08:25:71:10:9a
          inet addr:172.16.32.17  Bcast:172.16.32.255  Mask:255.255.255.0
          inet6 addr: fe80::1808:25ff:fe71:109a/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1971934 errors:0 dropped:0 overruns:0 frame:0
          TX packets:755624 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:470237340 (470.2 MB)  TX bytes:244620767 (244.6 MB)
          Interrupt:114


omni@omnibox8:~$ ifconfig
eth0      Link encap:Ethernet  HWaddr e2:8d:96:31:c8:93
          inet addr:172.16.32.86  Bcast:172.16.32.255  Mask:255.255.255.0
          inet6 addr: fe80::e08d:96ff:fe31:c893/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:566 errors:0 dropped:0 overruns:0 frame:0
          TX packets:204 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:68262 (68.2 KB)  TX bytes:22233 (22.2 KB)
          Interrupt:114






------------------------------------------------------------------------


socat /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0,raw,echo=0,crnl /dev/serial/by-id/usb-FTDI_TTL232R_FT94TOL6-if00-port0,raw,echo=0,crnl

(gdb) info reg
r0             0x15 21
r1             0x0  0
r2             0x4f 79
r3             0xdeadc0de   -559038242
r4             0x2000abb0   536914864
r5             0x0  0
r6             0x3  3
r7             0x82 130
r8             0x2000ae40   536915520
r9             0x0  0
r10            0x4  4
r11            0x20000000   536870912
r12            0x0  0
sp             0x2001ffc0   0x2001ffc0
lr             0x205fb  132603
pc             0x20604  0x20604 <HardFault_Handler+164>
xPSR           0x21000003   553648131
fpscr          0x0  0
msp            0x2001ffc0   0x2001ffc0
psp            0x2000abb0   0x2000abb0 <s_hdlcStack+1080>
primask        0x0  0
basepri        0x0  0
faultmask      0x0  0
control        0x0  0
(gdb) where
#0  HardFault_Handler () at src/hw/efr32/crash.c:129
#1  <signal handler called>
#2  0xf3198310 in ?? ()
#3  0xcd66f370 in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb)


(gdb) where
#0  0x0002057e in HardFault_Handler () at src/hw/efr32/crash.c:150
#1  <signal handler called>
#2  0xf3198310 in ?? ()
#3  0xcd66f370 in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb) stepi
0x00038db8 in processHdlcUAFrame (header=0x2000abe8 <s_hdlcStack+1136>) at src/device/communication/hdlc/hdlc.c:1049
1049        sendFrame(s_sendPayload->payload, s_sendPayload->len, s_sendPayload->type);
(gdb) where
#0  0x00038db8 in processHdlcUAFrame (header=0x2000abe8 <s_hdlcStack+1136>) at src/device/communication/hdlc/hdlc.c:1049
#1  processHdlcMacFrame (header=0x2000abe8 <s_hdlcStack+1136>) at src/device/communication/hdlc/hdlc.c:1102
#2  parseMac (bb=0x200114d8) at src/device/communication/hdlc/hdlc.c:1273
#3  processRxMessage () at src/device/communication/hdlc/hdlc.c:1294
#4  hdlcReaderTask (arg=<optimized out>) at src/device/communication/hdlc/hdlc.c:1357
#5  0x000592d0 in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb)


-------------------------------------------


uplink.gracetime = 900 (15 mins). before conman will take down the uplink.
rpl.dag_switch.time = 7200 (2hrs)

rplGoToGatewayMode() called from startGateway()
rplGoToMeshMode() called from startMesg()

If a neighbour has a better rank than me for > rpl.dag_switch.time then a DAG switch will
be triggered (rplMRHOFSelectParent).

A node will not join a mesh where its rank would be bad (RPL_MAX_ACCEPTABLE_RANK).

With OF0 alg:
rplOFZeroSelectParent()
Nodes can also be "pushed away" from joining a DAG due to the number of nodes on that potential
mesh. rpl.netsize_penalty penalises the gw rank based on (numberOfDownroutes/10)*rpl.netsize_penalty

// There is a better parent than our preferred parent. Moving up
// in a DAG like this is allowed. Moving down is allowed only to
// lowestAdvertisedRank + MaxRankIncrease.

with MRHOF alg (default):
https://tools.ietf.org/html/rfc6719
rpl.br.mrhof.min_rank_increase = true
rpl.br.mrhof.max_rank_increase = true
rpl.mrhof.pp_hysteresis = 75 [% of MinHopRankIncrease]
rpl.dag_switch.hysteresis = 150
RPL_MRHOF_ACCEPTABLE_PARENT_THRESHOLD_PCT = 25%   (acceptable parent threshold)

// If a parent that is substantially better is found, use that as preferred parent

RPL_MRHOF_ETX_VALID_THRESHOLD = 3 (have to have >3 valid ETX samples for a node
when computing its rank otherwise it gets an infinitely-bad-rank).

Trickle timers also affect the timing of any network change (RFC 6550).

----------------------------------------

omnibox9: 2a03:a000:5:192:85ad:e4e:1239:1b
omnibox8: 2a03:a000:5:192:85ad:e4e:1239:1a
kalkitech1: 2a03:a000:5:192:85ad:e4e:1239:19

node: 021bc50c6001a1dd
2a03:a000:5:192:021b:c50c:6001:a1dd

---------------------------------------------------------

fd28:914c:1da9:1:21b:c50c:6001:b635

fd28:914c:1da9:1: 21b:c50c:6001:b635

/usr/bin/tun6d --loglevel debug --prefix fd01::/48 --source 2401:8800:a50:1::2 --timeout 300 --port 8050 --keepalive 10 -r /root/tun6d_persist 2>&1 | perl -pe 'use POSIX strftime; print strftime "[%Y-%m-%d %H:%M:%S] ", localtime'
/usr/bin/tun6d --loglevel debug --prefix 2a03:a000:0005:0192/64 --source 2401:8800:a50:1::2 --timeout 300 --port 8050 --keepalive 10 -r /root/tun6d_persist

local is 2a03:a000:5:192:7b20: 213d:4468:dd9d
prefix is 2a03:a000:0005:0192

/etc/init/tun6d.conf

sudo route -A inet6 add 2a03::200/48 gw 2a03:a000:5:192:8d82:51be:6a91:7259

tcpdump -i tun6d0 ip6

# do this:
sudo route -6 add 2a03:a000:5:192:85ad:e4e:1239:1a eth0
sudo route -6 add 2a03:a000:5:192:85ad:e4e:1239:1b eth0
sudo route -6 add 2a03:a000:5:192:85ad:e4e:1239:19 eth0
sudo route -6 add 2402:3a80:1700:90:e996:6cf3:c770:b08a eth0
ip6tables -t nat -A POSTROUTING -o eth0 -s fd28:914c:1da9:0:200::/64 -j MASQUERADE
ip -6 add add fd00::1 dev eth0

genus-tt1 setup


------------------------------------------

genus-tt1:
- modify /etc/init/tun6d.conf to add "loglevel debug" and "prefix 2a03:a000::/48"
- "sysctl -w net.ipv6.conf.all.forwarding=1" or edit /etc/sysctl.conf to make permanent
- "systemctl restart tun6d"

gdb --args ./build/host-genus-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01  \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
 -initrtc  \
 -ctrlhub 127.0.0.1  \
 -ctrlhubport 4242  \
 -loglevel debug  \
 -param device.dlms.lls_password=1A2B3C4D  \
 -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.hls_key=756776636c686c737567313836616263 \
 -param device.time.sync_timer=1 \
 -param server.ip=fd00::1  \
 -param server.port=5684 \
 -param modem.tun6.ip=genus-tt1.dev.cyanconnode.com \
 -param modem.tun6.secret=Genus-MM   \
 -param modem.apn=4g.tele2.se  \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=1 \
 -param device.dlms.pipe_enabled=1 \
 -rootcert /Data/Temp/KeyTest/root.crt.der  \
 -cert /Data/Temp/KeyTest/node.crt.der  \
 -key /Data/Temp/KeyTest/node.key.der  \
 -mackey /Data/Temp/KeyTest/mac-keys.txt  \
 -gateway  \
 -statedir AgentState \
 -socket



------------------------------------------------

git remove commit

"git rebase -p --onto SHA^ SHA" where SHA is the hash of the commit to remove.


----------------------------------------------------

openocd repo

http://openocd.zylin.com/#/q/status:open


---------------------------------------------

udp ipv6 forward:

socat -ddd UDP6-RECVFROM:4059,fork UDP6-SENDTO:[fd28:914c:1da9:1:21b:c50c:6001:b635]:4059

----------------------------------------------------

forward udp6 packets from omnibox8 -> host-agent on my machine.
sudo ip6tables -t nat -A PREROUTING -s 2a03:a000:5:192:85ad:e4e:1239:1a -p udp -j DNAT --to-destination fd28:914c:1da9:0:200::1 --dport 4059



------------------------------------------------

./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -listen 4242 -loglevel debug

gdb --args ./build/host-genus-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01  \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
 -initrtc  \
 -ctrlhub 127.0.0.1  \
 -ctrlhubport 4242  \
 -loglevel debug  \
 -param device.dlms.lls_password=1A2B3C4D  \
 -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.hls_key=756776636c686c737567313836616263 \
 -param device.time.sync_timer=1 \
 -param server.ip=fd00::1  \
 -param server.port=5684 \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner   \
 -param modem.apn=4g.tele2.se  \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=1 \
 -param device.dlms.pipe_enabled=1 \
 -rootcert /Data/Temp/KeyTest/root.crt.der  \
 -cert /Data/Temp/KeyTest/node.crt.der  \
 -key /Data/Temp/KeyTest/node.key.der  \
 -mackey /Data/Temp/KeyTest/mac-keys.txt  \
 -gateway  \
 -statedir AgentState \
 -socket


gdb --args ./build/host-genus-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01  \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0  \
 -initrtc  \
 -ctrlhub 127.0.0.1  \
 -ctrlhubport 4242  \
 -loglevel debug  \
 -param device.dlms.lls_password=1A2B3C4D  \
 -param device.dlms.authentication_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263    \
 -param device.dlms.hls_key=756776636c686c737567313836616263 \
 -param device.time.sync_timer=1 \
 -param server.ip=fd00::1  \
 -param server.port=5684 \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner   \
 -param modem.apn=4g.tele2.se  \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=0 \
 -param device.dlms.pipe_enabled=0 \
 -rootcert /Data/Temp/KeyTest/root.crt.der  \
 -cert /Data/Temp/KeyTest/node.crt.der  \
 -key /Data/Temp/KeyTest/node.key.der  \
 -mackey /Data/Temp/KeyTest/mac-keys.txt  \
 -gateway  \
 -statedir AgentState \
 -socket

------------------------------

2018-11-08 14:22:38.434 [debug] [        meter/dlms] {      device}: 3671) ** processDlmsPayload (0) **
2018-11-08 14:22:38.434 [debug] [              dlms] {      device}: 716 ) Get 0-0:1.0.0*255 ic 8 attr 2 normal access
2018-11-08 14:22:38.484 [ERROR] [              dlms] {      device}: 2191) Previous send request is not yet processed
2018-11-08 14:22:38.484 [debug] [        meter/dlms] {      device}: 3942)  -- waiting on s_dlmsSemaphore for 14000ms --
2018-11-08 14:22:38.508 [debug] [        meter/dlms] {    schedule}: 354 ) Request to retrieve time from meter
2018-11-08 14:22:38.508 [ERROR] [        meter/dlms] {    schedule}: 327 ) Queue full, dropping msg
2018-11-08 14:22:38.517 [debug] [              hdlc] {        hdlc}: 1337) ** giveCause = 3, 1 **
2018-11-08 14:22:38.517 [debug] [              hdlc] {        hdlc}: 0   ) rx: (1/3): 7ea0204103733e9d8180140502015e06
2018-11-08 14:22:38.517 [debug] [              hdlc] {        hdlc}: 0   ) rx: (2/3): 02015e07040000000108040000000151
2018-11-08 14:22:38.517 [debug] [              hdlc] {        hdlc}: 0   ) rx: (3/3): af7e
2018-11-08 14:22:38.517 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): 7e
2018-11-08 14:22:38.517 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): a044
2018-11-08 14:22:38.518 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): 03
2018-11-08 14:22:38.519 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): 41
2018-11-08 14:22:38.519 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): 10
2018-11-08 14:22:38.519 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): b3e1
2018-11-08 14:22:38.520 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): e6e600
2018-11-08 14:22:38.521 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/4): 6036a1090607608574050801018a0207
2018-11-08 14:22:38.521 [debug] [              hdlc] {        hdlc}: 0   ) tx: (2/4): 808b0760857405080201ac0a80083141
2018-11-08 14:22:38.521 [debug] [              hdlc] {        hdlc}: 0   ) tx: (3/4): 324233433444be10040e01000000065f
2018-11-08 14:22:38.521 [debug] [              hdlc] {        hdlc}: 0   ) tx: (4/4): 1f0400001f1fffff
2018-11-08 14:22:38.522 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): dd04
2018-11-08 14:22:38.523 [debug] [              hdlc] {        hdlc}: 0   ) tx: (1/1): 7e
2018-11-08 14:22:38.523 [debug] [              hdlc] {        hdlc}: 1335) ** Waiting for HDLC event (10000ms) **
2018-11-08 14:22:38.611 [debug] [        meter/dlms] {    schedule}: 354 ) Request to retrieve time from meter
2018-11-08 14:22:38.611 [ERROR] [        meter/dlms] {    schedule}: 327 ) Queue full, dropping msg
2018-11-08 14:22:38.661 [debug] [              hdlc] {        hdlc}: 1337) ** giveCause = 3, 1 **
2018-11-08 14:22:38.661 [debug] [              hdlc] {        hdlc}: 0   ) rx: (1/4): 7ea0374103302179e6e7006129a10906
2018-11-08 14:22:38.661 [debug] [              hdlc] {        hdlc}: 0   ) rx: (2/4): 0760857405080101a203020100a305a1
2018-11-08 14:22:38.661 [debug] [              hdlc] {        hdlc}: 0   ) rx: (3/4): 03020100be10040e0800065f1f040000
2018-11-08 14:22:38.661 [debug] [              hdlc] {        hdlc}: 0   ) rx: (4/4): 1014015e000789337e
2018-11-08 14:22:38.662 [debug] [              dlms] {        dlms}: 4307) COSEM AA with LLS setup is accepted
2018-11-08 14:22:38.662 [debug] [              dlms] {        dlms}: 3981) extracted server max pdu size is 350
2018-11-08 14:22:38.662 [debug] [              dlms] {        dlms}: 2521) DLMS result is 0 bytes with code 0
2018-11-08 14:22:38.662 [debug] [        meter/dlms] {        dlms}: 512 ) dlmsReceiveCb called with s_rxRes=0
2018-11-08 14:22:38.662 [debug] [              hdlc] {        hdlc}: 1335) ** Waiting for HDLC event (10000ms) **
2018-11-08 14:22:38.662 [debug] [        meter/dlms] {      device}: 3671) ** processDlmsPayload (0) **

Thread 16 "device" received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7fffecaf1700 (LWP 28828)]
__memcmp_sse4_1 () at ../sysdeps/x86_64/multiarch/memcmp-sse4.S:949
949 ../sysdeps/x86_64/multiarch/memcmp-sse4.S: No such file or directory.
(gdb) where
#0  __memcmp_sse4_1 () at ../sysdeps/x86_64/multiarch/memcmp-sse4.S:949
#1  0x00007ffff6ee174f in memcmp () from /usr/lib/x86_64-linux-gnu/libasan.so.2
#2  0x0000000000513f82 in dlmsGetDateTime (payload=0x0, payloadLen=0, dateTime=0x7fffecaf0d00) at src/device/communication/dlms/dlms.c:2004
#3  0x000000000050702a in handleMeterTime (data=0x0, dataLen=0, meterTime=0x8f18c0 <s_meterTime>) at src/device/drivers/dlms-common/device-dlms-common.c:30
#4  0x00000000004e89d4 in processDlmsPayload () at src/device/drivers/dlms/device-dlms.c:3820
#5  0x00000000004e8df2 in deviceTask (arg=0x0) at src/device/drivers/dlms/device-dlms.c:3950
#6  0x0000000000546759 in taskWrapper (arg=0x8f1060 <s_deviceTask>) at src/platform/osal/osal-posix/osal_posix.c:134
#7  0x00007ffff6c546ba in start_thread (arg=0x7fffecaf1700) at pthread_create.c:333
#8  0x00007ffff698a41d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:109
(gdb)

- dlmsGetDateTime() payload is NULL.
- handleMeterTime() data is NULL, dataLen is 0.

- s_responseBuffer is NULL in processDlmsPayload()
- s_responseLength is 0 in processDlmsPayload()

therefore:

dlmsReceiveCb() must have received a NULL payload.


----------------------------------------------

show tags with dates.

git log --oneline --decorate --tags --no-walk

order by date:
git for-each-ref --sort=taggerdate --format '%(refname) %(taggerdate)' refs/tags


----------------------------------

coap tools

apt install python3-pip libjansson4
pip3 install serial
pip3 install protobuf

rm -rf CoAPTools
mkdir CoAPTools
cd CoAPTools
tar zxvf ~/Downloads/CoAPTools.tgz
--------------------------------------------

JVVNL creds:

lls pw: 50 00 53 53 57 52 44 32
auth key: 75 67 76 63 6c 65 6b 61 6b 67 31 38 36 61 62 63
hls key: 48 00 53 50 41 53 53 57 4f 52 44 30 30 30 30 32

48 00 53 50 41 53 53 57 4F 52 44 30 30 30 30 32

------------------------------------------------------------

JVVNL:

gdb --args ./build/host-genus-insecure/bin/agent \
 -eui64 00-00-00-00-00-00-00-01   \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0   \
 -initrtc   \
 -ctrlhub 127.0.0.1   \
 -ctrlhubport 4242   \
 -loglevel debug   \
 -param device.dlms.lls_password=5000535357524432   \
 -param device.dlms.authentication_key=776636c656b616b67313836616263     \
 -param device.dlms.encryption_key=756776636c656b616b67313836616263     \
 -param device.dlms.hls_key=5C680D0F30312B4C6179212835201D45  \
 -param device.time.sync_timer=1  \
 -param server.ip=fd00::1   \
 -param server.port=5684  \
 -param modem.tun6.ip=127.0.0.1  \
 -param modem.tun6.secret=whatsfordinner    \
 -param modem.apn=4g.tele2.se   \
 -param server.mq.push_now=1  \
 -param server.mq.push_delay=30  \
 -param device.capabilities.dlmspipe.push=0  \
 -param device.dlms.pipe_enabled=1  \
 -rootcert /Data/Temp/KeyTest/root.crt.der   \
 -cert /Data/Temp/KeyTest/node.crt.der   \
 -key /Data/Temp/KeyTest/node.key.der   \
 -mackey /Data/Temp/KeyTest/mac-keys.txt   \
 -gateway   \
 -statedir /Data/Temp/AgentState  \
 -socket

-----------------------------------

ESWF:
const CosemData alarmFilter = {
    1, { 0x00, 0x00, 0x5e, 0x5b, 0x1a, 0xFF }, ATTR_ID_2
};

00010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
00011000000100000000000000000000000000000000000000010000000000000000000000000000011111110000000000000000000000000000100000000000



---------------------------------------------

A description of the process follows, there are a few interacting aspects in the above questions:

A node must first establish itself on the mesh in order to gain access to the gateway and ultimately to the server as the mesh provides the IP network infrastructure to enable communication with the server.
The node can exist on and communicate on the IP network without being logged into the server itself.
The sever-login is dependent on DTLS credentials, so for example the node can appear on the network (and be ICMP pingable) without having an active DTLS session if (for example) the credentials are incorrect.
Presuming that a node has valid credentials and has logged in, it may drop off the network for many reasons such as cellular or power issues.
The DTLS connection (from the servers point-of-view) will timeout after approximately one hour (for a node, and 24h for a gateway). No communications with a node for this amount of time will cause the server to consider it offline. At this point, the server will log an event that the node has 'logged out', but this is generated internally by the server,
From the nodes point-of-view, the DTLS connection with the server have a 'heartbeat' that will cause packets to be sent to the server at least once every hour (by default, but configurable). if no response if heard from the server after that time then the node will retry a few times and if the failure persists, will attempt a new (DTLS level) login. The number and frequency of these retries will also add delays.

Additionally, (and in parallel with) the above mechanism, if a gateway loses its uplink (cellular connection) then the mesh to which the node is attached will be reconfigured and the nodes will attempt to find a neighbouring mesh network.
There are various conditions that must be met before a node will 'hop' onto another mesh in an attempt to find another route to the server, for example; before a gateway considers its uplink to be down, a period of 15 minutes must pass before it will take action. This is to prevent too many uplink-drop events from occurring. For a node on the gateways mesh to hop, it must have had a neighbouring mesh with the correct credentials that has had a stronger link for a period of greater than 2 hours.

This process is quite complex and very dynamic, but although in a demo situation the timeouts seem to be quite long, they're appropriately sized for a field deployment. We attempt to avoid 'churn' of the mesh networks as much as possible in the presence of unreliable communication mediums such as meshes and cellular networks.
For a full diagnosis, it is essential to consider not only the node, but the other nodes and traffic both on its current mesh and its neighbouring mesh(es) in addition to the cellular network conditions.

For the final question regarding the login-events, we never explicitly 'logout', the node will attempt to keep the DTLS communication open with the server indefinitely. What you should see instead is the node being marked as 'offline'.

A lot of these timeouts are configurable, but caution must be applied before changing them as they may negatively affect the network.


--------------------------------------


stickle@genus-tt1:~$ ping6 fd28:914c:1da9:2:021b:c50c:6001:a1dd

openvpn interface:
tun0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          inet addr:10.8.0.1  P-t-P:10.8.0.1  Mask:255.255.255.0
          inet6 addr: 2001:db8:ee00:abcd::1/64 Scope:Global
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:197 errors:0 dropped:0 overruns:0 frame:0
          TX packets:155 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100
          RX bytes:16270 (16.2 KB)  TX bytes:26554 (26.5 KB)
----------------------------

tun6d conf
/etc/init/tun6d.conf

vi /etc/init/tun6d.conf

netsh interface ipv6 add route 2002::/60 "Ethernet 3"
route -6 print

netsh interface ipv6 add route 2002::/60 interface="Ethernet 3" nexthop=2a03:a000:5:192:45a4:8ecf:7053:cf41

-------------------------------------

tun6d on omnibox:
$ mkdir -p /dev/net
$ mknod /dev/net/tun c 10 200

modem.tun6.ip 172.16.32.62
modem.tun6.secret whatsfordinner

172.16.32.62
2a03:a000:5:192:85ad:e4e:1239:1a

udp6 ipv6 packet send.

listen:
nc -6kluvw 0 -p 4059

send:
echo "hello" | socat - udp6:[2a03:b0c0:1:d0::10b:c001]:4059

------------------------------------

./udpproxy.py 2a05:d014:8af:4c00:1f91:9695:0643:71e6 fd28:914c:1da9:0:021b:c50c:6003:b375
./udpproxy.py 2a05:d014:8af:4c00:80d3:59d4:8420:f985 fd28:914c:1da9:0:021b:c50c:6003:b375
./udpproxy.py 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8 fd28:914c:1da9:0:021b:c50c:6003:b375
./udpproxy.py 2a05:d014:8af:4c00:691f:5c19:7782:6861 fd28:914c:1da9:0:021b:c50c:6003:b375


--------------------------------------------------


git log --since "MAY 16 2017" --until "JUNE 2 2017" --pretty=format:"%h %an %ad"

refs/tags/v97 Tue May 16 13:16:59 2017 +0200
refs/tags/v98 Fri Jun 2 14:51:14 2017 +0200



---------------------------------------------

BackOffice VPN :

sudo openvpn --config ~/.vpn/SteveTickle.ovpn

BackOffice VPN:
SteveTickle
garment seize optimism allow
b67bc45987c51f40f43606839cfd757b


Ansible:

ansible-playbook  -i inventory/inventory  -e "target=localhost" playbooks/omnimesh.yml



-----------------------------------------------
gdb --args ./build/host-lnt-insecure/bin/agent
 -eui64 00-00-00-00-00-00-00-01
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0
 -initrtc
 -ctrlhub 127.0.0.1
 -ctrlhubport 4242
 -loglevel debug
 -param device.dlms.lls_password=lnt1
 -param device.dlms.authentication_key=31323334353637383930313233343536
 -param device.dlms.encryption_key=31323334353637383930313233343536
 -param device.dlms.hls_key=30303030303030303031303335383230
 -param device.time.sync_timer=1
 -param server.ip=fd00::1
 -param modem.tun6.ip=127.0.0.1
 -param modem.tun6.port=8050
 -param modem.tun6.secret=password
 -param modem.apn=4g.tele2.se
 -param server.mq.push_now=1
 -param server.mq.push_delay=30
 -rootcert /Data/Temp/KeyTest/root.crt.der
 -cert /Data/Temp/KeyTest/node.crt.der
 -key /Data/Temp/KeyTest/node.key.der
 -mackey /Data/Temp/KeyTest/mac-keys.txt
 -gateway
 -socket


gdb --args ./build/host-lnt-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01 \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0 \
 -initrtc \
 -ctrlhub 127.0.0.1 \
 -ctrlhubport 4242 \
 -loglevel debug \
 -param device.dlms.lls_password=lnt1 \
 -param device.dlms.authentication_key=31323334353637383930313233343536 \
 -param device.dlms.encryption_key=31323334353637383930313233343536 \
 -param device.dlms.hls_key=30303030303030303031303335383230 \
 -param device.time.sync_timer=1 \
 -param server.ip=2a03:a000:192:35:a72f:f760:55bd:9cf \
 -param server.port=5684 \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner \
 -param modem.apn=4g.tele2.se \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=0 \
 -param device.dlms.pipe_enabled=0 \
 -rootcert /Data/Temp/KeyTest/root.crt.der \
 -cert /Data/Temp/KeyTest/node.crt.der \
 -key /Data/Temp/KeyTest/node.key.der \
 -mackey /Data/Temp/KeyTest/mac-keys.txt \
 -gateway \
 -statedir AgentState \
 -socket

--------------------------------------------------

EVENT_FIRMWAREUPDATE_RESTART
coap response to the 'update' msg CoapResponsePreconditionFailed, if fileIds not correct or decryption failed.

----------------------------------------------

tun6d0 tcpdump on server:

15:46:51.252871 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:51.273854 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:52.374903 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:52.395176 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:53.495454 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:53.514675 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:54.762037 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:54.782972 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:56.007230 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:56.027404 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:57.126004 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:57.144665 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:58.244960 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:58.264564 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:46:59.363634 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 13
15:46:59.383066 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:47:50.568987 IP6 fd00::1.5684 > fd28:914c:1da9:0:21b:c50c:6000:4d34.5684: UDP, length 55
15:47:51.200792 IP6 fd28:914c:1da9:0:21b:c50c:6000:4d34.5684 > fd00::1.5684: UDP, length 88
15:47:59.967673 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 294
15:48:50.629317 IP6 fd00::1.5684 > fd28:914c:1da9:0:21b:c50c:6000:4d34.5684: UDP, length 55
15:48:53.856686 IP6 fd28:914c:1da9:0:21b:c50c:6000:4d34.5684 > fd00::1.5684: UDP, length 88
15:49:00.967076 IP6 fd00::1.46933 > fd28:914c:1da9:0:21b:c50c:6003:b375.4059: UDP, length 13
15:49:03.008632 IP6 fd28:914c:1da9:0:21b:c50c:6003:b375.4059 > fd00::1.46933: UDP, length 10
15:49:50.679846 IP6 fd00::1.5684 > fd28:914c:1da9:0:21b:c50c:6000:4d34.5684: UDP, length 55
15:50:02.146112 IP6 fd28:914c:1da9:0:21b:c50c:6000:4d34.5684 > fd00::1.5684: UDP, length 125
15:50:02.154162 IP6 fd00::1.5684 > fd28:914c:1da9:0:21b:c50c:6000:4d34.5684: UDP, length 37
15:50:02.263629 IP6 fd00::1.5684 > fd28:914c:1da9:0:21b:c50c:6000:4d34.5684: UDP, length 55
15:50:02.846015 IP6 fd28:914c:1da9:0:21b:c50c:6000:4d34.5684 > fd00::1.5684: UDP, length 88


eth0 tcpdump on server:
15:46:50.152194 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:50.152449 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:50.518944 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 103
15:46:50.624539 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 136
15:46:51.252732 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:51.253000 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:51.273697 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:51.274215 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:51.490939 IP 42-107-233-226.live.vodafone.in.63330 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48
15:46:51.491282 IP genus-tt1.dev.cyanconnode.com.8050 > 42-107-233-226.live.vodafone.in.63330: UDP, length 48
15:46:52.374593 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:52.375052 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:52.395000 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:52.395388 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:53.495246 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:53.495596 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:53.514518 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:53.514788 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:54.761889 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:54.762219 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:54.782830 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:54.783113 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:56.006966 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:56.007391 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:56.027247 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:56.027655 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:57.125819 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:57.126168 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:57.144526 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:57.144869 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:58.244775 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:58.245128 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
15:46:58.264407 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
15:46:58.264685 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:46:59.363499 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 61
15:46:59.363777 IP6 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059 > 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875: UDP, length 13
>>> above was the last one received on PC.

15:46:59.382915 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
>>> This packet was sent from PC to server, reaches tun6d0 interface, but not the agent.

15:46:59.383189 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
>>> This is likely the above 294b packet forwarded and wrapped by tun6d over ipv4 to the gateway (cellular)

15:47:17.153070 IP 42-107-233-226.live.vodafone.in.63330 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48
15:47:17.153339 IP genus-tt1.dev.cyanconnode.com.8050 > 42-107-233-226.live.vodafone.in.63330: UDP, length 48
15:47:19.512107 IP6 fe80::2e:9ff:fe37:1e84.dhcpv6-client > ff02::1:2.dhcpv6-server: dhcp6 renew
15:47:19.512152 IP6 fe80::51:daff:fe5a:740.dhcpv6-server > fe80::2e:9ff:fe37:1e84.dhcpv6-client: dhcp6 reply
15:47:23.952457 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48
15:47:23.952757 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 48
15:47:41.369688 IP 42-107-233-226.live.vodafone.in.63330 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48
15:47:41.369918 IP genus-tt1.dev.cyanconnode.com.8050 > 42-107-233-226.live.vodafone.in.63330: UDP, length 48
15:47:48.939332 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48
15:47:48.939561 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 48
15:47:50.569145 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 103
15:47:51.200567 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 136
15:47:52.157101 IP genus-tt1.dev.cyanconnode.com.bootpc > ip-10-73-1-1.eu-central-1.compute.internal.bootps: BOOTP/DHCP, Request from 02:2e:09:37:1e:84 (oui Unknown), length 300
15:47:52.157144 IP ip-10-73-1-1.eu-central-1.compute.internal.bootps > genus-tt1.dev.cyanconnode.com.bootpc: BOOTP/DHCP, Reply, length 548
15:47:52.157241 IP genus-tt1.dev.cyanconnode.com.46517 > ip-10-73-0-2.eu-central-1.compute.internal.domain: 33151+ PTR? 1.1.73.10.in-addr.arpa. (40)
15:47:52.157954 IP ip-10-73-0-2.eu-central-1.compute.internal.domain > genus-tt1.dev.cyanconnode.com.46517: 33151 1/0/0 PTR ip-10-73-1-1.eu-central-1.compute.internal. (96)


(agent log) 2018-11-28 15:47:59.125 #1   000000006003b375 <log> 4:39:07.033 [debug] [    dlmspipe] { dlmspipe}: close session: timeout
>>> This is the agent timing out the session.

15:47:59.967505 IP6 2a03:a000:5:192:226:b9ff:fe1b:4bf8.52875 > 2a05:d014:8af:4c00:c41d:cd18:9d70:96d8.4059: UDP, length 294
>>> This is Kalkitech retrying... unfortunately the agent has already timed out and closed the session.


15:47:59.967868 IP genus-tt1.dev.cyanconnode.com.8050 > 193.192.218.204.50412: UDP, length 342
15:48:06.280086 IP 42-107-233-226.live.vodafone.in.63330 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48
15:48:06.280282 IP genus-tt1.dev.cyanconnode.com.8050 > 42-107-233-226.live.vodafone.in.63330: UDP, length 48
15:48:16.635276 IP 193.192.218.204.50412 > genus-tt1.dev.cyanconnode.com.8050: UDP, length 48


agent log:

02-1b-c5-0c-60-00-4d-34: rssi -88 dBm, sec 5, payload 214 B
2018-11-28 15:46:53.927 #1   000000006003b375 <log> 4:38:01.829 [debug] [      mac_rx] {   mac_rx}: Received 153 B, unicast #173 from 02-1b-c5-0c-60-00-4d-34: rssi -89 dBm, sec 5, payload 123 B
2018-11-28 15:46:53.943 #1   000000006003b375 <log> 4:38:01.843 [debug] [ tran_switch] {   mac_rx}: UDP received from [fd00::1]:46933 to [fd28:914c:1da9:0:21b:c50c:6003:b375]:4059 of size 294: dtls session: -1
2018-11-28 15:46:53.951 #1   000000006003b375 <log> 4:38:01.858 [debug] [    dlmspipe] {   mac_rx}: UDP rx 294 B from [fd00::1]:46933
2018-11-28 15:46:53.959 #1   000000006003b375 <log> 4:38:01.867 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task triggered **
2018-11-28 15:46:53.968 #1   000000006003b375 <log> 4:38:01.875 [debug] [    dlmspipe] { dlmspipe}:  ** packet forwarding to meter. **
2018-11-28 15:46:53.975 #1   000000006003b375 <log> 4:38:01.883 [debug] [    dlmspipe] { dlmspipe}: HDLC send 286 B
2018-11-28 15:46:53.981 #1   000000006003b375 <log> 4:38:01.890 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:53.988 #1   000000006003b375 <log> 4:38:01.896 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a12a
2018-11-28 15:46:53.994 #1   000000006003b375 <log> 4:38:01.903 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 03
2018-11-28 15:46:54.001 #1   000000006003b375 <log> 4:38:01.910 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a1
2018-11-28 15:46:54.007 #1   000000006003b375 <log> 4:38:01.916 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 10
2018-11-28 15:46:54.014 #1   000000006003b375 <log> 4:38:01.923 [debug] [        hdlc] { dlmspipe}: tx: (1/1): c834
2018-11-28 15:46:54.021 #1   000000006003b375 <log> 4:38:01.929 [debug] [        hdlc] { dlmspipe}: tx: (1/1): e6e600
2018-11-28 15:46:54.032 #1   000000006003b375 <log> 4:38:01.938 [debug] [        hdlc] { dlmspipe}: tx: (1/18): c301c1001200002c0000ff0201020206
2018-11-28 15:46:54.041 #1   000000006003b375 <log> 4:38:01.947 [debug] [        hdlc] { dlmspipe}: tx: (2/18): 0000003a0982010600010400bc27d14f
2018-11-28 15:46:54.050 #1   000000006003b375 <log> 4:38:01.956 [debug] [        hdlc] { dlmspipe}: tx: (3/18): 232d0600f1920600032cc19306000a20
2018-11-28 15:46:54.059 #1   000000006003b375 <log> 4:38:01.965 [debug] [        hdlc] { dlmspipe}: tx: (4/18): f193060007247c40fa00b41308cc4c43
2018-11-28 15:46:54.068 #1   000000006003b375 <log> 4:38:01.974 [debug] [        hdlc] { dlmspipe}: tx: (5/18): 8001085d1f42bc27d14f242d02001f42
2018-11-28 15:46:54.078 #1   000000006003b375 <log> 4:38:01.984 [debug] [        hdlc] { dlmspipe}: tx: (6/18): bc27554f252d1f42bc27564f262df190
2018-11-28 15:46:54.087 #1   000000006003b375 <log> 4:38:01.993 [debug] [        hdlc] { dlmspipe}: tx: (7/18): 18000200062c75903c00032c76903c00
2018-11-28 15:46:54.096 #1   000000006003b375 <log> 4:38:02.002 [debug] [        hdlc] { dlmspipe}: tx: (8/18): 07287c40fa00b41308cc4c438001085d
2018-11-28 15:46:54.105 #1   000000006003b375 <log> 4:38:02.011 [debug] [        hdlc] { dlmspipe}: tx: (9/18): 1f42bc27594f1f2d9253bc274f493ff0
2018-11-28 15:46:54.115 #1   000000006003b375 <log> 4:38:02.020 [debug] [        hdlc] { dlmspipe}: tx: (10/18): ff008f10084f1f42bc275f4f1f2d4f4f
2018-11-28 15:46:54.124 #1   000000006003b375 <log> 4:38:02.030 [debug] [        hdlc] { dlmspipe}: tx: (11/18): 3f5030f8085f9253bc2749484c49b413
2018-11-28 15:46:54.133 #1   000000006003b375 <log> 4:38:02.039 [debug] [        hdlc] { dlmspipe}: tx: (12/18): 22bbc24c77371f42bc27594f1f2d9253
2018-11-28 15:46:54.143 #1   000000006003b375 <log> 4:38:02.048 [debug] [        hdlc] { dlmspipe}: tx: (13/18): bc274c49b41322bbc24c78371f42bc27
2018-11-28 15:46:54.152 #1   000000006003b375 <log> 4:38:02.058 [debug] [        hdlc] { dlmspipe}: tx: (14/18): 594f1f2d9253bc274c49b41322bbc24c
2018-11-28 15:46:54.161 #1   000000006003b375 <log> 4:38:02.067 [debug] [        hdlc] { dlmspipe}: tx: (15/18): 79371f42bc27594f1f2d9253bc277990
2018-11-28 15:46:54.171 #1   000000006003b375 <log> 4:38:02.076 [debug] [        hdlc] { dlmspipe}: tx: (16/18): 070001204943f193060005244c49b413
2018-11-28 15:46:54.180 #1   000000006003b375 <log> 4:38:02.086 [debug] [        hdlc] { dlmspipe}: tx: (17/18): 22bbc24c7a371f42bc27594f1f2d9253
2018-11-28 15:46:54.189 #1   000000006003b375 <log> 4:38:02.095 [debug] [        hdlc] { dlmspipe}: tx: (18/18): bc274c49b41322bbc24c76378f85
2018-11-28 15:46:54.490 #1   000000006003b375 <log> 4:38:02.399 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 3eef
2018-11-28 15:46:54.497 #1   000000006003b375 <log> 4:38:02.405 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:54.507 #1   000000006003b375 <log> 4:38:02.412 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task waiting to be triggered (59992) **
2018-11-28 15:46:54.660 #1   000000006003b375 <log> 4:38:02.567 [debug] [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
2018-11-28 15:46:54.669 #1   000000006003b375 <log> 4:38:02.575 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea011a1033049b4e6e700c701c10000
2018-11-28 15:46:54.676 #1   000000006003b375 <log> 4:38:02.584 [debug] [        hdlc] {     hdlc}: rx: (2/2): fcb47e
2018-11-28 15:46:54.685 #1   000000006003b375 <log> 4:38:02.591 [debug] [    dlmspipe] {     hdlc}: HDLC rx 5 B forwarding to [fd00::1]:46933
2018-11-28 15:46:54.699 #1   000000006003b375 <log> 4:38:02.601 [debug] [          ip] {     hdlc}: Send IP on lowpan, 21 B, type 17, ttl 32: fd28:914c:1da9:0:21b:c50c:6003:b375 -> fd00::1
2018-11-28 15:46:54.708 #1   000000006003b375 <log> 4:38:02.614 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:46:54.731 #1   000000006003b375 <log> 4:38:02.634 [debug] [      mac_tx] {lowpan_tx}: Tx 77 B at -26 dBm as #17 to 02-1b-c5-0c-60-00-4d-34: Got ack after 1 try
2018-11-28 15:46:54.743 #1   000000006003b375 <log> 4:38:02.646 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-4d-34: ack: 1, nack: 0, roundtrip: 1 ms, etx: 128/128
2018-11-28 15:46:54.754 #1   000000006003b375 <log> 4:38:02.658 [ info] [      status] { schedule}: Version: ipa3-genus-dlms-insecure:v136-13-g1a2c258 on hw ipa3
2018-11-28 15:46:54.762 #1   000000006003b375 <log> 4:38:02.669 [ info] [      status] { schedule}: IID: 02-1b-c5-0c-60-03-b3-75
2018-11-28 15:46:54.772 #1   000000006003b375 <log> 4:38:02.677 [event] [      status] { schedule}: LoWPAN address: fd28:914c:1da9:0:21b:c50c:6003:b375
2018-11-28 15:46:54.782 #1   000000006003b375 <log> 4:38:02.687 [debug] [      status] { schedule}: Next hop (parent): fd28:914c:1da9:0:21b:c50c:6000:4d34
2018-11-28 15:46:54.793 #1   000000006003b375 <log> 4:38:02.697 [ info] [          ip] { schedule}: IP queue lowpan: pkts: 0 (max 2), bytes: 0 (max 290), max wait: 252 ms
2018-11-28 15:46:54.806 #1   000000006003b375 <log> 4:38:02.708 [ info] [       radio] { schedule}: RX packets:27472 bad:1144, TX packets:1779 channel-busy:145 errors:0, resets: 0
2018-11-28 15:46:54.815 #1   000000006003b375 <log> 4:38:02.721 [ info] [       login] { schedule}: Login state: logged in, server: [fd00::1]:5684
2018-11-28 15:46:54.823 #1   000000006003b375 <log> 4:38:02.730 [ info] [      conman] { schedule}: Agent Mode: Auto, ifaces up: lowpan
2018-11-28 15:46:54.834 #1   000000006003b375 <log> 4:38:02.741 [debug] [        osal] { schedule}: Task:  3  schedule p2  464/1440 3.510s
2018-11-28 15:46:54.844 #1   000000006003b375 <log> 4:38:02.750 [debug] [        osal] { schedule}: Task:  2      IDLE p0  232/ 280 16643.965s
2018-11-28 15:46:54.852 #1   000000006003b375 <log> 4:38:02.759 [debug] [        osal] { schedule}: Task: 10       rpl p3  672/1600 2.395s
2018-11-28 15:46:54.861 #1   000000006003b375 <log> 4:38:02.767 [debug] [        osal] { schedule}: Task: 11  readings p2  856/1600 0.340s
2018-11-28 15:46:54.870 #1   000000006003b375 <log> 4:38:02.776 [debug] [        osal] { schedule}: Task:  1  terminal p1  328/1600 3.375s
2018-11-28 15:46:54.879 #1   000000006003b375 <log> 4:38:02.785 [debug] [        osal] { schedule}: Task: 12      hdlc p4  288/1200 7.624s
2018-11-28 15:46:54.888 #1   000000006003b375 <log> 4:38:02.794 [debug] [        osal] { schedule}: Task: 15      cron p2 1016/1200 0.011s
2018-11-28 15:46:54.896 #1   000000006003b375 <log> 4:38:02.803 [debug] [        osal] { schedule}: Task: 17  dlmspipe p2  248/1200 9.166s
2018-11-28 15:46:54.906 #1   000000006003b375 <log> 4:38:02.811 [debug] [        osal] { schedule}: Task:  6     radio p5  408/ 800 3.622s
2018-11-28 15:46:54.919 #1   000000006003b375 <log> 4:38:02.821 [debug] [      mac_rx] {   mac_rx}: Received 244 B, unicast #174 from 02-1b-c5-0c-60-00-4d-34: rssi -91 dBm, sec 5, payload 214 B
2018-11-28 15:46:54.928 #1   000000006003b375 <log> 4:38:02.835 [debug] [        osal] { schedule}: Task:  5    mac_rx p4  600/1400 5.772s
2018-11-28 15:46:54.937 #1   000000006003b375 <log> 4:38:02.844 [debug] [        osal] { schedule}: Task:  7 lowpan_tx p3  432/1000 1.287s
2018-11-28 15:46:54.946 #1   000000006003b375 <log> 4:38:02.852 [debug] [        osal] { schedule}: Task: 16    filedl p2 1312/1600 0.000s
2018-11-28 15:46:54.955 #1   000000006003b375 <log> 4:38:02.861 [debug] [        osal] { schedule}: Task: 14 timeSynch p2 2248/3072 0.030s
2018-11-28 15:46:54.964 #1   000000006003b375 <log> 4:38:02.870 [debug] [        osal] { schedule}: Task:  9      dtls p2  656/1700 0.780s
2018-11-28 15:46:54.972 #1   000000006003b375 <log> 4:38:02.879 [debug] [        osal] { schedule}: Task:  8      coap p3 1440/2048 0.019s
2018-11-28 15:46:54.981 #1   000000006003b375 <log> 4:38:02.887 [debug] [        osal] { schedule}: Task:  4  ctrlport p3 1320/1600 0.000s
2018-11-28 15:46:54.990 #1   000000006003b375 <log> 4:38:02.896 [debug] [        osal] { schedule}: Task: 13      dlms p2  232/1200 0.834s
2018-11-28 15:46:54.997 #1   000000006003b375 <log> 4:38:02.905 [debug] [      status] { schedule}: CPU load: 3%
2018-11-28 15:46:55.007 #1   000000006003b375 <log> 4:38:02.912 [debug] [    memstats] { schedule}: FILE                      now blocks    max  total  calls
2018-11-28 15:46:55.018 #1   000000006003b375 <log> 4:38:02.922 [debug] [    memstats] { schedule}: wolfssl_funcs            2697     24   6242  50888    216
2018-11-28 15:46:55.028 #1   000000006003b375 <log> 4:38:02.933 [debug] [    memstats] { schedule}: device-dlms               960      1    960    960      1
2018-11-28 15:46:55.038 #1   000000006003b375 <log> 4:38:02.943 [debug] [    memstats] { schedule}: dataprofile               368     10    368    368     10
2018-11-28 15:46:55.052 #1   000000006003b375 <log> 4:38:02.954 [debug] [      mac_rx] {   mac_rx}: Received 153 B, unicast #175 from 02-1b-c5-0c-60-00-4d-34: rssi -92 dBm, sec 5, payload 123 B
2018-11-28 15:46:55.068 #1   000000006003b375 <log> 4:38:02.968 [debug] [ tran_switch] {   mac_rx}: UDP received from [fd00::1]:46933 to [fd28:914c:1da9:0:21b:c50c:6003:b375]:4059 of size 294: dtls session: -1
2018-11-28 15:46:55.076 #1   000000006003b375 <log> 4:38:02.983 [debug] [    dlmspipe] {   mac_rx}: UDP rx 294 B from [fd00::1]:46933
2018-11-28 15:46:55.087 #1   000000006003b375 <log> 4:38:02.991 [debug] [    memstats] { schedule}: lowpan_frag               328      1    328  87904    268
2018-11-28 15:46:55.097 #1   000000006003b375 <log> 4:38:03.002 [debug] [    memstats] { schedule}: schedule_service          220     11    280   1740     87
2018-11-28 15:46:55.108 #1   000000006003b375 <log> 4:38:03.012 [debug] [    memstats] { schedule}: GLOBAL                   4445     53   8719 1988599  23631
2018-11-28 15:46:55.125 #1   000000006003b375 <log> 4:38:03.023 [ info] [    rpl/task] {      rpl}: RPL: attached, inst 20, rank 256, dag fd28:914c:1da9:0:21b:c50c:6000:4d34 v.240, pp fd28:914c:1da9:0:21b:c50c:6000:4d34, hop 1, routes 0
2018-11-28 15:46:55.132 #1   000000006003b375 <log> 4:38:03.040 [ info] [    rpl/data] {      rpl}: Number of dags: 1
2018-11-28 15:46:55.141 #1   000000006003b375 <log> 4:38:03.047 [debug] [    rpl/data] {      rpl}: DAG prefix                ver DODAG-ID
2018-11-28 15:46:55.152 #1   000000006003b375 <log> 4:38:03.056 [debug] [    rpl/data] {      rpl}:   0 fd28:914c:1da9::      240 fd28:914c:1da9:0:21b:c50c:6000:4d34
2018-11-28 15:46:55.161 #1   000000006003b375 <log> 4:38:03.067 [ info] [    rpl/data] {      rpl}: Neighbors: 1, local: 1. Parents: 1, preferred: 1
2018-11-28 15:46:55.174 #1   000000006003b375 <log> 4:38:03.077 [debug] [    rpl/data] {      rpl}: NB D state       iid                     ver  rank  ttl   etx sam t_btr global IP
2018-11-28 15:46:55.189 #1   000000006003b375 <log> 4:38:03.089 [debug] [    rpl/data] {      rpl}:  0 0 pref-parent 02-1b-c5-0c-60-00-4d-34 240   128 2096   128  64     0 fd28:914c:1da9:0:21b:c50c:6000:4d34
2018-11-28 15:46:55.199 #1   000000006003b375 <log> 4:38:03.104 [debug] [rpl/routelist] {      rpl}: RPL route list: 0 entries using 0 B (0 B/entry)
2018-11-28 15:46:55.206 #1   000000006003b375 <log> 4:38:03.113 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task triggered **
2018-11-28 15:46:55.215 #1   000000006003b375 <log> 4:38:03.121 [debug] [    dlmspipe] { dlmspipe}:  ** packet forwarding to meter. **
2018-11-28 15:46:55.222 #1   000000006003b375 <log> 4:38:03.130 [debug] [    dlmspipe] { dlmspipe}: HDLC send 286 B
2018-11-28 15:46:55.228 #1   000000006003b375 <log> 4:38:03.137 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:55.235 #1   000000006003b375 <log> 4:38:03.143 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a12a
2018-11-28 15:46:55.241 #1   000000006003b375 <log> 4:38:03.150 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 03
2018-11-28 15:46:55.248 #1   000000006003b375 <log> 4:38:03.156 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a1
2018-11-28 15:46:55.254 #1   000000006003b375 <log> 4:38:03.163 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 32
2018-11-28 15:46:55.261 #1   000000006003b375 <log> 4:38:03.169 [debug] [        hdlc] { dlmspipe}: tx: (1/1): d836
2018-11-28 15:46:55.268 #1   000000006003b375 <log> 4:38:03.176 [debug] [        hdlc] { dlmspipe}: tx: (1/1): e6e600
2018-11-28 15:46:55.279 #1   000000006003b375 <log> 4:38:03.184 [debug] [        hdlc] { dlmspipe}: tx: (1/18): c301c1001200002c0000ff0201020206
2018-11-28 15:46:55.288 #1   000000006003b375 <log> 4:38:03.193 [debug] [        hdlc] { dlmspipe}: tx: (2/18): 0000003b09820106000105001f42bc27
2018-11-28 15:46:55.297 #1   000000006003b375 <log> 4:38:03.203 [debug] [        hdlc] { dlmspipe}: tx: (3/18): 594f1f2d9253bc274c49b41322bbc24c
2018-11-28 15:46:55.306 #1   000000006003b375 <log> 4:38:03.212 [debug] [        hdlc] { dlmspipe}: tx: (4/18): 75371f42bc27594f1f2d9253bc274c49
2018-11-28 15:46:55.315 #1   000000006003b375 <log> 4:38:03.221 [debug] [        hdlc] { dlmspipe}: tx: (5/18): b41322bbc24c7437d292773798401428
2018-11-28 15:46:55.325 #1   000000006003b375 <log> 4:38:03.230 [debug] [        hdlc] { dlmspipe}: tx: (6/18): d292984077370420d292783797400c28
2018-11-28 15:46:55.334 #1   000000006003b375 <log> 4:38:03.240 [debug] [        hdlc] { dlmspipe}: tx: (7/18): d292984077378420d292974078378020
2018-11-28 15:46:55.343 #1   000000006003b375 <log> 4:38:03.249 [debug] [        hdlc] { dlmspipe}: tx: (8/18): d292964079377c28d243d736c243c840
2018-11-28 15:46:55.352 #1   000000006003b375 <log> 4:38:03.258 [debug] [        hdlc] { dlmspipe}: tx: (9/18): d292984077376c20d292974078376820
2018-11-28 15:46:55.362 #1   000000006003b375 <log> 4:38:03.267 [debug] [        hdlc] { dlmspipe}: tx: (10/18): d292964079376420d292954076372f20
2018-11-28 15:46:55.371 #1   000000006003b375 <log> 4:38:03.277 [debug] [        hdlc] { dlmspipe}: tx: (11/18): 40185c427537b413fab6c14c0b004018
2018-11-28 15:46:55.380 #1   000000006003b375 <log> 4:38:03.286 [debug] [        hdlc] { dlmspipe}: tx: (12/18): 5c429440b413fab6c14c0a005c410b00
2018-11-28 15:46:55.390 #1   000000006003b375 <log> 4:38:03.295 [debug] [        hdlc] { dlmspipe}: tx: (13/18): 4c127c403c005e429037b4138cc84e4c
2018-11-28 15:46:55.399 #1   000000006003b375 <log> 4:38:03.304 [debug] [        hdlc] { dlmspipe}: tx: (14/18): 7c41b4138cc84c125c410c004c127c40
2018-11-28 15:46:55.408 #1   000000006003b375 <log> 4:38:03.314 [debug] [        hdlc] { dlmspipe}: tx: (15/18): 3c005e429037b4138cc84e4c7c41b413
2018-11-28 15:46:55.417 #1   000000006003b375 <log> 4:38:03.323 [debug] [        hdlc] { dlmspipe}: tx: (16/18): 8cc87e414e9c0320c243c7403b3dd292
2018-11-28 15:46:55.427 #1   000000006003b375 <log> 4:38:03.332 [debug] [        hdlc] { dlmspipe}: tx: (17/18): 763795400828d292954076370c20d292
2018-11-28 15:46:55.436 #1   000000006003b375 <log> 4:38:03.342 [debug] [        hdlc] { dlmspipe}: tx: (18/18): 944075370828d243c74040187f08
2018-11-28 15:46:55.737 #1   000000006003b375 <log> 4:38:03.646 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 62c6
2018-11-28 15:46:55.744 #1   000000006003b375 <log> 4:38:03.652 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:55.754 #1   000000006003b375 <log> 4:38:03.659 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task waiting to be triggered (59870) **
2018-11-28 15:46:55.906 #1   000000006003b375 <log> 4:38:03.814 [debug] [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
2018-11-28 15:46:55.916 #1   000000006003b375 <log> 4:38:03.821 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea011a103525df4e6e700c701c10000
2018-11-28 15:46:55.922 #1   000000006003b375 <log> 4:38:03.830 [debug] [        hdlc] {     hdlc}: rx: (2/2): fcb47e
2018-11-28 15:46:55.932 #1   000000006003b375 <log> 4:38:03.838 [debug] [    dlmspipe] {     hdlc}: HDLC rx 5 B forwarding to [fd00::1]:46933
2018-11-28 15:46:55.945 #1   000000006003b375 <log> 4:38:03.847 [debug] [          ip] {     hdlc}: Send IP on lowpan, 21 B, type 17, ttl 32: fd28:914c:1da9:0:21b:c50c:6003:b375 -> fd00::1
2018-11-28 15:46:55.954 #1   000000006003b375 <log> 4:38:03.860 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:46:55.977 #1   000000006003b375 <log> 4:38:03.880 [debug] [      mac_tx] {lowpan_tx}: Tx 77 B at -26 dBm as #18 to 02-1b-c5-0c-60-00-4d-34: Got ack after 1 try
2018-11-28 15:46:55.989 #1   000000006003b375 <log> 4:38:03.892 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-4d-34: ack: 1, nack: 0, roundtrip: 1 ms, etx: 128/128
2018-11-28 15:46:56.160 #1   000000006003b375 <log> 4:38:04.061 [debug] [      mac_rx] {   mac_rx}: Received 244 B, unicast #176 from 02-1b-c5-0c-60-00-4d-34: rssi -89 dBm, sec 5, payload 214 B
2018-11-28 15:46:56.291 #1   000000006003b375 <log> 4:38:04.192 [debug] [      mac_rx] {   mac_rx}: Received 153 B, unicast #177 from 02-1b-c5-0c-60-00-4d-34: rssi -84 dBm, sec 5, payload 123 B
2018-11-28 15:46:56.306 #1   000000006003b375 <log> 4:38:04.206 [debug] [ tran_switch] {   mac_rx}: UDP received from [fd00::1]:46933 to [fd28:914c:1da9:0:21b:c50c:6003:b375]:4059 of size 294: dtls session: -1
2018-11-28 15:46:56.315 #1   000000006003b375 <log> 4:38:04.221 [debug] [    dlmspipe] {   mac_rx}: UDP rx 294 B from [fd00::1]:46933
2018-11-28 15:46:56.323 #1   000000006003b375 <log> 4:38:04.230 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task triggered **
2018-11-28 15:46:56.331 #1   000000006003b375 <log> 4:38:04.238 [debug] [    dlmspipe] { dlmspipe}:  ** packet forwarding to meter. **
2018-11-28 15:46:56.338 #1   000000006003b375 <log> 4:38:04.246 [debug] [    dlmspipe] { dlmspipe}: HDLC send 286 B
2018-11-28 15:46:56.345 #1   000000006003b375 <log> 4:38:04.253 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:56.351 #1   000000006003b375 <log> 4:38:04.259 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a12a
2018-11-28 15:46:56.358 #1   000000006003b375 <log> 4:38:04.266 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 03
2018-11-28 15:46:56.364 #1   000000006003b375 <log> 4:38:04.273 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a1
2018-11-28 15:46:56.371 #1   000000006003b375 <log> 4:38:04.279 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 54
2018-11-28 15:46:56.378 #1   000000006003b375 <log> 4:38:04.286 [debug] [        hdlc] { dlmspipe}: tx: (1/1): e830
2018-11-28 15:46:56.384 #1   000000006003b375 <log> 4:38:04.292 [debug] [        hdlc] { dlmspipe}: tx: (1/1): e6e600
2018-11-28 15:46:56.395 #1   000000006003b375 <log> 4:38:04.301 [debug] [        hdlc] { dlmspipe}: tx: (1/18): c301c1001200002c0000ff0201020206
2018-11-28 15:46:56.404 #1   000000006003b375 <log> 4:38:04.310 [debug] [        hdlc] { dlmspipe}: tx: (2/18): 0000003c09820106000106005c429037
2018-11-28 15:46:56.413 #1   000000006003b375 <log> 4:38:04.319 [debug] [        hdlc] { dlmspipe}: tx: (3/18): b4138e2e273df2400a009b36f240e000
2018-11-28 15:46:56.423 #1   000000006003b375 <log> 4:38:04.328 [debug] [        hdlc] { dlmspipe}: tx: (4/18): 9c36f240a1008f1df240a000901db313
2018-11-28 15:46:56.432 #1   000000006003b375 <log> 4:38:04.337 [debug] [        hdlc] { dlmspipe}: tx: (5/18): 96efc2438340d2428340c637b413e485
2018-11-28 15:46:56.441 #1   000000006003b375 <log> 4:38:04.347 [debug] [        hdlc] { dlmspipe}: tx: (6/18): d243c74040185c429037b4138e2e0a3d
2018-11-28 15:46:56.450 #1   000000006003b375 <log> 4:38:04.356 [debug] [        hdlc] { dlmspipe}: tx: (7/18): d243c74040185c429037b4138e2e023d
2018-11-28 15:46:56.460 #1   000000006003b375 <log> 4:38:04.365 [debug] [        hdlc] { dlmspipe}: tx: (8/18): f2400a009b36f240e0009c36f240a100
2018-11-28 15:46:56.469 #1   000000006003b375 <log> 4:38:04.374 [debug] [        hdlc] { dlmspipe}: tx: (9/18): 8f1df240a000901db31396efc2438340
2018-11-28 15:46:56.478 #1   000000006003b375 <log> 4:38:04.383 [debug] [        hdlc] { dlmspipe}: tx: (10/18): d2428340c637b413e48540185e427737
2018-11-28 15:46:56.487 #1   000000006003b375 <log> 4:38:04.393 [debug] [        hdlc] { dlmspipe}: tx: (11/18): 40185d42783740185c427937b413ec9c
2018-11-28 15:46:56.497 #1   000000006003b375 <log> 4:38:04.402 [debug] [        hdlc] { dlmspipe}: tx: (12/18): 084c7940c80055421638464356922738
2018-11-28 15:46:56.506 #1   000000006003b375 <log> 4:38:04.411 [debug] [        hdlc] { dlmspipe}: tx: (13/18): 142c4f450f5f189f082507284f450f5f
2018-11-28 15:46:56.515 #1   000000006003b375 <log> 4:38:04.421 [debug] [        hdlc] { dlmspipe}: tx: (14/18): 8f93082502244945083c755375930320
2018-11-28 15:46:56.525 #1   000000006003b375 <log> 4:38:04.430 [debug] [        hdlc] { dlmspipe}: tx: (15/18): 7940c800023c5653e93f7990c8000b20
2018-11-28 15:46:56.534 #1   000000006003b375 <log> 4:38:04.439 [debug] [        hdlc] { dlmspipe}: tx: (16/18): c2431638d2432638d243c740d243c840
2018-11-28 15:46:56.543 #1   000000006003b375 <log> 4:38:04.449 [debug] [        hdlc] { dlmspipe}: tx: (17/18): c24318384b3c4f450f5f8f980825282c
2018-11-28 15:46:56.552 #1   000000006003b375 <log> 4:38:04.458 [debug] [        hdlc] { dlmspipe}: tx: (18/18): 5f4216384f4f49490f893f902850
2018-11-28 15:46:56.854 #1   000000006003b375 <log> 4:38:04.762 [debug] [        hdlc] { dlmspipe}: tx: (1/1): f618
2018-11-28 15:46:56.860 #1   000000006003b375 <log> 4:38:04.768 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:56.870 #1   000000006003b375 <log> 4:38:04.775 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task waiting to be triggered (59992) **
2018-11-28 15:46:57.023 #1   000000006003b375 <log> 4:38:04.930 [debug] [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
2018-11-28 15:46:57.032 #1   000000006003b375 <log> 4:38:04.938 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea011a1037469b0e6e700c701c10000
2018-11-28 15:46:57.039 #1   000000006003b375 <log> 4:38:04.947 [debug] [        hdlc] {     hdlc}: rx: (2/2): fcb47e
2018-11-28 15:46:57.048 #1   000000006003b375 <log> 4:38:04.954 [debug] [    dlmspipe] {     hdlc}: HDLC rx 5 B forwarding to [fd00::1]:46933
2018-11-28 15:46:57.062 #1   000000006003b375 <log> 4:38:04.963 [debug] [          ip] {     hdlc}: Send IP on lowpan, 21 B, type 17, ttl 32: fd28:914c:1da9:0:21b:c50c:6003:b375 -> fd00::1
2018-11-28 15:46:57.071 #1   000000006003b375 <log> 4:38:04.977 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:46:57.094 #1   000000006003b375 <log> 4:38:04.997 [debug] [      mac_tx] {lowpan_tx}: Tx 77 B at -26 dBm as #19 to 02-1b-c5-0c-60-00-4d-34: Got ack after 1 try
2018-11-28 15:46:57.106 #1   000000006003b375 <log> 4:38:05.009 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-4d-34: ack: 1, nack: 0, roundtrip: 1 ms, etx: 128/128
2018-11-28 15:46:57.280 #1   000000006003b375 <log> 4:38:05.181 [debug] [      mac_rx] {   mac_rx}: Received 244 B, unicast #178 from 02-1b-c5-0c-60-00-4d-34: rssi -87 dBm, sec 5, payload 214 B
2018-11-28 15:46:57.411 #1   000000006003b375 <log> 4:38:05.312 [debug] [      mac_rx] {   mac_rx}: Received 153 B, unicast #179 from 02-1b-c5-0c-60-00-4d-34: rssi -85 dBm, sec 5, payload 123 B
2018-11-28 15:46:57.427 #1   000000006003b375 <log> 4:38:05.326 [debug] [ tran_switch] {   mac_rx}: UDP received from [fd00::1]:46933 to [fd28:914c:1da9:0:21b:c50c:6003:b375]:4059 of size 294: dtls session: -1
2018-11-28 15:46:57.435 #1   000000006003b375 <log> 4:38:05.341 [debug] [    dlmspipe] {   mac_rx}: UDP rx 294 B from [fd00::1]:46933
2018-11-28 15:46:57.443 #1   000000006003b375 <log> 4:38:05.350 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task triggered **
2018-11-28 15:46:57.451 #1   000000006003b375 <log> 4:38:05.358 [debug] [    dlmspipe] { dlmspipe}:  ** packet forwarding to meter. **
2018-11-28 15:46:57.458 #1   000000006003b375 <log> 4:38:05.366 [debug] [    dlmspipe] { dlmspipe}: HDLC send 286 B
2018-11-28 15:46:57.465 #1   000000006003b375 <log> 4:38:05.373 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:57.471 #1   000000006003b375 <log> 4:38:05.379 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a12a
2018-11-28 15:46:57.478 #1   000000006003b375 <log> 4:38:05.386 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 03
2018-11-28 15:46:57.485 #1   000000006003b375 <log> 4:38:05.393 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a1
2018-11-28 15:46:57.491 #1   000000006003b375 <log> 4:38:05.399 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 76
2018-11-28 15:46:57.498 #1   000000006003b375 <log> 4:38:05.406 [debug] [        hdlc] { dlmspipe}: tx: (1/1): f832
2018-11-28 15:46:57.505 #1   000000006003b375 <log> 4:38:05.412 [debug] [        hdlc] { dlmspipe}: tx: (1/1): e6e600
2018-11-28 15:46:57.515 #1   000000006003b375 <log> 4:38:05.421 [debug] [        hdlc] { dlmspipe}: tx: (1/18): c301c1001200002c0000ff0201020206
2018-11-28 15:46:57.524 #1   000000006003b375 <log> 4:38:05.430 [debug] [        hdlc] { dlmspipe}: tx: (2/18): 0000003d098201060001070028000a34
2018-11-28 15:46:57.534 #1   000000006003b375 <log> 4:38:05.439 [debug] [        hdlc] { dlmspipe}: tx: (3/18): 5e4218384e4e5f4216384f4f49490f89
2018-11-28 15:46:57.543 #1   000000006003b375 <log> 4:38:05.448 [debug] [        hdlc] { dlmspipe}: tx: (4/18): 0e9f0334c2431838083c5e4218385e82
2018-11-28 15:46:57.552 #1   000000006003b375 <log> 4:38:05.457 [debug] [        hdlc] { dlmspipe}: tx: (5/18): 16384e595e53c24e18384e495e53c24e
2018-11-28 15:46:57.561 #1   000000006003b375 <log> 4:38:05.467 [debug] [        hdlc] { dlmspipe}: tx: (6/18): 1638d2432638d243c740d243c8401e3c
2018-11-28 15:46:57.570 #1   000000006003b375 <log> 4:38:05.476 [debug] [        hdlc] { dlmspipe}: tx: (7/18): 5f4216384f4f49490f893f9028000a34
2018-11-28 15:46:57.579 #1   000000006003b375 <log> 4:38:05.485 [debug] [        hdlc] { dlmspipe}: tx: (8/18): 5e4218384e4e5f4216384f4f49490f89
2018-11-28 15:46:57.588 #1   000000006003b375 <log> 4:38:05.494 [debug] [        hdlc] { dlmspipe}: tx: (9/18): 0e9f0334c2431838053cd28216381838
2018-11-28 15:46:57.597 #1   000000006003b375 <log> 4:38:05.503 [debug] [        hdlc] { dlmspipe}: tx: (10/18): c25918384e497e53c24e1638c2431938
2018-11-28 15:46:57.607 #1   000000006003b375 <log> 4:38:05.513 [debug] [        hdlc] { dlmspipe}: tx: (11/18): d24379363c406002b41360bbd2421838
2018-11-28 15:46:57.616 #1   000000006003b375 <log> 4:38:05.522 [debug] [        hdlc] { dlmspipe}: tx: (12/18): 8340d242193884407d400f003c408340
2018-11-28 15:46:57.625 #1   000000006003b375 <log> 4:38:05.531 [debug] [        hdlc] { dlmspipe}: tx: (13/18): b4131cafc24c92403d4060023c401000
2018-11-28 15:46:57.635 #1   000000006003b375 <log> 4:38:05.541 [debug] [        hdlc] { dlmspipe}: tx: (14/18): b413b0b1d243d7363c403006b41360bb
2018-11-28 15:46:57.644 #1   000000006003b375 <log> 4:38:05.550 [debug] [        hdlc] { dlmspipe}: tx: (15/18): 1c42442a3c5028003e402800b41390c8
2018-11-28 15:46:57.653 #1   000000006003b375 <log> 4:38:05.559 [debug] [        hdlc] { dlmspipe}: tx: (16/18): 5c0a0f4c5c060c5f824c442ad242452a
2018-11-28 15:46:57.662 #1   000000006003b375 <log> 4:38:05.569 [debug] [        hdlc] { dlmspipe}: tx: (17/18): 8440d242442a85401c42c22a0d431c52
2018-11-28 15:46:57.671 #1   000000006003b375 <log> 4:38:05.578 [debug] [        hdlc] { dlmspipe}: tx: (18/18): 462a1d62482a1e42c22a0f4300d5
2018-11-28 15:46:57.973 #1   000000006003b375 <log> 4:38:05.882 [debug] [        hdlc] { dlmspipe}: tx: (1/1): aa31
2018-11-28 15:46:57.980 #1   000000006003b375 <log> 4:38:05.888 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:57.989 #1   000000006003b375 <log> 4:38:05.895 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task waiting to be triggered (59992) **
2018-11-28 15:46:58.142 #1   000000006003b375 <log> 4:38:06.050 [debug] [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
2018-11-28 15:46:58.151 #1   000000006003b375 <log> 4:38:06.058 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea011a103967574e6e700c701c10000
2018-11-28 15:46:58.158 #1   000000006003b375 <log> 4:38:06.067 [debug] [        hdlc] {     hdlc}: rx: (2/2): fcb47e
2018-11-28 15:46:58.167 #1   000000006003b375 <log> 4:38:06.074 [debug] [    dlmspipe] {     hdlc}: HDLC rx 5 B forwarding to [fd00::1]:46933
2018-11-28 15:46:58.181 #1   000000006003b375 <log> 4:38:06.083 [debug] [          ip] {     hdlc}: Send IP on lowpan, 21 B, type 17, ttl 32: fd28:914c:1da9:0:21b:c50c:6003:b375 -> fd00::1
2018-11-28 15:46:58.190 #1   000000006003b375 <log> 4:38:06.097 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:46:58.213 #1   000000006003b375 <log> 4:38:06.117 [debug] [      mac_tx] {lowpan_tx}: Tx 77 B at -26 dBm as #20 to 02-1b-c5-0c-60-00-4d-34: Got ack after 1 try
2018-11-28 15:46:58.226 #1   000000006003b375 <log> 4:38:06.129 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-4d-34: ack: 1, nack: 0, roundtrip: 1 ms, etx: 128/128
2018-11-28 15:46:58.398 #1   000000006003b375 <log> 4:38:06.300 [debug] [      mac_rx] {   mac_rx}: Received 244 B, unicast #180 from 02-1b-c5-0c-60-00-4d-34: rssi -89 dBm, sec 5, payload 214 B
2018-11-28 15:46:58.530 #1   000000006003b375 <log> 4:38:06.432 [debug] [      mac_rx] {   mac_rx}: Received 153 B, unicast #181 from 02-1b-c5-0c-60-00-4d-34: rssi -86 dBm, sec 5, payload 123 B
2018-11-28 15:46:58.546 #1   000000006003b375 <log> 4:38:06.446 [debug] [ tran_switch] {   mac_rx}: UDP received from [fd00::1]:46933 to [fd28:914c:1da9:0:21b:c50c:6003:b375]:4059 of size 294: dtls session: -1
2018-11-28 15:46:58.554 #1   000000006003b375 <log> 4:38:06.461 [debug] [    dlmspipe] {   mac_rx}: UDP rx 294 B from [fd00::1]:46933
2018-11-28 15:46:58.562 #1   000000006003b375 <log> 4:38:06.470 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task triggered **
2018-11-28 15:46:58.571 #1   000000006003b375 <log> 4:38:06.478 [debug] [    dlmspipe] { dlmspipe}:  ** packet forwarding to meter. **
2018-11-28 15:46:58.577 #1   000000006003b375 <log> 4:38:06.486 [debug] [    dlmspipe] { dlmspipe}: HDLC send 286 B
2018-11-28 15:46:58.584 #1   000000006003b375 <log> 4:38:06.493 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:58.591 #1   000000006003b375 <log> 4:38:06.499 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a12a
2018-11-28 15:46:58.597 #1   000000006003b375 <log> 4:38:06.506 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 03
2018-11-28 15:46:58.604 #1   000000006003b375 <log> 4:38:06.513 [debug] [        hdlc] { dlmspipe}: tx: (1/1): a1
2018-11-28 15:46:58.610 #1   000000006003b375 <log> 4:38:06.519 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 98
2018-11-28 15:46:58.617 #1   000000006003b375 <log> 4:38:06.526 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 883c
2018-11-28 15:46:58.624 #1   000000006003b375 <log> 4:38:06.532 [debug] [        hdlc] { dlmspipe}: tx: (1/1): e6e600
2018-11-28 15:46:58.634 #1   000000006003b375 <log> 4:38:06.541 [debug] [        hdlc] { dlmspipe}: tx: (1/18): c301c1001200002c0000ff0201020206
2018-11-28 15:46:58.644 #1   000000006003b375 <log> 4:38:06.550 [debug] [        hdlc] { dlmspipe}: tx: (2/18): 0000003e0982010600010800b4134cc1
2018-11-28 15:46:58.653 #1   000000006003b375 <log> 4:38:06.559 [debug] [        hdlc] { dlmspipe}: tx: (3/18): 021232c203439242c22ad004824ce004
2018-11-28 15:46:58.662 #1   000000006003b375 <log> 4:38:06.568 [debug] [        hdlc] { dlmspipe}: tx: (4/18): 824de2049242e404462a9242e604482a
2018-11-28 15:46:58.671 #1   000000006003b375 <log> 4:38:06.577 [debug] [        hdlc] { dlmspipe}: tx: (5/18): 034332419242462a982a9242482a9a2a
2018-11-28 15:46:58.680 #1   000000006003b375 <log> 4:38:06.587 [debug] [        hdlc] { dlmspipe}: tx: (6/18): d2429b2a8640d2429a2a8740d242992a
2018-11-28 15:46:58.690 #1   000000006003b375 <log> 4:38:06.596 [debug] [        hdlc] { dlmspipe}: tx: (7/18): 8840d242982a89403d4030063c401000
2018-11-28 15:46:58.699 #1   000000006003b375 <log> 4:38:06.605 [debug] [        hdlc] { dlmspipe}: tx: (8/18): b413b0b1d29388380820d2d37f36d253
2018-11-28 15:46:58.708 #1   000000006003b375 <log> 4:38:06.614 [debug] [        hdlc] { dlmspipe}: tx: (9/18): dc377c409700b41306163c40500eb413
2018-11-28 15:46:58.717 #1   000000006003b375 <log> 4:38:06.623 [debug] [        hdlc] { dlmspipe}: tx: (10/18): 60bbc2439140c2439040c243bb41c243
2018-11-28 15:46:58.727 #1   000000006003b375 <log> 4:38:06.633 [debug] [        hdlc] { dlmspipe}: tx: (11/18): 8e40c24385423d40500e3c401000b413
2018-11-28 15:46:58.736 #1   000000006003b375 <log> 4:38:06.642 [debug] [        hdlc] { dlmspipe}: tx: (12/18): b0b1b41368bab41398ca3e4086404018
2018-11-28 15:46:58.745 #1   000000006003b375 <log> 4:38:06.651 [debug] [        hdlc] { dlmspipe}: tx: (13/18): 1c429a2240181d429c22b413c2c73e40
2018-11-28 15:46:58.755 #1   000000006003b375 <log> 4:38:06.661 [debug] [        hdlc] { dlmspipe}: tx: (14/18): 8a4040181c429e2240181d42a022b413
2018-11-28 15:46:58.764 #1   000000006003b375 <log> 4:38:06.670 [debug] [        hdlc] { dlmspipe}: tx: (15/18): c2c73e408e4040181c42a22240181d42
2018-11-28 15:46:58.773 #1   000000006003b375 <log> 4:38:06.679 [debug] [        hdlc] { dlmspipe}: tx: (16/18): a422b413c2c73d4080023c403000b413
2018-11-28 15:46:58.783 #1   000000006003b375 <log> 4:38:06.689 [debug] [        hdlc] { dlmspipe}: tx: (17/18): b0b1b41398ca3e40864040181c42ae22
2018-11-28 15:46:58.792 #1   000000006003b375 <log> 4:38:06.698 [debug] [        hdlc] { dlmspipe}: tx: (18/18): 40181d42b022b413c2c73e405929
2018-11-28 15:46:59.093 #1   000000006003b375 <log> 4:38:07.002 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 4e4a
2018-11-28 15:46:59.100 #1   000000006003b375 <log> 4:38:07.008 [debug] [        hdlc] { dlmspipe}: tx: (1/1): 7e
2018-11-28 15:46:59.110 #1   000000006003b375 <log> 4:38:07.015 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task waiting to be triggered (59992) **
2018-11-28 15:46:59.262 #1   000000006003b375 <log> 4:38:07.170 [debug] [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
2018-11-28 15:46:59.271 #1   000000006003b375 <log> 4:38:07.177 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea011a103b809bce6e700c701c10000
2018-11-28 15:46:59.278 #1   000000006003b375 <log> 4:38:07.186 [debug] [        hdlc] {     hdlc}: rx: (2/2): fcb47e
2018-11-28 15:46:59.287 #1   000000006003b375 <log> 4:38:07.194 [debug] [    dlmspipe] {     hdlc}: HDLC rx 5 B forwarding to [fd00::1]:46933
2018-11-28 15:46:59.301 #1   000000006003b375 <log> 4:38:07.203 [debug] [          ip] {     hdlc}: Send IP on lowpan, 21 B, type 17, ttl 32: fd28:914c:1da9:0:21b:c50c:6003:b375 -> fd00::1
2018-11-28 15:46:59.310 #1   000000006003b375 <log> 4:38:07.217 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:46:59.332 #1   000000006003b375 <log> 4:38:07.236 [debug] [      mac_tx] {lowpan_tx}: Tx 77 B at -26 dBm as #21 to 02-1b-c5-0c-60-00-4d-34: Got ack after 1 try
2018-11-28 15:46:59.345 #1   000000006003b375 <log> 4:38:07.248 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-4d-34: ack: 1, nack: 0, roundtrip: 1 ms, etx: 128/128
>>> last received on laptop.
>>> this was received, the next 294b packet transmitted, but never received here.

2018-11-28 15:47:09.317 #1   000000006003b375 <log> 4:38:17.225 [debug] [        hdlc] {     hdlc}: ** giveCause = 10, 0 **
2018-11-28 15:47:09.323 #1   000000006003b375 <log> 4:38:17.232 [debug] [        hdlc] {     hdlc}: Idle tickover.
2018-11-28 15:47:09.330 #1   000000006003b375 <log> 4:38:17.239 [debug] [        hdlc] {     hdlc}: disconnectLink 0x0
2018-11-28 15:47:09.337 #1   000000006003b375 <log> 4:38:17.246 [debug] [        hdlc] {     hdlc}: Disconnect HDLC link
2018-11-28 15:47:09.346 #1   000000006003b375 <log> 4:38:17.253 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:47:16.293 #1   000000006003b375 <log> 4:38:24.196 [debug] [      mac_rx] {   mac_rx}: Received 113 B, broadcast #83 from 02-1b-c5-0c-60-00-c9-8e: rssi 0 dBm, sec 5, payload 89 B
2018-11-28 15:47:16.306 #1   000000006003b375 <log> 4:38:24.210 [debug] [        icmp] {   mac_rx}: ICMPv6 multicast from fe80::21b:c50c:6000:c98e, RPL control message (DIO), 80 B
2018-11-28 15:47:16.315 #1   000000006003b375 <log> 4:38:24.222 [debug] [    rpl/core] {      rpl}: 0: Ignoring DIO for instance 0 (mine is 20)
2018-11-28 15:47:16.698 #1   000000006003b375 <log> 4:38:24.601 [debug] [      mac_rx] {   mac_rx}: Received 113 B, broadcast #252 from 02-1b-c5-0c-60-01-8e-10: rssi -45 dBm, sec 5, payload 89 B
2018-11-28 15:47:16.711 #1   000000006003b375 <log> 4:38:24.615 [debug] [        icmp] {   mac_rx}: ICMPv6 multicast from fe80::21b:c50c:6001:8e10, RPL control message (DIO), 80 B
2018-11-28 15:47:16.720 #1   000000006003b375 <log> 4:38:24.627 [debug] [    rpl/core] {      rpl}: 0: Ignoring DIO for instance 0 (mine is 20)
2018-11-28 15:47:19.352 #1   000000006003b375 <log> 4:38:27.261 [debug] [        hdlc] {     hdlc}: ** giveCause = 10, 0 **
2018-11-28 15:47:19.359 #1   000000006003b375 <log> 4:38:27.268 [debug] [        hdlc] {     hdlc}: Idle tickover.
2018-11-28 15:47:19.366 #1   000000006003b375 <log> 4:38:27.275 [debug] [        hdlc] {     hdlc}: disconnectLink 0x0
2018-11-28 15:47:19.375 #1   000000006003b375 <log> 4:38:27.282 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (10000ms) **
2018-11-28 15:47:20.785 #1   000000006003b375 <log> 4:38:28.691 [debug] [     rpl/dao] {      rpl}: 0: DAO: lifetime expires in 797s (defLifeTime=1200s)
2018-11-28 15:47:27.210 #1   000000006003b375 <log> 4:38:35.112 [debug] [      mac_rx] {   mac_rx}: Received 113 B, broadcast #47 from 02-1b-c5-0c-60-01-73-c0: rssi -44 dBm, sec 5, payload 89 B



Wireshark on laptop:








-------------------------------------

Stop@ 12:14:07
last @12:13:12.533
2018-11-29 12:13:12.502 #1   000000006003b375 <log> 2:59:48.930 [debug] [          ip] {     hdlc}: Send IP on lowpan, 16 B, type 17, ttl 32: fd28:914c:1da9:0:21b:c50c:6003:b375 -> fd00::1

DISC from
2018-11-29 12:13:12.979 #1   000000006003b375 <log> 2:59:49.413 [debug] [    dlmspipe] {     hdlc}: hdlc DISC response


RLRE from meter.


Bad detection of RLRQ @12:13:12
2018-11-29 12:13:13.035 #1   000000006003b375 <log> 2:59:49.467 [debug] [    dlmspipe] { dlmspipe}: Syth RLRE 10 B forwarding to [fd00::1]:37257
2018-11-29 12:13:12.533 #1   000000006003b375 <log> 2:59:48.963 [debug] [      mac_tx] {lowpan_tx}: Tx 72 B at -26 dBm as #213 to 02-1b-c5-0c-60-00-4d-34: Got ack after 1 try
2018-11-29 12:13:12.546 #1   000000006003b375 <log> 2:59:48.975 [debug] [    rpl/core] {lowpan_tx}: Stats for 02-1b-c5-0c-60-00-4d-34: ack: 1, nack: 0, roundtrip: 2 ms, etx: 128/128
2018-11-29 12:13:12.678 #1   000000006003b375 <log> 2:59:49.106 [debug] [      mac_rx] {   mac_rx}: Received 77 B, unicast #224 from 02-1b-c5-0c-60-00-4d-34: rssi -68 dBm, sec 5, payload 47 B
2018-11-29 12:13:12.693 #1   000000006003b375 <log> 2:59:49.119 [debug] [ tran_switch] {   mac_rx}: UDP received from [fd00::1]:37257 to [fd28:914c:1da9:0:21b:c50c:6003:b375]:4059 of size 13: dtls session: -1
2018-11-29 12:13:12.701 #1   000000006003b375 <log> 2:59:49.134 [debug] [    dlmspipe] {   mac_rx}: UDP rx 13 B from [fd00::1]:37257
2018-11-29 12:13:12.709 #1   000000006003b375 <log> 2:59:49.142 [debug] [    dlmspipe] { dlmspipe}: ** dlmspipe task triggered **
2018-11-29 12:13:12.717 #1   000000006003b375 <log> 2:59:49.150 [debug] [    dlmspipe] { dlmspipe}:  ** packet forwarding to meter. **
2018-11-29 12:13:12.724 #1   000000006003b375 <log> 2:59:49.159 [debug] [    dlmspipe] { dlmspipe}: HDLC send DISC





-------------------------------------------------

git push ssh://stevetickle@gerrit.cyco.io:222/terminal HEAD:refs/for/master

-------------------------------

lnt 3-phase

gdb --args ./build/host-lnt-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01\
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0\
 -initrtc\
 -ctrlhub 127.0.0.1\
 -ctrlhubport 4243\
 -loglevel debug\
 -param device.dlms.lls_password=6C6E7431\
 -param device.dlms.authentication_key=31323334353637383930313233343536\
 -param device.dlms.encryption_key= 31323334353637383930313233343536\
 -param device.dlms.hls_key=30303030303030303031303335383230\
 -param device.time.sync_timer=1\
 -param server.ip=2a03:a000:192:35:a72f:f760:55bd:9cf\
 -param server.port=5684\
 -param modem.tun6.ip=127.0.0.1\
 -param modem.tun6.secret=whatsfordinner\
 -param modem.apn=4g.tele2.se\
 -param server.mq.push_now=1\
 -param server.mq.push_delay=30\
 -param device.capabilities.dlmspipe.push=0\
 -param device.dlms.pipe_enabled=0\
 -rootcert /Data/Temp/KeyTest/root.crt.der\
 -cert /Data/Temp/KeyTest/node.crt.der\
 -key /Data/Temp/KeyTest/node.key.der\
 -mackey /Data/Temp/KeyTest/mac-keys.txt\
 -gateway\
 -statedir AgentState\
 -socket

-------------------------------------------------

select device_id from device where node_id in (select id from terminal where terminal_id='00-00-00-00-00-00-00-01');


------------------------------
disable ipv6 temporary addresses

sysctl -w net.ipv6.conf.all.use_tempaddr=0
sysctl -w net.ipv6.conf.default.use_tempaddr=0
sysctl -w net.ipv6.conf.<devname>.use_tempaddr=0

---------------------------------------------

produce provision

./tools/c4-tools/coap_request.py --ctrlporthub :4243  --config prod.lowpan.eui64 00-00-00-00-00-00-00-01
./tools/c4-tools/coap_request.py --ctrlporthub :4243  --config prod.prodtime 1

./tools/c4-tools/coap_request.py --ctrlporthub :4243 --load-key client-key /Data/Temp/KeyTest/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub :4243 --load-key client-cert /Data/Temp/KeyTest/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4243 --load-key root-cert /Data/Temp/KeyTest/root.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4243 --rll-key /Data/Temp/KeyTest/mac-keys.txt

channelplan
channel
dtls instance id
server.ip
tnunel pw
tunnel ip.

----------------------------------------------

ip3b-kaifa assert

    at src/platform/drivers/uart/uart-efr32.c:127
127     ASSERT(port >= 0 && port < ARRAY_SIZE(s_usartPortDescriptors));
(gdb) p port
$1 = 6
(gdb) where
#0  uartOpen (port=port@entry=6, settings=settings@entry=0x200103f0 <s_terminalTaskStack+1472>)
    at src/platform/drivers/uart/uart-efr32.c:127
#1  0x0002c7fa in deviceStart () at src/device/drivers/kaifa_ma304/device-kaifa_ma304.c:3243
#2  0x0001022c in modulesStart (list=list@entry=0x5d624 <meteringModules>) at src/base/module.c:25
#3  0x0002618c in deviceStart () at src/device/addons/management/device.c:1390
#4  0x0001022c in modulesStart (list=list@entry=0x5b51c <managementModules>) at src/base/module.c:25
#5  0x00020602 in start () at src/management/management.c:82
#6  0x0003bc68 in terminalTask (arg=0x2000fd20 <s_terminalInitedSemaphore>)
    at src/terminal/terminal.c:255
#7  0x0004dfbc in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb)

CONFIG_DEVICE_UART=6

----------------------------------------



gdb --args ./build/host-kaifa-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01 \
 -meter /dev/serial/by-id/usb-FTDI_TTL232R-3V3_FT9SI5ZW-if00-port0 \
 -initrtc \
 -ctrlhub 127.0.0.1 \
 -ctrlhubport 4242 \
 -loglevel debug \
 -param device.dlms.lls_password=lnt1 \
 -param device.dlms.authentication_key=31323334353637383930313233343536 \
 -param device.dlms.encryption_key=31323334353637383930313233343536 \
 -param device.dlms.hls_key=31323334353637383930414243444546 \
 -param device.time.sync_timer=1 \
 -param server.ip=2a03:a000:192:35:a72f:f760:55bd:9cf \
 -param server.port=5684 \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner \
 -param modem.apn=4g.tele2.se \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=0 \
 -param device.dlms.pipe_enabled=0 \
 -rootcert /Data/Temp/KeyTest/root.crt.der \
 -cert /Data/Temp/KeyTest/node.crt.der \
 -key /Data/Temp/KeyTest/node.key.der \
 -mackey /Data/Temp/KeyTest/mac-keys.txt \
 -gateway \
 -statedir AgentState \
 -socket


gdb --args ./build/host-kaifa-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01 \
 -meter /dev/serial/by-id/usb-FTDI_UC232R_FTXQJEKR-if00-port0 \
 -initrtc \
 -ctrlhub 127.0.0.1 \
 -ctrlhubport 4242 \
 -loglevel debug \
 -param device.dlms.lls_password=hello \
 -param device.dlms.authentication_key=31323334353637383930313233343536 \
 -param device.dlms.encryption_key=31323334353637383930313233343536 \
 -param device.dlms.hls_key=31323334353637383930414243444546 \
 -param device.time.sync_timer=1 \
 -param server.ip=2a03:a000:192:35:a72f:f760:55bd:9cf \
 -param server.port=5684 \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner \
 -param modem.apn=4g.tele2.se \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=0 \
 -param device.dlms.pipe_enabled=0 \
 -rootcert /Data/Temp/KeyTest/root.crt.der \
 -cert /Data/Temp/KeyTest/node.crt.der \
 -key /Data/Temp/KeyTest/node.key.der \
 -mackey /Data/Temp/KeyTest/mac-keys.txt \
 -gateway \
 -statedir AgentState \
 -socket


--------------------------------------------

commit 27fa525e6acbe023a0b0c72ba89f36b61ac3608b
Author: Steve Tickle <Steve.Tickle@CyanConnode.com>
Date:   Thu Nov 8 17:59:17 2018 +0000

    Fix race condition causing RAM leak in HDLC.

    Because the HDLC and device tasks effectively share data such as
    s_sendPayload, there exists a race-condition where in high load conditions
    the data can get overwritten in disconnectLink without first FREEing the
    allocated data.
    All the global data is now protected by a mutex and the missing FREE has
    been added.

    Change-Id: I1b977f88fddb7dc9e8d15aa8b3df03c2536eac25

commit 45925561d1601922b28cb736f37fd9b2e404073b
Author: Steve Tickle <Steve.Tickle@CyanConnode.com>
Date:   Thu Nov 8 14:22:05 2018 +0000

    Protect data shared between DLMS and device tasks.

    The response data passed up from the DLMS task is shared between it
    and the device-task.
    In high-load situations with timeouts, the timeout can be signalled
    while processing the previous (good) message, since the shared data
    is overwritten, the continuing processing of the data results in
    a) hard-fault while accessing the data.
    b) the previous good message not being FREEd, leading to OOM errors
    and a subsequent panic later down the line.

    Change-Id: Ic5c5de7db24dacdfaa091242850bf7fd83870e12



--------------------------------


Breakpoint 2, isrHardFaultHandler () at src/hw/stm32/crash.c:147
147     while (keepMeHere == true) {
(gdb) p keepMeHere
$1 = true
(gdb) set keepMeHere=0
(gdb) stepi
0x08036fea  147     while (keepMeHere == true) {
(gdb)
150 }
(gdb) stepi
0x08036fee  150 }
(gdb)
uffs_crc16update (data=0x2000fbf8 <s_uffsPool+508>, length=length@entry=50331647, crc=17207,
    crc@entry=65535) at build/3pp/uffs/src/uffs/uffs_crc.c:84
84          CRC16(crc, *p);
(gdb) where
#0  uffs_crc16update (data=0x2000fbf8 <s_uffsPool+508>, length=length@entry=50331647, crc=17207,
    crc@entry=65535) at build/3pp/uffs/src/uffs/uffs_crc.c:84
#1  0x08068fd8 in uffs_crc16sum (data=<optimized out>, length=50331647)
    at build/3pp/uffs/src/uffs/uffs_crc.c:92
#2  0x0806c6da in uffs_MakeSum16 (p=<optimized out>, len=<optimized out>)
    at build/3pp/uffs/src/uffs/uffs_public.c:255
#3  0x0806d60a in _BuildValidTreeNode (st=<synthetic pointer>, bc=0x2001103c <s_uffsPool+5696>,
    node=0x2001188c <s_uffsPool+7824>, dev=0x2000f81c <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_tree.c:426
#4  _BuildTreeStepOne (dev=dev@entry=0x2000f81c <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_tree.c:626
#5  uffs_BuildTree (dev=dev@entry=0x2000f81c <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_tree.c:1325
#6  0x0806bf6e in uffs_InitDevice (dev=0x2000f81c <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_init.c:132
#7  0x0806c196 in uffs_Mount (mount=mount@entry=0x807d9b8 "/")
    at build/3pp/uffs/src/uffs/uffs_mtb.c:195
#8  0x0804af4a in start () at src/services/fs/uffs/fs_service.c:86
#9  0x0802017c in modulesStart (list=list@entry=0x807d0f8 <serviceModules>) at src/base/module.c:25
#10 0x08049616 in servicesStart () at src/services/services.c:64
#11 0x08053686 in terminalBasicStart () at src/terminal/terminal.c:124
#12 0x080536d4 in terminalTask (arg=0x20016c68 <s_terminalInitedSemaphore>)
    at src/terminal/terminal.c:232
#13 0x08065484 in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb)

-------------------------------------------------


ubuntu@ubuntu-VirtualBox:/Data/Projects/terminal$ ~/pbd 0801121c303031626335306336303030643363615f657863657270742e6c6f6718cd2a2080012a4666696c65747970653d6d6574657266772c7461726765746465766963653d30303030303030312c6d6574657266775f69643d313832383135353337353031333136363037393430d8043a103388745bd5ccf0c9aeecf564621f2b6342240a106264f1dedf904e9a8ad5fad10571a978121096b1eafe5a864d294e65a332315b09cc
1: 1
2: "001bc50c6000d3ca_excerpt.log"
3: 5453
4: 128
5: "filetype=meterfw,targetdevice=00000001,meterfw_id=18281553750131660794"
6: 600
7: "3\210t[\325\314\360\311\256\354\365db\037+c"
8 {
  1: "bd\361\336\337\220N\232\212\325\372\321\005q\251x"
  2: "\226\261\352\376Z\206M)Ne\24321[\t\314"
}


0801121c303031626335306336303030643363615f657863657270742e6c6f6718cd2a2080012a4666696c65747970653d6d6574657266772c7461726765746465766963653d30303030303030312c6d6574657266775f69643d313832383135353337353031333136363037393430d8043a103388745bd5ccf0c9aeecf564621f2b6342240a106264f1dedf904e9a8ad5fad10571a978121096b1eafe5a864d294e65a332315b09cc


0x08,0x01,0x12,0x1c,0x30,0x30,0x31,0x62,
0x63,0x35,0x30,0x63,0x36,0x30,0x30,0x30,
0x64,0x33,0x63,0x61,0x5f,0x65,0x78,0x63,
0x65,0x72,0x70,0x74,0x2e,0x6c,0x6f,0x67,
0x18,0xcd,0x2a,0x20,0x80,0x01,0x2a,0x46,
0x66,0x69,0x6c,0x65,0x74,0x79,0x70,0x65,
0x3d,0x6d,0x65,0x74,0x65,0x72,0x66,0x77,
0x2c,0x74,0x61,0x72,0x67,0x65,0x74,0x64,
0x65,0x76,0x69,0x63,0x65,0x3d,0x30,0x30,
0x30,0x30,0x30,0x30,0x30,0x31,0x2c,0x6d,
0x65,0x74,0x65,0x72,0x66,0x77,0x5f,0x69,
0x64,0x3d,0x31,0x38,0x32,0x38,0x31,0x35,
0x35,0x33,0x37,0x35,0x30,0x31,0x33,0x31,
0x36,0x36,0x30,0x37,0x39,0x34,0x30,0xd8,
0x04,0x3a,0x10,0x33,0x88,0x74,0x5b,0xd5,
0xcc,0xf0,0xc9,0xae,0xec,0xf5,0x64,0x62,
0x1f,0x2b,0x63,0x42,0x24,0x0a,0x10,0x62,
0x64,0xf1,0xde,0xdf,0x90,0x4e,0x9a,0x8a,
0xd5,0xfa,0xd1,0x05,0x71,0xa9,0x78,0x12,
0x10,0x96,0xb1,0xea,0xfe,0x5a,0x86,0x4d,
0x29,0x4e,0x65,0xa3,0x32,0x31,0x5b,0x09,
0xcc,

-------------------------------------------------

Kaifa MA304

6033a10906076085
74050801018a0207
808b076085740508
0201ac0780056865
6c6c6fbe10040e01
000000065f1f0400
001f1f00c8

<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="68656C6C6F" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="06" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="00C8" />
  </InitiateRequest>
</AssociationRequest>


604aa10906076085
7405080101a60a
040800000000000000008a0207808b07
60857405080205ac128010c0beac7da2
f23ff8fe5f18342d60ebf3be10040e01
000000065f1f0400001f1f00c8

<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <CallingAPTitle Value="0000000000000000" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="HighGMac" />
  <CallingAuthentication Value="C0BEAC7DA2F23FF8FE5F18342D60EBF3" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="06" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="00C8" />
  </InitiateRequest>
</AssociationRequest>



From above (dlms_request.py):
Kaifa LLS pw : "hello"
Kaifa HLS GMAC key: C0BEAC7DA2F23FF8FE5F18342D60EBF3

Test IPA3b
00-1B-C5-0C-60-04-FD-D6

./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config prod.lowpan.eui64 00-1B-C5-0C-60-04-FD-D6
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config prod.prodtime 1

./tools/c4-tools/coap_request.py --ctrlporthub :4000 --load-key client-key /Data/Temp/00-1B-C5-0C-60-04-FD-D6/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub :4000 --load-key client-cert /Data/Temp/00-1B-C5-0C-60-04-FD-D6/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4000 --load-key root-cert /Data/Temp/00-1B-C5-0C-60-04-FD-D6/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4000 --rll-key /Data/Temp/00-1B-C5-0C-60-04-FD-D6/mac_keys.txt

./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config lowpan.channel 5
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config lowpan.channelplan 2
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config rpl.instance_id 0
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config server.ip fd00::1

-----------------------------------------------

apt install radvd

vi /etc/radvd.conf

interface eth0
{
    # This simply means that we are sending advertisements.
    AdvSendAdvert on;
    # This example prefix uses the IPv6 prefix for documentation.
    # When deploying, generate an ULA prefix from: http://unique-local-ipv6.com/
    # Netmask length must be "/64" (see RFC 2462, sect 5.5.3, page 18).
    prefix 2001:db8:1::/64
    {
        AdvOnLink on;
        AdvAutonomous on;
    };
};

sudo radvd --debug=5 -n

---------------------------------

blfwupload:

./build/host-lnt-insecure/bin/blfwupload -ctrlport 4000 -loglevel debug -image kaifa.image -dev /dev/serial/by-id/usb-FTDI_UM232H-B_FTWNSWIJ-if00-port0


-----------------------------------

  CC       src/tun4d-tun4d.o
In file included from src/tun4d.c:32:0:
src/tun4d.c: In function ‘receiveMessage’:
src/tun4d.c:393:26: error: format ‘%llu’ expects argument of type ‘long long unsigned int’, but argument 4 has type ‘size_t {aka unsigned int}’ [-Werror=format=]
     LOG_DEBUG_PEER(peer, "Parsing %" PRIu64 " bytes of RequestMessage",
                          ^
src/log.h:38:106: note: in definition of macro ‘LOG_DEBUG_PEER’
 #define LOG_DEBUG_PEER(p, fmt, ...) logWithAddress(LogLevelDebug, (const struct sockaddr *)(&(p)->addr), fmt, ##__VA_ARGS__)
                                                                                                          ^
cc1: all warnings being treated as errors
Makefile:644: recipe for target 'src/tun4d-tun4d.o' failed

------------------------------------------



gdb --args ./build/host-lnt-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01 \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0 \
 -initrtc \
 -ctrlhub 127.0.0.1 \
 -ctrlhubport 4244 \
 -loglevel debug \
 -param device.dlms.lls_password=lnt1 \
 -param device.dlms.authentication_key=31323334353637383930313233343536 \
 -param device.dlms.encryption_key=31323334353637383930313233343536 \
 -param device.dlms.hls_key=30303030303030303031303335383230 \
 -param device.time.sync_timer=1 \
 -param server.ip=2a03:a000:192:35:a72f:f760:55bd:9cf \
 -param server.port=5684 \
 -param modem.tun6.ip=lnt-dev2.dev.cyanconnode.com \
 -param modem.tun6.secret=lnt-dev2 \
 -param modem.apn=4g.tele2.se \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=0 \
 -param device.dlms.pipe_enabled=0 \
 -rootcert /Data/Temp/KeyTest/root.crt.der \
 -cert /Data/Temp/KeyTest/node.crt.der \
 -key /Data/Temp/KeyTest/node.key.der \
 -mackey /Data/Temp/KeyTest/mac-keys.txt \
 -gateway \
 -statedir AgentState \
 -socket


------------------------------------------

./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config prod.lowpan.eui64 00-1b-c5-0c-60-01-b6-31
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config prod.prodtime 1

./tools/c4-tools/coap_request.py --ctrlporthub :4000 --load-key client-key /Data/Temp/00-1b-c5-0c-60-01-b6-31/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub :4000 --load-key client-cert /Data/Temp/00-1b-c5-0c-60-01-b6-31/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4000 --load-key root-cert /Data/Temp/00-1b-c5-0c-60-01-b6-31/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4000 --rll-key /Data/Temp/00-1b-c5-0c-60-01-b6-31/mac_keys.txt

./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config lowpan.channel 5
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config lowpan.channelplan 2
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config rpl.instance_id 0
./tools/c4-tools/coap_request.py --ctrlporthub :4000  --config server.ip fd00::1

-----------------------------------------


omni@omnibox10:~$ cat /lib/systemd/system/tun6d.service
[Unit]
Description=Connode IPv6 tunnel daemon
After=network-online.target c4server.service
Requires=c4server.service

[Service]
ExecStart=/usr/local/bin/tun6d
CapabilityBoundingSet=CAP_NET_ADMIN
EnvironmentFile=/usr/local/etc/tun6d.secret

[Install]
WantedBy=multi-user.target





omni@omnibox10:~$ cat /etc/network/interfaces
source /etc/network/interfaces.d/*

# This file intentionally left blank
#
# All interfaces are handled by network-manager, use nmtui or nmcli on
# server/headless images or the "Network Manager" GUI on desktop images
#  ! Not any more !


#auto usb0
iface usb0 inet dhcp
hwaddress ether 82:bc:09:47:28:a9


#auto wlan0
#iface wlan0 inet dhcp
#wpa-ssid Cyanconnode-1
#wpa-psk W6&v$8?6d!p3

#
# This is the static IP definition for Kalkitech/DLMSpipe-push testing.
#
auto eth0
iface eth0 inet6 static
        address fd00::1
        netmask 64



#
# NM has great difficulties creating random MAC addresses (spoofing) and
# really gets in the way of spoofing, so manage eth0 here.
#
auto eth0
iface eth0 inet static
        address 172.16.32.1
        netmask 255.255.255.0
        broadcast 172.16.32.255
        gateway 172.16.32.1
        pre-up [ -f /etc/network/if-pre-up.d/randomise-mac ]


auto tun6d0
iface tun6d0 inet static
        address 172.16.33.1


-----------------------------------------------------------

SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/usr/local/connode/lib/activemq-all-5.15.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/usr/local/connode/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]


--------------------------------------------------------

SMIP CH

https://www.telit.com/m2m-iot-products/cellular-modules/standard-industrial-grade/xe910-family/#UE910-EU-downloads

Log:
minicom -D /dev/serial/by-id/usb-Telit_6_CDC-ACM_004678058002915-if06

lxfp m2mapz.bin  /dev/serial/by-id/usb-Telit_6_CDC-ACM_004678058002915-if00 -d6 verbose

Scimitar.xml:150:     <Value>UE910-EUD-AZ</Value>

Telit UE910-EUD-AZ (Type 6)

AT+GMM
UE910-EUD-AZ

OK


tools/c4-tools/upload_smip.py


OK
AT#M2MLIST
#M2MLIST: <MOD>
#M2MLIST: "m2m_config",185
#M2MLIST: <MFG>
#M2MLIST: <fileservice>
#M2MLIST: "debuglog_normal.txt",32768
#M2MLIST: <connode>
#M2MLIST: "diag.txt",179
#M2MLIST: <smurf>
#M2MLIST: "m2mapz.bin",1670688
#M2MLIST: free bytes: 27971584

OK

OK
AT#M2MREAD="diag.txt"
<<<Self Test Result: PASS-F8000000
Telit Firmware Version: 12.00.926-B024
CH Software Version: 9.r
CHFID: 887384530000092C
GPFID: 887384FF0000092C
Zigbee SW Version: 04.05.00.04
OK


AT#M2MRUN=2,m2mapz.bin

AT+M2M=4,10 this means that the application will start 10 seconds after start-up.






--------------------------------------------------------

Kaifa debug release for IPA3b:

kaifa-insecure:v138-14-ge12e424

equivalent to 33f391fceaeb9e91bf16c1f230a1dcc7ab79111e

18/12/2018




-------------------------------------


6abb0203720420a5d0e7c78db9964251c8bca1ca

a317f188b6229046a72ff8e5dbd1a3b391298aaa

5e1e4f20336e24cd6d4c761d4ab901265865babb


------------------------------------------------------

52416 [   6295.476][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
52417 [   6295.485][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
52418 [   6295.495][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
52419 [   6295.500][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
52420 [   6295.506][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
52421 [   6295.512][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
52422 [   6295.518][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
52423 [   6295.528][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
52424 [   6295.534][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
52425 [   6295.540][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
52426 [   6295.573][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52427 [   6295.582][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
52428 [   6295.591][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0x00:
52429 [   6295.599][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max end device children to 0x 6: Status: 0x00:
52430 [   6295.636][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52431 [   6295.642][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout to 0x5a: Status: 0x00:
52432 [   6295.647][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout shift to 0x 6: Status: 0x00:
52433 [   6295.653][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set transient key timeout to 0x12c: Status: 0x37:
52434 [   6295.661][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CommsHubSample_callbacks.c,318:Ember Bootloader Version 1.0.0.9, Application Version 4.5.0.4
52435 [   6295.693][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,89:Failure in network index
52436 [   6295.694][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,54:Failure in network index
52437 [   6295.715][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_CONNECTED
52438 [   6295.717][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,982:Previous timer still pending, new timer not created
52439 [   6297.046][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set TC Key Request to "Deny":
52440 [   6297.055][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set App. Key Request to "Allow":
52441 [   6297.063][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set Trust Center Policy to "Allow preconfigured key joins":
52442 [   6297.079][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 0 to 1
52443 [   6297.090][yyyy-mm-dd hh:mm:ss][ info][Diagnostics       ]DIAGNOSTICS_Task.c,217:Current CPU load is 16%
52444 [   6297.123][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]af-main-host.c,986:ERROR: ezspErrorHandler : EZSP_ERROR_INVALID_FRAME_ID (0x31)
52445 [   6297.127][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_DISCONNECTED
52446 [   6297.132][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CH_osal_ezsp.c,4176:EZSP state is already set as : EZSP_DISCONNECTED
52447 [   6297.135][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,820:Failure in EZSP main loop execution
52448 [   6297.141][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1033:EZSP received CHAPPMSG_EzspHandleZigBeeReset, handling errors
52449 [   6297.143][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 1 to 0
52450 [   6297.146][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent]
=== ASH started ===

52451 [   6298.036][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52452 [   6300.415][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,288:[ASH:TraceEventTime] ASH connected
52453 [   6300.421][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1275:ERROR: NCP EZSP protocol version of 0x4 does not match Host version 0x6

52454 [   6300.427][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1294:ezsp ver 0x4 stack type 0x2
52455 [   6300.451][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set source route table size to 0x10: Status: 0x00:
52456 [   6300.457][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
52457 [   6300.467][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
52458 [   6300.476][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
52459 [   6300.482][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
52460 [   6300.488][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
52461 [   6300.495][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
52462 [   6300.501][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
52463 [   6300.510][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
52464 [   6300.515][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
52465 [   6300.522][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
52466 [   6300.554][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52467 [   6300.564][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
52468 [   6300.573][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0x00:
52469 [   6300.582][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max end device children to 0x 6: Status: 0x00:
52470 [   6300.619][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52471 [   6300.625][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout to 0x5a: Status: 0x00:
52472 [   6300.631][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout shift to 0x 6: Status: 0x00:
52473 [   6300.638][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set transient key timeout to 0x12c: Status: 0x37:
52474 [   6300.645][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CommsHubSample_callbacks.c,318:Ember Bootloader Version 1.0.0.9, Application Version 4.5.0.4
52475 [   6300.677][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,89:Failure in network index
52476 [   6300.679][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,54:Failure in network index
52477 [   6300.699][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_CONNECTED
52478 [   6300.701][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,982:Previous timer still pending, new timer not created
52479 [   6302.026][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set TC Key Request to "Deny":
52480 [   6302.034][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set App. Key Request to "Allow":
52481 [   6302.040][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set Trust Center Policy to "Allow preconfigured key joins":
52482 [   6302.055][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 0 to 1
52483 [   6302.106][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]af-main-host.c,986:ERROR: ezspErrorHandler : EZSP_ERROR_INVALID_FRAME_ID (0x31)
52484 [   6302.110][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_DISCONNECTED
52485 [   6302.115][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CH_osal_ezsp.c,4176:EZSP state is already set as : EZSP_DISCONNECTED
52486 [   6302.120][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,820:Failure in EZSP main loop execution
52487 [   6302.123][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1033:EZSP received CHAPPMSG_EzspHandleZigBeeReset, handling errors
52488 [   6302.124][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 1 to 0
52489 [   6302.126][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent]
=== ASH started ===

52490 [   6303.016][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52491 [   6305.399][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,288:[ASH:TraceEventTime] ASH connected
52492 [   6305.405][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1275:ERROR: NCP EZSP protocol version of 0x4 does not match Host version 0x6

52493 [   6305.412][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1294:ezsp ver 0x4 stack type 0x2
52494 [   6305.435][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set source route table size to 0x10: Status: 0x00:
52495 [   6305.441][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
52496 [   6305.451][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
52497 [   6305.460][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
52498 [   6305.466][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
52499 [   6305.472][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
52500 [   6305.478][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
52501 [   6305.484][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
52502 [   6305.494][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
52503 [   6305.500][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
52504 [   6305.506][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
52505 [   6305.539][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52506 [   6305.548][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
52507 [   6305.557][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0x00:
52508 [   6305.569][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max end device children to 0x 6: Status: 0x00:
52509 [   6305.606][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52510 [   6305.613][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout to 0x5a: Status: 0x00:
52511 [   6305.618][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout shift to 0x 6: Status: 0x00:
52512 [   6305.624][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set transient key timeout to 0x12c: Status: 0x37:
52513 [   6305.631][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CommsHubSample_callbacks.c,318:Ember Bootloader Version 1.0.0.9, Application Version 4.5.0.4
52514 [   6305.663][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,89:Failure in network index
52515 [   6305.664][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,54:Failure in network index
52516 [   6305.684][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_CONNECTED
52517 [   6305.686][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,982:Previous timer still pending, new timer not created
52518 [   6307.008][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set TC Key Request to "Deny":
52519 [   6307.018][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set App. Key Request to "Allow":
52520 [   6307.023][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set Trust Center Policy to "Allow preconfigured key joins":
52521 [   6307.039][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 0 to 1
52522 [   6307.092][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]af-main-host.c,986:ERROR: ezspErrorHandler : EZSP_ERROR_INVALID_FRAME_ID (0x31)
52523 [   6307.095][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_DISCONNECTED
52524 [   6307.100][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CH_osal_ezsp.c,4176:EZSP state is already set as : EZSP_DISCONNECTED
52525 [   6307.104][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,820:Failure in EZSP main loop execution
52526 [   6307.107][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1033:EZSP received CHAPPMSG_EzspHandleZigBeeReset, handling errors
52527 [   6307.108][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 1 to 0
52528 [   6307.110][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent]
=== ASH started ===

52529 [   6307.999][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52530 [   6310.384][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,288:[ASH:TraceEventTime] ASH connected
52531 [   6310.391][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1275:ERROR: NCP EZSP protocol version of 0x4 does not match Host version 0x6

52532 [   6310.397][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1294:ezsp ver 0x4 stack type 0x2
52533 [   6310.421][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set source route table size to 0x10: Status: 0x00:
52534 [   6310.427][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
52535 [   6310.436][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
52536 [   6310.446][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
52537 [   6310.452][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
52538 [   6310.458][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
52539 [   6310.464][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
52540 [   6310.470][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
52541 [   6310.479][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
52542 [   6310.485][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
52543 [   6310.491][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
52544 [   6310.525][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52545 [   6310.534][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
52546 [   6310.543][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0x00:
52547 [   6310.552][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max end device children to 0x 6: Status: 0x00:
52548 [   6310.588][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52549 [   6310.594][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout to 0x5a: Status: 0x00:
52550 [   6310.600][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout shift to 0x 6: Status: 0x00:
52551 [   6310.607][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set transient key timeout to 0x12c: Status: 0x37:
52552 [   6310.614][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CommsHubSample_callbacks.c,318:Ember Bootloader Version 1.0.0.9, Application Version 4.5.0.4
52553 [   6310.645][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,89:Failure in network index
52554 [   6310.647][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,54:Failure in network index
52555 [   6310.667][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_CONNECTED
52556 [   6310.669][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,982:Previous timer still pending, new timer not created
52557 [   6311.990][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set TC Key Request to "Deny":
52558 [   6311.999][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set App. Key Request to "Allow":
52559 [   6312.005][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set Trust Center Policy to "Allow preconfigured key joins":
52560 [   6312.020][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 0 to 1
52561 [   6312.072][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]af-main-host.c,986:ERROR: ezspErrorHandler : EZSP_ERROR_INVALID_FRAME_ID (0x31)
52562 [   6312.077][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_DISCONNECTED
52563 [   6312.082][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CH_osal_ezsp.c,4176:EZSP state is already set as : EZSP_DISCONNECTED
52564 [   6312.087][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,820:Failure in EZSP main loop execution
52565 [   6312.089][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1033:EZSP received CHAPPMSG_EzspHandleZigBeeReset, handling errors
52566 [   6312.090][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 1 to 0
52567 [   6312.092][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent]
=== ASH started ===

52568 [   6312.981][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52569 [   6312.983][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52570 [   6312.984][yyyy-mm-dd hh:mm:ss][ERROR][Supervisor        ]SUPERVISOR_Task.c,1584:C4_Task task heart beat not received: Rebooting
52571 [   6313.002][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]DEVICE_Task.c,1663:Re-boot cause set to 5
52572 [   6313.004][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]LOGGING_Service.c,628:[DMM Reboot Log: Write entry: Reason=1
52573 [   6313.080][yyyy-mm-dd hh:mm:ss][ info][Power             ]POWER_Task.c,331:power_Shutdown
52574 [   6315.367][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,288:[ASH:TraceEventTime] ASH connected
52575 [   6315.374][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1275:ERROR: NCP EZSP protocol version of 0x4 does not match Host version 0x6

52576 [   6315.380][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1294:ezsp ver 0x4 stack type 0x2
52577 [   6315.403][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set source route table size to 0x10: Status: 0x00:
52578 [   6315.409][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
52579 [   6315.418][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
52580 [   6315.428][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
52581 [   6315.434][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
52582 [   6315.440][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
52583 [   6315.445][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
52584 [   6315.451][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
52585 [   6315.461][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
52586 [   6315.468][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
52587 [   6315.474][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
52588 [   6315.507][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52589 [   6315.516][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
52590 [   6315.526][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0x00:
52591 [   6315.535][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max end device children to 0x 6: Status: 0x00:
52592 [   6315.571][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
52593 [   6315.577][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout to 0x5a: Status: 0x00:
52594 [   6315.584][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout shift to 0x 6: Status: 0x00:
52595 [   6315.589][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set transient key timeout to 0x12c: Status: 0x37:
52596 [   6315.596][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CommsHubSample_callbacks.c,318:Ember Bootloader Version 1.0.0.9, Application Version 4.5.0.4
52597 [   6315.628][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,89:Failure in network index
52598 [   6315.630][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,54:Failure in network index
52599 [   6315.650][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_CONNECTED
52600 [   6315.652][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,982:Previous timer still pending, new timer not created
52601 [   6315.654][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]interpan.c,289:Interpan is already Disabled
52602 [   6315.656][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent] ======== ASH stopped ========

52603 [   6315.657][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_SHUTDOWN
52604 [   6315.660][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]ota-storage-telit.c,246:Closing the Ota Server File Store.
52605 [   6315.663][yyyy-mm-dd hh:mm:ss][ info][WanManager        ]WANMGR_Task.c,1549:WANMGR shutdown de-activating PDP context
52606 [   6315.666][yyyy-mm-dd hh:mm:ss][ info][SocketManager     ]SOCKETMGR_Task.c,2559:SOCKETMGR_clearRetryTable cleared
52607 [   6315.668][yyyy-mm-dd hh:mm:ss][ info][C4_Task           ]C4_Task.c,1100:taskc4_Shutdown
52608 [   6315.670][yyyy-mm-dd hh:mm:ss][ info][WanManager        ]LED_Service.c,150:SetLED, LED:WAN, Freq(state):OFF
52609 [   6315.672][yyyy-mm-dd hh:mm:ss][ info][SocketManager     ]SOCKETMGR_Task.c,2575:SOCKETMGR_clearAckRetryTable cleared
52610 [   6315.674][yyyy-mm-dd hh:mm:ss][ERROR][WanManager        ]CH_osal_ezsp.c,4842:Failed to get EZSP LOCK
52611 [   6315.676][yyyy-mm-dd hh:mm:ss][ERROR][WanManager        ]LED_Service.c,185:Failed ZigBee SetLED, status : 104
52612 [   6315.678][yyyy-mm-dd hh:mm:ss][ info][WanManager        ]WANMGR_NetworkTimers.c,1558:WANMGR_DeleteNetworkTimers
52613 [   6315.680][yyyy-mm-dd hh:mm:ss][ info][WanManager        ]WANMGR_Task.c,750:Completing shutdown
52614 [   6315.682][yyyy-mm-dd hh:mm:ss][ info][WanManager        ]WANMGR_Task.c,835:wanmgr_atCmdQueueInit
52615 [   6315.799][yyyy-mm-dd hh:mm:ss][ info][HANInterface      ]HANInterface_Task.c,1627:CHF: haninterfaceTomMsgTimer Timer deleted
52616 [   6315.848][yyyy-mm-dd hh:mm:ss][ info][FwDownload        ]FwDownload_Task.c,2245:Shutting down FwDownload Task
52617 [   6315.866][yyyy-mm-dd hh:mm:ss][ info][HANmanager        ]HANMGR_HANInterface.c,581:HAN Interface Enabled/Disabled status = 0
52618 [   6315.868][yyyy-mm-dd hh:mm:ss][ info][FwDownload        ]FwDownload_Task.c,1596:FwDownload.State setting updated to 1
52619 [   6315.886][yyyy-mm-dd hh:mm:ss][ info][HANmanager        ]HANMGR_HANInterface.c,599:HAN Interface_Enabled = FALSE
52620 [   6315.888][yyyy-mm-dd hh:mm:ss][ info][FwDownload        ]FwDownload_Task.c,1596:FwDownload.Interruptions setting updated to 0
52621 [   6315.905][yyyy-mm-dd hh:mm:ss][ info][FwDownload        ]FwDownload_Task.c,1596:FwDownLoad.RetryCounterOuter setting updated to 0
52622 [   6315.924][yyyy-mm-dd hh:mm:ss][ info][FwDownload        ]FwDownload_Task.c,1596:FwDownload.OngoingFwDownloadType setting updated to 0
52623 [   6315.925][yyyy-mm-dd hh:mm:ss][ info][FwDownload        ]FwDownload_Tftp.c,881:Closing socket and file descriptors, Buffer is NULL
52624 [   6315.928][yyyy-mm-dd hh:mm:ss][ info][Diagnostics       ]DIAGNOSTICS_Task.c,372:diagnostics_Shutdown
52625 [   6315.931][yyyy-mm-dd hh:mm:ss][ERROR][Diagnostics       ]DIAGNOSTICS_Task.c,266:Unrecognised timer expired (1027), removed!
52626 [   6317.964][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52627 [   6317.968][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52628 [   6317.971][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52629 [   6322.952][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52630 [   6322.955][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52631 [   6322.960][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52632 [   6327.939][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52633 [   6327.943][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52634 [   6327.946][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52635 [   6332.925][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52636 [   6332.929][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52637 [   6332.933][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52638 [   6337.905][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52639 [   6337.909][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52640 [   6337.913][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52641 [   6342.888][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52642 [   6342.892][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52643 [   6342.896][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52644 [   6347.868][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52645 [   6347.872][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52646 [   6347.876][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52647 [   6352.852][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52648 [   6352.856][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52649 [   6352.859][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52650 [   6357.833][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52651 [   6357.837][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52652 [   6357.841][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52653 [   6362.812][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52654 [   6362.817][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52655 [   6362.820][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52656 [   6367.796][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52657 [   6367.800][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52658 [   6367.804][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52659 [   6372.777][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52660 [   6372.781][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52661 [   6372.785][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52662 [   6377.759][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52663 [   6377.763][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52664 [   6377.767][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52665 [   6382.740][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52666 [   6382.744][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52667 [   6382.748][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52668 [   6387.720][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52669 [   6387.725][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52670 [   6387.728][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52671 [   6392.703][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52672 [   6392.707][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52673 [   6392.711][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52674 [   6397.683][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52675 [   6397.687][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52676 [   6397.691][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52677 [   6402.664][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52678 [   6402.667][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52679 [   6402.671][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52680 [   6407.648][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52681 [   6407.652][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52682 [   6407.656][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52683 [   6412.627][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52684 [   6412.632][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52685 [   6412.636][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52686 [   6417.610][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52687 [   6417.614][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52688 [   6417.617][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52689 [   6422.589][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52690 [   6422.594][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52691 [   6422.597][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52692 [   6427.570][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52693 [   6427.574][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52694 [   6427.577][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52695 [   6432.551][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
52696 [   6432.555][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1568:Feeding watchdog: checking tasks
52697 [   6432.559][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1580:C4_Task task heart beat not received. Supervisor is already in shutdown state. no action taken.
52698 [   6432.564][yyyy-mm-dd hh:mm:ss][ERROR][Supervisor        ]SUPERVISOR_Task.c,1727:Time out waiting for tasks to shutdown, shutting down
52699 [   6432.567][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,677:Supervisor reboot/shutdown type 5 in progress...
52700 [   6432.570][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]CH_osal_lock.c,1066:LOCK Name: C4_Task, LockedBy:c:schedule
52701 [   6432.573][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]CH_osal_lock.c,1066:LOCK Name: c:termina, LockedBy:c:schedule
52702 [   6432.574][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]CH_osal_lock.c,1070:Total Lock Entries in use: 157
52703 [   6432.576][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]LED_Service.c,150:SetLED, LED:SW, Freq(state):HIGH_FREQ
52704 [   6432.578][yyyy-mm-dd hh:mm:ss][ERROR][Supervisor        ]CH_osal_ezsp.c,4842:Failed to get EZSP LOCK
52705 [   6432.579][yyyy-mm-dd hh:mm:ss][ERROR][Supervisor        ]LED_Service.c,185:Failed ZigBee SetLED, status : 52
52706 [   6432.581][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]sqlite3_setup.c,170:chClose called! for file: /file2
52707 [   6432.603][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]CRYPTOIF_Service.c,1345:Read Key: Group 3, Index 0x0C


----------------------------------------

omnibox10 changes:
- Add a second static ipv6 address in /etc/network/interfaces (2a03:a000:5:192:226:b9ff:fe1b:4b00)
- Add a static ipv6 address on the laptop (2a03:a000:5:192:226:b9ff:fe1b:4bf8).
"/64" addresses

tun6 ip
2a03:a000:5:192:226:b9ff:fe1b:4bf8

--prefix

server.ip address on nodes needs to be the ip address of server, otherwise packets are returned
from aliased source address (2a03...) whereas they were sent to fd00::1 and are therefore rejected.

---------------------------------------

back office vpn

sudo openvpn --config ~/.vpn/SteveTickle.ovpn

----------------------------------

gerrit manual verification

ssh -p 222 stevetickle@gerrit.cyco.io gerrit review --verified 2 --message "'Manual Verification by SteveT'" a558787356713d818fd9fdcdd70a4aaa422c1079
ssh -p 222 stevetickle@gerrit.cyco.io gerrit review --submit a558787356713d818fd9fdcdd70a4aaa422c1079
-------------------------------------------


git remote set-url origin ssh://stevetickle@gerrit.cyco.io:222/interface

------------------------------------------


First make sure all commit are in master

then make sure your HEAD is point to the latest master

git fetch
git checkout origin/master
Command to tag a version in git:

git tag -a v50
git push origin v50


------------------------------------------

build #8 for agent
MPWZ_R4

v141 agent v58 server tund v7

agent-gw200-bl-OMNIMESH_R5.2.zip            - Done
agent-gw200-OMNIMESH_R5.2.zip               - Done
agent-ipa3-bl-OMNIMESH_R5.2.zip             - Done
agent-ipa3-genus-dlms-OMNIMESH_R5.2.zip     - Done
agent-ipa3-lnt-dlms-OMNIMESH_R5.2.zip       - Done
server-MPWZ_R4.zip                          - Done
tund-OMNIMESH_R5.2.zip                      - Done

----------------------------------------
ssh stickle@release.se.cyco.io


OMNIMESH_R6
build #8 server == v60


--------------------------------------------------------


ubuntu@ubuntu-VirtualBox:/Data/Projects/terminal$ ./tools/c4-tools/upload_smip.py -r --reboot m2mapz.bin
--> AT
AT
OK
--> ATE1
ATE1
OK
--> AT#PORTCFG?
AT#PORTCFG?
#PORTCFG: 8,8

OK
--> AT#PORTCFG=8
AT#PORTCFG=8
OK
--> AT+GMR
AT+GMR
12.00.927

OK
Uploading m2mapz.bin to /dev/ttyACM4
--> AT#M2MWRITE="m2mapz.bin",1688968,1
AT#M2MWRITE="m2mapz.bin",1688968,1
.................................................................................................................................................................................................................
File of size 1688968 written, waiting for modem to confirm with OK...
>>>
OK
Writing SHA sum b65a1b9245053996ebfe09474e884062183d930d2ae93794de016835c65c21e6 of m2mapz.bin to hash info file slot
--> AT#M2MCHDIR?
AT#M2MCHDIR?
#M2MCHDIR: "/"

OK
--> AT#M2MCHDIR="/fileservice/firmware/slot4"
AT#M2MCHDIR="/fileservice/firmware/slot4"
OK
--> AT#M2MWRITE="slot4.slt",32,0
AT#M2MWRITE="slot4.slt",32,0
.
File of size 32 written, waiting for modem to confirm with OK...
>>>
OK
--> AT#M2MCHDIR="/"
AT#M2MCHDIR="/"
OK
Making m2mapz.bin runnable
--> AT#M2MRUN=2,"m2mapz.bin"
AT#M2MRUN=2,"m2mapz.bin"
OK
--> AT#M2MRUN?
AT#M2MRUN?
#M2MRUN: "m2mapz.bin"

OK
--> AT+M2M=4,10
AT+M2M=4,10
OK
Rebooting CH
--> AT#REBOOT


--------------------------------------------

SMIP CH:

"AT+M2M=1"

Starts the application.

use ./tools/c4-tools/readport.py to get log.

Generate keys and certs for SMIP.

./tools/c4-tools/provision_smip.sh  -p /dev/ttyACM4 8a-73-84-53-00-00-09-2c


 1536 [    166.087][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
 1537 [    167.476][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,288:[ASH:TraceEventTime] ASH connected
 1538 [    167.483][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1275:ERROR: NCP EZSP protocol version of 0x4 does not match Host version 0x6

 1539 [    167.489][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1294:ezsp ver 0x4 stack type 0x2
 1540 [    167.512][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set source route table size to 0x10: Status: 0x00:
 1541 [    167.518][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
 1542 [    167.527][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
 1543 [    167.537][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
 1544 [    167.542][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
 1545 [    167.549][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
 1546 [    167.555][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
 1547 [    167.561][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
 1548 [    167.570][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
 1549 [    167.577][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
 1550 [    167.583][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
 1551 [    167.616][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
 1552 [    167.618][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]interpan-host.c,48:Inter pan NCP init Callback
 1553 [    167.635][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
 1554 [    167.644][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0x00:
 1555 [    167.653][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max end device children to 0x 6: Status: 0x00:
 1556 [    167.690][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
 1557 [    167.692][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]interpan-host.c,48:Inter pan NCP init Callback
 1558 [    167.701][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]interpan-host.c,88:Mac filter List Enable status = 0x00
 1559 [    167.707][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout to 0x5a: Status: 0x00:
 1560 [    167.713][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set end device poll timeout shift to 0x 6: Status: 0x00:
 1561 [    167.719][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set transient key timeout to 0x12c: Status: 0x37:
 1562 [    167.726][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CommsHubSample_callbacks.c,318:Ember Bootloader Version 1.0.0.9, Application Version 4.5.0.4
 1563 [    167.757][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,89:Failure in network index
 1564 [    167.759][yyyy-mm-dd hh:mm:ss][ERROR][Ezsp              ]multi-network.c,54:Failure in network index
 1565 [    167.779][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_CONNECTED
 1566 [    167.781][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,982:Previous timer still pending, new timer not created
 1567 [    169.082][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set TC Key Request to "Deny":
 1568 [    169.090][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set App. Key Request to "Allow":
 1569 [    169.098][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set Trust Center Policy to "Allow preconfigured key joins":
 1570 [    169.113][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 0 to 1
 1571 [    169.115][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]af-main-host.c,986:ERROR: ezspErrorHandler : EZSP_ERROR_INVALID_FRAME_ID (0x31)
 1572 [    169.117][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_DISCONNECTED
 1573 [    169.119][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CH_osal_ezsp.c,4176:EZSP state is already set as : EZSP_DISCONNECTED
 1574 [    169.121][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,820:Failure in EZSP main loop execution
 1575 [    169.123][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1033:EZSP received CHAPPMSG_EzspHandleZigBeeReset, handling errors
 1576 [    169.124][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 1 to 0
 1577 [    169.126][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent]
=== ASH started ===


ost.c,986:ERROR: ezspErrorHandler : EZSP_ERROR_INVALID_FRAME_ID (0x31)
 2002 [    215.290][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]CH_osal_ezsp.c,4165:EZSP state is set as : EZSP_DISCONNECTED
 2003 [    215.296][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]CH_osal_ezsp.c,4176:EZSP state is already set as : EZSP_DISCONNECTED
 2004 [    215.299][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]EZSP_Task.c,820:Failure in EZSP main loop execution
 2005 [    215.302][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1033:EZSP received CHAPPMSG_EzspHandleZigBeeReset, handling errors
 2006 [    215.304][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]EZSP_Task.c,1916:Set EZSP ZigBee Network monitor state from 1 to 0
 2007 [    215.305][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,297:[ASH:TraceEvent]
=== ASH started ===

 2008 [    216.623][yyyy-mm-dd hh:mm:ss][ info][  status          ] Version: smip_ctrlporthub:v141-2-g0717dd0M on hw B3PRIME_SKU3_NOSIM
 2009 [    216.625][yyyy-mm-dd hh:mm:ss][ info][  status          ] IID: 88-73-84-53-00-00-09-2c
 2010 [    216.627][yyyy-mm-dd hh:mm:ss][ info][  status          ] LoWPAN address: ::
 2011 [    216.628][yyyy-mm-dd hh:mm:ss][ info][  ip              ] IP queue lowpan: pkts: 0 (max 1), bytes: 0 (max 32), max wait: 1 ms
 2012 [    216.630][yyyy-mm-dd hh:mm:ss][ info][  ip              ] IP queue uplink: pkts: 0 (max 0), bytes: 0 (max 0), max wait: 0 ms
 2013 [    216.631][yyyy-mm-dd hh:mm:ss][ info][  cc1200          ] RX packets:1 ignored:0 bytes:56 FIFO-overflow:0 invalid:0
 2014 [    216.632][yyyy-mm-dd hh:mm:ss][ info][  cc1200          ] TX packets:3 bytes:168 channel-busy:0 FIFO-underflow:0 other-errors:0
 2015 [    216.634][yyyy-mm-dd hh:mm:ss][ info][  login           ] Login state: wait, server: [2001:9b0:192:8::10]:5684
 2016 [    216.635][yyyy-mm-dd hh:mm:ss][ info][  conman          ] Agent Mode: MeshOnly, ifaces up: NONE
 2017 [    216.637][yyyy-mm-dd hh:mm:ss][ info][  rpl/task        ] RPL Status: soliciting, instance 26
 2018 [    216.639][yyyy-mm-dd hh:mm:ss][ info][  rpl/data        ] Number of dags: 0
 2019 [    216.640][yyyy-mm-dd hh:mm:ss][ info][  rpl/data        ] Neighbors: 0, local: 0. Parents: 0, preferred: 0
 2020 [    218.214][yyyy-mm-dd hh:mm:ss][ info][Supervisor        ]SUPERVISOR_Task.c,1546:Feeding watchdog
 2021 [    218.566][yyyy-mm-dd hh:mm:ss][ WARN][Ezsp              ]telit-stubs.c,288:[ASH:TraceEventTime] ASH connected
 2022 [    218.572][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1275:ERROR: NCP EZSP protocol version of 0x4 does not match Host version 0x6

 2023 [    218.578][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,1294:ezsp ver 0x4 stack type 0x2
 2024 [    218.601][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set source route table size to 0x10: Status: 0x00:
 2025 [    218.608][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set security level to 0x 5: Status: 0x00:
 2026 [    218.617][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set address table size to 0x10: Status: 0x00:
 2027 [    218.626][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set TC addr cache to 0x 2: Status: 0x00:
 2028 [    218.632][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set stack profile to 0x 2: Status: 0x00:
 2029 [    218.638][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set MAC indirect TX timeout to 0x1e00: Status: 0x00:
 2030 [    218.644][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set max hops to 0x1e: Status: 0x00:
 2031 [    218.650][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set tx power mode to 0x8000: Status: 0x00:
 2032 [    218.659][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set supported networks to 0x 1: Status: 0x00:
 2033 [    218.666][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set binding modify to "allow for valid endpoints & clusters only":
 2034 [    218.672][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,746:Ezsp Policy: set message content in msgSent to "return":
 2035 [    218.705][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set Fragmentation RX window size to 0x 1: Status: 0x00:
 2036 [    218.707][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]interpan-host.c,48:Inter pan NCP init Callback
 2037 [    218.724][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set binding table size to 0x10: Status: 0x00:
 2038 [    218.733][yyyy-mm-dd hh:mm:ss][ info][Ezsp              ]af-main-host.c,712:Ezsp Config: set key table size to 0x10: Status: 0


 2022 [    216.627][yyyy-mm-dd hh:mm:ss][ info][  status          ] Version: smip_ctrlporthub:v141-2-g0717dd0M on hw B3PRIME_SKU3_NOSIM



----------------------------------------------------------------------




{
  "jobName": "RAVISET12",
  "meterGroup": "RAVIFW1",
  "scheduledTime": null,
  "timeoutTime": null,
  "createTime": "2018-12-19T11:53:57Z",
  "updateTime": "2018-12-19T11:56:25Z",
  "status": "FINISHED",
  "jobType": "METER_COMMAND_SET",
  "jobConfiguration": {
    "name": null,
    "commands": [
      {
        "type": "PROFILE_CAPTURE_PERIOD",
        "activationTime": "2018-12-19T17:30:00+0530",
        "profileType": "BLOCK_LOAD",
        "capturePeriod": 1800
      },
      {
        "type": "PROFILE_CAPTURE_PERIOD",
        "activationTime": "2018-12-19T17:30:00+0530",
        "profileType": "INSTANTANEOUS",
        "capturePeriod": 1800
      },
      {
        "type": "DEMAND_INTEGRATION_PERIOD",
        "activationTime": "2018-12-19T17:30:00+0530",
        "demandPeriod": 1800
      },
      {
        "type": "BILLING_PERIOD",
        "activationTime": "2018-12-19T17:30:00+0530",
        "date": {
          "dayOfMonth": 3
        }
      }
    ]
  },
  "totalProcessedDevices": 2,
  "totalSuccessfulDevices": 2,
  "totalFailedDevices": 0
}



{
  "meters": [
    {
      "meterId": "G102008",
      "status": "SUCCESS",
      "failureStep": "0",
      "response": [
        {
          "type": "BILLING_PERIOD",
          "active": true,
          "date": {
            "dayOfMonth": 1
          }
        },
        {
          "type": "DEMAND_INTEGRATION_PERIOD",
          "demandPeriod": 1800,
          "active": true
        },
        {
          "type": "PROFILE_CAPTURE_PERIOD",
          "profileType": "BLOCK_LOAD",
          "capturePeriod": 1800,
          "active": true
        },
        {
          "type": "PROFILE_CAPTURE_PERIOD",
          "profileType": "INSTANTANEOUS",
          "capturePeriod": 1800,
          "active": true
        }
      ]
    },
    {
      "meterId": "G102009",
      "status": "SUCCESS",
      "failureStep": "0",
      "response": [
        {
          "type": "BILLING_PERIOD",
          "active": true,
          "date": {
            "dayOfMonth": 5
          }
        },
        {
          "type": "DEMAND_INTEGRATION_PERIOD",
          "demandPeriod": 900,
          "active": true
        },
        {
          "type": "PROFILE_CAPTURE_PERIOD",
          "profileType": "BLOCK_LOAD",
          "capturePeriod": 1800,
          "active": true
        },
        {
          "type": "PROFILE_CAPTURE_PERIOD",
          "profileType": "INSTANTANEOUS",
          "capturePeriod": 1800,
          "active": true
        }
      ]
    }
  ]
}

---------------------------------

--------------------------------

FILE_service.h


/*!
 * Connode files, which are located in Telit file system.
 */
enum
{
   FILE_ConActivityReportSlot = 0U,
   FILE_ConRplStateSlot,
   FILE_ConFwDlEncryptedFileSlot,
   FILE_ConFwDlFileSlot,
   FILE_ConFwDlStateSlot,
   FILE_ConCfgDataSlot,             /*!< Unused from Agent v84, Kept for backward compatibility */
   FILE_ConMacSecStateSlot,
   FILE_ConDtlsStateSlot,           /*!< Unused from Agent v84, Kept for backward compatibility */
   FILE_ConMsgQ0Slot,
   FILE_ConMsgQ1Slot,
   FILE_ConMsgQ2Slot,
   FILE_ConMsgQ3Slot,
   FILE_ConMsgQ4Slot,
   FILE_ConMsgQ5Slot,
   FILE_ConMsgQ6Slot,
   FILE_ConMsgQ7Slot,
   FILE_ConMsgQ8Slot,
   FILE_ConMsgQ9Slot,
   FILE_ConSpare1Slot,
   FILE_ConSpare2Slot,
   FILE_ConSpare3Slot,
   FILE_ConSpare4Slot,
   FILE_ConSpare5Slot,
   FILE_ConSpare6Slot,
   FILE_ConSpare7Slot,
   FILE_ConSpare8Slot,
   FILE_ConSpare9Slot,
   FILE_ConTempDL,                  /*!< Temporary file location used once Connode have completed download */
   FILE_ConnodeSlotsSizeEnum        /*!< MUST be last entry, used for validation */
};


--------------------------------------------

NMS API

"/networks/:networkId/nodes*": "/network-nodes",
"/widget/nodestats": "/widgets-nodestats",
"/widget/serverstats": "/widgets-servers",
"/nodes/:nodeId/configuration*": "/node-configuration",
"/nodes/:nodeId/widgets/statistics": "/nodes-widgets-statistics",
"/nodes/:nodeId/actions/ping": "/node-ping",
"/nodes/:nodeId/actions/restart": "/node-restart",
"/nodes/:nodeId/events/node*": "/node-events-node",
"/groups/:groupId/nodes*": "/group-nodes",
"/nodes/:nodeId/events/network*": "/node-events-network",
"/nodes/:nodeId/devices*": "/node-devices",
"/jobs/configuration/params*": "/configuration-params",
"/platform/servers/:serverName": "/platform-server",
"/platform/servers*": "/platform-servers",
"/jobs/:jobId/nodes*": "/job-nodes",
"/platform/config/auth": "/configuration-auth",
"/platform/config/dns": "/configuration-dns",
"/platform/config/ha": "/configuration-ha",
"/platform/config/proxy": "/configuration-proxy",
"/platform/config/log": "/configuration-logging",
"/platform/config/mq": "/configuration-message-queue",
"/platform/config/events": "/configuration-network-events",
"/platform/config/alarms": "/configuration-server-alarms",
"/platform/config/tun6d": "/configuration-uplink-monitoring",
"/platform/config/pki": "/configuration-pki",
"/platform/config/nodeAccess": "/configuration-node-access",
"/platform/alarms*": "/platform-alarms",
"/map/nodes*": "/map-nodes",
"/nodes/:nodeId/statistics/properties": "/node-statistics-properties",
"/nodes/:nodeId/statistics*": "/node-statistics",
"/platform/dtls*": "/platform-dtls$1",
"/map/networks*": "/map-networks",
"/platform/server-security-pair*": "/platform-server-security-pair"


---------------------------------------------

smip error:

74638 [   8898.621][yyyy-mm-dd hh:mm:ss][ERROR][WanManager        ]WANMGR_NetworkTimers.c,1106:Too many AT command errors, rebooting to recover, AT command: 'AT#CSURV' after command 'AT+COPS=2'


---------------------------------------------

Adams repo omnimesh

https://gitlab.cyco.io/Omnimesh/omnimesh-demo/blob/master/omnisma-demo.py

----------------------------------------------

Disabling ipv6 address generation with NetworkManager:

/etc/NetworkManager/system-connections/BackOffice

[ipv6]
addr-gen-mode=eui64

----------------------------------------------------------------

SMIP-26

- Suspected deadlock on acquiring SPI mutex. Is VaultIC device and CC1200 on same SPI bus?
- Possible problem is CC code has SPI bus held, but then tries to acquire SPI bus again for
random number generation? Don't think this can happen.
- Possibly generate high rate of SPI traffic with CC1200 and RNG calls?



ch_hal_spi_transfer:
 - ch_osal_mutex_lock(spi_mtx, CH_HAL_SPI_MUTEX_TIMEOUT, CH_OSAL_MUTEX_RECURSIVE)

agent.h
cndsmip.h

C4_rndSetCallback(taskc4_rndCB);
s_rndCB() -> taskc4_rndCB() -> CRYPTOIF_Random()

CRYPTOIF_Random:
ch_osal_mutex_lock(cryptoif_Lock, C_CH_OSAL_MUTEX_INFINITE, CH_OSAL_MUTEX_RECURSIVE)
cryptoif_IC_Random() -> VltGenerateRandom()
ch_osal_mutex_unlock(cryptoif_Lock);


--------------------------------------------------

agent.h:

cnd_ConState
cnd_AgentMode

cnd_ConStateCB()
cnd_conStateAddCallback()

conStateUpdatedSchedule()
triggered by conStateUpdated()

---------------------------------------------------------

secondary ipv6 order:

https://unix.stackexchange.com/questions/285051/how-do-i-add-a-second-ipv6-address-on-linux-without-making-it-default

ip addr add <address> dev <device> preferred_lft <lifetime>

you can also set it on an existing address

ip addr change <address> dev <device> preferred_lft <lifetime>


if-up script in /etc/network/interfaces

-------------------------------------------------------------------

time sync test:

server->gateway->nodes->meter.

tests:
- (Set test) end-to-end, read meter-clock and server-clock simulateneouslyi(ish) to determine current offset. Modify server-clock -1hr to
and monitor meter-time by monitoring log to check for time sync occurring. When found, perform a final read and comparison to verify.
- (update) end-to-end, with a delta of -(update-threshold), -(update-threshold+1), +(update-threshold-1), +(update-threshold+1)

[meter/time_synch] { schedule}: Time synchronization request


---------------------------------------------------------------


Stages:
- Implement end-to-end application-level reliability so we don't rely on transport-level reliability (MQ) so we don't rely on transport-level reliability (MQ).
- Implement a small RAM-backed mq, run in parallel. Duplicate existing mq code, change file-backing to RAM-backed.
- Move sample-data to RAM-MQ. Small-change, lots of testing.
- Allocate space in internal FLASH for file-distribution, redirect file distribution to use this area. Encryption may need to be done a block-basis instead of whole-file.
- Make small cirular buffer (notification-queue) in FLASH for node events, redirect eventStore API to use this area.
- Move metrics to straight CoAP PUSH. Allow metrics to be unreliable? I think this is a good trade-off.
- Move Storage of the Configuration PB to a simple small circular buffer. This is currently implemented with two-files as a (small) circular buffer.
- Add storage for configuration of instantaneous profile capture-period (in configuration circular buffer?). Remove DataProfileContext storage.
- Move meter-push-alarm notifications to circular buffer notification-queue.

At this point we have the FLASH requirement removed for the following types:
- Profile samples (moved to RAM-MQ which can be further optimised given time).
- Meter push alarm notifications (moved to notification-queue).
- Node events (moved to notification-queue)
- Metrics data changed to use direct CoAP PUSH mechanism rather than storing in MQ (change of semantics here).
- File distribution (moved to designated area on internal-FLASH).
- Configuration (moved to small circular-buffer on internal FLASH).
- Meter-driver context storage (removed exept for instantaneous-profile capture-period which moves into config).

Which leaves the final step:
- Make FLASH driver & CNDFS optional in build.


First phase ofFLASH-removal, put application checking in position:
- SMA to validate incoming profile data against corresponding schema (number of fields, type of field).
- On device registration/login, SMA responds with new message containing timestamps for all profiles.
- On Agent:
DataProfileContext->timestamp
dataprofile::storeConfig()
dataprofile::restoreConfig()
handle storage of the last timestamp, these will evetually be removed, but for now DataProfileContext->timestamp can be
modified by receipt of a new message from SMA: SetLastKnownGoodProfileTimestamp.
- SMA must handle potential duplicated messages for same timestamps via db update.

At this point, FLASH is still being used to store updated last-known-good timestamp. We can stop this
then the DataProfileContext mostly doesn't need storage.
There is capture-period-setting state in there that needs to be persisted in a different way that
is common with all other config data, not just capture-period.
DataProfileContext can then be removed, leaving the timestamp to be stored (transiently) in DataProfileDiscovery struct.
along with discovery infomation.
DataProfileContext does store capturePeriod for isntantaneous, need to find a way around that.



-------------------------------------------------------

Hard fault:  Hsch BF200543f5@633beL63383S2000e958
location is within "_malloc_r()"


-----------------------------------------------------------


- Add, not replace generation of Activation-complete with newly created activation-complete node-event.
- parameter in node event needs to contain job id for NMS to match up.
- Timed activation of meter is complete for job.
- Got picture of sequence to document.


----------------------------------------------------------


./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4000 -listen 4242 -loglevel debug


gdb --args ./build/host-lnt-insecure/bin/agent -eui64 00-00-00-00-00-00-00-01 \
 -meter /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0 \
 -initrtc \
 -ctrlhub 127.0.0.1 \
 -ctrlhubport 4242 \
 -loglevel debug \
 -param device.dlms.lls_password=lnt1 \
 -param device.dlms.authentication_key=31323334353637383930313233343536 \
 -param device.dlms.encryption_key=31323334353637383930313233343536 \
 -param device.dlms.hls_key=30303030303030303031303335383230 \
 -param device.time.sync_timer=1 \
 -param server.ip=2a03:a000:5:192:e437:5170:6f78:cfc5 \
 -param server.port=5684 \
 -param modem.tun6.ip=127.0.0.1 \
 -param modem.tun6.secret=whatsfordinner \
 -param modem.apn=4g.tele2.se \
 -param server.mq.push_now=1 \
 -param server.mq.push_delay=30 \
 -param device.capabilities.dlmspipe.push=0 \
 -param device.dlms.pipe_enabled=0 \
 -rootcert /Data/Temp/KeyTest/root.crt.der  \
 -cert /Data/Temp/KeyTest/node.crt.der  \
 -key /Data/Temp/KeyTest/node.key.der  \
 -mackey /Data/Temp/KeyTest/mac-keys.txt \
 -gateway \
 -statedir AgentState \
 -socket


------------------------------------------------------------



Regarding low-power

9) low-power is in Omnimeshs's future (however distant).
9b) sleepy-nodes will always be lower-power than mostly-on nodes, reagrdless of technology.
9c) High-power (always-on) is a special-case of low-power (i.e. a high-power node can just do nothing with the 'off' time).
9d) The architectural requirements of sleepy-nodes dictate a large part of the architecture of the system as a whole.
9c) 9 + 9b + 9c  imply that we *can* design for sleepy-nodes now without losing any features.
9e) 9d + 9c imply that we *should* design for low power now rather than later.
10) Non-mesh networks such as stars are inherently better for low-power than meshes.
11) Low-power networks such as ZigBee, BLE or LoRA cannot support the overhead of IPv6 (or rather they can, but generally choose not to). There are good reasons for this.
12) 9 + 10 + 11 implies IPv6 is not a given in Ommnimesh's future.
13) 12 implies IPv6 is not suitable for addressing nodes looking forward.
14) In this (eventual) low-power future, it would be desirable to support mixed always-on/mostly-off networks, i.e. Elec/Gas/Water.
15) 14 implies a hybrid network (e.g. mesh-of-stars) is a good fit for Omnimesh in the future (almost ZigBee model).
16) 15 implies there is an elephant in the room ;o)



Primary node addressing scheme:

0) Addressing-scheme is a critical architectural point that dictates available technologies in the future.
0b) addressing is difficult to change.
1) IPv6 addresses under Omnimesh are dynamic (mesh hopping).
1b) IPv6 addresses are arbitrary and composed by our code from "prefix##eui64".
2) Individual transactions are long-duration, and multi-packet, thus may cross dynamic IP boundaries, i.e. a node can change IP in the middle of a transfer.
2b) different technologies will have (potentially) hardcoded addressing schemes (e.g. based on manufacturer-specified MAC address).
3) 1 + 2 + 2b imply IPv6 addresses are not suitable to uniquely identify a node.
4) 1 + 2 also imply a DTLS session (between IPv6 endpoints) will not be efficient as the session may be torn down and restarted mid-transaction.
4) IPv6 is an implementation detail. You can imagine a ZigBee or LoRAWAN based network with different addressing needs.
5) Device EUI is static, uniquely identifies a node and is assigned by us, independent of communication technology.
6) 4 + 5 imply the real unique identifiers of nodes for communication purposes should be EUI-64.
7) DTLS may be appropriate for some applications, so no problem keeping it as an option for those (and for backward compatibility).


NMS split:

Data types:
- IPv6                          - open.
- EUI64                         - open.
- meterID                       - open.
- Configuration data            - authenticated.
- event data                    - closed/authenticated.
- metering data                 - closed/authenticated.
- PKI credentials               - closed/authenticated.
- monitoring data               - open.

Features of NMS are:
- job management                        - unprivileged, coupled with node-data-transfer.
- node data transfer                    - unpriveleged, coupled with job management/asynchronous comms.
- DTLS PKI management                   - privileged coupled with transport security (DTLS).
- transport security (DTLS)             - privileged, coupled with CoAP/HTTP proxy (?)
- CoAP/HTTP proxy                       - unprivileged, coupled with DTLS and PKI.
- configuration management              - privileged, coupled with other management features,
- event handling                        - privileged, coupled with other management features.
- network monitoring                    - unprivileged, coupled with other management features.

So NMS becomes 3 submodules:
- Network Management Application (NMA). Network configuration,  event handling and monitoring.
- Secure Transport Endpoint (STE). Secure CoAP/HTTP proxy. Could be co-located with MDMS over a VPN providing a secure endpoint to SMA (not HTTPS over open network which would require re-encrypting), bypssing NMA (old NMS).
- Asynchronous Communications Manager (ACM).




Secure Transport Endpoint (STE):
- Secure CoAP/HTTP proxy.
- VPN between our data centre and secure data centre (MDMS).
- SMA co-located with MDMS.
- STE co-located with MDMS.
- Nodes can target STE over IPv6/VPN, physically located in secure data centre.
- decrypting avoided until physically inside secure data centre with SMA and MDMS.
- *only* secure when physically located at the *real* endpoint.
- Reusable for different applications.

Network Management Application (NMA).
- Network configuration
- event handling and notfication.
- Network Monitoring and notification.
- Geographic UI.

Asynchronous Communications Manager (ACM):
- Co-located with tun6d.
- request aggregation.
- multi-packet response collation.
- Has to be a man-in-the-middle in order to perform aggregation and collation of multi-packet responses.
- Single ACM instance serves multiple applications, can optimise across applications.
- ACM has a new API that we can migrate to slowly
- Has to be ouside of DTLS as an ACM inside DTLS would have no visibility of other DTLS streams.
- ACM has to deal with raw UDP packets to be able to transport DTLS streams.
- ACM can have no API, it must be a network interface similar to tun6.
- ACM could present a tun interface to outside world (i.e. STE).
- incoming packets are aggregated according to network topology obtained from tun6.


- packet aggregation can be done outside DTLS
- async API needs to be inside DTLS
- request aggregation needs to be done instide DTLS.
- reponse collation needs visibility of data, therfore has to be inside of DTLS.



1) Nodes are primarily addressed by EUI-64 (following from above).
2) Communications facility should be (able to be) shared between multiple applications (application independence).
3) Some metering networks (e.g. SMETS) exist where end-to-end encryption is assumed.
4) Welmec/MID (European metering standards) software requirements for metering *strongly* imply end-to-end encryption.
5) CPA requirements (GB security/robistness standards related to metering) for metering *specify* end-to-end encryption.
6) Welmec would consider Omnimesh to be an "open network" and suggest use of encryption (and specify authentication).
7) Most/all(?) deployed DLMS systems use end-to-end encryption.
8) Accepted techniques for secure end-to-end transfer of private information (i.e. metering data) involve end-to-end encryption.
9) 7 + 8 imply our competitors will be end-to-end encrypted.
10) We can't consider the data centre (AWS/bare-metal) to be secure as it is out of our control.
11a) "Dont trust services"; We can't trust a data centre to be secure.
11b) "Principle of least privelage"; The communications portions of our network don't need to see the plaintext data, therefore they shouldn't.
11c) "Minimise attack surface area"; We have the opportunity to remove an exposed surface (security endpoint terminating at NMS) therefore we should.
11d) "limit the impact of any compromise". If the data centre gets exposed, *all* metering data for the *whole* population would be exposed (and could be exfiltrated with e.g. tcpdump on a running server).
11e) "No segment or tier of a service should implicitly trust requests from other segments." Currently our NMS/SMA implicitly trust each other, they shouldn't.
12) True end-to-end encryption is table-stakes for a secure metering application.

13) Network data transfer infrastructure should be un-privelaged (opaque data/payloads).
14) Management features should be privelaged (transparent data/payloads).
15) CoAP/HTTP proxy simply performs protocol translation, entirely decoupled from rest of system, therefore can be entirely standalone.
16) PKI management is obviously privelaged.
17) Event handling may need to trigger privelaged actions, therefore privelaged.
18) Job management is effectively an asynchronous data transfer API, therefore application independent and sees opaque data, therfore unprivelaged.

20) Secure end-to-end transport communications (i.e. to STE) cannot be aggregated/optimised though ACM (ACM *has* to be a man-in-the-middle).
21) ACM is a single isntance serving multiple applications.

Factors to consider for determining split?
- security/privelage separation.
- performance
- Grouping of features
- use-case



MID requirement: "Any network that contains legally controlled devices with IR or wireless network communications
interfaces shall be considered to be an open network."

Welmec: https://www.owasp.org/index.php/Security_by_Design_Principles
NCSC: https://www.ncsc.gov.uk/blog-post/how-ncsc-thinks-about-security-architecture




------------------------------------------------

Load balancing:


    TunnelA -|
             --- Tunnel
    TunnelB -|


    fd00::a -|
             ---- fd00::1
    fd00::b -|

- Agent opens uplink with tunnel, gets forwaded to tunnelA.
- Agent opens DTLS session with fd00::1, get forwarded to fd00:B.

- by sharing a prefix file, tunnelA and tunnelB can allocate the same IP address

----------------------------------------------------

prefer IPv4 over IPv6
getaddrinfo

/etc/gai.conf


https://community.rackspace.com/products/f/public-cloud-forum/5110/how-to-prefer-ipv4-over-ipv6-in-ubuntu-and-centos

precedence ::ffff:0:0/96  100

------------------------------------------------------


__ram_start = 536888834 __ram_end = 406209674
stackVar= 536938872 heapVar=536942368

__ram_start = 0x20004602
__ram_end   = 0x1836448a
stackVar    = 0x20010978
heapVar     = 0x20011720

#include "platform/core/pointer-checks.h"
#include <inttypes.h>
#include "platform/core/memory.h"

void prodmodeEnterIfNotCommissioned(void)
{
    logSetLevel(LogLevelDebug);

    uint8_t     stackVar[16];
    uint8_t*    heapVar = MALLOC(10);
    //LOG_INFO("__ram_start = %"PRIu32" __ram_end = %"PRIu32"",__ram_start,__ram_end);
    //LOG_INFO("stackVar= %"PRIu32" heapVar=%"PRIu32"",(uint32_t)&stackVar[0],(uint32_t)&heapVar[0]);
    LOG_INFO(">>> doing test...");
    OS_sleepSec(1);
    CHECK_POINTER_IS_READABLE( &stackVar[0] );
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);
    CHECK_POINTER_IS_WRITABLE( &stackVar[0] );
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);
    CHECK_POINTER_IS_READABLE( &heapVar[0] );
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);
    CHECK_POINTER_IS_WRITABLE( &heapVar[0] );
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);
    CHECK_POINTER_IS_WITHIN_BUFFER( &stackVar[1], &stackVar[0],&stackVar[0]+sizeof(stackVar));
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);
    CHECK_POINTER_IS_WITHIN_BUFFER( &stackVar[0], &stackVar[0],&stackVar[0]+sizeof(stackVar));
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);
    CHECK_POINTER_IS_WITHIN_BUFFER( &stackVar[15], &stackVar[0],&stackVar[0]+sizeof(stackVar));
    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);

    //CHECK_POINTER_IS_WITHIN_BUFFER( &stackVar[16], &stackVar[0],&stackVar[0]+sizeof(stackVar));

    LOG_INFO(">>> %d",__LINE__);
    OS_sleepSec(1);



----------------------------

Kaifa: PanMesh server on http://10.32.31.121
EUI of gateway 00-1b-c5-0c-60-00-27-11

64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=1 ttl=32 time=72.8 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=2 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=3 ttl=32 time=72.8 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=4 ttl=32 time=73.0 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=5 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=6 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=7 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=8 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=9 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=10 ttl=32 time=72.9 ms
64 bytes from fd7e:ce88:ce59:0:21b:c50c:6000:2711: icmp_seq=11 ttl=32 time=72.9 ms

hello

The following information may be useful if you are connected to this computer.


Serial port:


ttyACM0 is Gateway
ttyACM1 is IPA3 module

The IPA3 Module is not connected to the gateway.


my computer password:tianmei


the following two board are old version RF mesh

fd7e:ce88:ce59:0:21b:c50c:6000:2791
fd7e:ce88:ce59:0:21b:c50c:6000:2793


thank you and good luck!
Thanks!
ok



pls go on

tianmei@user:~/CoAPTools$ ./coap_tool.py --config-list

agent:
2019-01-22 19:19:46,640 ctrlport : Connecting to ctrlporthub on localhost:4000
prod.prodtime                            : 1544457897
prod.alias.id                            :
prod.ethernet.macaddr                    :
prod.lowpan.eui64                        : 00-1B-C5-0C-60-04-FD-D9
prod.hw.version                          :
rpl.enabled                              : 1
rpl.br.dio.imin                          : 12
rpl.br.dio.imax                          : 8
rpl.br.dio.k                             : 6
rpl.br.routelife                         : 1200
rpl.br.ocp                               : 1
rpl.dis.trickle.min.ms                   : 10000
rpl.dis.trickle.doublings                : 4
rpl.probe.interval.min.ms                : 1500
rpl.probe.doublings                      : 6
rpl.instance_id                          : 0
rpl.etx.weight_factor                    : 64
rpl.mrhof.pp_hysteresis                  : 75
rpl.dag_switch.hysteresis                : 150
rpl.dag_switch.time                      : 7200
rpl.routes.max                           : 10000
rpl.dao.deferred_ack                     : 1
rpl.netsize_penalty                      : 64
^[[Alowpan.txpower.max                       : 10
lowpan.hop_limit                         : 32
lowpan.frame_retries                     : 3
lowpan.powercontrol.interval             : 480
lowpan.powercontrol.target               : -90
lowpan.powercontrol                      : 1
lowpan.cca.threshold                     : -94
lowpan.channelplan                       : 7
lowpan.channel                           : 0
lowpan.autochannel                       : 0
lowpan.highgainmode                      : 0
server.ip                                : fd00:c4::1
server.port                              : 5684
server.mq.push_now                       : 0
server.mq.push_delay                     : 3600
server.mq.more_delay                     : 600
modem.uplink.max_failures_before_reset   : 5
mac.lbt.min.be                           : 3
mac.lbt.max.be                           : 8
mac.lbt.max.backoffs                     : 20
mac.dutycycle.limit                      : 10
mac.dutycycle.buffer                     : 1000
mac.frame_size                           : 253
dtls.timeout.initial.s                   : 8
dtls.timeout.max.s                       : 127
dtls.heartbeat.period.s                  : 3600
dtls.heartbeat.retry.s                   : 120
dtls.heartbeat.max.retries               : 4
monitor.profile.default.enabled          : 1
monitor.profile.default.sample.interval  : 86400
monitor.profile.radio.enabled            : 0
monitor.profile.radio.sample.interval    : 3600
monitor.profile.network.enabled          : 0
monitor.profile.network.sample.interval  : 3600
monitor.profile.ip.enabled               : 0
monitor.profile.ip.sample.interval       : 3600
time.tz                                  : CET-1CEST,M3.5.0/2,M10.5.0/3
time.max.diff                            : 30
time.mesh.fail.event.interval            : 1800
time.mesh.period                         : 3600
time.ref.period                          : 43200
time.ref.rtt.max                         : 30
coap.retry.timeout                       : 10
coap.session.timeout                     : 60
coap.attempts                            : 3
device.error.rate_limit.s                : 7200
device.dlms.lls_password                 : hello
device.dlms.data_profiles                : 1
device.time.set.enabled                  : 1
device.instant.default_period            : 15
device.time.min_deviation                : 10
device.time.max_deviation                : 180
device.time.sync_timer                   : 240
device.dlms.pipe_enabled                 : 1
device.capabilities.dlmspipe.push        : 0
node.power_fail.gracetime                : 0
node.production.rssisource.enabled       : 0
node.production.rssisource.power         : 10
node.production.rssisource.period        : -500
node.production.meter_update_period      : 5
capabilities.meter.reverse_ESW           : 0
capabilities.meter.device_testing        : 1
capabilities.dlmspipe.session_close_detection : 0


gw:

activity
activity.report.enabled 1
coap
coap.attempts   3
coap.retry.timeout  10
coap.session.timeout    60
device
device.error.rate_limit.s   7200
device.dlms.lls_password    hello
dtls
dtls.timeout.initial.s  8
dtls.heartbeat.retry.s  120
dtls.heartbeat.period.s 3600
dtls.timeout.max.s  127
dtls.heartbeat.max.retries  4
lowpan
lowpan.cca.threshold    -94
lowpan.frame_retries    3
lowpan.frequency    0
lowpan.channel  27
lowpan.hop_limit    32
lowpan.autochannel  0
lowpan.phymode  0
lowpan.powercontrol.target  -90
lowpan.txpower.max  38
lowpan.powercontrol 1
lowpan.powercontrol.interval    480
mac
mac.frame_size  253
mac.lbt.max.backoffs    20
mac.filter.src.iid.1    00-00-00-00-00-00-00-00
mac.filter.src.iid.2    00-00-00-00-00-00-00-00
mac.dutycycle.buffer    1000
mac.lbt.min.be  3
mac.dutycycle.limit 10
mac.lbt.max.be  8
modem
modem.tun6.secret   yooheem6eeBe
modem.tun6.port 8050
modem.tun6.ip   10.32.31.121
monitor
monitor.profile.radio.enabled   0
monitor.profile.network.sample.interval 3600
monitor.profile.ip.enabled  0
monitor.profile.network.enabled 0
monitor.profile.ip.sample.interval  3600
monitor.profile.default.enabled 1
monitor.profile.radio.sample.interval   3600
monitor.profile.default.sample.interval 3600
rpl
rpl.dis.trickle.doublings   4
rpl.br.dio.k    6
rpl.instance_id 0
rpl.br.routelife    1200
rpl.br.mrhof.max_rank_increase  384
rpl.br.mrhof.min_rank_increase  128
rpl.probe.doublings 6
rpl.dis.trickle.min.ms  10000
rpl.probe.interval.min.ms   1500
rpl.br.dio.imin 12
rpl.dag_switch.time 7200
rpl.dag_switch.hysteresis   150
rpl.br.ocp  1
rpl.mrhof.pp_hysteresis 75
rpl.br.dio.imax 8
rpl.etx.weight_factor   64
rpl.enabled 1
server
server.mq.push_delay    3600
server.mq.push_now  0
server.ip   fd00:c4::1
server.port 5684
server.mq.more_delay    600
time
time.ref.rtt.max    30
time.ref.period 43200
time.mesh.period    3600
time.mesh.fail.event.interval   1800
time.max.diff   30
time.tz CET-1CEST,M3.5.0/2,M10.5.0/3



echo -n 0 `xxd -ps mac_key` > mac_keys.txt.mine
diff mac_keys.txt mac_keys.txt.mine


./tools/c4-tools/coap_request.py ---eui64 <eui64> --fs_read dp_config


gw v94 on an ma304_eth
v45 on Panmesh server
v14x on IPA3b.


channel 27 == plan 0, channel 27

On Mesh , can ping
fd7e:ce88:ce59:0:21b:c50c:6004:fdd9

eui: 00-1b-c5-0c-60-04-fd-d9


/opt/panmesh/current
- Can see DTLS conversation happening on Panmesh server.
- Conversation ends with "no server certificate available"



2019-01-24 00:07:22,083 TRACE [dtls-pool-4] DTLSConnection - DTLS packet 5d3963b7 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), migrating=false
2019-01-24 00:07:22,083 TRACE [dtls-pool-4] DTLSConnection - Wrong epoch address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, gotEpoch=1, gotSeqNo=0
2019-01-24 00:08:13,413 TRACE [dtls] DTLSConnectionRegistry - New connection address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684
2019-01-24 00:08:13,413 TRACE [dtls] DTLSConnection - DTLS packet bf12b9f0 added to queue, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=null, migrating=false
2019-01-24 00:08:13,414 TRACE [dtls-pool-1] DTLSConnection - DTLS packet bf12b9f0 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=null, migrating=false
2019-01-24 00:08:13,415 TRACE [dtls-pool-1] DTLSConnection - Start handshake address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, serverSessionId=null
2019-01-24 00:08:13,415 TRACE [dtls-pool-1] DTLSServerHandshake - Handshake fragment address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=client_hello, messageSeq=0
2019-01-24 00:08:13,415 TRACE [dtls-pool-1] DTLSHandshakeProcedureFactory - isResuming address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=null, clientRandom=Random(6c3a20316e53baca519e656eb8d41e122ae2036fda5dd41df29e9b43033aba2c), remoteCookie=null
2019-01-24 00:08:13,417 TRACE [dtls-pool-1] NodeStorageProvider - Session info null
2019-01-24 00:08:13,418 TRACE [dtls-pool-1] DTLSHandshakeProcedureFactory - Cannot read session info from the database - reverting to full handshake, clientSessionId=Cannot read session info from the database
2019-01-24 00:08:13,418 TRACE [dtls-pool-1] DTLSHandshakeProcedureFactory - isResuming address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), resuming=false
2019-01-24 00:08:13,419 TRACE [dtls-pool-1] DTLSHandshakeProcedure - Handshake message address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=client_hello, expectedMessageSeq=0, messageSeq=0
2019-01-24 00:08:13,419 TRACE [dtls-pool-1] DTLSHandshakeProcedure - receiveInitialClientHello address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=null, cookie=12744cbd011fb530b30eaf6a4700c8155da9a7b0e6769e3bd69994b3d5d1
2019-01-24 00:08:13,634 TRACE [dtls] DTLSConnection - DTLS packet 1a4e7352 added to queue, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=null, migrating=false
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSConnection - DTLS packet 1a4e7352 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=null, migrating=false
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSConnection - Record packet address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, contentType=ContentType=handshake, epoch=0, nextSeqNo=2, gotEpoch=0, gotSeqNo=1
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSServerHandshake - Handshake fragment address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=client_hello, messageSeq=1
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSHandshakeProcedure - Handshake message address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=client_hello, expectedMessageSeq=1, messageSeq=1
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - receiveClientHelloWithCookie address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=null, clientRandom=Random(6c3a20316e53baca519e656eb8d41e122ae2036fda5dd41df29e9b43033aba2c), remoteCookie=12744cbd011fb530b30eaf6a4700c8155da9a7b0e6769e3bd69994b3d5d1
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - protocolVersion version=DTLS_PROTOCOL_VERSION_1_2
2019-01-24 00:08:13,635 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - trustedCaKeys x509Name=null, keySha1Hash=bd0adc9791da7b4ac2e4cf1fc364217114f23205
2019-01-24 00:08:13,636 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - sendServerHello address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), serverRandom=Random(bd677a7513f3ad531d51f214385195381ab05e7e10bcff88fa778680fe272bdc), cipherSuite=TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8
2019-01-24 00:08:13,636 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - sendCertificate address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525)
2019-01-24 00:08:13,657 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - sendServerKeyExchange address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525)
2019-01-24 00:08:13,662 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - sendCertificateRequest address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), authorities=null
2019-01-24 00:08:13,663 TRACE [dtls-pool-3] DTLSFullHandshakeProcedure - sendServerHelloDone address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, clientSessionId=SessionId(781dc1955974417547b817a32e5a53829a48416742a675d0b78b2b0914ec9b46), serverSessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525)
2019-01-24 00:09:59,539 TRACE [dtls] DTLSConnection - DTLS packet 41972fa1 added to queue, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), migrating=false
2019-01-24 00:09:59,539 TRACE [dtls-pool-2] DTLSConnection - DTLS packet 41972fa1 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), migrating=false
2019-01-24 00:09:59,539 TRACE [dtls-pool-2] DTLSConnection - Record packet address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, contentType=ContentType=handshake, epoch=0, nextSeqNo=3, gotEpoch=0, gotSeqNo=2
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSServerHandshake - Handshake fragment address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=certificate, messageSeq=2
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSConnection - DTLS packet 41972fa1 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), migrating=false
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSConnection - Record packet address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, contentType=ContentType=handshake, epoch=0, nextSeqNo=4, gotEpoch=0, gotSeqNo=3
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSServerHandshake - Handshake fragment address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=client_key_exchange, messageSeq=3
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSConnection - DTLS packet 41972fa1 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), migrating=false
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSConnection - Record packet address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, contentType=ContentType=handshake, epoch=0, nextSeqNo=5, gotEpoch=0, gotSeqNo=4
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSServerHandshake - Handshake fragment address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=certificate_verify, messageSeq=4
2019-01-24 00:09:59,540 TRACE [dtls-pool-2] DTLSHandshakeProcedure - Handshake message address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, handshakeType=HandshakeType=certificate, expectedMessageSeq=2, messageSeq=2
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] DTLSFullHandshakeProcedure - receiveCertificate address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, length=1
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] PKIManagement - Extracting identifier from certificate issued by CN=poc.cyanconnode.com,OU=R&D,O=Connode AB,L=Stockholm,ST=Stockholm,C=SE with serial number 10305341667164315852.
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] CommonNameCertificateIdentifierExtractor - Extracting identifier from certificate issued by CN=poc.cyanconnode.com,OU=R&D,O=Connode AB,L=Stockholm,ST=Stockholm,C=SE with serial number 10305341667164315852.
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] CommonNameCertificateIdentifierExtractor - 1 CNs found.
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] CommonNameCertificateIdentifierExtractor - First CN is 00-1B-C5-0C-60-04-FD-D9
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] CommonNameCertificateIdentifierExtractor - Certificate issued by CN=poc.cyanconnode.com,OU=R&D,O=Connode AB,L=Stockholm,ST=Stockholm,C=SE with serial number 10305341667164315852 yielded identifier 00-1B-C5-0C-60-04-FD-D9.
2019-01-24 00:09:59,541 TRACE [dtls-pool-2] PKIManagement - Extracted identifier 00-1B-C5-0C-60-04-FD-D9 from certificate issued by CN=poc.cyanconnode.com,OU=R&D,O=Connode AB,L=Stockholm,ST=Stockholm,C=SE with serial number 10305341667164315852.
2019-01-24 00:09:59,542 TRACE [dtls-pool-2] ClientDTLSDomain - Domain node_default does not trust certificate issued by CN=poc.cyanconnode.com,OU=R&D,O=Connode AB,L=Stockholm,ST=Stockholm,C=SE with serial number 10305341667164315852 and subject CN=00-1B-C5-0C-60-04-FD-D9, due to: java.security.cert.CertPathBuilderException: No issuer certificate for certificate in certification path found.
2019-01-24 00:09:59,543 TRACE [dtls-pool-2] ClientDTLSDomain - Domain kaifa_nodes does not trust certificate issued by CN=poc.cyanconnode.com,OU=R&D,O=Connode AB,L=Stockholm,ST=Stockholm,C=SE with serial number 10305341667164315852 and subject CN=00-1B-C5-0C-60-04-FD-D9, due to: java.security.cert.CertPathBuilderException: No issuer certificate for certificate in certification path found.
2019-01-24 00:09:59,544 TRACE [dtls-pool-2] DTLSECDHKeyExchange - Cannot validate client certificate: Node certificate is not trusted by any node DTLS domain.
2019-01-24 00:09:59,544 TRACE [dtls-pool-2] DTLSConnection - DTLS alert address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), level=fatal, description=certificate_unknown, message=Node certificate is not trusted by any node DTLS domain.
2019-01-24 00:09:59,544 TRACE [dtls-pool-2] ServiceRegistry - CoAP layer signaled closing of remote address /fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684.
2019-01-24 00:09:59,544 TRACE [dtls-pool-2] TerminalProxiesRegistry - Logged out remote address /fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684 which resolved to node null.
2019-01-24 00:09:59,545 TRACE [dtls-pool-2] DTLSConnection - Send fatal alert, closing connection address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525)
2019-01-24 00:09:59,545 TRACE [dtls-pool-2] DTLSConnection - DTLS packet 41972fa1 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), migrating=false
2019-01-24 00:09:59,545 TRACE [dtls-pool-2] DTLSConnection - Record packet address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, contentType=ContentType=change_cipher_spec, epoch=0, nextSeqNo=6, gotEpoch=0, gotSeqNo=5
2019-01-24 00:09:59,545 TRACE [dtls-pool-2] DTLSConnection - DTLS packet 41972fa1 being processed, address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, sessionId=SessionId(441def1dc2df18dbcb178d823d0e83fe58e4447c7f129e43f1e86fd9795d2525), migrating=false
2019-01-24 00:09:59,545 TRACE [dtls-pool-2] DTLSConnection - Wrong epoch address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684, gotEpoch=1, gotSeqNo=0
2019-01-24 00:10:07,550 TRACE [dtls] DTLSConnectionRegistry - New connection address=/fd7e:ce88:ce59:0:21b:c50c:6004:fdd9:5684


------------------------------------------

CNDFS

Meter configuration hash.

Also... thinking about the "right" way to do this... we should really perform a configuration-discovery operation on startup in the same manner as we do a profile-discovery to obtain the profile-hash.

The configuration-discovery would produce a "meter config hash" that goes up to the server. The server can then perform a change-detect on the configuration and initiate a recovery operation if needed.

This mirrors what we do for the profiles and would close a significant gap in that we have no guarantee of the meter-configuration at any point in time (and this can have significant effects on the billing which would be noticed by an MDMS in theory).


--------------------------------------------------------

CA certificate          ca_demo-poc.crt.crt Import to Server DTLS domain/"Issuer Certificate" and Node DTLS domain/Trusted certificates
CA private key          ca_demo-poc.crt.key Optional, Import to Node DTLS domain/CA private key, only csr renew require this
Server certificate      omnitube-demo-poc.crt.pem   Import to Server DTLS domain/Certificate
Server private key      omnitube-demo-poc.key.pem   Import to Server DTLS domain/Private key
RSA private key         rsa.priv    Import to Server Security Pair/Private key
RSA public key          rsa.pub Import to Server Security Pair/Public key
RSA private key         password    rsa_pass.txt    Copy the content to Server Security Pair/Password


Name    File_name    Comment
CA certificate    poc.crt.crt    Import to Server DTLS domain/"Issuer Certificate" and Node DTLS domain/Trusted certificates
CA private key    poc.crt.key    Optional, Import to Node DTLS domain/CA private key, only csr renew require this
Server certificate    kaifa_development.crt.pem    Import to Server DTLS domain/Certificate
Server private key    kaifa_development.key.pem    Import to Server DTLS domain/Private key
RSA private key    rsa.priv    Import to Server Security Pair/Private key
RSA public key    rsa.pub    Import to Server Security Pair/Public key
RSA private key password    rsa_pass.txt    Copy the content to Server Security Pair/Password


-----------------------------------------------------------

IPA1: STM32F217 + FLASH + CC1200 (127KB SRAM)
SPA3: stm32f401ce + CC1200 (96KB SRAM)

tradfri hub:
https://github.com/basilfx/TRADFRI-Hacking
oMicrocontroller: EFR32MG1P132F256GM32
2 Mbit SPI Flash: IS25LQ020B
Crystal: 38.4 MHz


./tools/c4-tools/coap_request.py --ctrlporthub :4001 --load-key client-key /Data/Temp/00-1B-C5-0C-60-04-FD-D9/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub :4001 --load-key client-cert /Data/Temp/00-1B-C5-0C-60-04-FD-D9/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4001 --load-key root-cert /Data/Temp/00-1B-C5-0C-60-04-FD-D9/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4001 --rll-key /Data/Temp/00-1B-C5-0C-60-04-FD-D9/mac_keys.txt


--------------------------------------------------

So, while its on my mind and since we also had the email from Alan regarding thinking about the cost reduction, I took the liberty to sketch out the tickets needed for entirely removing FLASH (since the MQ issue is step 1). The details for step 1 are at the bottom.

This is in addition to Adams low-level "lossy-mq" changes.


The stages are:

- Implement end-to-end application-level reliability so we don't rely on transport-level reliability (MQ). This is what we discussed yesterday.
- Implement a small RAM-backed mq, run in parallel. Duplicate existing mq code, change file-backing to RAM-backed (keep it small, can optimise this later, but for now keep semantics the same).
- Move sample-data to RAM-MQ. Small-change, lots of testing.
- Allocate space in internal FLASH for file-distribution, redirect file distribution to use this area. Encryption may need to be done a block-basis instead of whole-file.
- Make small circular buffer (notification-queue) in internal-FLASH for node events, redirect eventStore API to use this area.
- Move metrics to straight CoAP PUSH. Allow metrics to be unreliable? I think this is a good trade-off.
- Move Storage of the Configuration PB to a simple small circular buffer. This is currently implemented with two-files as a (small) circular buffer (ish).
- Add storage for configuration of instantaneous profile capture-period (in configuration circular buffer?). Remove DataProfileContext storage.
- Move meter-push-alarm notifications to circular buffer notification-queue.

At this point we have the FLASH requirement removed for the following types:
- Profile samples (moved to RAM-MQ which can be further optimised given time).
- Meter push alarm notifications (moved to notification-queue).
- Node events (moved to notification-queue)
- Metrics data changed to use direct CoAP PUSH mechanism rather than storing in MQ (change of semantics here).
- File distribution (moved to designated area on internal-FLASH).
- Configuration (moved to small circular-buffer on internal FLASH).
- Meter-driver context storage (removed except for instantaneous-profile capture-period which moves into config).

Which leaves the final step:
- Make FLASH driver & CNDFS optional in build.
- (optional) Optimise and remove RAM-MQ.


The detail for the first task is to remove the dependence on transport-level-reliability by adding an application-level reliability mechanism.
- SMA to validate incoming profile data against corresponding schema (number of fields, type of field).
- Implement new pb sent from SMA to Agent containing tiemstamps for all profiles.
- On device registration/login, SMA responds with new message containing last-known-good timestamps for all profiles.
- On Agent, "DataProfileContext->timestamp", "dataprofile::storeConfig()", and "dataprofile::restoreConfig()" handle storage of the last timestamp, these will eventually be removed, but for now DataProfileContext->timestamp can be modified by receipt of a new message from SMA: SetLastKnownGoodProfileTimestamp.
- SMA must handle potential duplicated messages for same timestamps via db update. This is because our delivery mechanism is now an "at-least-once" rather than "at-most-once".
- Testing needs to cover normal usage over time with power-cycles for recovery, ensuring all samples are retrieved.

-------------------------------------------------------------

FLASH removal, initially focus on one processor family (EFR32) then bring in STM32 builds.

Stage 0: Get some tests in place for sampling-correctness in presence of restarts/power-cycles/watchdogs/long-delays.

Stage 1: Application-level reliability mechanism:
- Agent to stop using filesystem for 'lastDriverTimestamp'. This becomes simply a global var with no persistence over resets.
- When Agent registers with SMA, the SMA needs to get the timestamp of the last-received timestamp for each profile and return it to the Agent. Probably
needs to hook up with the profile-registering mechanism.
- The interface between Agent/SMA needs to provide protobuf structures for this new message.
- Agent should not start sampling a profile until it receives the last-received-timestamp for it.
- When SMA receives a sample, it should perform a validation of it prior to putting it into the db (e.g. check number and type of fields).
- Test thoroughly.

At this stage, the data is still being put into the MQ on FLASH, but we remove the reliance on it for sampling-reliability.


Stage 2: Make a transitional 'RAM' MQ on Agent.
- Duplicate mq.c into ram_mq.c and make the storage layer an OS_Queue.
- On a schedule (same as mq equivalent), check the queue and send (via CoAP) the messages from the queue sequentially.
These CoAP messages will need to either have some indication in them to the server that the sequence number is not valid as it
has not come via the real mq or perhaps easier to have a new "NewSample" message to the SMA to bypass the existing scheme.
- Move the Agent sampling code over to using the RAM MQ instead of the FLASH MQ (API is same).
- Test thoroughly.

At this stage, meter sample data is not being stored on FLASH, yet should be reliably received on SMA in presence of restarts/power-cycles/watchdogs/long-delays.

Stage 3: Enable concurrent FLASH-erase and program execution.
- Move interrupt-handlers into RAM to allow running while internal-FLASH is being erased.
- UART use may need use of a queue.

Now, we're able to start using internal FLASH for storage (without a filesystem).
Note: This will only be needed on EFR32 devices with <512KB due to their ability to do read-while-write operations in
separate banks.


Stage 4: Move File-distribution storage.
- Reduce size of filesystem on FLASH and allocate space for file-distribution (512KB? or just under) (storage_flash.c)
- Change filedl_storage to store data in new partion in a 'raw' format, no fs (this will eventually be moved to internal FLASH).
- May need to change from whole-file encryption to block-by block encryption to make this usable in-place.

Stage 5: Move file distribution to internal-FLASH.
- Move filedl_storage to (efr32-internal-flash/stm32f2xx_flash).
- Think about whether we need bad-block-management/wear-levelling in this area as we have 10'000 erase cycles available.
If we do, use a simple rotation/circular-buffer mechanism nothing complicated.
- Test thoroughly.

At this point, we should be able to perform meter-upgrade and node-upgrade just using internal FLASH.



Stage 6: Move node-events into internal-FLASH (notification-queue)
- Allocate a very-small area/partition in internal-FLASH to store a circular-buffer of events structures.
- Create a small persistent-circular-buffer mechanism in this area. Each element is (say 16 bytes) and buffer size of (say) 16 elements.
- Add an 'eventStore' compatible API onto this circular-buffer.
- On a schedule, read events from the persistent-circular-buffer and send them via CoAP.
- Sending via CoAP will likely need a new 'NewEvent' message created to the NMS to bypass the current mq mechanism.
- Make this an 'interlocked' operation, i.e Only mark element in circular-buffer as sent when Agent gets CoAP response.
- Test

Now node-events should be stored persistent and have reliable delivery up to the NMS event with power-cycle/watchdogs/etc.


Stage 7: Make metrics 'unreliable' by moving them to CoAP out of the flash-mq.
- Change monitor.c:sample() to perform a direct CoAP request instead of putting the data into the mq.
- Will likely need a new message to bypass the flas-mq mechanism.
- Test.

Here, we lose persistence on delivery of metrics, but this is (probably) not critical and under-used anyway.



Stage 8: Move configuration-storage internal.
- Allocate space for a small persistent-circular-buffer in internal FLASH (3x1KB?)
- Implement a persistent-circular-buffer in internal-FLASH
- Move Storage of the Configuration to this persistent-circular-buffer in internal-FLASH.
- Create a new configuration "backend" to store data in the circular-buffer instead of a file (config_backend.h)

Now configuration should be stored in internal-FLASH and rollback can happen if corrupted by virtue of circular-buffer.



Stage 9: Add a small 'local-configuration' struct into the configuration pb.
- We have a need to store a small amount of data for configuration of local services (e.g. instantaneous profile read).
So we can add a pb structure into the configuration storage for this purpose.
- Test

Now storage of the instantaneous capture-period and other small miscellaneous items should be in internal-FLASH.


Stage 10: Move meter-push-alarm notification into node-event queue
- Give the node event queue (notification queue) the ability to target multiple API endpoints (e.g. NMS & SMA APIs)
- Move device_alarms usage of FLASH mq into notification-queue (circular buffer).
- Make PUSH operations (from meter) an interlocked operation with insertion into the notification-queue.
- Test.

Now push-alarms from the meter will be persistently stored in the notification-queue and sent to SMA periodically.

We should now have removed all the usage of the filesystem from the Agent, allowing us to...


Stage 11: Cleanup.
- Remove FLASH driver.
- Remove CNDFS.
- Remove MQ.
- Remove production-mode FLASH test.


From EFR32 reference doc:

7.3.14.1 Read-While-Write
Parts with 512 KB flash or more have the ability to read from the flash while writing to it. On these parts, reading from the lower half of
the flash is possible while writing/erasing from the upper half of the flash and vice versa. Enable read-while-write by setting RWWEN in
MSC_WRITECTRL.
The information pages can be written and erased while running from the lower half of the flash


-----------------------

4133584 42047   22.0    node.boot                           PUSH    S~restart   04/12/18 17:07:08   04/12/18 17:12:13
4133583 42046   15.0    firmwareupdate.restart              PUSH    13          04/12/18 17:05:32   04/12/18 17:12:13
4130297 41981   14.3    filedistribution.downloadFinished   PUSH    1           04/12/18 09:13:45   04/12/18 09:18:40
4119680 41794   14.2    filedistribution.downloadStarted    PUSH                03/12/18 10:04:23   03/12/18 10:06:02

----------------------------------------

flashGetInfo:

const FlashInfo* flashGetInfo(void)
{
    static const FlashInfo fi = {
            .pageSize = FLASH_PAGE_SIZE (512),           (512)
            .spareSize = 0,                              (0)
            .pagesPerBlock = PAGES_PER_BLOCK (4096/512), (8)
            .blocks = BLOCK_COUNT ( (4096*1024))/4096 }; (1024)
    return &fi;
}


at45GetInfo()



--------------------------------------------

08cd01121a6d5f696d675f6d6574657246775570677261646533312e62696e18012080012a3c66696c65747970653d6d6574657266772c7461726765746465766963653d55535320303030323030342c6d6574657266775f69643d3132333435363730d8043a10b10a8db164e0754105b7a99be72e3fe542240a10580f79b15b2453a53c3e9b18771ee2661210918eded9ecf11c56885e628025199ee1

(gdb) p bytes->bytes
$15 = 0x60c00001de28 "filetype=meterfw,targetdevice=USS 0002004,meterfw_id=1234567", '\265' <repeats 16 times>
(gdb)


(gdb) p *bytes
$17 = {size = 60, bytes = 0x60c00001de28 "filetype=meterfw,targetdevice=USS 0002004,meterfw_id=1234567", '\265' <repeats 16 times>}
(gdb)

(gdb) p ((PbDecodeBytes*)*arg)->bytes
$22 = 0x60c00001de28 "filetype=meterfw,targetdevice=USS 0002004,meterfw_id=1234567", '\265' <repeats 16 times>
(gdb)

(gdb) p ((PbDecodeBytes*)0x60c00001de20)->bytes
$24 = 0x60c00001de28 "filetype=meterfw,targetdevice=USS 0002004,meterfw_id=1234567", '\265' <repeats 16 times>
(gdb)

decode_field (stream=0x7ffff3afeb70, wire_type=PB_WT_STRING, iter=0x7ffff3afea20) at build/3pp/nanopb/pb_decode.c:723
723 }
(gdb) p iter->pos->type
$26 = 85 'U'
(gdb) s




uffs_Mount (mount=mount@entry=0x807dcc0 "/") at build/3pp/uffs/src/uffs/uffs_mtb.c:192
192     uffs_Perror(UFFS_MSG_NOISY, "mount partiton: %d,%d",
(gdb)
195     if (uffs_InitDevice(mtb->dev) != U_SUCC) {


uffs_InitDevice()
uffs_BuildTree()
_BuildTreeStepOne()




#2  0x00000000 in ?? ()
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb) set exitLoop=true
No symbol "true" in current context.
(gdb) set exitLoop=1
(gdb) s
159 }
(gdb)
uffs_crc16update (data=0x2000fd20 <s_uffsPool+508>, length=length@entry=50331647, crc=41354,
    crc@entry=65535) at build/3pp/uffs/src/uffs/uffs_crc.c:84
84          CRC16(crc, *p);
(gdb) where
#0  uffs_crc16update (data=0x2000fd20 <s_uffsPool+508>, length=length@entry=50331647, crc=41354,
    crc@entry=65535) at build/3pp/uffs/src/uffs/uffs_crc.c:84
#1  0x080690d8 in uffs_crc16sum (data=<optimized out>, length=50331647)
    at build/3pp/uffs/src/uffs/uffs_crc.c:92
#2  0x0806c7da in uffs_MakeSum16 (p=<optimized out>, len=<optimized out>)
    at build/3pp/uffs/src/uffs/uffs_public.c:255
#3  0x0806d70a in _BuildValidTreeNode (st=<synthetic pointer>, bc=0x20011164 <s_uffsPool+5696>,
    node=0x200119b4 <s_uffsPool+7824>, dev=0x2000f944 <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_tree.c:426
#4  _BuildTreeStepOne (dev=dev@entry=0x2000f944 <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_tree.c:626
#5  uffs_BuildTree (dev=dev@entry=0x2000f944 <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_tree.c:1325
#6  0x0806c06e in uffs_InitDevice (dev=0x2000f944 <s_flashDevice>)
    at build/3pp/uffs/src/uffs/uffs_init.c:132
#7  0x0806c296 in uffs_Mount (mount=mount@entry=0x807daf0 "/")
    at build/3pp/uffs/src/uffs/uffs_mtb.c:195
#8  0x0804affa in start () at src/services/fs/uffs/fs_service.c:86
#9  0x0802017c in modulesStart (list=list@entry=0x807d228 <serviceModules>) at src/base/module.c:25
#10 0x080496c6 in servicesStart () at src/services/services.c:64
#11 0x08053762 in terminalBasicStart () at src/terminal/terminal.c:124
#12 0x080537b0 in terminalTask (arg=0x20016d90 <s_terminalInitedSemaphore>)
    at src/terminal/terminal.c:232
#13 0x08065584 in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb)

uffs_crc16update asked to do CRC on 50331647 bytes (50MB).

in _BuildValidTreeNode()

(gdb) p *dev
$2 = {Init = 0x804ae0d <flashDeviceInitForUffs>, Release = 0x804af55 <flashDeviceReleaseForUffs>,
  _private = 0x0, attr = 0x20000464 <s_attr>, par = {start = 164, end = 1023},
  ops = 0x807da44 <s_flashOps>, bc = {head = 0x2001117c <s_uffsPool+5720>,
    tail = 0x20011164 <s_uffsPool+5696>, mem_pool = 0x20011104 <s_uffsPool+5600>}, lock = {sem = 0x0,
    task_id = 0, counter = 0}, buf = {head = 0x2000fb9c <s_uffsPool+120>,
    tail = 0x2000fcdc <s_uffsPool+440>, clone = 0x0, dirtyGroup = {{count = 0, lock = 0, dirty = 0x0},
      {count = 0, lock = 0, dirty = 0x0}, {count = 0, lock = 0, dirty = 0x0}}, buf_max = 10,
    dirty_buf_max = 8, pool = 0x2000fb74 <s_uffsPool+80>}, com = {pg_data_size = 508, header_size = 4,
    pg_size = 512}, tree = {erased = 0x200116f4 <s_uffsPool+7120>,
    erased_tail = 0x200119a4 <s_uffsPool+7808>, erased_count = 35, suspend = 0x0, bad = 0x0,
    bad_count = 0, dir_entry = {65535 <repeats 32 times>}, file_entry = {65535, 65535, 38, 21, 65535,
      65535, 65535, 65535}, data_entry = {18, 65535, 34, 39, 65535 <repeats 23 times>, 28, 65535, 33,
      65535, 65535}, max_serial = 0}, pending = {count = 1, list = {{block = 208, mark = 3 '\003'}, {
        block = 0, mark = 0 '\000'}, {block = 0, mark = 0 '\000'}, {block = 0, mark = 0 '\000'}},
    block_in_recovery = 65534}, st = {block_erase_count = 0, page_write_count = 0,
    page_read_count = 59, page_header_read_count = 55, spare_write_count = 0, spare_read_count = 83,
    io_read = 3596, io_write = 0}, mem = {init = 0x0, release = 0x0,
    malloc = 0x806c0d1 <static_malloc>, free = 0x0, blockinfo_pool_buf = 0x20011104 <s_uffsPool+5600>,
    pagebuf_pool_buf = 0x2000fb74 <s_uffsPool+80>, tree_nodes_pool_buf = 0x200116f4 <s_uffsPool+7120>,
    spare_pool_buf = 0x2000fb24 <s_uffsPool>, blockinfo_pool_size = 1520, pagebuf_pool_size = 5520,
    tree_nodes_pool_size = 13760, spare_pool_size = 80, tree_pool = {
      mem = 0x200116f4 <s_uffsPool+7120> "\004\027\001 ", buf_size = 16, num_bufs = 860,
      free_list = 0x200119c4 <s_uffsPool+7840>, sem = 0x0}, spare_pool = {
      mem = 0x2000fb24 <s_uffsPool> <incomplete sequence \373>, buf_size = 16, num_bufs = 5,
      free_list = 0x2000fb24 <s_uffsPool>, sem = 0x0}, spare_data_size = 16,
    buf_start = 0x2000fb24 <s_uffsPool> <incomplete sequence \373>, buf_size = 20880, pos = 20880},
  cfg = {bc_caches = 10, page_buffers = 10, dirty_pages = 8, dirty_groups = 3,
    reserved_free_blocks = 2}, ref_count = 0, dev_num = 1}

at call to uffs_MakeSum16()
info =
(gdb) p *(uffs_FileInfo *) (buf->data)
$4 = {attr = 4294967295, create_time = 4294967295, last_modify = 4294967295, access = 4294967295,
  reserved = 4294967295, name_len = 50331647,
  name = "macs", '\377' <repeats 66 times>, "\000\000\000\377", '\000' <repeats 53 times>}
(gdb)



---------------------------------

- Application-level reliability covers samples from meter.
- Other events aren't covered, so need a mechanism.
-



        Agent <-----> NMS <-----> SMA
samples       <----------------->
node-events   <-----> CM


- Protocol is assymetric, at-least-once, deduped upstream. Downstream non-existent?
- Delivers normal packets
- priorities?
- window of acks?
- sequence number == UTC 32bit uint?
- Each element in circular buffer has a UTC time associated with it.
- On login, time (-a few seconds) of last element received is sent down to Agent (for all queues).
- On server, messages are de-duped.
- On Agent, removal of element from queue is interlocked with receipt of ACK.
- On Server, transmission of ACK is interlocked with storage of received message.
- Before Agent is logged-in, knowledge of time can be retrieved from latest time in queues.
- Last-gasp therefore will provide the time on startup prior to login, so never have zero time.
- Can have multiple messages with same time, rely on dedupe rather than exact sequence numbers.
- Time cannot go backwards due to retrieval of time from circular buffers.
- If too much overhead in dedupe, increase resolution of message-timestamps to make them more unique.
- How to send multiple packets, and collate then into a single request??
- Include "message sequence number" along with time and dedupe on time##msgSeqNum?
- Start sequence number at maximum and work downwards to zero.
- Server identifies when a zero is hit and collates the full message for forwarding.



--------------------------------

Purposes
- Move away from a callback and state-machine approach to a blocking model.
- Increase determinism.
- Simplify!
- In-place processing of DLMS requests & responses.
- Use a blocking model to stay in the same context instead of using heap to save
global data. Use stack instead of heap. Stack is more efficient and can be sanitised.
- Current code requires *way too much* cognitive overhead to keep track of context. Aim to
minimise this by staying in the one context as much as possible.
- Reduce association overhead to once-per-cycle at highest required level.


//
// Push request.
//
bool pushHasBeenSignalled   = false;

void pushISR()
{
    pushHasBeenSignalled    = true;
}

void readPushData()
{
    if( pushHasBeenSignalled == true) {

        // Clear the request.
        pushHasBeenSignalled    = false;

        // Collect push data.
    }
}



//
// Meter ping request.
//
bool meterPingHasBeenSignalled  = false;

void performMeterPing()
{
    if( meterPingHasBeenSignalled == true ) {

        // Clear the request.
        meterPingHasBeenSignalled   = false;

        // Request time object
        dlmsSendGetRequest(8, timeRegisterObis, 2, NULL, 0);

        // Block waiting for response (or timeout).
        AXDRStream* responseStream    = dlmsWaitForResponseOrTimmeout();

        // Parse DLMS response.
        uint32_t value  = axdrGetUint32( responseStream );

        // Send response to server.
        MeterPingStatus msg = MeterPingStatus_init_zero;
        msg.status = value;
        coapSendResponseProtobuf(req->sessiondId, CoapResponseContent, MeterPingStatus_fields, &msg);
    }
}


//
// Association request.
//
void associateWithMeter()
{
    bool    llsRequired                     = false;
    bool    hlsRequired                     = false;
    bool    invocationCounterReadRequired   = false;
    bool    cipheringRequired               = false;
    bool    fwUpgradeRequired               = false;

    //
    // Determine the highest level required for this operation cycle.
    //

    if( meterPingHasBeenSignalled == true ) {
        llsRequired = true;
    }

    if( meterSetHasBeenSignalled == true ) {
        hlsRequired = true;
        invocationCounterReadRequired   = true;
    }

    if( profileReadHasBeenSignalled == true ) {
        llsRequired = true;
    }

    if( meterSetConfigurationHasBeenSignalled == true ) {
        hlsRequired = true;
    }

    //
    // Now perform the association.
    //

    // Send AARQ
    if( hlsRequired == true ) {
        dlmsVariantSetupAA(DLMS_DRIVER_CONTEXT, true, isCiphering, fwUpgrade);
    }
    else if( llsRequired == true ) {
        dlmsVariantSetupAA(DLMS_DRIVER_CONTEXT, false, isCiphering, fwUpgrade);
    }

    // Block waiting for response (or timeout).
    AXDRStream* responseStream    = dlmsWaitForResponseOrTimmeout();

    // Parse response.
    parseAARE();
}


//
// Read a profile from the meter.
//
bool profileReadHasBeenSignalled    = false;

void readProfile( Profile profile, uint32_t currentNodeTime )
{
    if( profileReadHasBeenSignalled == true ) {

        // Check that its time for this profile to be read.
        if( isItTimeForProfileRead( profile, currentNodeTime ) {

            // Form request (selective access by time or index).

            // Send request to meter.

            // Block, waiting for response (or timeout).

            // Parse DLMS response.

            // Form response to server.

            // Send response to server.
        }
    }
}



//
// This is the main superloop for all the meter-facing activity.
//
// - Everything is driven from the one loop, flags and current-time indicate
// whether operations should be performed or not.
// - Asynchronous operationsi (i.e. from ISR or CoAP)  are signalled via flags.
// - Operations are blocking, so request and response sent within the same context. This really
// simplifies the code and will greately benefit ease-of-development.
// - Associations are performed once-per-cycle.
// - Meter-configuration is performed once prior to entering the superloop.
// - Meter re-configuration is performed by setting a flag to make the superloop restart.
// - meter-configuration is checked against expected values prior to entering superloop.
// - Time sensitive operation are performed immediately after the cycle starts, in this deterministic
// phase of the superloop requests are not retried. The cycle will naturally retry the operation.
// - The second phase of the superloop is the non-deterministic phase. Sufficient slack time needs
// to be planned into the schedule to allow this to run to worst-case otherwise the following
// deterministic phase will be commprimised.
// - Messages are processed in-place (zero-copy style) via the use of AXDRStreams, reducing
// RAM usage.
//
void deviceTask()
{
    // Forever....
    while(true) {

        //
        // Note, this would probably be better handled as a full reset of the device
        // but that would take down the network-side also which is probably unnecessarily
        // harsh (though cleaner as we can guarantee no state will be left behind).
        // As it is, we should probably have a dedicated heap for the application that
        // we can clear at this point.
        //

        // Clear out our application-heap.
        resetApplicationHeap();

        // Discover the capture-objects from the profile registers.
        performProfileDiscovery();

        // Read, check and set the configuration registers to the expected values
        //  before we do anything further.
        do {
            // read the contents of all configuration registers.
            performMeterConfigurationDiscovery();

            // Check validity of meter-configuration.
            checkMeterConfiguration();

            checkCount++;

        } while( configIsValid == false && checkCount < 2 );

        // Report current state of profiles and meter-configuration to server.
        sendDiscoveredProfiles();
        sendDiscoveredMeterConfiguration();

        //
        // Forever (or until we need to reset the device task).
        //
        // Note: No retry is needed on the operations here because the schedule
        // naturally retries them.
        //
        // Note: When we wish to apply a configuration, simply cause a restart by
        // setting 'restartDeviceTask' to true. This will cause this loop to
        // terminate and the whole outer sequence to be re-run.
        //
        while( restartDeviceTask == false ) {

            // Wait until our next allotted time (every 5 mins?)
            waitUntilNextTimeSlotOrPushSignalled();

            //
            // Now do the time-sensitive reads.
            // No retries on these requests, just rely on the natural cycle to retry.
            // This portion of the cycle should be as deterministic as possible.
            // We allow a 'slack' period after the time-sensitive operations to do all
            // the miscellaneous operations.
            //

            // Get the current node time
            currentNodeTime = getNodeTime();

            // Associate with meter once-per-cycle at the highest level required
            // for this cycle. This is determined by looking at all the condition
            // flags.
            associateWithMeter();

            // Perform time sync if required.
            performTimeSync( currentNodeTime );

            // Capture an Instantaneous profile if required.
            // NOTE: This is the capture only. Not the profile read.
            performInstantaneousProfileCapture().

            // Iterate thru all the profiles reading them if the time
            // is appropriate for them.
            // NOTE: This profileList also contains the instantaneous profile which has
            // been previously captured. This brings all profile-reading code together.
            for( profile in profileList ) {
                readProfile( profile, currentNodeTime );
            }

            //
            // Now perform the asynchronous operations.
            // These operations are not time-sensitive, so providing we leave enough slack
            // time in the schedule, we should be ok for long reads.
            //
            // This provides a good amount of determinism for the soft-real-time operations
            // such as time-sync and IS capture.
            //

            // If a 'push' event has been signalled, lets read the push data now..
            readPushData();

            // Perform an on-demand profile read if requested.
            performOnDemandRead();

            // Perform the 'get configuration' operation.
            performGetConfiguration();

            //
            performMeterUpgrade();

            //
            performDisconnectorSet();

            //
            performMeterPing();

            // Release the association.
            releaseMeterAssociation();
        }
    }
}


---------------------------------------


kaifa_ma304 time

CLOCK_UPDATE_STATE_TIME

Bad:

7e
a021
0201
41
93
9e86
81801405020100060201000704000000
01080400000001
696d
7e
e = 3, 1 **
7ea02141020173e8fb81801405020100
06020100070400000001080400000001
696d7e
7e
a042
0201
41
10
728c
e6e600
6033a1090607608574050801018a0207
808b0760857405080201ac0780056865
6c6c6fbe10040e01000000065f1f0400
001f1fffff
e741
7e
for HDLC event (60000ms) **
e = 3, 1 **
7ea03841020130536ee6e7006129a109
060760857405080101a203020100a305
a103020100be10040e0800065f1f0400
00101c020000079cdf7e

 [meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from time synch
 [meter/time_synch] {timeSynch}: Clock drift is -112 seconds
 [        dlms] {timeSynch}: Action 0-0:1.0.0*255 ic 8 methodId 6 actionLen: 3 B
 [      mac_rx] {   mac_rx}: Received 43 B, unicast #113 from 02-1b-c5-0c-60-00-ea-10: rssi -61 dBm, sec 5, payload 13 B
 [        icmp] {   mac_rx}: ICMPv6 unicast from fe80::21b:c50c:6000:ea10, Private (probe), 6 B
 [        hdlc] {timeSynch}: tx: (1/1): 7e
 [        hdlc] {timeSynch}: tx: (1/1): a01d
 [        hdlc] {timeSynch}: tx: (1/1): 0201
 [        hdlc] {timeSynch}: tx: (1/1): 41
 [        hdlc] {timeSynch}: tx: (1/1): 32
 [        hdlc] {timeSynch}: tx: (1/1): fc91
 [        hdlc] {timeSynch}: tx: (1/1): e6e600
 [        hdlc] {timeSynch}: tx: (1/1): c3018100080000010000ff060110ff90
 [        hdlc] {timeSynch}: tx: (1/1): 59ad
 [        hdlc] {timeSynch}: tx: (1/1): 7e
 [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
 [        hdlc] {     hdlc}: rx: (1/2): 7ea012410201527e02e6e700c7018103
 [        hdlc] {     hdlc}: rx: (2/2): 00e2987e
 [        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
 [        dlms] {     dlms}: Action Response result: r/w denied     <----
 [        dlms] {     dlms}: processXDlmsApdu(5 B): failed
 [        dlms] {     dlms}: DLMS result is 0 bytes with code 12
 [meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=12 from time synch
 [meter/time_synch] {timeSynch}: Broken response: check failed
 [meter/time_synch] {timeSynch}: Failed to adjust time: check failed
 [        dlms] {timeSynch}: Disconnect HDLC link
 [        hdlc] {timeSynch}: tx: (1/1): 7e
 [        hdlc] {timeSynch}: tx: (1/1): a008
 [        hdlc] {timeSynch}: tx: (1/1): 0201
 [        hdlc] {timeSynch}: tx: (1/1): 41
 [        hdlc] {timeSynch}: tx: (1/1): 53
 [        hdlc] {timeSynch}: tx: (1/1): 6771
 [        hdlc] {timeSynch}: tx: (1/1): 7e

7e
a021
0201
41
93
9e86
81801405020100060201000704000000
01080400000001
696d
7e
7ea02141020173e8fb81801405020100
06020100070400000001080400000001
696d7e
7e
a042
0201
41
10
728c
e6e600
6033a1090607608574050801018a0207
808b0760857405080201ac0780056865
6c6c6fbe10040e01000000065f1f0400
001f1fffff
e741
7e
7ea03841020130536ee6e7006129a109
060760857405080101a203020100a305
a103020100be10040e0800065f1f0400
00101c020000079cdf7e

7e
a01d
0201
41
32
fc91
e6e600
c3018100080000010000ff060110ff90
59ad
7e
7ea012410201527e02e6e700c7018103
00e2987e


Bad:

<HDLC len="32" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>

<HDLC len="32" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>

<HDLC len="65" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="68656C6C6F" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="65535" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

<HDLC len="55" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--AARE frame.-->
<FrameType Value="30" />
<PDU>
<AssociationResponse>
  <ApplicationContextName Value="LN" />
  <AssociationResult Value="0" />
  <ResultSourceDiagnostic>
    <ACSEServiceUser Value="0" />
  </ResultSourceDiagnostic>
  <InitiateResponse>
    <NegotiatedDlmsVersionNumber Value="6" />
    <NegotiatedConformance>
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </NegotiatedConformance>
    <NegotiatedMaxPduSize Value="512" />
    <VaaName Value="7" />
  </InitiateResponse>
</AssociationResponse>
</PDU>
</HDLC>

<HDLC len="28" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="32" />
<PDU>
<ActionRequest>
  <ActionRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <MethodDescriptor>
      <!--CLOCK-->
      <ClassId Value="8" />
      <!--0.0.1.0.0.255-->
      <InstanceId Value="0000010000FF" />
      <MethodId Value="6" />
    </MethodDescriptor>
    <MethodInvocationParameters>
      <Int16 Value="-112" />
    </MethodInvocationParameters>
  </ActionRequestNormal>
</ActionRequest>
</PDU>
</HDLC>

<HDLC len="17" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--I frame.-->
<FrameType Value="52" />
<PDU>
<ActionResponse>
  <ActionResponseNormal>
    <InvokeIdAndPriority Value="129" />
    <Result Value="ReadWriteDenied" />
  </ActionResponseNormal>
</ActionResponse>
</PDU>
</HDLC>







Good:

 [        hdlc] {     hdlc}: tx: (1/3): 7ea021020141939e8681801405020100
 [        hdlc] {     hdlc}: tx: (2/3): 06020100070400000001080400000001
 [        hdlc] {     hdlc}: tx: (3/3): 696d7e
 [        hdlc] {     hdlc}: rx: (1/3): 7ea02141020173e8fb81801405020100
 [        hdlc] {     hdlc}: rx: (2/3): 06020100070400000001080400000001
 [        hdlc] {     hdlc}: rx: (3/3): 696d7e
 [        hdlc] {     hdlc}: tx: (1/5): 7ea04202014110728ce6e6006033a109
 [        hdlc] {     hdlc}: tx: (2/5): 0607608574050801018a0207808b0760
 [        hdlc] {     hdlc}: tx: (3/5): 857405080201ac07800568656c6c6fbe
 [        hdlc] {     hdlc}: tx: (4/5): 10040e01000000065f1f0400001f1fff
 [        hdlc] {     hdlc}: tx: (5/5): ffe7417e
 [        hdlc] {     hdlc}: rx: (1/4): 7ea03841020130536ee6e7006129a109
 [        hdlc] {     hdlc}: rx: (2/4): 060760857405080101a203020100a305
 [        hdlc] {     hdlc}: rx: (3/4): a103020100be10040e0800065f1f0400
 [        hdlc] {     hdlc}: rx: (4/4): 00101c020000079cdf7e
 [meter/kaifaMa304] {   device}: Request meter time update
 [        hdlc] {     hdlc}: tx: (1/3): 7ea028020141327963e6e600c1018100
 [        hdlc] {     hdlc}: tx: (2/3): 080000010000ff0200090c07e3011fff
 [        hdlc] {     hdlc}: tx: (3/3): 0c3708ffffc400c9357e
 [        hdlc] {     hdlc}: rx: (1/2): 7ea01141020152b21fe6e700c5018100
 [        hdlc] {     hdlc}: rx: (2/2): 36cf7e



Good:

7ea021020141939e8681801405020100
06020100070400000001080400000001
696d7e
7ea02141020173e8fb81801405020100
06020100070400000001080400000001
696d7e
7ea04202014110728ce6e6006033a109
0607608574050801018a0207808b0760
857405080201ac07800568656c6c6fbe
10040e01000000065f1f0400001f1fff
ffe7417e
7ea03841020130536ee6e7006129a109
060760857405080101a203020100a305
a103020100be10040e0800065f1f0400
00101c020000079cdf7e

7ea028020141327963e6e600c1018100
080000010000ff0200090c07e3011fff
0c3708ffffc400c9357e
7ea01141020152b21fe6e700c5018100
36cf7e

<HDLC len="32" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>

</PDU>
</HDLC>
<HDLC len="32" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>

<HDLC len="65" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="68656C6C6F" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="65535" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

<HDLC len="55" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--AARE frame.-->
<FrameType Value="30" />
<PDU>
<AssociationResponse>
  <ApplicationContextName Value="LN" />
  <AssociationResult Value="0" />
  <ResultSourceDiagnostic>
    <ACSEServiceUser Value="0" />
  </ResultSourceDiagnostic>
  <InitiateResponse>
    <NegotiatedDlmsVersionNumber Value="6" />
    <NegotiatedConformance>
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </NegotiatedConformance>
    <NegotiatedMaxPduSize Value="512" />
    <VaaName Value="7" />
  </InitiateResponse>
</AssociationResponse>
</PDU>
</HDLC>

<HDLC len="39" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="32" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--CLOCK-->
      <ClassId Value="8" />
      <!--0.0.1.0.0.255-->
      <InstanceId Value="0000010000FF" />
      <AttributeId Value="2" />
    </AttributeDescriptor>
    <Value>
      <!--2019-01-31 12:55:08-->
      <OctetString Value="07E3011FFF0C3708FFFFC400" />
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>

<HDLC len="16" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--I frame.-->
<FrameType Value="52" />
<PDU>
<SetResponse>
  <SetResponseNormal>
    <InvokeIdAndPriority Value="129" />
    <Result Value="Success" />
  </SetResponseNormal>
</SetResponse>
</PDU>
</HDLC>

-------------------

CLOCK_UPDATE_STATE_DST_START:
setMeterDstRule()
0  1  2  3  4  5  6  7  8  9  10 11
07 E3 01 1F FF 0C 37 08 FF FF C4 00

[meter/time_synch] {timeSynch}: Clock drift is 2 seconds
[meter/common] {timeSynch}: Setting time: 2019-02-01T14:30:36.000+01:00 0
[        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 2 valueLen 14 B
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a028
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): 32
[        hdlc] {timeSynch}: tx: (1/1): 7963
[        hdlc] {timeSynch}: tx: (1/1): e6e600
[        hdlc] {timeSynch}: tx: (1/2): c1018100080000010000ff0200090c07
[        hdlc] {timeSynch}: tx: (2/2): e30201050e1e24ff003c00
[        hdlc] {timeSynch}: tx: (1/1): 9bf4
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {     hdlc}: ** giveCause = 3, 1 **
[        hdlc] {     hdlc}: rx: (1/2): 7ea01141020152b21fe6e700c5018100
[        hdlc] {     hdlc}: rx: (2/2): 36cf7e
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from ti

[meter/time_synch] {timeSynch}: ** Setting DST deviation **
[meter/time_synch] {timeSynch}: Request meter DST deviation update
[        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 7 valueLen 2 B
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a01c
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): 54
[        hdlc] {timeSynch}: tx: (1/1): 889c
[        hdlc] {timeSynch}: tx: (1/1): e6e600
[        hdlc] {timeSynch}: tx: (1/1): c1018100080000010000ff07000f3c
[        hdlc] {timeSynch}: tx: (1/1): c2e8
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {     hdlc}: ** giveCause = 3, 1 **
[        hdlc] {     hdlc}: rx: (1/2): 7ea01141020174865be6e700c5018100
[        hdlc] {     hdlc}: rx: (2/2): 36cf7e
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[    modemdrv] {    modem}: Not present
[       modem] {    modem}: Unknown -> Unknown
[    modemdrv] {    modem}: Not present
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from ti

[meter/time_synch] {timeSynch}: ** Setting DST enabled flag **
[meter/time_synch] {timeSynch}: Request meter DST enabled update
[        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 8 valueLen 2 B
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a01c
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): 76
[        hdlc] {timeSynch}: tx: (1/1): 989e
[        hdlc] {timeSynch}: tx: (1/1): e6e600
[        hdlc] {timeSynch}: tx: (1/1): c1018100080000010000ff08000301
[        hdlc] {timeSynch}: tx: (1/1): fd19
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {     hdlc}: ** giveCause = 3, 1 **
[        hdlc] {     hdlc}: rx: (1/2): 7ea011410201969a9fe6e700c5018100
[        hdlc] {     hdlc}: rx: (2/2): 36cf7e
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from ti

[meter/time_synch] {timeSynch}: ** Setting DST daylight_savings_begin **
[        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 5 valueLen 14 B
[      mac_rx] {   mac_rx}: Received 113 B, broadcast #90 from 02-1b-c5-0c-

[        icmp] {   mac_rx}: ICMPv6 multicast from fe80::21b:c50c:6000:e9fc,

[    rpl/core] {      rpl}: 0: process DIO from fe80::21b:c50c:6000:e9fc (f

[    rpl/core] {      rpl}: Neighbor info: fde4:731d:dfa6:0:21b:c50c:6000:e

[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a028
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): 98
[        hdlc] {timeSynch}: tx: (1/1): 2969
[        hdlc] {timeSynch}: tx: (1/1): e6e600
[        hdlc] {timeSynch}: tx: (1/2): c1018100080000010000ff0500090cff
[        hdlc] {timeSynch}: tx: (2/2): ff03fe07020000ff800000
[        hdlc] {timeSynch}: tx: (1/1): d817
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {     hdlc}: ** giveCause = 3, 1 **
[        hdlc] {     hdlc}: rx: (1/2): 7ea011410201b8e657e6e700c5018100
[        hdlc] {     hdlc}: rx: (2/2): 36cf7e
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from ti

[meter/time_synch] {timeSynch}: ** Setting DST daylight_savings_end **
[        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 6 valueLen 14 B
[      mac_rx] {   mac_rx}: Received 113 B, broadcast #41 from 02-1b-c5-0c-

[        icmp] {   mac_rx}: ICMPv6 multicast from fe80::21b:c50c:6001:8dff,

[    rpl/core] {      rpl}: 0: process DIO from fe80::21b:c50c:6001:8dff (f

[    rpl/core] {      rpl}: Neighbor info: fde4:731d:dfa6:0:21b:c50c:6001:8

[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a028
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): ba
[        hdlc] {timeSynch}: tx: (1/1): 396b
[        hdlc] {timeSynch}: tx: (1/1): e6e600
[        hdlc] {timeSynch}: tx: (1/2): c1018100080000010000ff0600090cff
[        hdlc] {timeSynch}: tx: (2/2): ff0afe07030000ff800000
[        hdlc] {timeSynch}: tx: (1/1): 2257
[        hdlc] {timeSynch}: tx: (1/1): 7e
[    modemdrv] {    modem}: Not present
[       modem] {    modem}: Unknown -> Unknown
[    modemdrv] {    modem}: Not present
[        hdlc] {     hdlc}: ** giveCause = 3, 1 **
[        hdlc] {     hdlc}: rx: (1/2): 7ea011410201daf217e6e700c5018100
[        hdlc] {     hdlc}: rx: (2/2): 36cf7e
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[    hdlclock] {   device}: -- HDLC locked --
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from ti

[      cc1200] {   cc1200}: RX FIFO overflow, flushed
[meter/time_synch] {timeSynch}: ** Time sync complete **


---------------------------------------

LNT Good:

<HDLC len="31" >
<TargetAddress Value="1" />
<SourceAddress Value="16" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="350" />
  <MaxInfoRX Value="350" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>

<HDLC len="29" >
<TargetAddress Value="16" />
<SourceAddress Value="1" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="128" />
  <MaxInfoRX Value="128" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>

<HDLC len="42" >
<TargetAddress Value="1" />
<SourceAddress Value="16" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="65535" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

<HDLC len="54" >
<TargetAddress Value="16" />
<SourceAddress Value="1" />
<!--AARE frame.-->
<FrameType Value="30" />
<PDU>
<AssociationResponse>
  <ApplicationContextName Value="LN" />
  <AssociationResult Value="0" />
  <ResultSourceDiagnostic>
    <ACSEServiceUser Value="0" />
  </ResultSourceDiagnostic>
  <InitiateResponse>
    <NegotiatedDlmsVersionNumber Value="6" />
    <NegotiatedConformance>
      <ConformanceBit Name="Get" />
    </NegotiatedConformance>
    <NegotiatedMaxPduSize Value="560" />
    <VaaName Value="7" />
  </InitiateResponse>
</AssociationResponse>
</PDU>
</HDLC>




LNT Bad:

<HDLC len="59" >
<TargetAddress Value="1" />
<SourceAddress Value="16" />
<!--I frame.-->
<FrameType Value="54" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <InitiateRequest>
    <DedicatedKey Value="78787878787878787878787878787878" />
    <ProposedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="65535" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

<HDLC len="44" >
<TargetAddress Value="16" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="74" />
<PDU>
<AssociationResponse>
  <ApplicationContextName Value="LN" />
  <!--PERMANENT_REJECTED-->
  <AssociationResult Value="1" />
  <ResultSourceDiagnostic>
    <!--NO_REASON_GIVEN-->
    <ACSEServiceUser Value="1" />
  </ResultSourceDiagnostic>
  <ConfirmedServiceError>
    <Service Value="1" />
    <ServiceError>
      <Initiate Value="Other" />
    </ServiceError>
  </ConfirmedServiceError>
</AssociationResponse>
</PDU>
</HDLC>


---------------------------------------------------------

 7e
 a020
 03
 21
 93
 7dd9
 8180140502015e0602015e0704000000
 01080400000001
 51af
 7e
g on s_dlmsSemaphore for 64000ms --
se = 3, 1 **
 7ea01e210373c37a8180120501800601
 80070400000001080400000001533b7e
 7e
 a02b
 03
 21
 10
 fbaf
 e6e600
 601da109060760857405080101be1004
 0e01000000065f1f0400001f1fffff
 c64d
 7e
 for HDLC event (60000ms) **
se = 3, 1 **
 7ea0372103306c7ce6e7006129a10906
 0760857405080101a203020100a305a1
 03020100be10040e0800065f1f040000
 001002300007b26c7e


Send IC read request for 1
Get 0-0:43.1.3*255 ic 1 attr 2 normal access


 7e
 a019
 03
 21
 32
 6fd8
 e6e600
 c00181000100002b0103ff0200
 b567
 7e
g on s_dlmsSemaphore for 64000ms --
se = 3, 1 **
 7ea0152103525d8ae6e700c401810006
 003ad8df2e957e

IC value is:3856607

frameCounter:385660

 frameCounter:3856607
 Setup AA with HLS
 Connect HDLC link
 tx: (1/1): 7e
 tx: (1/1): a020
 tx: (1/1): 03
 tx: (1/1): 61
 tx: (1/1): 93
 tx: (1/1): 1b9f
 tx: (1/2): 81801405020080060200800704000000
 tx: (2/2): 01080400000001
 tx: (1/1): ce6a
 tx: (1/1): 7e
  -- waiting on s_dlmsSemaphore for 64000ms --
 ** giveCause = 3, 1 **
 rx: (1/2): 7ea01e610373b57c8180120501800601
 rx: (2/2): 80070400000001080400000001533b7e
 tx: (1/1): 7e
 tx: (1/1): a07c
 tx: (1/1): 03
 tx: (1/1): 61
 tx: (1/1): 10
 tx: (1/1): aa6b
 tx: (1/1): e6e600
 tx: (1/7): 606ea109060760857405080103a60a04
 tx: (2/7): 084c54434c49454e548a0207808b0760
 tx: (3/7): 857405080202ac128010306545374563
 tx: (4/7): 63633938356635344342be3404322130
 tx: (5/7): 30003ad8dfe6bc287074ea3387383597
 tx: (6/7): 610d967081ae3b1749c66f4a2776cdca
 tx: (7/7): 767d786f1bc534e79d4b641d645b7453
 tx: (1/1): d116
 tx: (1/1): 7e
 ** Waiting for HDLC event (60000ms) **
 ** giveCause = 3, 1 **
 rx: (1/8): 7ea077610330ad6ce6e7006169a10906
 rx: (2/8): 0760857405080103a203020100a305a1
 rx: (3/8): 0302010ea40a04084c4e543031313830
 rx: (4/8): 88020780890760857405080202aa1280
 rx: (5/8): 106162636465666768696a6b6c6d6e6f
 rx: (6/8): 70be230421281f30000081d9f6a16f35
 rx: (7/8): a11a0f3c666281af1e458c05a818a8cb
 rx: (8/8): ca9290d0149df6cf7e
 ** Waiting for HDLC event (60000ms) **
 rx decrypted: (1/1): 0800065f1f040000181d02300007
 extracted server max pdu size is 1024
-----------------------------------------

Hard-fault

Hcoa DV27@2676eL5b3c1S20000fc0

coap task, data acess violation to address 0x27 (MMFAR).

ipa3-genus-dlms-insecure:v143-14-g656429d

ubuntu@ubuntu-VirtualBox:/Data/Projects/terminal$ ag -B 2 "=== Hard" ~/node62.log
87454-2019-02-01 13:43:42.430 #1   001bc50c6000d3ca <log> 1:41:44.913 [debug] [  meter/dlms] {     dlms}: dlmsReceiveCb called with s_rxRes=0
87455-2019-02-01 13:43:42.462 #1   001bc50c6000d3ca <log> 1:41:44.921 [debug] [  meter/dlms] {   device}: ** processDlmsPayload (0) **
87456:2019-02-01 13:43:42.462 #1   001bc50c6000d3ca <log> 1:41:44.929 ======== Hard fault ========
1211544-2019-02-03 11:56:01.621 #1   001bc50c6000cad0 <log> 36:43:12.639 [debug] [   coap/task] {     coap}: session 5028 (21f8bdd2): removing old outgoing, payload len 54
1211545-2019-02-03 11:56:01.621 #1   001bc50c6000cad0 <log> 36:43:12.650 [debug] [   coap/task] {     coap}: session 5028 (21f8bdd2): session timeout without a response (msgid 37401)
1211546:2019-02-03 11:56:01.621 #1   001bc50c6000cad0 <log> 36:43:12.661 ======== Hard fault ========
1535210-2019-02-04  4:50:35.276 #1   001bc50c6000cad0 <log> 16:54:07.830 [debug] [   coap/task] {     coap}: session 709 (69109af7): removing old outgoing, payload len 54
1535211-2019-02-04  4:50:35.276 #1   001bc50c6000cad0 <log> 16:54:07.840 [debug] [   coap/task] {     coap}: session 709 (69109af7): session timeout without a response (msgid 17736)
1535212:2019-02-04  4:50:35.276 #1   001bc50c6000cad0 <log> 16:54:07.852 ======== Hard fault ========
1624956-2019-02-04  9:32:17.890 #1   001bc50c6000cad0 <log> 4:41:14.453 [debug] [   coap/task] {     coap}: session 198 (40b657e6): removing old outgoing, payload len 54
1624957-2019-02-04  9:32:17.890 #1   001bc50c6000cad0 <log> 4:41:14.463 [debug] [   coap/task] {     coap}: session 198 (40b657e6): session timeout without a response (msgid 314)
1624958:2019-02-04  9:32:17.890 #1   001bc50c6000cad0 <log> 4:41:14.475 ======== Hard fault ========
1634189-2019-02-04  9:44:39.835 #1   001bc50c6000cad0 <log> 0:06:43.615 [debug] [   coap/task] {     coap}: session 9 (1f9f46bb): removing old outgoing, payload len 54
1634190-2019-02-04  9:44:39.835 #1   001bc50c6000cad0 <log> 0:06:43.625 [debug] [   coap/task] {     coap}: session 9 (1f9f46bb): session timeout without a response (msgid 3468)
1634191:2019-02-04  9:44:39.835 #1   001bc50c6000cad0 <log> 0:06:43.636 ======== Hard fault ========
1638834-2019-02-04  9:51:50.248 #1   001bc50c6000cad0 <log> 0:06:42.264 [debug] [   coap/task] {     coap}: session 10 (5ea2163a): removing old outgoing, payload len 54
1638835-2019-02-04  9:51:50.248 #1   001bc50c6000cad0 <log> 0:06:42.274 [debug] [   coap/task] {     coap}: session 10 (5ea2163a): session timeout without a response (msgid 28666)
1638836:2019-02-04  9:51:50.248 #1   001bc50c6000cad0 <log> 0:06:42.286 ======== Hard fault ========
1642971-2019-02-04  9:56:56.835 #1   001bc50c6000cad0 <log> 0:04:38.666 [debug] [   coap/task] {     coap}: session 8 (2f6c3b71): removing old outgoing, payload len 54
1642972-2019-02-04  9:56:56.835 #1   001bc50c6000cad0 <log> 0:04:38.676 [debug] [   coap/task] {     coap}: session 8 (2f6c3b71): session timeout without a response (msgid 18345)
1642973:2019-02-04  9:56:56.835 #1   001bc50c6000cad0 <log> 0:04:38.688 ======== Hard fault ========
1652066-2019-02-04 10:16:08.118 #1   001bc50c6000cad0 <log> 0:18:44.555 [debug] [   coap/task] {     coap}: session 17 (165f8605): removing old outgoing, payload len 54
1652067-2019-02-04 10:16:08.118 #1   001bc50c6000cad0 <log> 0:18:44.565 [debug] [   coap/task] {     coap}: session 17 (165f8605): session timeout without a response (msgid 14348)
1652068:2019-02-04 10:16:08.118 #1   001bc50c6000cad0 <log> 0:18:44.577 ======== Hard fault ========


00026740 <coapSendNodeRegistrationCb>:
{
   26740:   b538        push    {r3, r4, r5, lr}
   26742:   460d        mov r5, r1
   26744:   4604        mov r4, r0
    OS_mutexTake(&s_mutex);
   26746:   4811        ldr r0, [pc, #68]   ; (2678c <coapSendNodeRegistrationCb+0x4c>)
   26748:   f022 ffa4   bl  49694 <OS_mutexTake>
    if ((requestResultCode == CoapResultGotResponse &&
   2674c:   2d15        cmp r5, #21
   2674e:   d10c        bne.n   2676a <coapSendNodeRegistrationCb+0x2a>
            (messageInfo->header.code != CoapResponseCreated &&
   26750:   f894 3027   ldrb.w  r3, [r4, #39]   ; 0x27
    if ((requestResultCode == CoapResultGotResponse &&
   26754:   2b41        cmp r3, #65 ; 0x41
   26756:   d003        beq.n   26760 <coapSendNodeRegistrationCb+0x20>
            (messageInfo->header.code != CoapResponseCreated &&
   26758:   2b44        cmp r3, #68 ; 0x44
   2675a:   d001        beq.n   26760 <coapSendNodeRegistrationCb+0x20>
             messageInfo->header.code != CoapResponseChanged &&
   2675c:   2b84        cmp r3, #132    ; 0x84
   2675e:   d106        bne.n   2676e <coapSendNodeRegistrationCb+0x2e>
}
   26760:   e8bd 4038   ldmia.w sp!, {r3, r4, r5, lr}
    OS_mutexGive(&s_mutex);
   26764:   4809        ldr r0, [pc, #36]   ; (2678c <coapSendNodeRegistrationCb+0x4c>)
   26766:   f022 bf65   b.w 49634 <OS_mutexGive>
             messageInfo->header.code != CoapResponseNotFound)) ||
   2676a:   2d16        cmp r5, #22
   2676c:   d1f8        bne.n   26760 <coapSendNodeRegistrationCb+0x20>
        LOG_WARNING("Unexpected response %u from server,"
   2676e:   f894 3027   ldrb.w  r3, [r4, #39]   ; 0x27                                  <-------- crash here.
   26772:   4a07        ldr r2, [pc, #28]   ; (26790 <coapSendNodeRegistrationCb+0x50>)
   26774:   4907        ldr r1, [pc, #28]   ; (26794 <coapSendNodeRegistrationCb+0x54>)
   26776:   2004        movs    r0, #4
   26778:   f01f f872   bl  45860 <logFormatted>
        scheduleChangeOrAdd(&s_retrySendNodeRegistration, nodeRegistration,
   2677c:   4b06        ldr r3, [pc, #24]   ; (26798 <coapSendNodeRegistrationCb+0x58>)
   2677e:   2200        movs    r2, #0
   26780:   4906        ldr r1, [pc, #24]   ; (2679c <coapSendNodeRegistrationCb+0x5c>)
   26782:   4807        ldr r0, [pc, #28]   ; (267a0 <coapSendNodeRegistrationCb+0x60>)
   26784:   f01d f8fa   bl  4397c <scheduleChangeOrAdd>
   26788:   e7ea        b.n 26760 <coapSendNodeRegistrationCb+0x20>
   2678a:   bf00        nop
   2678c:   20007ea8    .word   0x20007ea8
   26790:   0006c581    .word   0x0006c581
   26794:   0006c5c9    .word   0x0006c5c9
   26798:   0001d4c0    .word   0x0001d4c0
   2679c:   00026c35    .word   0x00026c35
   267a0:   20007f0c    .word   0x20007f0c


static void coapSendNodeRegistrationCb(const CoapMessageInfo* messageInfo,
        ResultCode requestResultCode, const void* payload, int payloadSize,
        void* requestCallbackData)
{
    OS_mutexTake(&s_mutex);
    if ((requestResultCode == CoapResultGotResponse &&
            (messageInfo->header.code != CoapResponseCreated &&
             messageInfo->header.code != CoapResponseChanged &&
             messageInfo->header.code != CoapResponseNotFound)) ||
        (requestResultCode == CoapResultNoResponse)) {
        LOG_WARNING("Unexpected response %u from server,"
                "reschedule sending node registration", messageInfo->header.code);
        scheduleChangeOrAdd(&s_retrySendNodeRegistration, nodeRegistration,
                NULL, RETRY_SEND_NODE_REGISTRATION_DELAY);
    }
    OS_mutexGive(&s_mutex);
}

Suspected bad messageInfo pointer that isn't checked.

Seems to be another case of https://gerrit.cyco.io/#/c/12042/


----------------------------------------------------------------------

MQ

1) Corrupt messages transferred correctly through the mq to NMS... NMS continuously loops as it faults.
2) On Agent, an entire mq file goes bad, causing the mq to rollback a *long* way. Agent has to fill up the queue before the NMS recognises
that its back at a good position and starts letting the messages thru again.



Agent-old, NMS-new
Agent-new, NMS-old
Agent-new, NMS-new
Agent-old, NMS-old (Same as above, with repeated samples retrieved).




--------------------------

433MHz gw-200 build.... channel & channel plan??

---------------------------

IS 802.15.4 spec

384 Nodes must implement the User Datagram Protocol as defined in [RFC768].                     <--- Yes.
385 Nodes may also implement the Transport Control Protocol as defined in [RFC793].             <--- No, but its a *may*
386 Nodes must implement Internet Protocol Version 6 as described in [RFC2460].                 <--- Yes.
387 Nodes must implement ICMPv6 message processing as described in [RFC4443].                   <--- Yes.
388 Nodes must implement Neighbour Cache Management as described in [RFC6775].                  <--- No, and its a *must*
389 Nodes must implement [RFC6775] Neighbour Solicitation with Address Registration Option
390 (ARO) to resolve link layer addresses.                                                      <--- No. SLAAC-optimisations.
391 Nodes use the techniques described in [RFC6775] and [RFC6550] to optimize IPv6 Neighbour
392 Discovery.                                                                                  <--- RFC-6550 yes (RPL), RFC-6775, no.
393 Nodes should auto configure a link-local IPv6 address as described in [RFC4862]             <--- Yes on ethernet, not needed on mesh as IPs are allocated using EUI-64.
394 Node should support Duplicate Address Detection, as described in [RFC4861].                 <--- Yes on ethernet, not needed on mesh as IPs are allocated using EUI-64.
395 Nodes may originate multicast ICMPv6 or UDP messaging.                                      <--- Yes.
396 A Router Node may support the DHCPv6 Relay Agent mechanism as described in [RFC3315].       <--- DHCPv6 yes, relay-agent? its a *may*. Not really needed since we don't use DHCP on the mesh.
397 Nodes implement DHCPv6 [RFC3315] to provide automated management of IPv6 GUA and            <--- Yes, but fully? (december 2003)
398 ULA address assignments

a) Mutual authentication of a node and the node to which the node connects must be
416 supported.                                                                                  <--- Generally no, encryption, yes, authentication... IPSEC? DTLS over mesh to server.
417 b) The Node must provide a means to restrict traffic from non-authenticated nodes.          <--- Yes, RLL key
418 c) The Node must support establishment, refresh, and revocation of pairwise keys
419 between Border Routers and non-Border Router nodes.                                         <--- No, RLL keys are currently re shared.
420 d) The Node must support establishment, refresh, and revocation of group keys to nodes.     <--- hmm, is the RLL key considered a 'group' key?
421 e) The Node may support establishment, refresh, and revocation of pairwise keys
422 between any two nodes.                                                                      <--- Yes.
423 f) The Node must support encryption of transmitted frames and decryption of received
424 frames.                                                                                     <--- Yes.
425 g) The Node must support integrity checking of transmitted frames.                          <--- Yes (assuming it means received frames).

446 i) Misbehaving nodes are removed from the network by the Border Router revoking the node’s
447 pairwise keys, followed by distribution of new group keys to the remaining end nodes.       <--- We currently can't do this I don't think.

9.5.3:
CoAP over DTLS.

479 - MAC Layer: IEEE 802.15.4-2015                                                             <--- Yes.
480 - PHY Layer: IEEE 802.15.4u, IEEE 802.15.4v                                                 <---
481 - USIL Layer: 6LoWPAN, RPL                                                                  <--- Yes, RPL and 6LoWPAN.



Ok, I've had a look at the BIS PHY standard and the delta between it and what we currently have:



6.1: PPDU Format:
- Preamble field; some changes needed to length coding & decoding.
- SFD; Assuming no FEC, a simple constant change. Addition of FEC is a simple alternative value.
- PHR; Minor changes to logic regarding handling and rejection of frames without whitening enabled
also have to enable data whitening on transmit (EFR32 and CC1200 support this). Other fields such
as frame length can be updated to match.
6.2 FEC; This is optional, so yes we can support the 'no FEC' option. There are FEC options available
in the EFR32 that would seem to be appropriate tho. Adding these would require additional implementation and testing time.
6.3 Modulation and Coding
- Symbol rate and modulation index; Currently we support the 50 Ksym/sec for operating mode 1.
- Frequency Bands and Channel Parameters; We support a wide range of frequencies already, these lie within that range.
6.4 Data whitening; supporting this is a matter of turning on the facility in the EFR32 and marking the flags in the packet likewise.
7 PHY requirements
- Assumed h/w wise the part is compliant.

Additionally, we need some logic around variant handling; i.e. making the code sufficiently flexible to handle multiple variants in this part of the codebase.
Potentially at runtime where it is currently hardcoded.

Estimate: 1 weeks work to determine the details and implement with minimal dev-testing + 1 week for testing to ensure the effects of the
changes are as required + a period of interoperability testing which could last as long as desired.
Limitations: Need a suitable device for interop testing.  Is FEC needed? This would be roughly an additional few days to implement.




> *PHY LAYER*
>
>
> The PHY layer is derived from a sub-set of [IEEE802.15.4u].
>
> 2-FSK modulation schemes, with channel spacing range from 100 to 200
> kHz, are defined to provide uncoded data rates from 50 to 150 kbps.
> FEC is optional and based upon NRNSC code.
>
> The PHY Protocol Data Unit (PPDU) structure is as defined in
> [IEEE802.15.4u]. Coded and uncoded transmissions are discriminated by
> separate Start Words. Preamble lengths are predefined to achive the
> interoperability requirements. PHY header options are simplified by
> enforcing no Mode Switch, Data Whitening enabled and use of 4-octet FCS.
>
> ____________________________________
>
> *MAC LAYER*
>
> The MAC sub-layer uses data structures defined an [IEEE802.15.4].
>
> The MAC sub-layer operates in non-beacon enabled mode (no periodic
> beacon frames are defined) and hence no contention free period exists.
> All channel access operates using contention access mode. The
> [IEEE802.15.4] association procedures are not used.  Short addressing
> is not within scope of this specification.
>
> Nodes use EUI-64 based MAC address as defined in [IEEE802.15.4].  The
> Data and Enhanced Acknowledge frames are used and extended with a set
> of Information Elements.  Further, all MAC payload is encapsulated in
> an [IEEE802.15.9] MPX-IE, which enables LLC protocol dispatch.
I think we stopped using the enhanced ack frames some years ago. We don't use MPX-IE.

>
>
> ______________________________________
>
> *6LOWPAN*
>
> Nodes support transmission and reception of IPv6 packets over IEEE
> 802.15.4 networks as described in [RFC4944] and amended by [RFC 6282].
> Specifically:
>
> 1.     Nodes MUST implement reception for the NALP Header Type as
> defined in [RFC4944].
I think we do the right thing here, i.e. drop the packet.

>
> 2.     Nodes MUST implement generation and reception for the IPv6
> Header Type as defined in [RFC4944].
I think we support uncompressed as well, but it's not really used.

>
> 3.     Nodes MUST implement generation and reception for IPv6 Header
> Compression (LOWPAN_IPHC) as defined in [RFC6282].  Nodes are not
> required to implement stateful context based source, destination, or
> multicast address compression.
Yes we do.

>
> 4.     Nodes MUST implement generation and reception of IPv6 Extension
> Header Compression (LOWPAN_NHC) as defined in [RFC6282] (supporting
> IP-in-IP tunneling for packet forwarding).
I don't think we support IP-in-IP header compression.

>
> 5.     Nodes MUST implement reception of UDP header compression as
> defined in [RFC6282].
Yes, we do.

>
> 6.     Nodes MUST implement support for the FRAG1 and FRAGN Header
> Types as described in [RFC4944] (regardless of the FAN’s minimum IPv6
> MTU size, fragmentation support is desirable  for high noise environments).
> Fragmentation and re-assembly MUST be performed on a hop-by-hop basis.
> Fragments MUST be transmitted in order, and indication of successful
> fragment delivery MUST be received before the next fragment is
> transmitted.
Yes, we support this.

>
> 7.     Multicast packets SHOULD not be fragmented.  Fragmented
> multicast packets MUST be ignored on receipt (as layer 2 broadcast
> frames are unacknowledged).
I assume this mean IPv6 layer fragmentation and not 6LowPAN fragmentation. We don't support IPv6 fragmentation at all.

>
> 8.     Nodes MUST drop any frame containing an unknown 6LoWPAN Header Type.
We should do that.

>
>
> _______________________________________
>
> *ROUTING AND IPv6*
>
> Nodes MUST implement the non-storing downward mode of RPL as described
> in [RFC6550]
Yes we do.

>
> Nodes MUST implement Neighbor Cache Management as described in [RFC6775].
We don't do neighbor hood discovery on the radio.

>
> Nodes MUST implement [RFC6775] Neighbor Solicitation with Address
> Registration Option (ARO) to resolve link layer addresses.
We don't.

>
> Nodes use the techniques described in [RFC6775] and [RFC6550] to
> optimize IPv6 Neighbor Discovery.
We don't.

>
> Nodes MUST auto configure a link-local IPv6 address as described in
> [RFC4862]
Yes we do.

>
> Node MUST support Duplicate Address Detection, as described in [RFC4861].
We don't, not on mesh radio. When using IPv6 over Ethernet we support it.

>
> Nodes MAY originate multicast ICMPv6 or UDP messaging.
We do.

>
>
> This next one may be applicable to our Gateway ... Do we support
> DHCPv6 Relay agent ?
No, we don't.

>
>
> A Router Node MUST support the DHCPv6 Relay Agent mechanism as
> described in [RFC3315].
No.

>
> Nodes implement DHCPv6 [RFC3315] to provide automated management of
> IPv6 GUA and ULA address assignments.
Our GW has limited support for DHCPv6. HMP is using that for some deployment. There is a user story about improving the DHCPv6 support.

>
>
> _______________________________________________
>
> *SECURITY**
> *
> let me know what we do not support / like ... I wonder if the first
> one can be interpreted as a node being a mesh node in one side and our
> server on the other side or if they envision mutual authentication
> between every single mesh link in a mesh network... Which I guess we
> do not supportAuthentication is based on the fact that the other end
> knows about the
RLL key and is therefor trusted.

>
>
> Security functionalities (authentication, key management, and so on)
> is important pieaces of this document. The BIS – LMCP supports the
> following set of security mechanisms:
>
> The following section presents the technical requirements related to
> security.
>
> 1.     Mutual authentication of a node and the node to which the node
> connects MUST be supported.
Not supported, it's only end-to-end security.

>
> 2.     The Node MUST provide a means to restrict traffic from
> non-authenticated nodes.
If you don't have the correct RLL-key packets will be dropped. There is support for a restricted rll-key as implemented for smip.

>
> 3.     The Node MUST support establishment, refresh, and revocation of
> pairwise keys between Border Routers and non Border Router nodes.
Not supported. It's a shared rll-key.

>
> 4.     The Node MUST support establishment, refresh, and revocation of
> group keys to nodes.
Not supported.

>
> 5.     The Node MAY support establishment, refresh, and revocation of
> pairwise keys between any two nodes.
Not supported.

>
> 6.     The Node MUST support encryption of transmitted frames and
> decryption of received frames.
That we support.

>
> 7.     The N ode MUST support integrity checking of transmitted frames.
Should we check the integrity of frames sent? It makes more sense to check it on received frames and that we do.

>
>
> _________________________________________________________
>
> *SECURITY - PART 2
>
> *Finally I found this from that spec and there are a number of items I
> do not like as being far away from what we do like 802.1X.
> Should our Gateway be considered a Border Router and is there any kind
> of node-to-node mutual authentication, group key or node-to-node key
> in the standards we follow or in our implementation  .
Our Gateway is a RPL Boarder Router.

> All of this below sounds like a rewrite of our RLL Management Key solution..
A little, it's a different approach to it.

>
> So what are your comments for the text below ?
>
> Below are the component of the security to be implemented.
>
> 1.     Layer 2 network access control, mutual authentication, and
> establishment of a secure pairwise link between a End Node and its
> Border Router is implemented with an adaptation of [IEEE802.1X] and
> [RFC5216] for [IEEE802.15.4].
Not supported.

>
> 2.     Below are the role of different roles of the devices in network
>
> a.     Joining nodes should assume the role of SUP
>
> b.     Border Routers assume the role of Authenticator
>
> c.     A AAA service (such as RADIUS) fulfills the role of the
> Authentication Service.
>
> 2.     An EAPOL Relay mechanism is defined to provide EAPOL messaging
> between Supplicant and Authenticator when the two are not within radio
> range of each another.
>
> 3.     Mutual authentication is based on [IEEE802.1AR] secure device
> identity.
>
> 4.     The BIS-LMCP will support the PKI.
>
> 3.     An adaptation of the [IEEE802.11] 4-Way Handshake establishes a
> shorter-lived secure pairwise link between the joining node and the
> Border Router; the 4-Way Handshake also establishes the network group
> security between all nodes of the network.
>
> 4.     Secure node to node (pairwise) links are supported between
> one-hop neighbors using an adaptation of [ETSI-TS-102-887-2].
>
> 5.     BIS-LMCP nodes implements frame Security as specified in
> section
> 9 of [IEEE802.15.4], using either the group or node to node pairwise
> keys previously established.
>
> 6.     Misbehaving nodes are removed from the network by the Border
> Router revoking the node’s pairwise keys, followed by distribution of
> new group keys to the remaining end nodes.

Not sure what to say for all of the above. It basically re-iterates the 802.1X
standard which we skipped because it would require to much cpu resources and wouldn't really give us much.




neighbour discovery
https://confluence.cyco.io/display/ENG/C4+-+Design?preview=%2F1179851%2F2097164%2FIPSO_NeighborDiscovery.pdf


---------------------------------------
meter fw upgrade:

[filetype = meterfw]
setFileTypeFromMetadata( meterfw )
[targetdevice = KT026818]
[meterfw_id = 1234567]
setMeterFwIdFromMetadata( 1234567 )
fw Identifier = [1234567]


2019-02-06  7:59:40.079 #1   001bc50c6000cad0 <log> 6:40:20.589 [debug] [      filedl] {   filedl}: No more missing blocks; we are finished!
2019-02-06  8:00:12.262 #1   001bc50c6000cad0 <log> 6:40:52.763 [debug] [  meter/upgr] {   filedl}: --- Upgrade result: File received, meter-upgrade starting ---

[        hdlc] {     dlms}: tx: (1/1): 7e
[        hdlc] {     dlms}: tx: (1/1): a02b
[        hdlc] {     dlms}: tx: (1/1): 03
[        hdlc] {     dlms}: tx: (1/1): 61
[        hdlc] {     dlms}: tx: (1/1): 32
[        hdlc] {     dlms}: tx: (1/1): 8deb
[        hdlc] {     dlms}: tx: (1/1): e6e600
[        hdlc] {     dlms}: tx: (1/2): c30181000f0000280000ff0101091020
[        hdlc] {     dlms}: tx: (2/2): b7df32af70d9ced08102820ae3ed17
[  fs/service] {   filedl}: flashopErase 163:0x0 4096 B
[        hdlc] {     dlms}: tx: (1/1): a304
[        hdlc] {     dlms}: tx: (1/1): 7e
[        hdlc] {     hdlc}: ** giveCause = 3, 1 **
[        hdlc] {     hdlc}: rx: (1/2): 7ea011610352c7fee6e700c701c1010c
[  fs/service] {   filedl}: flashopErase 164:0x0 4096 B
[        hdlc] {     hdlc}: rx: (2/2): 48677e
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: Action Response result: hw fault
[        dlms] {     dlms}: processXDlmsApdu(5 B): failed
[        dlms] {     dlms}: DLMS result is 0 bytes with code 12
[  meter/dlms] {     dlms}: dlmsReceiveCb called with s_rxRes=0
[  meter/dlms] {   device}: ** processDlmsPayload (12) **
[  meter/dlms] {   device}: Broken response: check failed
[meter/device] {   device}: Error from KT026818: comm: broken rsp
[  fs/service] {   filedl}: flashopErase 165:0x0 4096 B


2019-02-06  8:00:17.907 #1   001bc50c6000cad0 <log> 6:40:58.424 [debug] [  meter/upgr] {   device}: --- Upgrade result: Meter-upgrade termination ---

----------------------------------------

Generate certs

"release" repo

sudo apt install libio-all-perl
sudo apt-get install libxml-libxml-perl libxml-simple-perl libexpect-perl libsoap-lite-perl libjson-perl libchart-clicker-perl libwww-perl libterm-readline-gnu-perl libdate-simple-perl libgraph-easy-perl libproc-simple-perl libproc-processtable-perl libipc-run-perl liblog-log4perl-perl libio-all-perl libcapture-tiny-perl libtext-asciitable-perl libyaml-perl libfile-find-rule-perl libstring-random-perl libdate-calc-perl libnet-smtp-tls-perl libio-all-perl libparse-recdescent-perl libio-captureoutput-perl libdata-structure-util-perl libfile-chdir-perl libmoo-perl libdevice-serialport-perl libnet-sftp-foreign-perl libdbd-sqlite3-perl libcrypt-ssleay-perl libio-interface-perl libdancer-perl libnet-rawip-perl libnetpacket-perl libnet-libdnet-perl libnetwork-ipv4addr-perl libnet-ipv6addr-perl libnet-write-perl libnet-frame-perl libnet-ssh-perl libnet-oping-perl libdbd-mysql-perl libbarcode-code128-perl libswitch-perl libio-socket-inet6-perl libdatetime-format-dateparse-perl


./utils/gen_certs.pl 00-00-00-00-00-00-00-01


------------------------------------------------

LMCP series of standards

- "Nodes must implement RPL". A significant point of the optimisation of neighbour-discovery ([RFC6775] and [RFC6550]) is to allow sleepy-nodes. Also the supported device-types indicate support for
battery-powered devices, yet RPL does not currently have any provision for sleepy-nodes, is there any consideration at this level for those types of devices?

- Is neighbour-cache-management necessary when the product in question has an alternative method of determining node address (i.e. static or deterministic allocation of addresses).

- To what extent is the standard flexible for producets that do not require interoperability (i.e. closed systems)

- Is Duplicate-Address-Detection necessary in networks of statically-allocated nodes?

- "Nodes implement DHCPv6 [RFC3315]" Is this a "must"? what if we have a system of static (or deterministic) addressed nodes?

- "Nodes must provide a means to restrict traffic from non-authenticated nodes". If a node can filter traffic (drop packets) that does not decrypt, is this sufficient? i.e. Is this
a requirement for authentication or a filtering function?

- "The Node must support establishment, refresh, and revocation of group keys to nodes". If a product does not support the concept of groups, is this feature still required?


-----------------------------------------------------------

MQ issue

Some MQ entries lost, server wants 7221, only 3154 to 7219 are available
Skipping missing mq #7220
Push re-scheduled in 7 s
Some MQ entries lost, server wants 7221, only 3154 to 7219 are available
Skipping missing mq #7220
Push re-scheduled in 28 s
Version: posix-kaifa:v144-4-g1efa345 on hw linux
IID: 02-00-00-00-00-00-00-01

sanitizePushLaterSeqNum();

Generate protobuf (pb) binary files.
https://medium.com/@at_ishikawa/cli-to-generate-protocol-buffers-c2cfdf633dce

cat mq.text
time: 1234

protoc --encode=MqEntry interface/proto/mq.proto -I./interface/proto  < mq.text > mq.data

cat <hex_string> | xxd -r -p > pb.bin
protoc --decode=MqEntry interface/proto/mq.proto -I./interface/proto  < pb.bin  > pb.text

------------------------------

TI SensorController

Ok, so out application would be running on the M4F core.
In that sense it has 80KB SRAM & 350KB of FLASH.

Problems:
- 80KB SRAM... would *hope* we would be able to cut down our app to run in that. Not a given tho.
- 350KB FLASH... Our app is around that size, so nothing available for firmware (or meter) upgrade unless
we get an external SPI FLASH also. Again, we can do something about this, but we aren't right now
(with the prospect of more security protocol modules coming up) this is likely to *increase* rather
than stay static (or reduce).
- The low-power 16-bit processor (SC) is currently useless to us (tho when we get into gas & water
meters it would become *very* useful).

Other points:
- If we needed to use that processor, the quickest way would be to take advantage of the fact that
they already have Thread (https://www.threadgroup.org/) running on it and simple port our application
to Thread. This would efectively remove the Connode IPv6/LoWPAN stack and you could argue would be
better in the long-run anyway (because we can't compete with Google, ARM, TI, etc who all throw their
money behind Thread).
- An interesting idea would be to port the low-level radio stack to the ultra-low-power processor
(the SC) on that device and allow the main Cortex-M4F to be turned off. This would resolve a number
of issues we will have when going low-power (in the future).



https://site.eettaiwan.com/events/iot_embed_2018/sources/05_TI_WT.pdf







-----------------------------

Listing entries from 60925:
NUMBER UTC TIME                 T-STATUS  - ENTRY
 60935 Sun Feb 10 06:15:30 2019 in sync   - Data profile sample: USS 0000483 Sun Feb 10 06:15:00 2019 1.0.99.1.0.255:  "2019-02-10T11:45:00 dev 330 status: 0x0","250.3800048828125","0.0","0.0","0.0","0.0","0.0","0.0","0"
 60941 Sun Feb 10 06:30:33 2019 in sync   - Data profile sample: USS 0000483 Sun Feb 10 06:30:00 2019 1.0.99.1.0.255:  "2019-02-10T12:00:00 dev 330 status: 0x0","251.97999572753906","0.0","0.0","0.0","0.0","0.0","0.0","0"

 60934 Sun Feb 10 06:15:31 2019 uncertain - Data profile sample: USS 0000483 Sun Feb 10 06:15:30 2019 1.0.94.91.0.255: "2019-02-10T11:45:30 dev 330 status: 0x0","250.1199951171875","0.0","0.0","0.0","50.0","0.0","0.0","32238.0","60442.0","0.0","b'ffffffffffffffffff014a00'","0.0","b'ffffffffffffffffff014a00'","444135.0","0","12","2","0.0","0.0","1","16560"
 60938 Sun Feb 10 06:15:33 2019 in sync   - Data profile sample: USS 0000483 Sun Feb 10 06:15:35 2019 1.0.94.91.0.255: "2019-02-10T11:45:35 dev 330 status: 0x0","249.97999572753906","0.0","0.0","0.0","50.0","0.0","0.0","32238.0","60442.0","0.0","b'ffffffffffffffffff014a00'","0.0","b'ffffffffffffffffff014a00'","444135.0","0","12","2","0.0","0.0","1","16560"

 60936 Sun Feb 10 06:15:31 2019 in sync   - Data profile sample: USS 0000483 Sun Feb 10 06:07:00 2019 0.0.99.98.2.255: "2019-02-10T11:37:00 dev 330 status: 0x0","102","286"
 60937 Sun Feb 10 06:15:31 2019 in sync   - Data profile sample: USS 0000483 Sun Feb 10 06:04:00 2019 0.0.99.98.2.255: "2019-02-10T11:34:00 dev 330 status: 0x0","101","285"
 60940 Sun Feb 10 06:30:31 2019 in sync   - Data profile sample: USS 0000483 Sun Feb 10 06:30:34 2019 1.0.94.91.0.255: "2019-02-10T12:00:34 dev 330 status: 0x0","254.6699981689453","0.0","0.0","0.0","50.0890007019043","0.0","0.0","32238.0","60442.0","0.0","b'ffffffffffffffffff014a00'","0.0","b'ffffffffffffffffff014a00'","444150.0","0","12","2","0.0","0.0","1","16560"


-------------------------


2019-02-12 12:39:13.809 [debug] [          hdlclock] {   timeSynch}: -- unlocking HDLC --
2019-02-12 12:39:13.809 [debug] [              hdlc] {   timeSynch}: disconnectLink 0x0
2019-02-12 12:39:14.652 [ WARN] [            mqcoap] {    schedule}: Some MQ entries lost, server wants 46624, only 5879 to 21234 are available
2019-02-12 12:39:14.653 [ WARN] [            mqcoap] {    schedule}: Skipping missing mq #21235





------------------------------

 ** Reading PFAIL BLOB **
 -- HDLC locked --
 GPIO Push Start (send HDLC RR)
 Setup AA using LLS without ciphering
 Setup AA with LLS
 Storing configuration
 fsOpen (/configuration-1.pb, newfile, fd=11)
 fsClose (fd=11)
 s_currentContextId = 3
 Connect HDLC link
 tx: (1/1): 7e
 tx: (1/1): a020
 tx: (1/1): 03
 tx: (1/1): 41
 tx: (1/1): 93
 tx: (1/1): 28bc
 tx: (1/2): 8180140502015e0602015e0704000000
 tx: (2/2): 01080400000001
 tx: (1/1): 51af
 tx: (1/1): 7e
 ** dlmspipe task waiting to be triggered (30000) **
 ** giveCause = 3, 1 **
 rx: (1/3): 7ea0204103733e9d8180140502015e06
 rx: (2/3): 02015e07040000000108040000000151
 rx: (3/3): af7e
 tx: (1/1): 7e
 tx: (1/1): a044
 tx: (1/1): 03
 tx: (1/1): 41
 tx: (1/1): 10
 tx: (1/1): b3e1
 tx: (1/1): e6e600
 tx: (1/4): 6036a1090607608574050801018a0207
 tx: (2/4): 808b0760857405080201ac0a80083141
 tx: (3/4): 324233433444be10040e01000000065f
 tx: (4/4): 1f0400001f1fffff
 tx: (1/1): dd04
 tx: (1/1): 7e
 ** Waiting for HDLC event (10000ms) **
 ** giveCause = 3, 1 **
 rx: (1/4): 7ea0374103302179e6e7006129a10906
 rx: (2/4): 0760857405080101a203020101a305a1
 rx: (3/4): 0302010dbe10040e0800065f1f040000
 rx: (4/4): 1014015e00079a8a7e
 DLMS:receiveCb (0)
 ** Waiting for HDLC event (10000ms) **
 COSEM AA is rejected: authentication failure
 processAcseApdu(43 B): failed
 DLMS result is 0 bytes with code 12
 ** dlmsReceiveCb **
 ** triggering dlmspipe task **
 ** dlmspipe task triggered **
 ** Waiting for DLMS report (14000) **
 ** processDlmsPayload **
 processDlmsPayload = 4, 12
 Broken response: check failed
 GPIO Push Finished


- GPIO level triggers ISR.
- Send RR frame for alarm request
tx: (1/3): 7ea02003819382768180140502015e06
tx: (2/3): 02015e07040000000108040000000151
tx: (3/3): af7e

(Decodes as an SNRM frame, the RR flags are set).
<HDLC len="31" >
<TargetAddress Value="1" />
<SourceAddress Value="64" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="350" />
  <MaxInfoRX Value="350" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>


- receipt of UA for the above.
rx: (1/3): 7ea020810373a4978180140502015e06
rx: (2/3): 02015e07040000000108040000000151
rx: (3/3): af7e

(decodes as follows)
<HDLC len="31" >
<TargetAddress Value="64" />
<SourceAddress Value="1" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="350" />
  <MaxInfoRX Value="350" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>


The pushed,encrypted data is then received on the node (pushed by the meter).
rx: (1/7): 7ea0688103105635e6e700db08474f45
rx: (2/7): 0000018e8e82004f200000000117b22c
rx: (3/7): 1cf312162ff40e7f2cedc8e3f0b72b95
rx: (4/7): 1f4894f767824259a64b60b746afdb9e
rx: (5/7): c4bf953575f54836a45c0a8c3aa3f700
rx: (6/7): dfeb96e030a65b073722e0789efe2f2e
rx: (7/7): cda8da1a7fb4bf05c17e


After decryption of the pushed,encrypted data, we get the unencrypted "pushed" payload...
09060004190900ff090c07e20816030b
031aff014a0004820080900000000050
00000000000000000000

which decodes as:
<GetResponse>
  <GetResponseNormal>
    <InvokeIdAndPriority Value="81" />
    <Result>
      <Data>
        <Array Qty="01" >
          <Structure Qty="19" >
            <Structure Qty="02" >
              <Int8 Value="00" />
              <Enum Value="FF" />
            </Structure>
            <Structure Qty="02" >
              <Int8 Value="FE" />
              <Enum Value="FF" />
            </Structure>
            <Structure Qty="02" >
              <Int8 Value="01" />
              <Enum Value="1E" />
            </Structure>
            <Structure Qty="02" >
              <Int8 Value="01" />
              <Enum Value="1E" />
            </Structure>
            <!--0.4.25.9.0.255-->
            <OctetString Value="0004190900FF" />
            <!--2018-08-22 11:03:26-->
            <OctetString Value="07E20816030B031AFF014A00" />
            <BitString Value="10010000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000" />
          </Structure>
        </Array>
      </Data>
    </Result>
  </GetResponseNormal>
</GetResponse>




In there, you can see the ESW (Equipment Status Word).












-------------------------------







-------------------------------------



@Bhavana Kotagiri @Steve Tickle @James Charlton
Hi all.
I tried to parse log where agent has been crashed and it seems to me that some content is a lot of strange. When agent sends request for get Profile Daily load (Get 1-0:99.2.0*255 ic 7 attr 2) then meter sends response where the length of array is a lot of size and it is 65319.  Please take a look to chunk of log

[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [debug] [              dlms] {      device}: Get 1-0:99.2.0*255 ic 7 attr 2 by range:
[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [ info] [              dlms] {      device}: Profile Daily load: From time: 2018-12-27 11:09:58
[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [ info] [              dlms] {      device}: Profile Daily load: To time: 2019-01-16 11:09:58
[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [debug] [              dlms] {      device}: tx unencrypted: (1/4): c0018100070100630200ff0201010204
[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [debug] [              dlms] {      device}: tx unencrypted: (2/4): 020412000809060000010000ff0f0212
[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [debug] [              dlms] {      device}: tx unencrypted: (3/4): 0000090c07e20c1b040b093aff014a00
[36mlnt3ph_1  |[0m 2019-01-16 15:27:23.750 [debug] [              dlms] {      device}: tx unencrypted: (4/4): 090c07e30110030b093aff014a000100
[36mlnt3ph_1  |[0m 2019-01-16  4:22:27.117 [debug] [              dlms] {        dlms}: rx decrypted: (1/62): c402810000000001008203d0 01 82 ff27 <---length
[36mlnt3ph_1  |[0m 2019-01-16  4:22:27.117 [debug] [              dlms] {        dlms}: rx decrypted: (2/62): 0205090c00000000ff0000ffff014a00
..............................................................................................................................................

<GetRequest>
  <GetRequestNormal>
    <InvokeIdAndPriority Value="81" />
    <AttributeDescriptor>
      <!--PROFILE_GENERIC-->
      <ClassId Value="0007" />
      <!--1.0.99.2.0.255-->
      <InstanceId Value="0100630200FF" />
      <AttributeId Value="02" />
    </AttributeDescriptor>
    <AccessSelection>
      <AccessSelector Value="01" />
      <AccessParameters>
        <Structure Qty="04" >
          <Structure Qty="04" >
            <UInt16 Value="0008" />
            <!--0.0.1.0.0.255-->
            <OctetString Value="0000010000FF" />
            <Int8 Value="02" />
            <UInt16 Value="0000" />
          </Structure>
          <!--2018-12-27 11:09:58-->
          <OctetString Value="07E20C1B040B093AFF014A00" />
          <!--2019-01-16 11:09:58-->
          <OctetString Value="07E30110030B093AFF014A00" />
          <Array Qty="00" >
          </Array>
        </Structure>
      </AccessParameters>
    </AccessSelection>
  </GetRequestNormal>
</GetRequest>



<GetResponse>
  <GetResponsewithDataBlock>
    <InvokeIdAndPriority Value="81" />
    <Result>
      <LastBlock Value="00" />
      <BlockNumber Value="00000001" />
      <Result>
        <!--Block is not complete.20/976.-->
        <RawData Value="0182FF270205090C00000000FF0000FFFF014A00" />
      </Result>
    </Result>
  </GetResponsewithDataBlock>
</GetResponse>


7e a020 03 81 93 8276 8180 140502015e0602015e070400000001080400000001 51af 7e

7ea02003819382768180140502015e0602015e07040000000108040000000151af7e`

--------------------------------------

CVE-2019-5736 generic container break-out exploit.
CVE-2019-7304 Ubuntu snapd API privelage-escalation
-----------------------------

METRIC_RADIO_MAC_CONTENTION_PERCENTAGE:
numSendErrorsAllTries


CND-9058 Set Time-sync support for DST

The current timesync mechanism does not take account of meters that
don't support time-update (as opposed to time-set).
Also, we need to set DST (deviation, enabled flags, period) on Kaifa meters
and any others that may require this in future.

Change-Id: I5ecb6d5a9ac1a492f56b56b643367d554a1c5057



--------------------------------------

0A0B5553532030303034373133120517438260001A0E090C07E30210FF160F00FF014A001A0517419800001A051741F000001A0517000000001A0517000000001A05173EE666661A05173EE666661A0312000022100A2CC11589B722195076D70FF6FF8754288CFCA0E305


---------------------------------------

Asynchronous Comms Manager (ACM)
- Maintain mesh in stable state, i.e. minimise disruption to mesh thru reboots, etc.
- Optimise throughput of cellular and mesh.
- Input is unoptimised list of nodes to send BLOBs to and topology of network.
- Output is packets sent to nodes, scheduled according to network conditions.
- Has to maintain estimate of current gateway load given changing topology.
- Packets are opaque.
- ACM has knowledge of how nodes are allocated to gateways, number of hops to a node, current
throughput on mesh and cellular link (per gateway, possibly cell-id is useful here also).
- Works using EUI-64 node-addressing.

NMS uses ACM by:
- Creation of packets and list of nodes (multicast to EUI-64s).
- Notified of response packets by ACM.
- Retrieval of response packets from ACM.

SMA uses ACM by:
- Same as NMS.


ACM API:
- POST /job         Create a multicast-job returns jobId.
- GET /jobStatus    Get status of all multicast targets in the job.

Problem:
- ACM encrypts on output (i.e. uses DTLS transport). If packets are encrypted
on entry to the ACM, they cannot be multicast (as they will all be unique).
- If ACM takes enrypted input, no multicast is possilble.


AWS security issues:

- AWS doesn't protect against insider-exploits. If a bad-actor can get inside the CC or AWS, then all packets are
wide open to tcpdump and the like.
- Most breakins occur due to credential theft. This means CC security is critical and the lack of end-to-end security
means CC would be a target for and liable for data theft.
- Application security is not in the domain of AWS security, we need to fuzz and lock it all down.
- Pen testing of the servers.
- AWS is a big target.
- Shared tenency can lead to side-channel attacks such as spectre/meltdown.
- M2M credentials as well as user credentials are targets (i.e. Ansible creds).
- A shared ACM is required for multi-applications. This is a single point where all data is plaintext and mixed in the
one application.
- Different servers should have different credentials. The system should not have one set for everything.
- Central point for communications should be isolated from applications credential-wise.
- "The default privacy setting for AWS S3 buckets is owner-only. Most AWS breaches involve organizations choosing the “all authorized users” setting when expanding access to their buckets, not realizing that this setting includes all authorized users of Amazon Web Services, not just their account. This means that anyone with an AWS account can access that bucket with whatever permissions are granted to that level of access. It’s a free-for-all."
- Principle of "least privelage", the ACM does not need to know the contents of the data so should not.

Do we need transparent data to optimise comms? Can we do the same with opawue data?
- Metadata can contain the required source and destination info, payload can be encrypted.
- Packets are unique, but can be coalesced if going towards a common gateway.
- Required metadata? destination-EUI, jobId.

Purpose of ACM:
- To perform asychronous communications with the mesh on behalf of the application.
- API presented to the application(s) allows large-scale multicast operations to be submitted. Responses from nodes
will be multi-part (completion indicated by node). Job status may be polled using a unique job id allocated by ACM.
Job statuses will show progress (packets received from node) and completion status (final packet received?)

Optimisations by ACM:
- Mesh loading; maintain throughput on the mesh by limiting activity in file-distributions, i.e. don't send
distribution requests to all nodes on a mesh, sequence them instead.
- Packet aggregation; combine packets for the same gateway into one transfer over cellular to optimise bandwidth.
- Mesh stability; order activities on mesh such that mesh stability is maintained, i.e don't reboot a node that has
children. Order based on outer-first and work-inwards.
- Packet aggregation and mesh laoding; broadcast on mesh whenever possible. If packets are targetted at multiple
EUIs on a mesh, broadcast the packet.
- Takes into account the network metrics (live) from nodes & gateways.
- Jobs can run in parallel, depending on optimisations, i.e. part of a mesh performing one job-id while the othe
part performing a separate job-id.

Addressing:
- Nodes are addressed by EUI.
- IP addresses are dynamic, based on environmental conditions, not suitable for application-level addressing.
- IP isn't a given in future protocols, e..g ZigBee, LoRAWAN, SigFox, etc.
- Request-response durations are expected to be long, increasing the chance of changing IP during the cycle.
- EUIs are allocated by CC in a controlled manner.
- EUIs are static.
- For SM product, nodes register meter-id with SMA. SMA maintains EUI<->meter-id mapping, NMA has no need for this
information.
- UI can perform data fusion between NMA and SMA (EUI/meter-id) to present the UI.
- ACM takes EUIs as input (destination adresses).
- ACM provides response packets as output to application, addressed by EUI to avoid dynamic IP issues.
- EUI<->IP mapping is performed on output/input to ACM (mesh-side) and is closely linked to tund to minimise chance
of misdirected packets during mesh hopping.


Phase 1:
- Use DTLS.

Phase 2:
- Use application encryption.
- At this point, packet aggregation is difficult to perform, but we could then move to a local distribution model
as the file-distribution mechanism currently does. This would send the bulk to the gw where it gets broadcast.

-----------------------------------------------

./tools/c4-tools/coap_request.py --ctrlporthub :4002 --load-key client-key /Data/Temp/00-1B-C5-0C-60-04-FD-D6/node.key.der
./tools/c4-tools/coap_request.py --ctrlporthub :4002 --load-key client-cert /Data/Temp/00-1B-C5-0C-60-04-FD-D6/node.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4002 --load-key root-cert /Data/Temp/00-1B-C5-0C-60-04-FD-D6/ca.crt.der
./tools/c4-tools/coap_request.py --ctrlporthub :4002 --rll-key /Data/Temp/00-1B-C5-0C-60-04-FD-D6/mac_keys.txt



-------------------------------------------------

Hsch DV8@31c64L5a9a5S2000e2d8

Schedule task, Data access violation, @31c64.

Possible that discovery has not completed and s_alarmsProfile->deviceId has not been created yet.

Alarm crash on startup:

00031c2c <synthesizeMeterAlarm.part.13>:
        DeviceAlarmsIndication* alarmsInd = MALLOCZ(sizeof(DeviceAlarmsIndication));
   31c2c:   f241 1363   movw    r3, #4451   ; 0x1163
static bool synthesizeMeterAlarm( uint32_t alarmId )
   31c30:   b5f0        push    {r4, r5, r6, r7, lr}
   31c32:   b085        sub sp, #20
   31c34:   4607        mov r7, r0
        DeviceAlarmsIndication* alarmsInd = MALLOCZ(sizeof(DeviceAlarmsIndication));
   31c36:   9300        str r3, [sp, #0]
   31c38:   2201        movs    r2, #1
   31c3a:   4b1c        ldr r3, [pc, #112]  ; (31cac <synthesizeMeterAlarm.part.13+0x80>)
   31c3c:   2110        movs    r1, #16
   31c3e:   2000        movs    r0, #0
   31c40:   f013 fcd2   bl  455e8 <reallocWrapper>
        alarmsInd->numAlarms = 1;
   31c44:   2601        movs    r6, #1
        alarmsInd->raisedAlarms = MALLOCZ(alarmsInd->numAlarms * sizeof(uint32_t));
   31c46:   f241 1365   movw    r3, #4453   ; 0x1165
        DeviceAlarmsIndication* alarmsInd = MALLOCZ(sizeof(DeviceAlarmsIndication));
   31c4a:   4604        mov r4, r0
        alarmsInd->numAlarms = 1;
   31c4c:   6006        str r6, [r0, #0]
        alarmsInd->raisedAlarms = MALLOCZ(alarmsInd->numAlarms * sizeof(uint32_t));
   31c4e:   4632        mov r2, r6
   31c50:   2104        movs    r1, #4
   31c52:   9300        str r3, [sp, #0]
   31c54:   2000        movs    r0, #0
   31c56:   4b15        ldr r3, [pc, #84]   ; (31cac <synthesizeMeterAlarm.part.13+0x80>)
   31c58:   f013 fcc6   bl  455e8 <reallocWrapper>
        alarmsInd->deviceId = s_alarmsProfile->deviceId;
   31c5c:   4d14        ldr r5, [pc, #80]   ; (31cb0 <synthesizeMeterAlarm.part.13+0x84>)
        alarmsInd->raisedAlarms = MALLOCZ(alarmsInd->numAlarms * sizeof(uint32_t));
   31c5e:   6060        str r0, [r4, #4]
        alarmsInd->deviceId = s_alarmsProfile->deviceId;
   31c60:   682b        ldr r3, [r5, #0]
        (void)driverGetMeterTime(&meterTime);
   31c62:   a802        add r0, sp, #8
        alarmsInd->deviceId = s_alarmsProfile->deviceId;
   31c64:   689b        ldr r3, [r3, #8]                    <-------- crash here!


----------------------------------------------

stty -F /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0 9600 raw
stty -F /dev/serial/by-id/usb-FTDI_TTL232R_FT94TOL6-if00-port0 9600 raw
socat -x /dev/serial/by-id/usb-FTDI_KMK116_A5G6O7M-if00-port0,raw,echo=0,crnl /dev/serial/by-id/usb-FTDI_TTL232R_FT94TOL6-if00-port0,raw,echo=0,crnl

---------------------------------------------

Kaifa IPA3b:

baud rate over opto == 9600

Bad:

<HDLC len="32" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>

<HDLC len="32" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>

<HDLC len="65" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="68656C6C6F" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="65535" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

good:

<HDLC len="32" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>

<HDLC len="32" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>

<HDLC len="65" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--AARQ frame.-->
<FrameType Value="10" />
<PDU>
<AssociationRequest>
  <ApplicationContextName Value="LN" />
  <SenderACSERequirements Value="1" />
  <MechanismName Value="Low" />
  <CallingAuthentication Value="68656C6C6F" />
  <InitiateRequest>
    <ProposedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="Action" />
      <ConformanceBit Name="EventNotification" />
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="InformationReport" />
      <ConformanceBit Name="MultipleReferences" />
      <ConformanceBit Name="BlockTransferWithAction" />
      <ConformanceBit Name="BlockTransferWithSetOrWrite" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </ProposedConformance>
    <ProposedMaxPduSize Value="65535" />
  </InitiateRequest>
</AssociationRequest>
</PDU>
</HDLC>

<HDLC len="55" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--AARE frame.-->
<FrameType Value="30" />
<PDU>
<AssociationResponse>
  <ApplicationContextName Value="LN" />
  <AssociationResult Value="0" />
  <ResultSourceDiagnostic>
    <ACSEServiceUser Value="0" />
  </ResultSourceDiagnostic>
  <InitiateResponse>
    <NegotiatedDlmsVersionNumber Value="6" />
    <NegotiatedConformance>
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </NegotiatedConformance>
    <NegotiatedMaxPduSize Value="512" />
    <VaaName Value="7" />
  </InitiateResponse>
</AssociationResponse>
</PDU>
</HDLC>




< 2019/02/20 16:21:21.020877  length=11 from=23257 to=23267
 81 80 14 05 02 01 00 06 02 01 00
< 2019/02/20 16:21:21.036662  length=12 from=23268 to=23279
 07 04 00 00 00 01 08 04 00 00 00 01
< 2019/02/20 16:21:21.052658  length=3 from=23280 to=23282
 69 6d 7e
> 2019/02/20 16:21:21.124714  length=12 from=7700 to=7711
 7e a0 21 41 02 01 73 e8 fb 81 80 14
> 2019/02/20 16:21:21.140966  length=14 from=7712 to=7725
 05 02 01 00 06 02 01 00 07 04 00 00 00 01
> 2019/02/20 16:21:21.156804  length=9 from=7726 to=7734
 08 04 00 00 00 01 69 6d 7e
< 2019/02/20 16:21:21.212590  length=1 from=23283 to=23283
 7e
< 2019/02/20 16:21:21.228583  length=5 from=23284 to=23288
 a0 42 02 01 41
< 2019/02/20 16:21:21.244564  length=3 from=23289 to=23291
 10 72 8c
< 2019/02/20 16:21:21.260790  length=3 from=23292 to=23294
 e6 e6 00
< 2019/02/20 16:21:21.292534  length=10 from=23295 to=23304
 60 33 a1 09 06 07 60 85 74 05
< 2019/02/20 16:21:21.308487  length=16 from=23305 to=23320
 08 01 01 8a 02 07 80 8b 07 60 85 74 05 08 02 01
< 2019/02/20 16:21:21.324549  length=15 from=23321 to=23335
 ac 07 80 05 68 65 6c 6c 6f be 10 04 0e 01 00
< 2019/02/20 16:21:21.340318  length=12 from=23336 to=23347
 00 00 06 5f 1f 04 00 00 1f 1f ff ff
< 2019/02/20 16:21:21.356401  length=3 from=23348 to=23350
 e7 41 7e
< 2019/02/20 16:22:21.501025  length=3 from=23351 to=23353
 7e a0 21
< 2019/02/20 16:22:21.516946  length=3 from=23354 to=23356
 02 01 41
< 2019/02/20 16:22:21.532793  length=3 from=23357 to=23359
 93 9e 86
< 2019/02/20 16:22:21.548799  length=8 from=23360 to=23367
 81 80 14 05 02 01 00 06
< 2019/02/20 16:22:21.564915  length=15 from=23368 to=23382
 02 01 00 07 04 00 00 00 01 08 04 00 00 00 01
< 2019/02/20 16:22:21.580814  length=3 from=23383 to=23385
 69 6d 7e
> 2019/02/20 16:22:21.650523  length=14 from=7735 to=7748
 7e a0 21 41 02 01 73 e8 fb 81 80 14 05 02
> 2019/02/20 16:22:21.666419  length=14 from=7749 to=7762
 01 00 06 02 01 00 07 04 00 00 00 01 08 04
> 2019/02/20 16:22:21.682273  length=7 from=7763 to=7769
 00 00 00 01 69 6d 7e
< 2019/02/20 16:22:21.741013  length=3 from=23386 to=23388
 7e a0 42
< 2019/02/20 16:22:21.756574  length=3 from=23389 to=23391
 02 01 41
< 2019/02/20 16:22:21.772503  length=5 from=23392 to=23396
 10 72 8c e6 e6
< 2019/02/20 16:22:21.788718  length=1 from=23397 to=23397
 00
< 2019/02/20 16:22:21.820509  length=15 from=23398 to=23412
 60 33 a1 09 06 07 60 85 74 05 08 01 01 8a 02
< 2019/02/20 16:22:21.836486  length=15 from=23413 to=23427
 07 80 8b 07 60 85 74 05 08 02 01 ac 07 80 05
< 2019/02/20 16:22:21.852343  length=15 from=23428 to=23442
 68 65 6c 6c 6f be 10 04 0e 01 00 00 00 06 5f
< 2019/02/20 16:22:21.868623  length=10 from=23443 to=23452
 1f 04 00 00 1f 1f ff ff e7 41
< 2019/02/20 16:22:21.884383  length=1 from=23453 to=23453
 7e
< 2019/02/20 16:22:25.145025  length=3 from=23454 to=23456
 7e a0 21
< 2019/02/20 16:22:25.161296  length=4 from=23457 to=23460
 02 01 41 93
< 2019/02/20 16:22:25.177314  length=2 from=23461 to=23462
 9e 86
< 2019/02/20 16:22:25.193222  length=9 from=23463 to=23471
 81 80 14 05 02 01 00 06 02
< 2019/02/20 16:22:25.209020  length=14 from=23472 to=23485
 01 00 07 04 00 00 00 01 08 04 00 00 00 01
< 2019/02/20 16:22:25.225189  length=3 from=23486 to=23488
 69 6d 7e

> 2019/02/20 16:22:25.262203  length=3 from=7770 to=7772
 7e a0 21
> 2019/02/20 16:22:25.278267  length=14 from=7773 to=7786
 41 02 01 73 e8 fb 81 80 14 05 02 01 00 06
> 2019/02/20 16:22:25.294412  length=14 from=7787 to=7800
 02 01 00 07 04 00 00 00 01 08 04 00 00 00
> 2019/02/20 16:22:25.310651  length=4 from=7801 to=7804
 01 69 6d 7e

 7e a0 42
 02 01 41 10
 72 8c e6 e6 00
 60 33
 a1 09 06 07 60 85 74 05 08 01 01 8a 02 07 80 8b
 07 60 85 74 05 08 02 01 ac 07 80 05 68 65 6c
 6c 6f be 10 04 0e 01 00 00 00 06 5f 1f 04 00
 00 1f 1f ff ff e7 41 7e

 7e a0 21
 02 01 41 93
 9e 86
 81 80 14 05 02 01 00 06 02
 01 00 07 04 00 00 00 01 08 04 00 00 00 01
 69 6d 7e

 7e a0 21 41 02 01 73 e8
 fb 81 80 14 05 02 01 00 06 02 01 00 07 04
 00 00 00 01 08 04 00 00 00 01 69 6d 7e

 7e
 a0 42 02 01 41
 10 72 8c
 e6 e6 00
 60 33 a1 09 06 07 60 85 74 05 08
 01 01 8a 02 07 80 8b 07 60 85 74 05 08 02 01
 ac 07 80 05 68 65 6c 6c 6f be 10 04 0e 01 00
 00 00 06 5f 1f 04 00 00 1f 1f ff ff
 e7 41 7e



-------------------------------------------
performance monitoring:

iostat -x -c -d -t 1
mytop -umeshnet -pmeshnet sma
while [ true ]; do mytop -umeshnet -pmeshnet -b sma && sleep 1; done

/etc/mysql/mysql.conf.d/mysqld.cnf
slow_query_log_file = /var/log/mysql/mysql-slow.log
slow_query_log =1
long_query_time = 1
log-queries-not-using-indexes


----------------------------------------------------

grep -oP "Query_time: \K[\.0-9]+" | gnuplot -p -e 'set term pdf;set output "out.pdf";plot "/dev/stdin"'

grep -oP "Query_time: \K[\.0-9]+" mysql-slow.log | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "query duration";plot "-" with points ps 0.5 '

grep -oP "Rows_sent: \K[\.0-9]+" mysql-slow.log | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "rows sent";plot "-" with points ps 0.5 '

cat cpuStats.log | tr -s ' ' | cut -d ' ' -f 3

cat sda.log | tr -s ' ' | cut -d ' ' -f 8  | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "avgrq-sz";plot "-" with points ps 0.5 '

cat sda.log | tr -s ' ' | cut -d ' ' -f 7  | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "rwkB/s";plot "-" with points ps 0.5 '

cat cpuStats.log | tr -s ' ' | cut -d ' ' -f 5 | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "iowait";plot "-" with points ps 0.5 '
cat cpuStats.log | tr -s ' ' | cut -d ' ' -f 4 | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "system cpu usage";plot "-" with points ps 0.5 '
cat cpuStats.log | tr -s ' ' | cut -d ' ' -f 2 | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "user cpu usage";plot "-" with points ps 0.5 '

grep -oP "Rows_sent: \K[\.0-9]+" mysql-slow.log | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "rows sent";plot "-" with points ps 0.5 '
grep -oP "Lock_time: \K[\.0-9]+" mysql-slow.log | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "lock time";plot "-" with points ps 0.5 '
grep -oP "Rows_examined: \K[\.0-9]+" mysql-slow.log | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "rows examined";plot "-" with points ps 0.5 '
grep -oP "Query_time: \K[\.0-9]+" mysql-slow.log | gnuplot -p -e 'set term pdf;set output "out.pdf";set title "query duration";plot "-" with points ps 0.5 '



select devices0_.device_profile_id as device_p1_9_0_, devices0_.device_id as device_i2_5_0_, device1_.id as id1_2_1_, device1_.create_time as create_t2_2_1_, device1_.entity_version as entity_v3_2_1_, de
vice1_.update_time as update_t4_2_1_, device1_.add_ons as add_ons5_2_1_, device1_.device_alarm_profile_id as device_10_2_1_, device1_.device_id as device_i6_2_1_, device1_.device_node_id as device_11_2_1
_, device1_.device_type as device_12_2_1_, device1_.dns_updated as dns_upda7_2_1_, device1_.profiles_hash as profiles8_2_1_, device1_.vendor as vendor9_2_1_ from device_device_profile devices0_ inner joi
n device device1_ on devices0_.device_id=device1_.id where devices0_.device_profile_id=9;



243126 * 4 = 972504 (high point).

 # Time: 2019-02-22T12:05:34.641576Z
 # User@Host: meshnet[meshnet] @ localhost [127.0.0.1]  Id:   646
 # Query_time: 0.375120  Lock_time: 0.000084 Rows_sent: 17954  Rows_examined: 50622
 SET timestamp=1550837134;
 select devices0_.device_profile_id as device_p1_9_0_, devices0_.device_id as device_i2_5_0_,


Next high point.

# Time: 2019-02-22T17:31:31.207473Z
# User@Host: meshnet[meshnet] @ localhost [127.0.0.1]  Id:    58
# Query_time: 0.293978  Lock_time: 0.000173 Rows_sent: 29599  Rows_examined: 79833
SET timestamp=1550856691;
select devices0_.device_profile_id as device_p1_9_0_, devices0_.device_id as device_i2_5_0_, device1_.id as id1_2_1_, device1


 use smc;
 SET timestamp=1550857023;
 SELECT version FROM db_version;
 # Time: 2019-02-22T17:37:03.965202Z
 # User@Host: meshnet[meshnet] @ localhost [127.0.0.1]  Id:    65
 # Query_time: 0.001423  Lock_time: 0.001304 Rows_sent: 1  Rows_examined: 1
 use sma;
 SET timestamp=1550857023;
 SELECT version FROM db_version;


# Time: 2019-02-22T14:06:40.332966Z

# Time: 2019-02-22T17:37:03.965167Z

--------------------------------------------------------------

SMIP CRT056 (RLL key support) analysis

Agent has low-level multiple rll-key support (mac_security), also with CoAP interface to set/get the keys/index/preferredIndex.
Interface is defined (/rll-key & RllKeyMessage).
Server has generated code for RllKey protobufs, but no application-level support either in UI or API.
Tests do not exist for this functionality.

Changes required:
- Agent needs to read a table of keys and a preferred key index from the CH instead of a single key.
- Agent needs robustness here, possibly a roll-back operation if no comms? That might not be secure, possible fallback
- Agent needs to send event to C4 server on key-change operations.
- Agent-side library integration API documentation.

- CH needs mods to store table instead of single-key and we need updated code to be able to test against this.

- Regression tests for existing functionality given the current (untested) state.
- Test case for first use of key after manufacture.
- Test case for update of software from pre-mod to post-mod. Must maintain preferred key usage.
- Test case for refurbished/sanitised CH.
- Test case for key update test case.
- Test case for messages from unknown index to be dropped.
- Test case(s) for interrupted key update and recovery.
- Fuzz testing on agent (software).
- Fuzz testing of radio interface (CPA will want this with this change).
- Test for events received on server for key update.
- Test for end-to-end behaviour when update process interrupted at various points, in-transit, on Agent, loss of update events in transit?
- What level of testing have we currently done on C4 server regards CPA? Dont want to pull a thread here.
- Test effect on RPL with changing keys.
- Test effect on RPL with changing keys while mesh hopping (could be dragons here?).

- Interface protos need to have a key-config message. Should contain up to 8 keys/indices and a preferred key index.

- Server needs a new API (SOAP) endpoint to allow get/set of key-table. This needs to be restricted to a specific user-role (RllKeyProtos.java).
- Server needs a corresponding UI mod to provide ability to set/get key-table (upload/download file? no, file-get doesn't exist).
- Server needs to perform action on key-change event? not specified tho.
- Server-side API documentation.

- System Documentation. What do we currently have? For CPA AMP requirements, we need to justify all diffs. Failure scenarios
and recovery documentation. Test evidence, etc.

All data to be sent as one to maintain atomic-update/rollback.  to default key? or always leave default key in table? never overwrite?

RPL implications of multiple RLL key usage.

--------------------------------------------------------

2019-02-26 10:52:46.042 #1   001bc50c6001df12 <log> 0:38:44.348 [debug] [        hdlc] {   device}: tx: (1/1): 7e



 7e a0 21 41 02 01 73
> 2019/02/26 13:03:36.432381  length=14 from=16835 to=16848
 e8 fb 81 80 14 05 02 01 00 06 02 01 00 07
> 2019/02/26 13:03:36.448487  length=14 from=16849 to=16862
 04 00 00 00 01 08 04 00 00 00 01 69 6d 7e

< 2019/02/26 13:03:36.607558  length=14 from=8995 to=9008
 7e a0 21 02 01 41 93 9e 86 81 80 14 05 02
< 2019/02/26 13:03:36.623486  length=16 from=9009 to=9024
 01 5e 06 02 01 5e 07 04 00 00 00 01 08 04 00 00

> 2019/02/26 13:03:36.624278  length=14 from=16863 to=16876
 7e a1 21 02 01 41 93 9e 86 81 80 14 05 02

< 2019/02/26 13:03:36.639425  length=5 from=9025 to=9029
 00 01 51 af 7e

> 2019/02/26 13:03:36.640203  length=14 from=16877 to=16890
 01 5e 06 0a 21 5e 07 04 00 00 00 01 48 04
> 2019/02/26 13:03:36.658572  length=7 from=16891 to=16897
 00 00 00 01 51 af 7e
> 2019/02/26 13:03:36.704195  length=6 from=16898 to=16903
 7e a0 21 41 02 01
> 2019/02/26 13:03:36.720177  length=14 from=16904 to=16917
 73 e8 fb 81 80 14 05 02 01 00 06 02 01 00
> 2019/02/26 13:03:36.735938  length=14 from=16918 to=16931
 07 04 00 00 00 01 08 04 00 00 00 01 69 6d
> 2019/02/26 13:03:36.751919  length=1 from=16932 to=16932
 7e



 7e a0 21 02 01 41 93 9e 86 81 80 14 05 02
 01 5e 06 02 01 5e 07 04 00 00 00 01 08 04 00 00
 00 01 51 af 7e

 7e a1 21 02 01 41 93 9e 86 81 80 14 05 02
 01 5e 06 0a 21 5e 07 04 00 00 00 01 48 04
 00 00 00 01 51 af 7e

New:
7ea01f410201520a7ee6e700c4018100
090c07e3021a020c1a39ff003c007e1a
7e
Got time: 2019-02-26T12:26:57.000+01:00 0
Meter local timezone offset 60


Old:
7ea01f410201520a7ee6e700c4018100
090c07e3021a020e121fff8000007a44
7e
Got time: 2019-02-26T14:18:31.000-00:00 0


from old meter:
06040111 / 06010066
Got time: 2019-02-26T11:20:44.000-00:00 0       <--- Note the "-00".
Setting time: 2019-02-26T11:20:46.000+01:00 0

from new meter:
06040115 / 06010002
Got time: 2019-02-26T12:51:47.000+01:00 0
Setting time: 2019-02-26T14:51:50.000+01:00 0


Central European Time, 1 hour east from Greenwich, daylight saving starts
on  the  last  Sunday  in  March  at  2 AM and ends on the last Sunday in
October at 3 AM:

          TZ='CET-1CEST,M3.5.0/2,M10.5.0/3'


---------------------------------------------------------------

 Hsch DV0 @49b5c L4a6c7 S2000c7a8
vListInsert crash.



--------------------------------------------------------

16919 2019-02-28 10:33:57.749 #1   001bc50c6004fdd6 <log> 0:13:53.887 [debug] [meter/time_synch] {timeSynch}:  s_timeOfMeterGetRequest = 1551350032

CET-1CEST,M3.5.0/2,M10.5.0/3

Standard time:
CET = UTC+1
CET-1 = UTC+2

SummerTime:
CEST


(gdb) p s_tzinfo->rule[0]
$2 = {ch = 77 'M', m = 3, n = 5, d = 0, s = 7200, change = 1553994000, offset = -3600}
(gdb) p s_tzinfo->rule[1]
$3 = {ch = 77 'M', m = 10, n = 5, d = 0, s = 10800, change = 1572138000, offset = -7200}

07E3 02 1C 04 0E 0A 0E FF FFC4 00


--------------------------------------------

7e a0 1d 02 01 41 54 cc 97 e6 e6 00 c1 01 81 00 08 00 00 01 00 00 ff 03 00 10 00 3c 21 13 7e

<HDLC len="28" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="54" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--CLOCK-->
      <ClassId Value="8" />
      <!--0.0.1.0.0.255-->
      <InstanceId Value="0000010000FF" />
      <AttributeId Value="3" />
    </AttributeDescriptor>
    <Value>
      <Int16 Value="60" />
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>


---------------------------------------------------------------

tObisCode (format=<optimized out>, value=<optimized out>, writer=<optimized out>)
    at src/platform/core/jprintf.c:262
262     formatUnsignedLongLongDecimal(writer, value[0], format);
(gdb) where
#0  formatObisCode (format=<optimized out>, value=<optimized out>, writer=<optimized out>)
    at src/platform/core/jprintf.c:262
#1  jvsprintf (args=..., formatString=0x701cb "On demand response failed for profile %po: %s",
    writer=0x2000a454 <s_deviceStack+2716>) at src/platform/core/jprintf.c:534
#2  jvsnprintf (buf=buf@entry=0x2000e555 <s_logBuf> "On demand response failed for profile  B/entry)",
    bufSize=bufSize@entry=200, formatString=0x701cb "On demand response failed for profile %po: %s",
    formatString@entry=0x20012198 "", args=..., args@entry=...) at src/platform/core/jprintf.c:579
#3  0x000453d4 in logFormatted (level=level@entry=cnd_LogLevelDebug,
    module=module@entry=0x6ff67 "meter/dlms",
    format=0x701cb "On demand response failed for profile %po: %s") at src/platform/core/log.c:194
#4  0x000308ae in onDemandResponseRegesterFillError (
    message=0x701f9 "Response is timeout on OnDemandRequest", msg=0x20013190)
    at src/device/drivers/dlms/device-dlms.c:1369
#5  dropMessage (msg=0x20013190) at src/device/drivers/dlms/device-dlms.c:715
#6  0x0003094c in requestCompleted (drop=drop@entry=true) at src/device/drivers/dlms/device-dlms.c:801
#7  0x00032796 in deviceTask (arg=<optimized out>) at src/device/drivers/dlms/device-dlms.c:4308
#8  0x0005b920 in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)


---------------------------------------------------------

./tools/c4-tools/coap_request.py --logmatch 1 "mac_tx" ""
./tools/c4-tools/coap_request.py --log


or from server:

./tools/c4-tools/coap_request.py --server localhost:8080 --agent <ipv6> --logmatch 1 "mac_tx" ""
./tools/c4-tools/coap_request.py --server localhost:8080 --agent <ipv6> --log


--------------------------

extend display

xrandr --output HDMI-1 --auto --right-of eDP-1

-----------------------------------------------

File distribution improvements:

- more broadcast, less fill-in
- order by hop? inside->out or outside->in? attempt to minimise mesh disturbance.
- timed/synchronised activation.
- Drip-feed broadcast to minimise disturbance of upstream traffic.
- "per-gateway" timing parameters. The optimal will be different in every environment & topology.
- On NMS, per-gateway concurrency, not per-node.
- Putting a limit on max nodes per-gateway also limits the efficiency, instead we should strictly control the
reboot ordering.
-


------------------------

Sniffer

make host-agent
builds CONFIG_EXAMPLE_APPS
sniffer in:
src/c4-examples/sniffer/
build/hw1/bin/sniffer.elf

New ipa3-sniffer or ipa1-sniffer:
./build/host-ctrlporthub/bin/ctrlporthub -controllerport 4001 -serial /dev/serial/by-id/usb-FTDI_TTL232R_FTG4DKEY-if00-port0 -loglevel debug -radiocapture radio.pcap -loglevel debug -inetcapture inet.bin

use WireShark to open radio.pcap


---------------------------------


2019-03-06 11:12:48.228 #1   001bc50c6001df12 <log> 41:36:29.544 [debug] [        dlms] {timeSynch}: Get 0-0:1.0.0*255 ic 8 attr 2 normal access
2019-03-06 11:12:48.310 #1   001bc50c6001df12 <log> 41:36:29.603 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e
2019-03-06 11:12:48.310 #1   001bc50c6001df12 <log> 41:36:29.609 [debug] [        hdlc] {timeSynch}: tx: (1/1): a01a
2019-03-06 11:12:48.310 #1   001bc50c6001df12 <log> 41:36:29.616 [debug] [        hdlc] {timeSynch}: tx: (1/1): 0201
2019-03-06 11:12:48.310 #1   001bc50c6001df12 <log> 41:36:29.622 [debug] [        hdlc] {timeSynch}: tx: (1/1): 41
2019-03-06 11:12:48.310 #1   001bc50c6001df12 <log> 41:36:29.629 [debug] [        hdlc] {timeSynch}: tx: (1/1): 32
2019-03-06 11:12:48.310 #1   001bc50c6001df12 <log> 41:36:29.635 [debug] [        hdlc] {timeSynch}: tx: (1/1): 20a1
2019-03-06 11:12:48.353 #1   001bc50c6001df12 <log> 41:36:29.662 [debug] [        hdlc] {timeSynch}: tx: (1/1): e6e600
2019-03-06 11:12:48.353 #1   001bc50c6001df12 <log> 41:36:29.669 [debug] [        hdlc] {timeSynch}: tx: (1/1): c0018100080000010000ff0200
2019-03-06 11:12:48.353 #1   001bc50c6001df12 <log> 41:36:29.677 [debug] [        hdlc] {timeSynch}: tx: (1/1): 65d7
2019-03-06 11:12:48.380 #1   001bc50c6001df12 <log> 41:36:29.684 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e
2019-03-06 11:12:48.380 #1   001bc50c6001df12 <log> 41:36:29.697 [debug] [meter/time_synch] {timeSynch}: s_timeOfMeterGetRequest = 1554545201
2019-03-06 11:12:48.446 #1   001bc50c6001df12 <log> 41:36:29.739 [debug] [        hdlc] {     hdlc}: ** giveCause = 3, 1 **
2019-03-06 11:12:48.446 #1   001bc50c6001df12 <log> 41:36:29.746 [debug] [        hdlc] {     hdlc}: rx: (1/3): 7ea01f410201520a7ee6e700c4018100
2019-03-06 11:12:48.446 #1   001bc50c6001df12 <log> 41:36:29.755 [debug] [        hdlc] {     hdlc}: rx: (2/3): 090c07e30406060b0928ff00788016c8
2019-03-06 11:12:48.446 #1   001bc50c6001df12 <log> 41:36:29.764 [debug] [        hdlc] {     hdlc}: rx: (3/3): 7e
2019-03-06 11:12:48.446 #1   001bc50c6001df12 <log> 41:36:29.771 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
2019-03-06 11:12:48.500 #1   001bc50c6001df12 <log> 41:36:29.779 [debug] [        dlms] {     dlms}: DLMS result is 14 bytes with code 0


<HDLC len="30" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--I frame.-->

<PDU>
<GetResponse>
<GetResponseNormal>
<InvokeIdAndPriority Value="129" />
<Result>
  <Data>
    <!--2019-04-06 11:09:40-->
    <OctetString Value="07E30406060B0928FF007880" />
  </Data>
</Result>
</GetResponseNormal>
</GetResponse>
</PDU>
</HDLC>

07E30406060B0928FF007880


2019-03-06 11:12:48.500 #1   001bc50c6001df12 <log> 41:36:29.788 [debug] [meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from time synch
2019-03-06 11:12:48.500 #1   001bc50c6001df12 <log> 41:36:29.798 [debug] [meter/time_synch] {timeSynch}:  s_timeOfMeterGetRequest = 1554545381
2019-03-06 11:12:48.500 #1   001bc50c6001df12 <log> 41:36:29.807 [ info] [meter/common] {timeSynch}: Got time: 2019-04-06T11:09:40.000+02:00 0
2019-03-06 11:12:48.500 #1   001bc50c6001df12 <log> 41:36:29.816 [debug] [meter/common] {timeSynch}: Meter local timezone offset 120

2019-03-06 11:12:49.267 #1   001bc50c6001df12 <log> 41:36:30.550 [debug] [meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from time synch
2019-03-06 11:12:49.267 #1   001bc50c6001df12 <log> 41:36:30.560 [debug] [meter/time_synch] {timeSynch}: localDeviation = -7200 meterDeviation=7200
2019-03-06 11:12:49.267 #1   001bc50c6001df12 <log> 41:36:30.570 [debug] [meter/time_synch] {timeSynch}: localNow = 1554552582 meterNow = 1554541780 diff=10802 utc=1554545382
2019-03-06 11:12:49.267 #1   001bc50c6001df12 <log> 41:36:30.582 [debug] [meter/time_synch] {timeSynch}: s_timeOfMeterSetRequest = 1554545382
2019-03-06 11:12:49.267 #1   001bc50c6001df12 <log> 41:36:30.591 [debug] [meter/time_synch] {timeSynch}: timeBetweenGetAndSet = 1
2019-03-06 11:12:49.304 #1   001bc50c6001df12 <log> 41:36:30.599 [debug] [meter/time_synch] {timeSynch}: Clock drift is 3601 seconds

localNow = 1554552582
meterNow = 1554541780
diff=10802
utc = 1554545382

meterNow - utcNow = 10802
localNow - utcNow = 7200
meterNow - localNow = 3602


(gdb) p s_meterTime
$2 = {time = 1554541780, timeDeviation = 120, isTimeOk = true}

(gdb) p *dateTime
$8 = {date = {year = 2019, month = 4 '\004', dom = 6 '\006', dow = 6 '\006'}, time = {hour = 11 '\v', min = 9 '\t', sec = 40 '(',
    hund = 0 '\000'}, dev = 120, clockStatus = 128 '\200'}

32          meterTime->time = dlmsGetEpochTime(&tsMeter);
(gdb) p tsMeter
$10 = {date = {year = 2019, month = 4 '\004', dom = 6 '\006', dow = 6 '\006'}, time = {hour = 11 '\v', min = 9 '\t', sec = 40 '(',
    hund = 0 '\000'}, dev = 120, clockStatus = 128 '\200'}



2019-03-06 11:12:49.369 #1   001bc50c6001df12 <log> 41:36:30.681 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e
2019-03-06 11:12:49.369 #1   001bc50c6001df12 <log> 41:36:30.688 [debug] [        hdlc] {timeSynch}: tx: (1/1): a028
2019-03-06 11:12:49.369 #1   001bc50c6001df12 <log> 41:36:30.694 [debug] [        hdlc] {timeSynch}: tx: (1/1): 0201
2019-03-06 11:12:49.412 #1   001bc50c6001df12 <log> 41:36:30.701 [debug] [        hdlc] {timeSynch}: tx: (1/1): 41
2019-03-06 11:12:49.412 #1   001bc50c6001df12 <log> 41:36:30.707 [debug] [        hdlc] {timeSynch}: tx: (1/1): 32
2019-03-06 11:12:49.412 #1   001bc50c6001df12 <log> 41:36:30.714 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7963
2019-03-06 11:12:49.412 #1   001bc50c6001df12 <log> 41:36:30.721 [debug] [        hdlc] {timeSynch}: tx: (1/1): e6e600
2019-03-06 11:12:49.412 #1   001bc50c6001df12 <log> 41:36:30.728 [debug] [        hdlc] {timeSynch}: tx: (1/2): c1018100080000010000ff0200090c07
2019-03-06 11:12:49.412 #1   001bc50c6001df12 <log> 41:36:30.737 [debug] [        hdlc] {timeSynch}: tx: (2/2): e30406060c092aff007880
2019-03-06 11:12:49.433 #1   001bc50c6001df12 <log> 41:36:30.745 [debug] [        hdlc] {timeSynch}: tx: (1/1): 17d2
2019-03-06 11:12:49.433 #1   001bc50c6001df12 <log> 41:36:30.751 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e




 len="39" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="32" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--CLOCK-->
      <ClassId Value="8" />
      <!--0.0.1.0.0.255-->
      <InstanceId Value="0000010000FF" />
      <AttributeId Value="2" />
    </AttributeDescriptor>
    <Value>
      <!--2019-04-06 12:09:42-->
      <OctetString Value="07E30406060C092AFF007880" />
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>
</HDLC>



2019-03-06 11:12:48.500 #1   001bc50c6001df12 <log> 41:36:29.807 [ info] [meter/common] {timeSynch}: Got time: 2019-04-06T11:09:40.000+02:00 0

time from meter = 11:09 + 2     (local)
                =  9:09         (UTC)


2019-03-06 11:12:49.267 #1   001bc50c6001df12 <log> 41:36:30.570 [debug] [meter/time_synch] {timeSynch}: localNow = 1554552582 meterNow = 1554541780 diff=10802 utc= 1554545382
(Saturday, 6 April 2019 10:09:42)

Time on node (truth)    = 12:09 (local)
                        = 10:09 (UTC)


Therefore meter has drift of 12:09->11:09 = -3600 (its gone back 1 hr).

So, relative difference = -3600 (for adjust operation)
or  absolute value      = 12:09 + 2     (local)

Set operation was:
2019-03-06 11:12:49.304 #1   001bc50c6001df12 <log> 41:36:30.607 [ info] [meter/common] {timeSynch}: Setting time: 2019-04-06T12:09:42.000+02:00 0








--------------------------------------

unit test

b testRecordFailure



---------------------------------

Kaifa HW1
~/node83.log
019-03-08 10:16:52.698 #1   001bc50c6004fdd6 <log> 0:38:19.920 [debug] [meter/kaifaMa304] {     hdlc}: dlmsReceiveCb called with s_rxRes=0
2019-03-08 10:16:52.746 #1   001bc50c6004fdd6 <log> 0:38:19.929 [debug] [meter/kaifaMa304] {     hdlc}: dlmsReceiveCb called with s_rxRes=0
2019-03-08 10:16:52.746 #1   001bc50c6004fdd6 <log> 0:38:19.938 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
2019-03-08 10:16:52.746 #1   001bc50c6004fdd6 <log> 0:38:19.946 [debug] [meter/kaifaMa304] {   device}: Received Alarm Indication Mask 83910853
2019-03-08 10:16:52.746 #1   001bc50c6004fdd6 <log> 0:38:19.956 [debug] [device_alarms] {   device}: Alarms state changed for device 7340157030078388
2019-03-08 10:16:52.746 #1   001bc50c6004fdd6 <log> 0:38:19.970 [debug] [      fs_api] {   device}: fsOpen (/mq/009.mq, mode=3, fd=4)
2019-03-08 10:16:52.790 #1   001bc50c6004fdd6 <log> 0:38:19.979 [ WARN] [        uffs] {   device}: pbuf: parent or serial in dirty pages buffer are not the same ?
2019-03-08 10:16:52.790 #1   001bc50c6004fdd6 <log> 0:38:19.989 [ WARN] [        uffs] {   device}: fs  : write inter data fail!
2019-03-08 10:16:52.790 #1   001bc50c6004fdd6 <log> 0:38:19.997 [ WARN] [        uffs] {   device}: pbuf: parent or serial in dirty pages buffer are not the same ?
2019-03-08 10:16:52.790 #1   001bc50c6004fdd6 <log> 0:38:20.008 [debug] [      fs_api] {   device}: fsClose (fd=4)
2019-03-08 10:16:52.790 #1   001bc50c6004fdd6 <log> 0:38:20.015 [ERROR] [   mqstorage] {   device}: Failed to write m# 2285340 of size 44 to /mq/009.mq
2019-03-08 10:16:52.833 #1   001bc50c6004fdd6 <log> 0:38:20.025 [debug] [    hdlclock] {   device}: -- unlocking HDLC --
2019-03-08 10:16:52.833 #1   001bc50c6004fdd6 <log> 0:38:20.032 [debug] [        hdlc] {   device}: disconnectLink 0x0
2019-03-08 10:16:52.833 #1   001bc50c6004fdd6 <log> 0:38:20.039 [debug] [        hdlc] {   device}: Disconnect HDLC link
2019-03-08 10:16:52.833 #1   001bc50c6004fdd6 <log> 0:38:20.046 [debug] [    hdlclock] {   device}: -- HDLC locked --
2019-03-08 10:16:52.833 #1   001bc50c6004fdd6 <log> 0:38:20.053 [debug] [        hdlc] {   device}: Connect HDLC link
2019-03-08 10:16:52.833 #1   001bc50c6004fdd6 <log> 0:38:20.060 [debug] [        hdlc] {   device}: tx: (1/1): 7e
2019-03-08 10:16:52.876 #1   001bc50c6004fdd6 <log> 0:38:20.066 [debug]

--------------------------------------------------

(gdb) where
#0  0x0806f294 in memcmp ()
#1  0x08048966 in dlmsGetDateTime (payload=payload@entry=0x0, payloadLen=payloadLen@entry=0, dateTime=dateTime@entry=0x2000d51c <s_timeSynchStack+2988>) at src/device/communication/dlms/dlms.c:2021
#2  0x08046546 in handleMeterTime (data=0x0, dataLen=0, meterTime=meterTime@entry=0x2000c938 <s_meterTime>) at src/device/drivers/dlms-common/device-dlms-common.c:30
#3  0x0804635e in processDlmsPayload () at src/device/drivers/dlms/time-synch/time_synch.c:324
#4  timeSynchTask (arg=<optimized out>) at src/device/drivers/dlms/time-synch/time_synch.c:398
#5  0x08065a38 in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)



<HDLC len="35" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="54" />
<NextFrame Value="6215800100BE10040E01000000065F1F0400001F1FFFFF" />
</HDLC>

<HDLC len="35" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--I frame.-->
<FrameType Value="74" />
<PDU>
<ReleaseResponse>
  <Reason Value="Normal" />
  <InitiateResponse>
    <NegotiatedDlmsVersionNumber Value="6" />
    <ProposedConformance>
      <ConformanceBit Name="SelectiveAccess" />
      <ConformanceBit Name="Set" />
      <ConformanceBit Name="Get" />
      <ConformanceBit Name="BlockTransferWithGetOrRead" />
    </NegotiatedConformance>
    <NegotiatedMaxPduSize Value="512" />
    <VaaName Value="7" />
  </InitiateResponse>
</ReleaseResponse>
</PDU>
</HDLC>

<HDLC len="31" >
<TargetAddress Value="0" />
<SourceAddress Value="0" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>

<HDLC len="31" >
<TargetAddress Value="0" />
<SourceAddress Value="0" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="256" />
  <MaxInfoRX Value="256" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>

<HDLC len="9" >
<TargetAddress Value="0" />
<SourceAddress Value="0" />
<!--S frame.-->
<FrameType Value="13" />
<Command Value="NextFrame" />
</HDLC>


requestAlarmsMask();



-----------------------------------------------------------

[meter/time_synch] {timeSynch}: ** Setting DST daylight_savings_end **
[        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 6 valueLen 14 B
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a028
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): ba
[        hdlc] {timeSynch}: tx: (1/1): 396b
[        hdlc] {timeSynch}: tx: (1/1): e6e600
[        hdlc] {timeSynch}: tx: (1/2): c1018100080000010000ff0600090cff
[        hdlc] {timeSynch}: tx: (2/2): ff0afe07030000ff800000
[        hdlc] {timeSynch}: tx: (1/1): 2257
[        hdlc] {timeSynch}: tx: (1/1): 7e
[meter/time_synch] {timeSynch}: (out) s_clockState = 5
[        hdlc] {     hdlc}: ACTION_WAIT_FOR_RESPONSE
[        hdlc] {     hdlc}: rx: (1/2): 7ea011410201daf217e6e700c5018100
[        hdlc] {     hdlc}: rx: (2/2): 36cf7e
[        hdlc] {     hdlc}: HDLC_TYPE_I
[        hdlc] {     hdlc}: Passing IFrame up the stack to the DLMS task.
[        hdlc] {     hdlc}: !! Result == ResultOK !!
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from time synch (0b 0x0)
[meter/time_synch] {timeSynch}: Previous step was ok, continuing with sequence.
[meter/time_synch] {timeSynch}: ** Time sync complete **

At this point, everything is good, time-sync has just finished, so we disconnect the link.

[    modemdrv] {    modem}: Not present
[       modem] {    modem}: Unknown -> Unknown
[    modemdrv] {    modem}: Not present
[        dlms] {timeSynch}: Disconnect HDLC link
[        hdlc] {timeSynch}: tx: (1/1): 7e
[        hdlc] {timeSynch}: tx: (1/1): a008
[        hdlc] {timeSynch}: tx: (1/1): 0201
[        hdlc] {timeSynch}: tx: (1/1): 41
[        hdlc] {timeSynch}: tx: (1/1): 53
[        hdlc] {timeSynch}: tx: (1/1): 6771
[        hdlc] {timeSynch}: tx: (1/1): 7e

Disconnect request sent
We now expect a UA from the meter in response.

[meter/time_synch] {timeSynch}: (out) s_clockState = 0
[        hdlc] {     hdlc}: ACTION_WAIT_FOR_RESPONSE
[        hdlc] {     hdlc}: rx: (1/3): 7ea02141020173e8fb81801405020100
[        hdlc] {     hdlc}: rx: (2/3): 06020100070400000001080400000001
[        hdlc] {     hdlc}: rx: (3/3): 696d7e
[        hdlc] {     hdlc}: HDLC_TYPE_UA
[        hdlc] {     hdlc}: HDLC link disconnected

UA received from meter, we're now disconnected.

[        hdlc] {     hdlc}: !! Result == ResultOK !!
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        dlms] {     dlms}: DLMS result is 0 bytes with code 0
[meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from time synch (0b 0x0)
[    hdlclock] {timeSynch}: -- unlocking HDLC --
[        hdlc] {timeSynch}: disconnectLink 0x0
[        hdlc] {   device}: disconnectLink 0x0

duplicate disconnectLink here.

[        hdlc] {   device}: Connect HDLC link
[        hdlc] {   device}: tx: (1/1): 7e
[        hdlc] {   device}: tx: (1/1): a020
[        hdlc] {   device}: tx: (1/1): 01
[        hdlc] {   device}: tx: (1/1): 01
[        hdlc] {   device}: tx: (1/1): 93
[        hdlc] {   device}: tx: (1/1): f64f
[        hdlc] {   device}: tx: (1/2): 81801405020100060201000704000000
[        hdlc] {   device}: tx: (2/2): 01080400000001
[        hdlc] {   device}: tx: (1/1): 696d
[        hdlc] {   device}: tx: (1/1): 7e

SNRM sent.

[        hdlc] {     hdlc}: ACTION_WAIT_FOR_RESPONSE
[        hdlc] {     hdlc}: rx: (1/3): 7ea020010173f8a88180140502010006
[        hdlc] {     hdlc}: rx: (2/3): 02010007040000000108040000000169
[        hdlc] {     hdlc}: rx: (3/3): 6d7e
[        hdlc] {     hdlc}: HDLC_TYPE_UA

UA received, we're now disconnected.

[        hdlc] {     hdlc}: tx: (1/1): 7e
[        hdlc] {     hdlc}: tx: (1/1): a007
[        hdlc] {     hdlc}: tx: (1/1): 01
[        hdlc] {     hdlc}: tx: (1/1): 01
[        hdlc] {     hdlc}: tx: (1/1): 13
[        hdlc] {     hdlc}: tx: (1/1): 8c13
[        hdlc] {     hdlc}: tx: (1/1): 7e


We sent the special frame to retrieve the push data.

<HDLC len="9" >
<TargetAddress Value="0" />
<SourceAddress Value="0" />
<!--S frame.-->
<FrameType Value="13" />
<Command Value="NextFrame" />
</HDLC>


[        hdlc] {     hdlc}: !! Result == ResultOK !!
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[        hdlc] {     hdlc}: ACTION_WAIT_FOR_RESPONSE
[        hdlc] {     hdlc}: rx: (1/1): 7ea00c01011002e1e6e7009eb47e
[        hdlc] {     hdlc}: HDLC_TYPE_I

In response to the special message, we get this packet, presumably the push data.
7e a00c 01 011002e1 e6e700 9eb4 7e

./HDLCToPDU.py 7ea00c01011002e1e6e7009eb47e
<HDLC>
  <controlField value="10" />
  <frameFormat value="a000,12" />
  <src value="1" />
  <dst value="1" />
  <LLC value="e6" />
  <HCS value="2e1" />
  <PDU value="" />
  <FCS value="9eb4" />
</HDLC>

[        hdlc] {     hdlc}: Passing IFrame up the stack to the DLMS task.
[meter/kaifaMa304] {     hdlc}: dlmsReceiveCb called with s_rxRes=0 from dev dlms (0b 0x0)
[meter/kaifaMa304] {     hdlc}: previous message *NOT* processed, *NOT* ok to proceed.



---------------

 !! (probably) ISR triggered hdlcSend  !!

SNRM->
<-UA

NextFrame->
<-PushData




7ea020010173f8a88180140502010006 02010007040000000108040000000169 6d7e

at receiveCb when previous message has not been processed:

#0  receiveCb (payload=0x20019d88 "\017@", len=34, res=<optimized out>) at src/device/drivers/kaifa_ma304/device-kaifa_ma304.c:584
#1  0x08047510 in processHdlcUAFrame (header=<optimized out>) at src/device/communication/hdlc/hdlc.c:1077
#2  processHdlcMacFrame (header=0x2000dbc8 <s_hdlcStack+1136>) at src/device/communication/hdlc/hdlc.c:1178
#3  parseMac (bb=0x20019de8) at src/device/communication/hdlc/hdlc.c:1356
#4  processRxMessage () at src/device/communication/hdlc/hdlc.c:1377
#5  hdlcReaderTask (arg=<optimized out>) at src/device/communication/hdlc/hdlc.c:1452
#6  0x080660b4 in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251

-----------------------------------


void test()
{
    ASSERT( timeIsNearDSTBoundary( 1552126538, 100 ) == false );
    ASSERT( timeIsNearDSTBoundary( 1572145200, 100 ) == true );
    ASSERT( timeIsNearDSTBoundary( 1554001200, 100 ) == true );

    ASSERT( timeIsNearDSTBoundary( 1572145200-101, 100 ) == false );
    ASSERT( timeIsNearDSTBoundary( 1554001200-101, 100 ) == false );

    ASSERT( timeIsNearDSTBoundary( 1572145200+101, 100 ) == false );
    ASSERT( timeIsNearDSTBoundary( 1554001200+101, 100 ) == false );

    ASSERT( timeIsNearDSTBoundary( 1572145200-99, 100 ) == true );
    ASSERT( timeIsNearDSTBoundary( 1554001200-99, 100 ) == true );

    ASSERT( timeIsNearDSTBoundary( 1572145200+99, 100 ) == true );
    ASSERT( timeIsNearDSTBoundary( 1554001200+99, 100 ) == true );
}




-------------------------------------

2019-03-11 17:40:30.040 #4   001bc50c6001df12 <log> 2:46:15.911 [debug] [        dlms] {     dlms}: COSEM AA with LLS setup is accepted
2019-03-11 17:40:30.040 #4   001bc50c6001df12 <log> 2:46:15.919 [debug] [        dlms] {     dlms}: extracted server max pdu size is 512
2019-03-11 17:40:30.041 #4   001bc50c6001df12 <log> 2:46:15.928 [debug] [        dlms] {     dlms}: DLMS result is 0 bytes with code 0
2019-03-11 17:40:30.083 #4   001bc50c6001df12 <log> 2:46:15.936 [debug] [meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=0 from time synch (0 bytes 0x0)
2019-03-11 17:40:30.084 #4   001bc50c6001df12 <log> 2:46:15.947 [debug] [meter/time_synch] {timeSynch}: localDeviation = -3600 meterDeviation=3600
2019-03-11 17:40:30.084 #4   001bc50c6001df12 <log> 2:46:15.957 [debug] [meter/time_synch] {timeSynch}: localNow = 1553993602 meterNow = 1553983237 diff=10365 utc=1553990002
2019-03-11 17:40:30.084 #4   001bc50c6001df12 <log> 2:46:15.969 [debug] [meter/time_synch] {timeSynch}: s_timeOfMeterSetRequest = 1553990002
2019-03-11 17:40:30.125 #4   001bc50c6001df12 <log> 2:46:15.978 [debug] [meter/time_synch] {timeSynch}: timeBetweenGetAndSet = 1
2019-03-11 17:40:30.126 #4   001bc50c6001df12 <log> 2:46:15.986 [debug] [meter/time_synch] {timeSynch}: Clock drift is -6764 seconds
2019-03-11 17:40:30.126 #4   001bc50c6001df12 <log> 2:46:15.994 [ info] [meter/common] {timeSynch}: Setting time: 2019-03-31T00:53:22.000+01:00 0
2019-03-11 17:40:30.126 #4   001bc50c6001df12 <log> 2:46:16.004 [debug] [        dlms] {timeSynch}: Set 0-0:1.0.0*255 ic 8 attr 2 valueLen 14 B
2019-03-11 17:40:30.206 #4   001bc50c6001df12 <log> 2:46:16.063 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e
2019-03-11 17:40:30.206 #4   001bc50c6001df12 <log> 2:46:16.069 [debug] [        hdlc] {timeSynch}: tx: (1/1): a028
2019-03-11 17:40:30.206 #4   001bc50c6001df12 <log> 2:46:16.076 [debug] [        hdlc] {timeSynch}: tx: (1/1): 0201
2019-03-11 17:40:30.206 #4   001bc50c6001df12 <log> 2:46:16.082 [debug] [        hdlc] {timeSynch}: tx: (1/1): 41
2019-03-11 17:40:30.206 #4   001bc50c6001df12 <log> 2:46:16.089 [debug] [        hdlc] {timeSynch}: tx: (1/1): 32
2019-03-11 17:40:30.206 #4   001bc50c6001df12 <log> 2:46:16.095 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7963
2019-03-11 17:40:30.253 #4   001bc50c6001df12 <log> 2:46:16.102 [debug] [        hdlc] {timeSynch}: tx: (1/1): e6e600
2019-03-11 17:40:30.254 #4   001bc50c6001df12 <log> 2:46:16.109 [debug] [        hdlc] {timeSynch}: tx: (1/2): c1018100080000010000ff0200090c07
2019-03-11 17:40:30.254 #4   001bc50c6001df12 <log> 2:46:16.118 [debug] [        hdlc] {timeSynch}: tx: (2/2): e3031f00003516ff003c00
2019-03-11 17:40:30.254 #4   001bc50c6001df12 <log> 2:46:16.126 [debug] [        hdlc] {timeSynch}: tx: (1/1): a187
2019-03-11 17:40:30.254 #4   001bc50c6001df12 <log> 2:46:16.133 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e
2019-03-11 17:40:30.269 #4   001bc50c6001df12 <log> 2:46:16.150 [debug] [meter/time_synch] {timeSynch}: (out) s_clockState = 1
2019-03-11 17:40:30.322 #4   001bc50c6001df12 <log> 2:46:16.178 [debug] [        hdlc] {     hdlc}: rx: (1/2): 7ea01141020152b21fe6e700c50181fa
2019-03-11 17:40:30.322 #4   001bc50c6001df12 <log> 2:46:16.187 [debug] [        hdlc] {     hdlc}: rx: (2/2): e3977e
2019-03-11 17:40:30.322 #4   001bc50c6001df12 <log> 2:46:16.194 [debug] [        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
2019-03-11 17:40:30.322 #4   001bc50c6001df12 <log> 2:46:16.203 [ WARN] [        dlms] {     dlms}: Data access result: other reason
2019-03-11 17:40:30.322 #4   001bc50c6001df12 <log> 2:46:16.211 [ WARN] [        dlms] {     dlms}: processXDlmsApdu(4 B): failed
2019-03-11 17:40:30.369 #4   001bc50c6001df12 <log> 2:46:16.219 [debug] [        dlms] {     dlms}: DLMS result is 0 bytes with code 12
2019-03-11 17:40:30.369 #4   001bc50c6001df12 <log> 2:46:16.228 [debug] [meter/time_synch] {     dlms}: dlmsReceiveCb called with s_rxRes=12 from time synch (0 bytes 0x0)
2019-03-11 17:40:30.369 #4   001bc50c6001df12 <log> 2:46:16.239 [ WARN] [meter/time_synch] {timeSynch}: Broken response: check failed
2019-03-11 17:40:30.370 #4   001bc50c6001df12 <log> 2:46:16.247 [ WARN] [meter/time_synch] {timeSynch}: Time-sync step 1 failed (check failed)
2019-03-11 17:40:30.450 #4   001bc50c6001df12 <log> 2:46:16.307 [debug] [        dlms] {timeSynch}: Disconnect HDLC link
2019-03-11 17:40:30.450 #4   001bc50c6001df12 <log> 2:46:16.314 [debug] [        hdlc] {timeSynch}: tx: (1/1): 7e
2019-03-11 17:40:30.450 #4   001bc50c6001df12 <log> 2:46:16.320 [debug] [        hdlc] {timeSynch}: tx: (1/1): a008


<HDLC len="39" >
<TargetAddress Value="128" />
<SourceAddress Value="32" />
<!--I frame.-->
<FrameType Value="32" />
<PDU>
<SetRequest>
  <SetRequestNormal>
    <InvokeIdAndPriority Value="129" />
    <AttributeDescriptor>
      <!--CLOCK-->
      <ClassId Value="8" />
      <!--0.0.1.0.0.255-->
      <InstanceId Value="0000010000FF" />
      <AttributeId Value="2" />
    </AttributeDescriptor>
    <Value>
      <!--2019-03-31 00:53:22-->
      <OctetString Value="07E3031F00003516FF003C00" />
    </Value>
  </SetRequestNormal>
</SetRequest>
</PDU>

</HDLC>
<HDLC len="16" >
<TargetAddress Value="32" />
<SourceAddress Value="128" />
<!--I frame.-->
<FrameType Value="52" />
<PDU>
<SetResponse>
  <SetResponseNormal>
    <InvokeIdAndPriority Value="129" />
    <Result Value="OtherReason" />
  </SetResponseNormal>
</SetResponse>
</PDU>
</HDLC>

07E3 03 1F 00 00 35 16 FF 003C 00
07e3 03 1f 00 00 35 16 ff 003c 00

07e3 03 0b 01 0c 2f 16 ff 003c 00

bbWriteU8(bb, t.tm_wday);
time_t tm_wday
should be 0xff;

should be:
Setting time: 2019-03-31T00:53:22.000+01:00 0
              2019-03-31T00:53:22.000+01:00 0


(gdb) p localNowTm
$1 = {tm_sec = 22, tm_min = 53, tm_hour = 23, tm_mday = 30, tm_mon = 2, tm_year = 119, tm_wday = 6,
  tm_yday = 88, tm_isdst = 0, tm_gmtoff = 0, tm_zone = 0x0}

(gdb) p t
$2 = {tm_sec = 22, tm_min = 53, tm_hour = 0, tm_mday = 31, tm_mon = 2, tm_year = 119, tm_wday = 0,
  tm_yday = 89, tm_isdst = 0, tm_gmtoff = 0, tm_zone = 0x0}


------------------------------------------

Profile read from Kaifa meter:

[ cndfs/utils] {   device}: Found metadata #0 for /mq/002.mq: id=19 st=320 sz=11053 refs=0
[   mqstorage] {   device}: Wrote m# 16284 of size 74 to file /mq/002.mq size 11053
[meter/kaifaMa304] {   device}: Profile 1-0:99.1.0*255: Fetching row 1827
[        hdlc] {   device}: tx: (1/1): 7e
[        hdlc] {   device}: tx: (1/1): a02d
[        hdlc] {   device}: tx: (1/1): 0201
[        hdlc] {   device}: tx: (1/1): 41
[        hdlc] {   device}: tx: (1/1): 76
[        hdlc] {   device}: tx: (1/1): 0d41
[        hdlc] {   device}: tx: (1/1): e6e600
[        hdlc] {   device}: tx: (1/2): c0018100070100630100ff0201020204
[        hdlc] {   device}: tx: (2/2): 06000007230600000723120000120000
[        hdlc] {   device}: tx: (1/1): c04f
[        hdlc] {   device}: tx: (1/1): 7e
[        hdlc] {     hdlc}: rx: (1/4): 7ea039410201962ba5e6e700c4018100
[        hdlc] {     hdlc}: rx: (2/4): 01010206090c07e3030c020e1e00ff00
[        hdlc] {     hdlc}: rx: (3/4): 3c001100060000000006000000000600
[        hdlc] {     hdlc}: rx: (4/4): 000000060000000000bb7e
[meter/kaifaMa304] {     hdlc}: dlmsReceiveCb called with s_rxRes=0
[meter/kaifaMa304] {     hdlc}: dlmsReceiveCb called with s_rxRes=0
[        hdlc] {     hdlc}: ** Waiting for HDLC event (60000ms) **
[meter/kaifaMa304] {   device}: Profile 1-0:99.1.0*255: Timestamp: 2019-03-12 14:30:00 at row 1827
[ dataProfile] {   device}: New data profile sample from 7340157030078388
[ cndfs/utils] {   device}: Found metadata #0 for /mq/002.mq: id=19 st=320 sz=11053 refs=0
[ cndfs/utils] {   device}: Found metadata #0 for /mq/002.mq: id=19 st=320 sz=11053 refs=0
[      fs/api] {   device}: fsOpen (/mq/002.mq, mode=3, fd=0)
[       cndfs] {   device}: Committing 76 B at 11053 (filesize 11053)
[  fs/service] {   device}: flashopProgram 323:0x0 40 B
[  fs/service] {   device}: flashopProgram 323:0xbaf 76 B
[ cndfs/utils] {   device}: Found metadata #0 for /mq/002.mq: id=19 st=320 sz=11129 refs=0
[   mqstorage] {   device}: Wrote m# 16285 of size 74 to file /mq/002.mq size 11129


--------------------------------------


// EM-DTR pin(PA4) is Meter output signal. When it is high level voltage, then
// Alarm Push is ready. Driver must request Alarm Mask from Meter on that.


// EM-CTS pin(PB0) is Driver output signal. When it is low level voltage, then Meter can
// trigger Alarm Push, otherwise Meter must postpone Alarm Push.



gpioSetInput(desc->ctsPin);
gpioSetOutput(desc->rtsPin, false);

void uartSetRts(int port, bool value)
bool uartGetCts(int port)

UART0:
rts = { gpioPortA, 5 }, cts = { gpioPortA, 4 }

UART1:


GPIO5 on dev board == alarm pin.

----------------------------------------

sudo mount -t cifs -o guest,vers=1.0  //192.168.2.1/RouterUSBDisk /mnt/RouterUSBDisk


----------------------------

       hdlc] {     hdlc}: rx: (1/3): 7ea02e0101102757e6e7000f40000000
[        hdlc] {     hdlc}: rx: (2/3): 090c07e3030d03111331ff8000000202
[        hdlc] {     hdlc}: rx: (3/3): 09060000616200ff06050060c574c97e


7ea02e0101102757e6e7000f40000000090c07e3030d03111331ff800000020209060000616200ff06050060c574c97e

ubuntu@ubuntu-VirtualBox:/Data/Projects/DLMSPlayground$ ./HDLCToPDU.py 7ea02e0101102757e6e7000f40000000090c07e3030d03111331ff800000020209060000616200ff06050060c574c97e
<HDLC>
  <controlField value="10" />
  <frameFormat value="a000,46" />
  <src value="1" />
  <dst value="1" />
  <LLC value="e6" />
  <HCS value="2757" />
  <PDU value="0f40000000090c07e3030d03111331ff800000020209060000616200ff06050060c5" />
  <FCS value="74c9" />
</HDLC>

Paste 0f40000000090c07e3030d03111331ff800000020209060000616200ff06050060c5 into a text file "t"

ubuntu@ubuntu-VirtualBox:/Data/Projects/DLMSPlayground$ python ParseAXDR.py t
   <Data>
     <Int8 offset="1">40</Int8>
     <OctetString offset="6" datetime="17:19:49:255 13/3/2019">07e3030d03111331ff800000</OctetString>
     <Structure length="2" offset="20">
     <Field index="0" offset="21">
       <OctetString offset="22">0000616200ff</OctetString>
     </Field>
     <Field index="1" offset="29">
       <Uint32 offset="30">050060c5</Float32>
     </Field>
     </Structure>
   </Data>

---------------------------------------------

Agent downsizing reduce size space

https://confluence.cyco.io/display/ENG/C4+Agent+downsizing

- remove log-ring
- ctrlport allocation of buffers (2x1280)? still there?
- WolfSSL uses around 14KB during handshake but settles down to ~2KB
- Removal of callbacks and their storage.
- RPL route storage.
- MAC neighbour table.
- Remove CoAP-BlockWise support.

--------------------------------------------

Wireshark encryption key:
https://confluence.cyco.io/display/ENG/flash+and+config+agent+on+hw1+and+ipa1?preview=/44007800/44007814/Screenshot%20from%202017-06-21%2017-22-57.png


Wireshark IEEE 802.15.4 preferences:
- Decryption key: c4:2a:c6:f7:5e:bc:3a:ff:5e:f3:db:91:8e:3d:69:0c
- TI CC24xx FCS format


DTR=C8=s_interruptPin=GPIO5
CTS=C9=s_alarmPushAllowPin=GPIO6



----------------------------------------------------------
git log v140..v148.1

P=PanMesh, O=OmniMesh

- P/O Time sync with Kafa MA304 with DST & timezone.
- P   Alarm polling for Kaifa on IPA3b.
- P/O HDLC/DLMS race condition in time sync fix.
- P/O No timesync in DST changeover window.
- P   Meter-upgrade protection against multiple simultaneous jobs.
- P/O Debugging improvements for filesystem issues.
-   O HPL driver implementation.
- P/O Prevent retries during time-sync to improve accuracy.
-   O Meter-upgrade events for job success.
- P   Node boot event on login shouldnt be repeated.
-   O Activity calendar on L&T LT/CT meters.
- P   Improve DLMS timeout mechanism.
- P/O Enter filesystem-safe-mode around known reset points.
- P/O Enable time-sync in pipe-mode.
-   O L&T LT/CT meters load-curtailment fix.
- P   HDLC inter-byte timing improvement for Kaifa.
-   O Synthesize first-breath without discovery crash fix.
-   O Meter-upgrade robustness improvements.
-   O Improved error reporting for meter-upgrade.
- P/O Fix for cron event around time-sync-adjustment causing extra sample reading.
- P/O Allow DLMS-pipe source-port changes in-session for compatibility with Kalkitech.
-   O L&T alarm fixes.
-   O Atomic payment display update.
-   O Add GET&SET current-limit configuration.
- P/O DLMS-pipe mode timeout changes to support push-association.
-   O Fix crash when DTLS times out during registration.
-   O Factory-mode writing of ipv6 address into meter.
-   O Load-curtailment on L&T 3ph meters.
-   O Prevent double samplings of IS.
-   O Fix week-profile parsing on L&T.
- P/O Fix filedl metadata parsing.
-   O Alarm-filter mask set with invalid bit.
- P/O Add pointer checks.
- P   Add support for IPA3b LEDs.
- P/O Prevent filesystem corruption with hard-power-off.
-   O Profile sampling improvements.
-   O L&T rate-calendar fixes.
-   O Change sampling from relative to absolute (cron) timing.
- P/O Enforce single in-flight request handling.
-   O Support for extended security on DLMS-side.
-   O Meter-configuuration get/set improvements.





- P/O Time sync with Kafa MA304 with DST & timezone. (CND-9058)
- P   Alarm polling for Kaifa on IPA3b (CND-9331).
- P/O HDLC/DLMS race condition in time sync fix (CND-9332).
- P/O No timesync in DST changeover window (CND-9333).
- P/O Prevent retries during time-sync to improve accuracy (CND-9285).
- P   Node boot event on login shouldnt be repeated (HMP-15).
- P/O Enable time-sync in pipe-mode (CND-9334).
- P   HDLC inter-byte timing improvement for Kaifa (CND-9232).
- P   Add support for IPA3b LEDs (CND-9335).
- P/O Prevent filesystem corruption with hard-power-off (CND-9266).



--------------------------------------

MA304H4 pinout.

EM-CTS = pin 7  ('allow event' signal from node)
EM-DTR = pin 11 (event interrupt from meter)



print('<HDLC>')
print('  <controlField value=\"%x\" />'%(controlField))
print('  <frameFormat value=\"%x,%d\" />'%(frameType,length))
print('  <src value=\"%x\" />'%(srcAddress))
print('  <dst value=\"%x\" />'%(dstAddress))
print('  <LLC value=\"%x\" />'%(LLC))
print('  <HCS value=\"%x\" />'%(HCS))
print('  <PDU value=\"%s\" />'%(binascii.hexlify(pdu)))
print('  <FCS value=\"%x\" />'%(FCS))
print('</HDLC>')

--------------------------------------


7ea03e0361327b46e6e600cb3030003e93820bc1d201afdda618d580dac69f0f236e0239fc85b8126ffffaad3e2a9d9ced9a19d14efaddb5e82534738c244e7e

7ea0376103520e3ae6e700cf293000016cea5846745b476df36cd700029f407edb6b66edb92ac6a256064aed0fa46404912b646e7be5cef27e

7ea0190341323abde6e600c0018100080000010000ff020065d77e

7ea01e410352054fe6e700c4018100090c07e3020105103728ff014a0009257e


7ea02d020141760d41e6e600c0018100070100630100ff02010202040600000eff0600000eff120000120000ac6d7e

7ea039410201962ba5e6e700c401810001010206090c07e30201050a0000ff800000110006000000000600000000060000000006000000000e597e


#7ea0376103520e3ae6e700   cf29 3000016cea5846745b476df36cd700029f407edb6b66edb92ac6a256064aed0fa46404912b646e7be5 cef2 7e
#7ea03e0361327b46e6e600   cb30 30003e93820bc1d201afdda618d580dac69f0f236e0239fc85b8126ffffaad3e2a9d9ced9a19d14efaddb5e82534738c 244e 7e
#7ea0190341323abde6e600   c001 81 00 08 0000010000ff 02 00 65d7 7e
#7ea02d020141760d41e6e600 c001 81 00 07 0100630100ff 02 01 02 0204 0600000eff 0600000eff 120000 120000 ac6d 7e


7ea02c03617cd617e6e600c81e30003ce8410f840010464cee62c2b453ef4641373bb230e34717b84322faf6097e

7ea8896103f6de4ce6e700cc81953000009439489b85f2144831dfe4bdb190fc99f5d00e7a07c79aa5145e2eef17188bf10c066f68a3c73757a905278e664e89df56df7ecce58b8fd5d4211ff3522f42501249af937b31b5929082eb3f5e1539cf369c63c42c8c32dfd0c21fa8bba2e6627212c081aaeaf380e9c048f5617e36afa300cdc4799bdf46397e



7ea8896103f6de4c e6e7 00 cc81953000 009439489b85f2144831dfe4bdb190fc 99f5d00e7a07c79aa5145e2eef17188b f10c066f68a3c73757a905278e664e89 df56df7ecce58b8fd5d4211ff3522f42 501249af937b31b5929082eb3f5e1539 cf369c63c42c8c32dfd0c21fa8bba2e6 627212c081aaeaf380e9c048f5617e36 afa300cdc4799bdf46397e


<HDLC len="136" >
<TargetAddress Value="48" />
<SourceAddress Value="1" />
<!--I frame.-->
<FrameType Value="F6" />
<NextFrame Value="CC81953000009439489B85F2144831DFE4BDB190FC99F5D00E7A07C79AA5145E2EEF17188BF10C066F68A3C73757A905278E664E89DF56DF7ECCE58B8FD5D4211FF3522F42501249AF937B31B5929082EB3F5E1539CF369C63C42C8C32DFD0C21FA8BBA2E6627212C081AAEAF380E9C048F5617E36AFA300CDC4799BDF" />
</HDLC>




7ea0200361931b9f8180140502008006020080070400000001080400000001ce6a7e
<HDLC len="31" >
<TargetAddress Value="1" />
<SourceAddress Value="48" />
<!--SNRM frame.-->
<FrameType Value="93" />
<PDU>
<Snrm>
  <MaxInfoTX Value="128" />
  <MaxInfoRX Value="128" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Snrm>
</PDU>
</HDLC>

7ea01e610373b57c818012050180060180070400000001080400000001533b7e7e
<HDLC len="29" >
<TargetAddress Value="48" />
<SourceAddress Value="1" />
<!--UA frame.-->
<FrameType Value="73" />
<PDU>
<Ua>
  <MaxInfoTX Value="128" />
  <MaxInfoRX Value="128" />
  <WindowSizeTX Value="1" />
  <WindowSizeRX Value="1" />
</Ua>
</PDU>
</HDLC>


7ea00703215303c77e
7e a007 03 2153 03c7 7e
<HDLC len="9" >
<TargetAddress Value="1" />
<SourceAddress Value="16" />
<!--S frame.-->
<FrameType Value="53" />
<DisconnectRequest>
</DisconnectRequest>
</HDLC>


7ea01e210373c37a818012050180060180070400000001080400000001533b7e

7ea00703215303c77e
<HDLC len="9" >
<TargetAddress Value="1" />
<SourceAddress Value="16" />
<!--S frame.-->
<FrameType Value="53" />
<DisconnectRequest>
</DisconnectRequest>
</HDLC>



---------------------------------------------------

gateway crash: receipt of packet with unknown indexes prior to s_mutex being setup, causing hard-fault.

Yen Hiew [2:39 PM]
(gdb) where
#0  0x0004a870 in vListInsert (pxList=pxList@entry=0x2000abcc <s_mutex+36>, pxNewListItem=0x2000c4bc <s_scheduleTask+24>) at build/3pp/freertos/FreeRTOS/Source/list.c:192
#1  0x0004b3da in vTaskPlaceOnEventList (pxEventList=pxEventList@entry=0x2000abcc <s_mutex+36>, xTicksToWait=120000) at build/3pp/freertos/FreeRTOS/Source/tasks.c:2860
#2  0x0004ad24 in xQueueGenericReceive (xQueue=xQueue@entry=0x2000aba8 <s_mutex>, pvBuffer=pvBuffer@entry=0x0, xTicksToWait=<optimized out>, xTicksToWait@entry=120000, xJustPeeking=xJustPeeking@entry=0)
   at build/3pp/freertos/FreeRTOS/Source/queue.c:1397
#3  0x0003965a in OS_mutexTake (m=m@entry=0x2000aba8 <s_mutex>) at src/platform/osal/osal-freertos/osal_freertos.c:365
#4  0x0002ca66 in mqStorageWrite (data=data@entry=0x20011260, size=17) at src/management/messagequeue/mqstorage.c:80
#5  0x0002d4a6 in mqCreateAtTime (type=type@entry=10, fields=fields@entry=0x66058 <MqEvent_fields>, msg=msg@entry=0x2000ca28 <s_scheduleTaskStack+1320>, time=837, timeUncertain=timeUncertain@entry=true)
   at src/management/messagequeue/mq.c:44
#6  0x0002d4f6 in mqCreate (type=type@entry=10, fields=0x66058 <MqEvent_fields>, msg=msg@entry=0x2000ca28 <s_scheduleTaskStack+1320>) at src/management/messagequeue/mq.c:64
#7  0x00028e14 in eventStore (event=event@entry=0x2000ca48 <s_scheduleTaskStack+1352>) at src/management/events/events.c:83
#8  0x0001cf7c in reportUnknownIndexes (id=<optimized out>, data=<optimized out>) at src/communication/mac/mac_security.c:475
#9  0x00032a3c in scheduleTask (arg=<optimized out>) at src/services/schedule/schedule_service.c:193
#10 0x0004b77c in pvTaskIncrementMutexHeldCount () at build/3pp/freertos/FreeRTOS/Source/tasks.c:4251
Backtrace stopped: previous frame identical to this frame (corrupt stack?)
(gdb) p event
$7 = {code = EVENT_MAC_UNKNOWNKEY, arg = {{string = 0x0, integer = 0, ipv6 = 0x0}, {string = 0x0, integer = 0, ipv6 = 0x0}, {string = 0x0, integer = 0, ipv6 = 0x0}}}

-------------------------------

Kaifa_ma304 -> ipa3b-kaifa


kaifa_ma304 v97.3 -> kaifa_ma304 v148.1


These deprecated items have been removed:

prod.terminal.id
prod.terminal.type
prod.iid.lowpan

terminal.version.fw
terminal.version.hw
terminal.latitude
terminal.longitude

amr.reading.interval
amr.powerswitch.admstate


These have been added:

rpl.routes.max
rpl.dao.deferred_ack

lowpan.channelplan

modem.uplink.gracetime
modem.username
modem.password
modem.authmethod
modem.pin
modem.uplink.max_failures_before_reset

monitor.profile.modem.enabled
monitor.profile.modem.sample.interval

device.dlms.data_profiles
device.time.set.enabled
device.instant.default_period
device.time.min_deviation
device.time.max_deviation
device.time.sync_timer
device.dlms.pipe_enabled
device.capabilities.dlmspipe.push
device.dataprofile.polling_period
device.dataprofile.polling_max_entries

node.power_fail.gracetime
node.node.production.rssisource.enabled
node.production.rssisource.power
node.production.rssisource.period
node.production.meter_update_period

capabilities.meter.reverse_ESW
capabilities.meter.device_testing
capabilities.meter.supports_Ipv6_setup
capabilities.meter.supports_payment_management
capabilities.dlmspipe.session_close_detection
capabilities.dlmspipe.session.source_port_change_allowed
capabilities.meter.time_update
capabilities.meter.timezone_set
capabilities.meter.dst_set


-------------------------------------------------------------

rpl.dis.trickle.doublings 4
rpl.br.dio.k 6
rpl.instance_id 0
rpl.br.routelife 1200
rpl.routes.max 10000
rpl.dao.deferred_ack 1
rpl.probe.doublings 6
rpl.dis.trickle.min.ms 10000
rpl.probe.interval.min.ms 1500
rpl.br.dio.imin 12
rpl.dag_switch.time 7200
rpl.dag_switch.hysteresis 150
rpl.br.ocp 1
rpl.mrhof.pp_hysteresis 75
rpl.br.dio.imax 8
rpl.etx.weight_factor 64
rpl.enabled 1
rpl.netsize_penalty 64


-----------------------------------------------------------------

In general, maintain existing high-level interfaces to maintain working IPA1/HW1 boards functionality.
Get interfaces in place and in-RAM functionality working quickly to enable early removal of CNDFS and SPI-FLASH drivers for RF testing.
Due to impact of changes, attempt to test/integrate-early.


- mqram (replacement for mqstorage). Quick win, immediate test for impact of resource-limited mq, frees up higher-level mods. Better model to base mq_internal_flash_storage on.

- Create Internal FLASH BlockDevice abstraction with partition table (FLASHPartition). (pgmflash.h, devicekeys_efr32, bl_fwimage).
- Make internal-FLASH driver usable concurrently with UART/Radio (Make executable region in SRAM for ISRs).
- Make mq_internal_flash using mqram as a model but using FLASHPartition as a backing-store.
- Make PersistentCircularBuffer as a simple circular buffer backed by FLASHPartition. CRC checked elements.
- Create a new config_backend to use a PersistentCircularBuffer in internal FLASH (2x2KB elements (currently 560b each), config_backend_pb variant that uses circ-buf).

- Move miscellaneous small files into config-storage (dlms_state/activity_report/dp_config/macsec_state).
- Move key storage into config-storage (agent_cert.der agent_key.der ca_cert.der mac_1 mac_2)... or is separate partition a better bet? Atomic configuration is good reason to have all in config.

- Create FileDistributionStorage on top of FLASHPartition (replacement for filedl_storage). Use a random starting point for a trivial wear-levelling mechanism.
- Make Bootloader read from FileDistributionStorage (bl_fwimage_fs) during upgrade.
- Make meter-upgrade read from FileDistributionStorage during image-transfer.
- Filedl will have to decrypt blocks during write to FLASH rather than current decrypt-file operation.
- NMS to encrypt blocks rather than file.

- Utility operations from ctrlporthub modified to restrict the 'erase' command, FLASH test, etc.

- Add server->agent message to set last-read-timestamp for each profile.
- SMA to determine last-read-timestamp from database.
- SMA to inform agent of last-read-timestamp for each profile during registration.
- SMA to perform sanity checks of samples prior to insertion in database. Number-of-fields, type of fields, sensible time-range etc.

- Cleanup. removal of cndfs, spi, flash-test, etc.

- (Optional) Move metrics to an unreliable model to reduce load on the (now resource limited) mq.
- (Optional) NMS to add metrics CoAP endpoint.

- (optional) Make FLASHEncryptedPartition from FLASHPartition (take a view on this, everything is on-device now so no external-bus access, keys already stored in internal-flash, devicekeys/fs_crypto).

- (optional) Add bad-block-management to FileDistributionStorage by making it a circular-buffer and CRC-checked elements.

- (optional) On-demand feature to use 'push-back' mechanism (i.e. set last-read-timestamp for profile) and let the normal operation take its course.


-----------------------------------------------------------------------------

gateway RPL improvement.

A gateways "attractiveness" to nodes should be reduced based on available cellular bandwidth.
Similar to the netsize_penalty confgurable which reduces the attractiveness of a gateway based
on the number of nodes, this would attempt to keep the node-load to a level that is actually
servicable by the mesh/uplink combination.
This was probably the intention behind the netsize_penalty in the first place but I'm not
convinced it would work that well in some cases, such as when a gateway has good mesh conditions
but bad cellular. This would in effect be a honey-pot situation where we're attracting all the
nodes to local-minimum. It may very well be that a neighbouring gateway may be able to service
the nodes better due to a better uplink despite a bad-mesh.


-------------------------------------------------------------

root@playground:~# certbot certonly --standalone -d tickle.email
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator standalone, Installer None
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for tickle.email
Waiting for verification...
Cleaning up challenges

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/tickle.email/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/tickle.email/privkey.pem
   Your cert will expire on 2019-06-21. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot
   again. To non-interactively renew *all* of your certificates, run
   "certbot renew"
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le

root@playground:~#


--------------------------------------------------------------------------

update sequence number on server.

select id from terminal where terminal_id="00-00-00-00-00-00-00-01";
update message_queue_state set start_seq_no=last_received_seq_no+1, receive_bit_set="", entity_version=entity_version+1 where node_id=<from above>

update message_queue_state set start_seq_no=1, last_received_seq_no=1, receive_bit_set="", entity_version=entity_version+1 where node_id=433;
update message_queue_state set entity_version=entity_version+1 where node_id=433;

update message_queue_state set start_seq_no=1, last_received_seq_no=1, receive_bit_set="", entity_version=entity_version+1 where node_id=4

-----------------------------------

MBus:

- To read a meter, the master issues a REQ_UD2 command string to the slave. The slave replies in a RSP_UD data
string, with the information previously selected by the master.

The REQ_UD2 data string (Request for User Data type 2) is a data string of the type “short -frame”, sent by the
master. It is composed of 5 bytes, by which the master asks the slave to send the previously selected information.
The structure of the data string is:
M®S: $10 $5B ADR CHK $16 where ADR = Primary address, CHK = ADR + $5B.
The ADR byte depend on address mode:
· Primary address: ADR specifies the bus number (between 1 and 250).
· Secondary address: ADR = $FD. The meter that is addressed must have been selected previously by a
SND_UD communication in which its secondary address has been specified.
· Point-to-point address: ADR=$FE. (See the limitations on usage given in section 5).
· Broadcast addressing within REQ_UD2 message is a nonsense.
For primary and point -to-point addressing, sending first a SND_UD is unnecessary. If no parameter has been explicitly
selected in a SND_UD communication, the slave will send at minimum the contents of its energy counter.
The receipt of a REQ_UD2 provokes a response from the slave in the form of a data string of type RSP_UD in which
the requested parameters are coded - see the following section.

Example:
Grouped reading of temperatures, power, flow rat e, date and hours in service for meter no. 03543109.
M>S: $68 $1D $1D $68 $53 $FD $51 $09 $31 $54 $03 $B4 $05 $FF $FF $FF $FF $FF $FF
$08 $2E $08 $3D $08 $5B $08 $5F $08 $63 $08 $22 $08 $6D $34 $16 (SND_UD)
S>M: $E5 (ACK)
M>S: $10 $5B $FD $58 $16 (REQ_UD2)
S>M: $68 $38 $38 $68 $08 $C8 $72 $09 $31 $54 $03 $B4 $05 $B0 $04 $C9 $10 $FF $FF $03 $22 $9A $00
$00 $05 $2E $A0 $C8 $51 $46 $05 $3E $B4 $E3 $D7 $42 $05 $5B $90 $D3 $07 $43 $05 $5F $0E $AA $E7 $41
$05 $63 $9C $BC $D5 $42 $04 $6D $10 $09 $05 $C5 $77 $16

The above RSP_UD data string, which contains neither DIFEs nor VIFEs, decodes as follows:
· Bus number: 200, manufacturer's number: 03543109.
· It concerns a Calec -MB, option Tariff (VER = 10110000b)
· There is no alarm state, but the lock -bit is not set (STAT = 00010000b)
· Hours in service (coded in binary in 3 bytes. DIF/VIF = $03/$22) = 154 ($00009A)
· Power (in kW, coded in floating point. DIF/VIF=$05/$2E) = 13426.2
· Flow rate (in m³/h, coded in floating point) = 107.945
· Warm side temperature (in °C, bytes $4307D390, coded in floating point) = 135.82
· Cold side temperature (°C) = 28.95
· Temperature difference (K) = 106.87
· Date/time (coded with F format): 5 May 96, 09h 16 mn.


----------------------------------------------

Laptop setup.

Install:
- Get latest coap_tools from Jenkins (https://jenkins.cyco.io/view/Terminal/job/Omnimesh_Terminal_Release/lastSuccessfulBuild/artifact/terminal/build/tools/release)
- Use a USB stick to copy c4-agent-tools to target machine home directory.
- Open terminal.
- "cd"
- "tar jxvf ~/c4-agent-tools.tar.bz2"
- "sudo apt install python3-pip libasan2"
- "pip3 install serial"


Running:
In one terminal, run one instance of "ctrlporthub" using USB-serial thats on "/dev/ttyUSB0":
- "cd c4-agent-tools"
- "./ctrlporthub -serial /dev/ttyUSB0"


In another terminal:
- "cd c4-agent-tools"
- "./coap_request --config-list"
- Then use whatever coap_request you like ("./coap_request --help")

Examples:
- "./coap_request.py --radio-test-id 7 --radio-send --radio-test-iid 02-1b-c5-0c-60-00-bc-2e --radio-test-power 54"
- "./coap_request.py --ctrlporthub localhost:4000 --config prod.lowpan.eui64 00-1B-C5-0C-60-00-01-84"


---------------------------

08f2af04122108f2aee5e4055a190a0708828010108d140a060883801010000a06088080241000123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099124008f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099040a0608868010123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099124008f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099040a0608868010123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099122108f2aee5e4055a190a0708828010108d140a060883801010000a06088080241000123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099124008f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099040a0608868010123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099124008f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099040a0608868010123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099122108f2aee5e4055a190a0708828010108d140a060883801010000a06088080241000123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a07088580101099123908f2aee5e4055a190a0708828010108d140a060883801010000a0608808024100008f2aee5e4055a310a0608848010100b0a070885801010991801


----------------------------------------------------------------


EN13757 m-bus.com
http://www.m-bus.com/
EN 13757-2 physical and link layer,
EN 13757-3 application layer for the remote reading of gas or electricity meters
EN1434-3 Data structures, data types, actions
IEC 870 transmission parameters, telegram formats, addressing, data integrity

libmbus: http://www.rscada.se/libmbus/ https://github.com/rscada/libmbus/tree/master/mbus
License: free to use, but must give attribution.
BSD 3-Clause License

https://github.com/rscada/libmbus/blob/master/mbus/mbus-protocol.c

http://www.m-bus.com/files/w4b21021.pdf

HMP/MBus work:

- targetting a PanMesh server to be compatible with Kaifa driver? Omni will be significantly different.
- Multiple devices (4) per agent.
- New protocol (MBus) to obtain data from meters.
- Scan for attached meters on startup.
- Server side must handle multiple devices per node. NMS will see one node, SMA will see many.
- sample data format in HMP format/special? dataProfileSampleCreate() sampleNextDataProfile() readProfileNEntries()
- Sending at saveDataProfileSample();
- Device abstraction is not properly abstracted, most methods dont take a deviceId.
- Discovery becomes a scan of the bus.
- Kaifa meter doesn't support profiles hash.
- MqDataProfileSample has deviceId field.
- Sample format is AXDR format structure from meter.
- deviceId in mq-message is taken from deviceId field in DataProfileSample.
- coapSendNodeRegistration()
- NodeRegistrationMessage: deviceHash could be hash over all detected meters, deviceAlarmHash tho is more device-specific as is globalProfileHash.
therefore use individual NodeRegistrationMessage messages, rather than one for all, should be renamed DeviceRegistrationMessage.
- Configuration needs to be split into node-specific and meter-specific. getParam-like calls such as getDeviceParam which take a deviceId.
- Configuration-UI work to split into node-specific and device-specific. Is this reflected in schema also?
- MaxDemand calculation.
- Single profile retrieval.
- Antenna switch control via configuration.
- On-demand request for data should be functional.
- licensing/activity is currently per-node, not per-meter?
- Rreset of billing, instantaneous, simple and enhanced billing possible.
- Read of serial number, identification number, version, fabrication number and manufacturer for name-plate.
- MBus types will generally map to AXDR types, BCD will need to be converted.
- Generally, use libmbus to read mbus format, translate into a DLMS/AXDR format profile structure using axdr fns, transfer up in normal dataprofile manner.
- Configuration: baud-rate,
- selective access can be done? maybe. may have to read all and filter internally.
- OBIS === DIF?
- Special parsing of BCD values (special codes for rollover, etc) that we need to parse into AXDR.
- Polling of alarms is time-critical.
- Translation of alarms into node-alarms.
- Time sync? DST, time zones?
- Need to allocate appropriate OBIS codes for MBus fields. There is some standardisation through EN1434 (I think).
- security? password field exists in doc.
- selective access performed by "storage number" in cyclic storage (index into circular buffer).
- "storage interval" == "capture period"
- Process of reading profile is to select DIFEs (one of which should be time) to read at a given storage-number (this is the unifying point).
- Need to define which parameters/DIFEs they want in a profile.
- reading of capture-period from meter.






PanMesh:
https://confluence.cyco.io/display/ENG/%5BDesignSpec%5D+C4+-+Device+management+add-on

Device discovery
The following outlines the device discovery procedure for the Connode server

A node sends the devices hash message to the server in about 3 minutes after login.
The server reads out the device hash property from the devices message.
If the device hash sent from the node is different from the hash stored by the server for the node.
The server sends a device list request to the node.
The node responds with a list of attached devices to the server together with the hash for those devices.
The server does the following for each device already stored in the database and associated with the node
If a device with the same device id is not found in the device list returned by the node
The device is disassociated from the node.
The server does the following for each device returned in the list
If a device with the same device id does not exist in the server database.
The server creates the device in the database and associates it with the node
Otherwise
If any of the properties received from the node does not match device properties in the database
The server updates the device in the database with the properties received from the node.
If the device is not associated with the node
The server associates the device with the node.
The server stores the device hash reported by the node in the database.

---------------------------------------

SMIP RLL Key estimation

- Table storage via CH API
- Table extraction from configuration
- Message from NMS to Agent to set the preferred key index?
- Send of KeyTableHash to server on login.

-   Agent needs to read a table of keys and a preferred key index from the CH instead of a single key. (Agent 3d when CH has support).
-   The process of distribution of the key-table and the application pf a key-table shall be separate operations.
Key-tables shall be identified by a hash (of their contents) in order to avoid application of inappropriate keys.
Use of configuration to distribute key-table & preferred key. Key-table hash separate from configuration-hash (3d).
-   Agent needs a timed activation of key-table to allow coordination of change-over (?).
-   Agent needs to send event to C4 server on key-change operations (1d).
-   Agent-side library integration API documentation (2d).
-   CH code will need updates to support key-table, and we need new code to integrate with (2d integration time for new code drop from Tosh).







Name    File_name   Comment
CA certificate  ca_demo-poc.crt.crt Import to Server DTLS domain/"Issuer Certificate" and Node DTLS domain/Trusted certificates
CA private key  ca_demo-poc.crt.key Optional, Import to Node DTLS domain/CA private key, only csr renew require this
Server certificate  omnitube-demo-poc.crt.pem   Import to Server DTLS domain/Certificate
Server private key  omnitube-demo-poc.key.pem   Import to Server DTLS domain/Private key
RSA private key rsa.priv    Import to Server Security Pair/Private key
RSA public key  rsa.pub Import to Server Security Pair/Public key
RSA private key password    rsa_pass.txt    Copy the content to Server Security Pair/Password


-----------------------------------------------

pgmflashWrite( MemBlock* )
pgmflashRead( MemBlock* )


mqramstorage->blockdevice->flashblockdevice
mqramstorage->blockdevice->flashpartitionblockdevice->flashblockdevice


--------------------------------------------------------

60000   bootloader
480000  running fw
480000  filedl
    2   activity_report
  438   configuration-1.pb
  133   device_alarms_profiles
    4   dlms_state
  197   dp_config
  786   dtls_state      (-CONFIG_DTLS_PERSISTENT_CACHE will remove this)
    4   macsec_state
  142   metering_profiles

  390   agent_cert.der
  121   agent_key.der
  554   ca_cert.der
   26   mac_1


CONFIG_DTLS_PERSISTENT_CACHE will remove dtls_state


---------------------------------------------------

ls build/ipa3-lnt-dlms-insecure/release/*.image

478344 agent-ipa3-lnt-dlms-insecure-v143-22-gd5957f567.image

454088 Apr  1 18:14 agent.bin*
 42440 Apr  1 18:14 bootloader.bin*


LTO saves 24KB firmaware & 11KB bootloader.

--- a/config/arch/arm-none-eabi-cortex_m3.mk
+++ b/config/arch/arm-none-eabi-cortex_m3.mk
@@ -14,6 +14,7 @@ execsuffix := .elf
 ARCH_CFLAGS += -mcpu=cortex-m3 -mthumb
 ARCH_CFLAGS += -mno-unaligned-access
 ARCH_CFLAGS += -Os
+ARCH_CFLAGS += -flto  -fverbose-asm

 # Use a non-semihosted C library
 ARCH_LDFLAGS += --specs=nosys.specs
@@ -21,6 +22,7 @@ ARCH_LDFLAGS += --specs=nosys.specs
 ARCH_LDFLAGS += --specs=nano.specs

 ARCH_LDFLAGS += -mcpu=cortex-m3 -mthumb -Lsrc/hw/cortex-m3
+ARCH_LDFLAGS += -flto  -fverbose-asm -save-temps

 # Add the Definition for FreeRTOS ARM Cortex M3
 ARCH_CPPFLAGS += -DGCC_ARMCM3
diff --git a/src/hw/cortex-m3/startup.c b/src/hw/cortex-m3/startup.c
index d1ae06a1f..7d0076792 100644
--- a/src/hw/cortex-m3/startup.c
+++ b/src/hw/cortex-m3/startup.c
@@ -69,7 +69,7 @@ static uint8_t stack[__STACK_SIZE] __attribute__ ((aligned(8), used, section(".s
 /*----------------------------------------------------------------------------
   Reset Handler called on controller reset
  *----------------------------------------------------------------------------*/
-void Reset_Handler(void)
+void __attribute__((__used__)) Reset_Handler(void)
 {
   // First, copy data from read only memory to RAM.
   uint32_t* pDest = &__data_start__;


-----------------------------------

Removing DTLS session cache:

CONFIG_DTLS_PERSISTENT_CACHE=n

452808 Apr  1 18:34 agent.bin*


--------------------------------

No change.
CONFIG_STRIP_BINARIES=y


452808 Apr  1 18:42 agent.bin*
 42440 Apr  1 18:42 bootloader.bin*



---------------------------

(Good change)

CONFIG_FS_SECURE=n
CONFIG_REMOTE_MEMORY=n

 449464 Apr  1 18:45 agent.bin*
  34516 Apr  1 18:45 bootloader.bin*


-------------------------------------

Secure and no flash-test/erase in prodmode-common.c

446900 Apr  1 19:23 agent.bin*
 34516 Apr  1 19:23 bootloader.bin*

------------------------------------------------

-fwhole-program (No change).
-ffunction-sections, --fdata-sections and --gc-sections no change.

446900 Apr  1 19:27 agent.bin*
 34516 Apr  1 19:27 bootloader.bin*

-----------------------------------------

CONFIG_BUILD_AGENTLIB=n

445612 Apr  1 20:53 agent.bin*
 34516 Apr  1 20:53 bootloader.bin*


----------------------------------------------

 ARCH_CFLAGS += -flto  -fverbose-asm -fwhole-program  -fno-exceptions  -Xlinker -Map=output.map
 18
 19 # Use a non-semihosted C library
 20 ARCH_LDFLAGS += --specs=nosys.specs
 21 # Use Newlib-nano, which leaves out support for float printf and other features
 22 ARCH_LDFLAGS += --specs=nano.specs
 23
 24 ARCH_LDFLAGS += -mcpu=cortex-m3 -mthumb -Lsrc/hw/cortex-m3
 25 ARCH_LDFLAGS += -flto  -fverbose-asm -save-temps -fwhole-program -Xlinker -Map=output.map
 26

-------------------------------------------------

Things to remove:

- cndfs
- CONFIG_FLASH_SPI
- CONFIG_FLASH_SPI25
- CONFIG_STORAGE_FLASH
- CONFIG_FS_CNDFS
- CONFIG_FS_SECURE
- CONFIG_POWERSWITCH
- PanMesh
- debug text (68KB)


--------------------------------------------

message queue in flash:
dd if=/dev/zero of=pgmFlash.bin bs=1024 count=1024
od -j 921728 -A x -v -t x1 pgmFlash.bin





